<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Bjarne Stroustrup" />
  <meta name="description" content="&lt;div&gt;&lt;p&gt;In &lt;strong&gt; &lt;em&gt;A Tour of C++, Second Edition,&lt;/em&gt; &lt;/strong&gt; Bjarne Stroustrup, the creator of C++, describes what constitutes modern C++. This concise, self-contained guide covers most major language features and the major standard-library components—not, of course, in great depth, but to a level that gives programmers a meaningful overview of the language, some key examples, and practical help in getting started.&lt;/p&gt;
&lt;p&gt;Stroustrup presents the C++ features in the context of the programming styles they support, such as object-oriented and generic programming. His tour is remarkably comprehensive. Coverage begins with the basics, then ranges widely through more advanced topics, including many that are new in C++17, such as move semantics, uniform initialization, lambda expressions, improved containers, random numbers, and concurrency. The tour even covers some extensions being made for C++20, such as concepts and modules, and ends with a discussion of the design and evolution of C++.&lt;/p&gt;
&lt;p&gt;This guide does not aim to teach you how to program (for that, see Stroustrup’s &lt;em&gt;Programming: Principles and Practice Using C++, Second Edition&lt;/em&gt;), nor will it be the only resource you’ll need for C++ mastery (for that, see Stroustrup’s &lt;em&gt;The C++ Programming Language, Fourth Edition,&lt;/em&gt; and recommended online sources). If, however, you are a C or C++ programmer wanting greater familiarity with the current C++ language, or a programmer versed in another language wishing to gain an accurate picture of the nature and benefits of modern C++, you can’t find a shorter or simpler introduction than this tour provides.&lt;/p&gt;
&lt;p&gt;**&lt;/p&gt;&lt;/div&gt;" />
  <title>A Tour of C++ (2nd Edition) (C++ In-Depth Series)</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">A Tour of C++ (2nd Edition) (C++ In-Depth Series)</h1>
<p class="author">Bjarne Stroustrup</p>
<p class="date">2018-07-09T04:00:00+00:00</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#part0000.html#pref00">About This eBook</a></li>
<li><a href="#part0002.html#calibre_pb_0"><span
id="part0002.html#page_iii" class="calibre2 pagebreak"></span>A Tour of
C++<br />
Second Edition</a></li>
<li><a href="#part0004.html#toc"><span id="part0004.html#page_v"
class="calibre2 pagebreak"></span>Contents</a></li>
<li><a href="#part0006.html#ch01"><span id="part0006.html#page_1"
class="calibre2 pagebreak"></span><span class="big">1</span></a>
<ul>
<li><a href="#part0006.html#ch01lev1sec1">1.1 Introduction</a></li>
<li><a href="#part0006.html#ch01lev1sec2"><span
id="part0006.html#page_2" class="calibre2 pagebreak"></span>1.2
Programs</a></li>
<li><a href="#part0006.html#ch01lev1sec3"><span
id="part0006.html#page_4" class="calibre2 pagebreak"></span>1.3
Functions</a></li>
<li><a href="#part0006.html#ch01lev1sec4">1.4 Types, Variables, and
Arithmetic</a></li>
<li><a href="#part0006.html#ch01lev1sec5"><span
id="part0006.html#page_9" class="calibre2 pagebreak"></span>1.5 Scope
and Lifetime</a></li>
<li><a href="#part0006.html#ch01lev1sec6">1.6 Constants</a></li>
<li><a href="#part0006.html#ch01lev1sec7"><span
id="part0006.html#page_11" class="calibre2 pagebreak"></span>1.7
Pointers, Arrays, and References</a></li>
<li><a href="#part0006.html#ch01lev1sec8">1.8 Tests</a></li>
<li><a href="#part0006.html#ch01lev1sec9">1.9 Mapping to
Hardware</a></li>
<li><a href="#part0006.html#ch01lev1sec10">1.10 Advice</a></li>
</ul></li>
<li><a href="#part0007.html#ch02"><span id="part0007.html#page_21"
class="calibre2 pagebreak"></span><span class="big">2</span></a>
<ul>
<li><a href="#part0007.html#ch02lev1sec1">2.1 Introduction</a></li>
<li><a href="#part0007.html#ch02lev1sec2">2.2 Structures</a></li>
<li><a href="#part0007.html#ch02lev1sec3">2.3 Classes</a></li>
<li><a href="#part0007.html#ch02lev1sec4">2.4 Unions</a></li>
<li><a href="#part0007.html#ch02lev1sec5">2.5 Enumerations</a></li>
<li><a href="#part0007.html#ch02lev1sec6">2.6 Advice</a></li>
</ul></li>
<li><a href="#part0008.html#ch03"><span id="part0008.html#page_29"
class="calibre2 pagebreak"></span><span class="big">3</span></a>
<ul>
<li><a href="#part0008.html#ch03lev1sec1">3.1 Introduction</a></li>
<li><a href="#part0008.html#ch03lev1sec2">3.2 Separate
Compilation</a></li>
<li><a href="#part0008.html#ch03lev1sec3">3.3 Modules (C++20)</a></li>
<li><a href="#part0008.html#ch03lev1sec4">3.4 Namespaces</a></li>
<li><a href="#part0008.html#ch03lev1sec5">3.5 Error Handling</a></li>
<li><a href="#part0008.html#ch03lev1sec6">3.6 Function Arguments and
Return Values</a></li>
<li><a href="#part0008.html#ch03lev1sec7"><span
id="part0008.html#page_46" class="calibre2 pagebreak"></span>3.7
Advice</a></li>
</ul></li>
<li><a href="#part0009.html#ch04"><span id="part0009.html#page_47"
class="calibre2 pagebreak"></span><span class="big">4</span></a>
<ul>
<li><a href="#part0009.html#ch04lev1sec1">4.1 Introduction</a></li>
<li><a href="#part0009.html#ch04lev1sec2">4.2 Concrete Types</a></li>
<li><a href="#part0009.html#ch04lev1sec3"><span
id="part0009.html#page_54" class="calibre2 pagebreak"></span>4.3
Abstract Types</a></li>
<li><a href="#part0009.html#ch04lev1sec4">4.4 Virtual Functions</a></li>
<li><a href="#part0009.html#ch04lev1sec5">4.5 Class Hierarchies</a></li>
<li><a href="#part0009.html#ch04lev1sec6">4.6 Advice</a></li>
</ul></li>
<li><a href="#part0010.html#ch05"><span id="part0010.html#page_65"
class="calibre2 pagebreak"></span><span class="big">5</span></a>
<ul>
<li><a href="#part0010.html#ch05lev1sec1">5.1 Introduction</a></li>
<li><a href="#part0010.html#ch05lev1sec2">5.2 Copy and Move</a></li>
<li><a href="#part0010.html#ch05lev1sec3">5.3 Resource
Management</a></li>
<li><a href="#part0010.html#ch05lev1sec4">5.4 Conventional
Operations</a></li>
<li><a href="#part0010.html#ch05lev1sec5"><span
id="part0010.html#page_77" class="calibre2 pagebreak"></span>5.5
Advice</a></li>
</ul></li>
<li><a href="#part0011.html#ch06"><span id="part0011.html#page_79"
class="calibre2 pagebreak"></span><span class="big">6</span></a>
<ul>
<li><a href="#part0011.html#ch06lev1sec1">6.1 Introduction</a></li>
<li><a href="#part0011.html#ch06lev1sec2">6.2 Parameterized
Types</a></li>
<li><a href="#part0011.html#ch06lev1sec3">6.3 Parameterized
Operations</a></li>
<li><a href="#part0011.html#ch06lev1sec4">6.4 Template
Mechanisms</a></li>
<li><a href="#part0011.html#ch06lev1sec5">6.5 Advice</a></li>
</ul></li>
<li><a href="#part0012.html#ch07"><span id="part0012.html#page_93"
class="calibre2 pagebreak"></span><span class="big">7</span></a>
<ul>
<li><a href="#part0012.html#ch07lev1sec1">7.1 Introduction</a></li>
<li><a href="#part0012.html#ch07lev1sec2">7.2 Concepts (C++20)</a></li>
<li><a href="#part0012.html#ch07lev1sec3">7.3 Generic
Programming</a></li>
<li><a href="#part0012.html#ch07lev1sec4">7.4 Variadic
Templates</a></li>
<li><a href="#part0012.html#ch07lev1sec5"><span
id="part0012.html#page_104" class="calibre2 pagebreak"></span>7.5
Template Compilation Model</a></li>
<li><a href="#part0012.html#ch07lev1sec6">7.6 Advice</a></li>
</ul></li>
<li><a href="#part0013.html#ch08"><span id="part0013.html#page_107"
class="calibre2 pagebreak"></span><span class="big">8</span></a>
<ul>
<li><a href="#part0013.html#ch08lev1sec1">8.1 Introduction</a></li>
<li><a href="#part0013.html#ch08lev1sec2">8.2 Standard-Library
Components</a></li>
<li><a href="#part0013.html#ch08lev1sec3"><span
id="part0013.html#page_109" class="calibre2 pagebreak"></span>8.3
Standard-Library Headers and Namespace</a></li>
<li><a href="#part0013.html#ch08lev1sec4">8.4 Advice</a></li>
</ul></li>
<li><a href="#part0014.html#ch09"><span id="part0014.html#page_111"
class="calibre2 pagebreak"></span><span class="big">9</span></a>
<ul>
<li><a href="#part0014.html#ch09lev1sec1">9.1 Introduction</a></li>
<li><a href="#part0014.html#ch09lev1sec2">9.2 Strings</a></li>
<li><a href="#part0014.html#ch09lev1sec3">9.3 String Views</a></li>
<li><a href="#part0014.html#ch09lev1sec4"><span
id="part0014.html#page_116" class="calibre2 pagebreak"></span>9.4
Regular Expressions</a></li>
<li><a href="#part0014.html#ch09lev1sec5"><span
id="part0014.html#page_122" class="calibre2 pagebreak"></span>9.5
Advice</a></li>
</ul></li>
<li><a href="#part0015.html#ch10"><span id="part0015.html#page_123"
class="calibre2 pagebreak"></span><span class="big">10</span></a>
<ul>
<li><a href="#part0015.html#ch10lev1sec1">10.1 Introduction</a></li>
<li><a href="#part0015.html#ch10lev1sec2">10.2 Output</a></li>
<li><a href="#part0015.html#ch10lev1sec3">10.3 Input</a></li>
<li><a href="#part0015.html#ch10lev1sec4">10.4 I/O State</a></li>
<li><a href="#part0015.html#ch10lev1sec5"><span
id="part0015.html#page_128" class="calibre2 pagebreak"></span>10.5 I/O
of User-Defined Types</a></li>
<li><a href="#part0015.html#ch10lev1sec6">10.6 Formatting</a></li>
<li><a href="#part0015.html#ch10lev1sec7">10.7 File Streams</a></li>
<li><a href="#part0015.html#ch10lev1sec8">10.8 String Streams</a></li>
<li><a href="#part0015.html#ch10lev1sec9">10.9 C-style I/O</a></li>
<li><a href="#part0015.html#ch10lev1sec10">10.10 File System</a></li>
<li><a href="#part0015.html#ch10lev1sec11"><span
id="part0015.html#page_136" class="calibre2 pagebreak"></span>10.11
Advice</a></li>
</ul></li>
<li><a href="#part0016.html#ch11"><span id="part0016.html#page_137"
class="calibre2 pagebreak"></span><span class="big">11</span></a>
<ul>
<li><a href="#part0016.html#ch11lev1sec1">11.1 Introduction</a></li>
<li><a href="#part0016.html#ch11lev1sec2"><span
id="part0016.html#page_138" class="calibre2 pagebreak"></span>11.2 <code
class="calibre17">vector</code></a></li>
<li><a href="#part0016.html#ch11lev1sec3">11.3 <code
class="calibre17">list</code></a></li>
<li><a href="#part0016.html#ch11lev1sec4"><span
id="part0016.html#page_144" class="calibre2 pagebreak"></span>11.4 <code
class="calibre17">map</code></a></li>
<li><a href="#part0016.html#ch11lev1sec5">11.5 <code
class="calibre17">unordered_map</code></a></li>
<li><a href="#part0016.html#ch11lev1sec6">11.6 Container
Overview</a></li>
<li><a href="#part0016.html#ch11lev1sec7"><span
id="part0016.html#page_148" class="calibre2 pagebreak"></span>11.7
Advice</a></li>
</ul></li>
<li><a href="#part0017.html#ch12"><span id="part0017.html#page_149"
class="calibre2 pagebreak"></span><span class="big">12</span></a>
<ul>
<li><a href="#part0017.html#ch12lev1sec1">12.1 Introduction</a></li>
<li><a href="#part0017.html#ch12lev1sec2">12.2 Use of Iterators</a></li>
<li><a href="#part0017.html#ch12lev1sec3">12.3 Iterator Types</a></li>
<li><a href="#part0017.html#ch12lev1sec4">12.4 Stream Iterators</a></li>
<li><a href="#part0017.html#ch12lev1sec5">12.5 Predicates</a></li>
<li><a href="#part0017.html#ch12lev1sec6">12.6 Algorithm
Overview</a></li>
<li><a href="#part0017.html#ch12lev1sec7">12.7 Concepts (C++20)</a></li>
<li><a href="#part0017.html#ch12lev1sec8">12.8 Container
Algorithms</a></li>
<li><a href="#part0017.html#ch12lev1sec9">12.9 Parallel
Algorithms</a></li>
<li><a href="#part0017.html#ch12lev1sec10">12.10 Advice</a></li>
</ul></li>
<li><a href="#part0018.html#ch13"><span id="part0018.html#page_163"
class="calibre2 pagebreak"></span><span class="big">13</span></a>
<ul>
<li><a href="#part0018.html#ch13lev1sec1">13.1 Introduction</a></li>
<li><a href="#part0018.html#ch13lev1sec2"><span
id="part0018.html#page_164" class="calibre2 pagebreak"></span>13.2
Resource Management</a></li>
<li><a href="#part0018.html#ch13lev1sec3">13.3 Range Checking: <code
class="calibre17">gsl::span</code></a></li>
<li><a href="#part0018.html#ch13lev1sec4">13.4 Specialized
Containers</a></li>
<li><a href="#part0018.html#ch13lev1sec5">13.5 Alternatives</a></li>
<li><a href="#part0018.html#ch13lev1sec6"><span
id="part0018.html#page_178" class="calibre2 pagebreak"></span>13.6
Allocators</a></li>
<li><a href="#part0018.html#ch13lev1sec7">13.7 Time</a></li>
<li><a href="#part0018.html#ch13lev1sec8"><span
id="part0018.html#page_180" class="calibre2 pagebreak"></span>13.8
Function Adaption</a></li>
<li><a href="#part0018.html#ch13lev1sec9">13.9 Type Functions</a></li>
<li><a href="#part0018.html#ch13lev1sec10"><span
id="part0018.html#page_185" class="calibre2 pagebreak"></span>13.10
Advice</a></li>
</ul></li>
<li><a href="#part0019.html#ch14"><span id="part0019.html#page_187"
class="calibre2 pagebreak"></span><span class="big">14</span></a>
<ul>
<li><a href="#part0019.html#ch14lev1sec1">14.1 Introduction</a></li>
<li><a href="#part0019.html#ch14lev1sec2"><span
id="part0019.html#page_188" class="calibre2 pagebreak"></span>14.2
Mathematical Functions</a></li>
<li><a href="#part0019.html#ch14lev1sec3"><span
id="part0019.html#page_189" class="calibre2 pagebreak"></span>14.3
Numerical Algorithms</a></li>
<li><a href="#part0019.html#ch14lev1sec4">14.4 Complex Numbers</a></li>
<li><a href="#part0019.html#ch14lev1sec5"><span
id="part0019.html#page_191" class="calibre2 pagebreak"></span>14.5
Random Numbers</a></li>
<li><a href="#part0019.html#ch14lev1sec6">14.6 Vector
Arithmetic</a></li>
<li><a href="#part0019.html#ch14lev1sec7">14.7 Numeric Limits</a></li>
<li><a href="#part0019.html#ch14lev1sec8">14.8 Advice</a></li>
</ul></li>
<li><a href="#part0020.html#ch15"><span id="part0020.html#page_195"
class="calibre2 pagebreak"></span><span class="big">15</span></a>
<ul>
<li><a href="#part0020.html#ch15lev1sec1">15.1 Introduction</a></li>
<li><a href="#part0020.html#ch15lev1sec2">15.2 Tasks and <code
class="calibre17">thread</code>s</a></li>
<li><a href="#part0020.html#ch15lev1sec3">15.3 Passing
Arguments</a></li>
<li><a href="#part0020.html#ch15lev1sec4">15.4 Returning
Results</a></li>
<li><a href="#part0020.html#ch15lev1sec5"><span
id="part0020.html#page_199" class="calibre2 pagebreak"></span>15.5
Sharing Data</a></li>
<li><a href="#part0020.html#ch15lev1sec6">15.6 Waiting for
Events</a></li>
<li><a href="#part0020.html#ch15lev1sec7">15.7 Communicating
Tasks</a></li>
<li><a href="#part0020.html#ch15lev1sec8">15.8 Advice</a></li>
</ul></li>
<li><a href="#part0021.html#ch16"><span id="part0021.html#page_207"
class="calibre2 pagebreak"></span><span class="big">16</span></a>
<ul>
<li><a href="#part0021.html#ch16lev1sec1">16.1 History</a></li>
<li><a href="#part0021.html#ch16lev1sec2">16.2 C++ Feature
Evolution</a></li>
<li><a href="#part0021.html#ch16lev1sec3">16.3 C/C++
Compatibility</a></li>
<li><a href="#part0021.html#ch16lev1sec4">16.4 Bibliography</a></li>
<li><a href="#part0021.html#ch16lev1sec5">16.5 Advice</a></li>
</ul></li>
<li><a href="#part0022.html#index"><span id="part0022.html#page_227"
class="calibre2 pagebreak"></span><span class="big">I</span></a>
<ul>
<li>Token</li>
<li>A</li>
<li>B</li>
<li>C</li>
<li>D</li>
<li>E</li>
<li>F</li>
<li>G</li>
<li>H</li>
<li><span id="part0022.html#page_233"
class="calibre2 pagebreak"></span>I</li>
<li>J</li>
<li>K</li>
<li>L</li>
<li>M</li>
<li>N</li>
<li>O</li>
<li>P</li>
<li>R</li>
<li>S</li>
<li>T</li>
<li>U</li>
<li>V</li>
<li>W</li>
<li>X</li>
<li>Z</li>
</ul></li>
<li><a href="#part0023.html#credit"><span id="part0023.html#page_240"
class="calibre2 pagebreak"></span>Credits</a></li>
<li><a href="#part0025_split_000.html#ch01_images">Code
Snippets</a></li>
</ul>
</nav>
<p><img src="cover.jpeg" /></p>
<p><span id="titlepage.xhtml"></span></p>
<div>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="100%" height="100%" viewbox="0 0 800 996" preserveaspectratio="none">
<image width="800" height="996" xlink:href="cover.jpeg"></image>
</svg>
</div>
<p><span id="part0000.html"></span></p>
<h2 class="h2a" id="part0000.html#pref00">About This eBook</h2>
<p>ePUB is an open, industry-standard format for eBooks. However,
support of ePUB and its many features varies across reading devices and
applications. Use your device or app settings to customize the
presentation to your liking. Settings that you can customize often
include font, font size, single or double column, landscape or portrait
mode, and figures that you can click or tap to enlarge. For additional
information about the settings and features on your reading device or
app, visit the device manufacturer’s Web site.</p>
<p>Many titles include programming code or configuration examples. To
optimize the presentation of these elements, view the eBook in
single-column, landscape mode and adjust the font size to the smallest
setting. In addition to presenting code and configurations in the
reflowable text format, we have included images of the code that mimic
the presentation found in the print book; therefore, where the
reflowable format may compromise the presentation of the code listing,
you will see a “Click here to view code image” link. Click the link to
view the print-fidelity code image. To return to the previous page
viewed, click the Back button on your device or app.</p>
<p><span id="part0001.html"></span></p>
<section class="frontmatter">
<div class="image">
<span id="part0001.html#page_ii" class="pagebreak"></span><img
src="images/00001.jpeg" class="calibre1" alt="Image" />
</div>
</section>
<p><span id="part0002.html"></span></p>
<section id="part0002.html#calibre_pb_0" class="h frontmatter">
<h1 class="h"><span id="part0002.html#page_iii"
class="calibre2 pagebreak"></span>A Tour of C++<br />
Second Edition</h1>
<p><strong>Bjarne Stroustrup</strong></p>
<p><img src="images/00002.jpeg" class="calibre1" alt="Image" /></p>
<p>Boston • Columbus • New York • San Francisco • Amsterdam • Cape
Town<br />
Dubai • London • Madrid • Milan • Munich • Paris • Montreal • Toronto •
Delhi • Mexico City<br />
São Paulo • Sydney • Hong Kong • Seoul • Singapore • Taipei • Tokyo</p>
</section>
<p><span id="part0003.html"></span></p>
<section class="frontmatter">
<p><span id="part0003.html#page_iv" class="pagebreak"></span>Many of the
designations used by manufacturers and sellers to distinguish their
products are claimed as trademarks. Where those designations appear in
this book, and the publisher was aware of a trademark claim, the
designations have been printed with initial capital letters or in all
capitals.</p>
<p>The author and publisher have taken care in the preparation of this
book, but make no expressed or implied warranty of any kind and assume
no responsibility for errors or omissions. No liability is assumed for
incidental or consequential damages in connection with or arising out of
the use of the information or programs contained herein.</p>
<p>For information about buying this title in bulk quantities, or for
special sales opportunities (which may include electronic versions;
custom cover designs; and content particular to your business, training
goals, marketing focus, or branding interests), please contact our
corporate sales department at <a href="mailto:corpsales@pearsoned.com"
class="calibre6">corpsales@pearsoned.com</a> or (800) 382-3419.</p>
<p>For government sales inquiries, please contact <a
href="mailto:governmentsales@pearsoned.com"
class="calibre6">governmentsales@pearsoned.com</a>.</p>
<p>For questions about sales outside the U.S., please contact <a
href="mailto:intlcs@pearson.com"
class="calibre6">intlcs@pearson.com</a>.</p>
<p>Visit us on the Web: <a href="http://informit.com/aw"
class="calibre6">informit.com/aw</a></p>
<p>Library of Congress Control Number: 2018941627</p>
<p>Copyright © 2018 by Pearson Education, Inc.</p>
<p>All rights reserved. This publication is protected by copyright, and
permission must be obtained from the publisher prior to any prohibited
reproduction, storage in a retrieval system, or transmission in any form
or by any means, electronic, mechanical, photocopying, recording, or
likewise. For information regarding permissions, request forms and the
appropriate contacts within the Pearson Education Global Rights &amp;
Permissions Department, please visit <a
href="http://www.pearsoned.com/permissions/"
class="calibre6">www.pearsoned.com/permissions/</a>.</p>
<p>This book was typeset in Times and Helvetica by the author.</p>
<p>ISBN-13: 978-0-13-499783-4<br />
ISBN-10: 0-13-499783-2<br />
First printing, June 2018<br />
1   18</p>
</section>
<p><span id="part0004.html"></span></p>
<section id="part0004.html#toc" class="h2a frontmatter">
<h2 class="h2a"><span id="part0004.html#page_v"
class="calibre2 pagebreak"></span>Contents</h2>
<p><a href="#part0005.html#preface"
class="calibre6"><strong>Preface</strong></a></p>
<p><a href="#part0006.html#ch01" class="calibre6"><strong>1 The
Basics</strong></a></p>
<p><a href="#part0006.html#ch01lev1sec1"
class="calibre6">1.1     Introduction</a></p>
<p><a href="#part0006.html#ch01lev1sec2"
class="calibre6">1.2     Programs</a></p>
<p><a href="#part0006.html#ch01lev1sec3"
class="calibre6">1.3     Functions</a></p>
<p><a href="#part0006.html#ch01lev1sec4" class="calibre6">1.4     Types,
Variables, and Arithmetic</a></p>
<p><a href="#part0006.html#ch01lev1sec5" class="calibre6">1.5     Scope
and Lifetime</a></p>
<p><a href="#part0006.html#ch01lev1sec6"
class="calibre6">1.6     Constants</a></p>
<p><a href="#part0006.html#ch01lev1sec7"
class="calibre6">1.7     Pointers, Arrays, and References</a></p>
<p><a href="#part0006.html#ch01lev1sec8"
class="calibre6">1.8     Tests</a></p>
<p><a href="#part0006.html#ch01lev1sec9"
class="calibre6">1.9     Mapping to Hardware</a></p>
<p><a href="#part0006.html#ch01lev1sec10"
class="calibre6">1.10   Advice</a></p>
<p><a href="#part0007.html#ch02" class="calibre6"><strong>2 User-Defined
Types</strong></a></p>
<p><a href="#part0007.html#ch02lev1sec1"
class="calibre6">2.1     Introduction</a></p>
<p><a href="#part0007.html#ch02lev1sec2"
class="calibre6">2.2     Structures</a></p>
<p><a href="#part0007.html#ch02lev1sec3"
class="calibre6">2.3     Classes</a></p>
<p><a href="#part0007.html#ch02lev1sec4"
class="calibre6">2.4     Unions</a></p>
<p><a href="#part0007.html#ch02lev1sec5"
class="calibre6">2.5     Enumerations</a></p>
<p><a href="#part0007.html#ch02lev1sec6"
class="calibre6">2.6     Advice</a></p>
<p><span id="part0004.html#page_vi" class="pagebreak"></span><a
href="#part0008.html#ch03" class="calibre6"><strong>3
Modularity</strong></a></p>
<p><a href="#part0008.html#ch03lev1sec1"
class="calibre6">3.1     Introduction</a></p>
<p><a href="#part0008.html#ch03lev1sec2"
class="calibre6">3.2     Separate Compilation</a></p>
<p><a href="#part0008.html#ch03lev1sec3"
class="calibre6">3.3     Modules (C++20)</a></p>
<p><a href="#part0008.html#ch03lev1sec4"
class="calibre6">3.4     Namespaces</a></p>
<p><a href="#part0008.html#ch03lev1sec5" class="calibre6">3.5     Error
Handling</a></p>
<p><a href="#part0008.html#ch03lev1sec6"
class="calibre6">3.6     Function Arguments and Return Values</a></p>
<p><a href="#part0008.html#ch03lev1sec7"
class="calibre6">3.7     Advice</a></p>
<p><a href="#part0009.html#ch04" class="calibre6"><strong>4
Classes</strong></a></p>
<p><a href="#part0009.html#ch04lev1sec1"
class="calibre6">4.1     Introduction</a></p>
<p><a href="#part0009.html#ch04lev1sec2"
class="calibre6">4.2     Concrete Types</a></p>
<p><a href="#part0009.html#ch04lev1sec3"
class="calibre6">4.3     Abstract Types</a></p>
<p><a href="#part0009.html#ch04lev1sec4"
class="calibre6">4.4     Virtual Functions</a></p>
<p><a href="#part0009.html#ch04lev1sec5" class="calibre6">4.5     Class
Hierarchies</a></p>
<p><a href="#part0009.html#ch04lev1sec6"
class="calibre6">4.7     Advice</a></p>
<p><a href="#part0010.html#ch05" class="calibre6"><strong>5 Essential
Operations</strong></a></p>
<p><a href="#part0010.html#ch05lev1sec1"
class="calibre6">5.1     Introduction</a></p>
<p><a href="#part0010.html#ch05lev1sec2" class="calibre6">5.2     Copy
and Move</a></p>
<p><a href="#part0010.html#ch05lev1sec3"
class="calibre6">5.3     Resource Management</a></p>
<p><a href="#part0010.html#ch05lev1sec4"
class="calibre6">5.4     Conventional Operations</a></p>
<p><a href="#part0010.html#ch05lev1sec5"
class="calibre6">5.5     Advice</a></p>
<p><a href="#part0011.html#ch06" class="calibre6"><strong>6
Templates</strong></a></p>
<p><a href="#part0011.html#ch06lev1sec1"
class="calibre6">6.1     Introduction</a></p>
<p><a href="#part0011.html#ch06lev1sec2"
class="calibre6">6.2     Parameterized Types</a></p>
<p><a href="#part0011.html#ch06lev1sec3"
class="calibre6">6.3     Parameterized Operations</a></p>
<p><a href="#part0011.html#ch06lev1sec4"
class="calibre6">6.4     Template Mechanisms</a></p>
<p><a href="#part0011.html#ch06lev1sec5"
class="calibre6">6.5     Advice</a></p>
<p><a href="#part0012.html#ch07" class="calibre6"><strong>7 Concepts and
Generic Programming</strong></a></p>
<p><a href="#part0012.html#ch07lev1sec1"
class="calibre6">7.1     Introduction</a></p>
<p><a href="#part0012.html#ch07lev1sec2"
class="calibre6">7.2     Concepts</a></p>
<p><a href="#part0012.html#ch07lev1sec3"
class="calibre6">7.3     Generic Programming</a></p>
<p><a href="#part0012.html#ch07lev1sec4"
class="calibre6">7.4     Variadic Templates</a></p>
<p><a href="#part0012.html#ch07lev1sec5"
class="calibre6">7.5     Template Compilation Model</a></p>
<p><a href="#part0012.html#ch07lev1sec6"
class="calibre6">7.6     Advice</a></p>
<p><span id="part0004.html#page_vii" class="pagebreak"></span><a
href="#part0013.html#ch08" class="calibre6"><strong>8 Library
Overview</strong></a></p>
<p><a href="#part0013.html#ch08lev1sec1"
class="calibre6">8.1     Introduction</a></p>
<p><a href="#part0013.html#ch08lev1sec2"
class="calibre6">8.2     Standard-Library Components</a></p>
<p><a href="#part0013.html#ch08lev1sec3"
class="calibre6">8.3     Standard-Library Headers and Namespace</a></p>
<p><a href="#part0013.html#ch08lev1sec4"
class="calibre6">8.4     Advice</a></p>
<p><a href="#part0014.html#ch09" class="calibre6"><strong>9 Strings and
Regular Expressions</strong></a></p>
<p><a href="#part0014.html#ch09lev1sec1"
class="calibre6">9.1     Introduction</a></p>
<p><a href="#part0014.html#ch09lev1sec2"
class="calibre6">9.2     Strings</a></p>
<p><a href="#part0014.html#ch09lev1sec3" class="calibre6">9.3     String
Views</a></p>
<p><a href="#part0014.html#ch09lev1sec4"
class="calibre6">9.4     Regular Expressions</a></p>
<p><a href="#part0014.html#ch09lev1sec5"
class="calibre6">9.5     Advice</a></p>
<p><a href="#part0015.html#ch10" class="calibre6"><strong>10 Input and
Output</strong></a></p>
<p><a href="#part0015.html#ch10lev1sec1"
class="calibre6">10.1   Introduction</a></p>
<p><a href="#part0015.html#ch10lev1sec2"
class="calibre6">10.2   Output</a></p>
<p><a href="#part0015.html#ch10lev1sec3"
class="calibre6">10.3   Input</a></p>
<p><a href="#part0015.html#ch10lev1sec4" class="calibre6">10.4   I/O
State</a></p>
<p><a href="#part0015.html#ch10lev1sec5" class="calibre6">10.5   I/O of
User-Defined Types</a></p>
<p><a href="#part0015.html#ch10lev1sec6"
class="calibre6">10.6   Formatting</a></p>
<p><a href="#part0015.html#ch10lev1sec7" class="calibre6">10.7   File
Streams</a></p>
<p><a href="#part0015.html#ch10lev1sec8" class="calibre6">10.8   String
Streams</a></p>
<p><a href="#part0015.html#ch10lev1sec9" class="calibre6">10.9   C-style
I/O</a></p>
<p><a href="#part0015.html#ch10lev1sec10" class="calibre6">10.10 File
System</a></p>
<p><a href="#part0015.html#ch10lev1sec11" class="calibre6">10.11
Advice</a></p>
<p><a href="#part0016.html#ch11" class="calibre6"><strong>11
Containers</strong></a></p>
<p><a href="#part0016.html#ch11lev1sec1"
class="calibre6">11.1   Introduction</a></p>
<p><a href="#part0016.html#ch11lev1sec2" class="calibre6">11.2   <code
class="calibre8">vector</code></a></p>
<p><a href="#part0016.html#ch11lev1sec3" class="calibre6">11.3   <code
class="calibre8">list</code></a></p>
<p><a href="#part0016.html#ch11lev1sec4" class="calibre6">11.4   <code
class="calibre8">map</code></a></p>
<p><a href="#part0016.html#ch11lev1sec5" class="calibre6">11.5   <code
class="calibre8">unordered_map</code></a></p>
<p><a href="#part0016.html#ch11lev1sec6"
class="calibre6">11.6   Container Overview</a></p>
<p><a href="#part0016.html#ch11lev1sec7"
class="calibre6">11.7   Advice</a></p>
<p><a href="#part0017.html#ch12" class="calibre6"><strong>12
Algorithms</strong></a></p>
<p><a href="#part0017.html#ch12lev1sec1"
class="calibre6">12.1   Introduction</a></p>
<p><a href="#part0017.html#ch12lev1sec2" class="calibre6">12.2   Use of
Iterators</a></p>
<p><a href="#part0017.html#ch12lev1sec3"
class="calibre6">12.3   Iterator Types</a></p>
<p><span id="part0004.html#page_viii" class="pagebreak"></span><a
href="#part0017.html#ch12lev1sec4" class="calibre6">12.4   Stream
Iterators</a></p>
<p><a href="#part0017.html#ch12lev1sec5"
class="calibre6">12.5   Predicates</a></p>
<p><a href="#part0017.html#ch12lev1sec6"
class="calibre6">12.6   Algorithm Overview</a></p>
<p><a href="#part0017.html#ch12lev1sec7"
class="calibre6">12.7   Concepts (C++20)</a></p>
<p><a href="#part0017.html#ch12lev1sec8"
class="calibre6">12.8   Container Algorithms</a></p>
<p><a href="#part0017.html#ch12lev1sec9"
class="calibre6">12.9   Parallel Algorithms</a></p>
<p><a href="#part0017.html#ch12lev1sec10" class="calibre6">12.10
Advice</a></p>
<p><a href="#part0018.html#ch13" class="calibre6"><strong>13
Utilities</strong></a></p>
<p><a href="#part0018.html#ch13lev1sec1"
class="calibre6">13.1   Introduction</a></p>
<p><a href="#part0018.html#ch13lev1sec2"
class="calibre6">13.2   Resource Management</a></p>
<p><a href="#part0018.html#ch13lev1sec3" class="calibre6">13.3   Range
Checking: <code class="calibre8">span</code></a></p>
<p><a href="#part0018.html#ch13lev1sec4"
class="calibre6">13.4   Specialized Containers</a></p>
<p><a href="#part0018.html#ch13lev1sec5"
class="calibre6">13.5   Alternatives</a></p>
<p><a href="#part0018.html#ch13lev1sec6"
class="calibre6">13.6   Allocators</a></p>
<p><a href="#part0018.html#ch13lev1sec7"
class="calibre6">13.7   Time</a></p>
<p><a href="#part0018.html#ch13lev1sec8"
class="calibre6">13.8   Function Adaption</a></p>
<p><a href="#part0018.html#ch13lev1sec9" class="calibre6">13.9   Type
Functions</a></p>
<p><a href="#part0018.html#ch13lev1sec10" class="calibre6">13.10
Advice</a></p>
<p><a href="#part0019.html#ch14" class="calibre6"><strong>14
Numerics</strong></a></p>
<p><a href="#part0019.html#ch14lev1sec1"
class="calibre6">14.1   Introduction</a></p>
<p><a href="#part0019.html#ch14lev1sec2"
class="calibre6">14.2   Mathematical Functions</a></p>
<p><a href="#part0019.html#ch14lev1sec3"
class="calibre6">14.3   Numerical Algorithms</a></p>
<p><a href="#part0019.html#ch14lev1sec4" class="calibre6">14.4   Complex
Numbers</a></p>
<p><a href="#part0019.html#ch14lev1sec5" class="calibre6">14.5   Random
Numbers</a></p>
<p><a href="#part0019.html#ch14lev1sec6" class="calibre6">14.6   Vector
Arithmetic</a></p>
<p><a href="#part0019.html#ch14lev1sec7" class="calibre6">14.7   Numeric
Limits</a></p>
<p><a href="#part0019.html#ch14lev1sec8"
class="calibre6">14.8   Advice</a></p>
<p><a href="#part0020.html#ch15" class="calibre6"><strong>15
Concurrency</strong></a></p>
<p><a href="#part0020.html#ch15lev1sec1"
class="calibre6">15.1   Introduction</a></p>
<p><a href="#part0020.html#ch15lev1sec2" class="calibre6">15.2   Tasks
and <code class="calibre8">thread</code>s</a></p>
<p><a href="#part0020.html#ch15lev1sec3" class="calibre6">15.3   Passing
Arguments</a></p>
<p><a href="#part0020.html#ch15lev1sec4"
class="calibre6">15.4   Returning Results</a></p>
<p><a href="#part0020.html#ch15lev1sec5" class="calibre6">15.5   Sharing
Data</a></p>
<p><a href="#part0020.html#ch15lev1sec6" class="calibre6">15.6   Waiting
for Events</a></p>
<p><a href="#part0020.html#ch15lev1sec7"
class="calibre6">15.7   Communicating Tasks</a></p>
<p><a href="#part0020.html#ch15lev1sec8"
class="calibre6">15.8   Advice</a></p>
<p><span id="part0004.html#page_ix" class="pagebreak"></span><a
href="#part0021.html#ch16" class="calibre6"><strong>16 History and
Compatibility</strong></a></p>
<p><a href="#part0021.html#ch16lev1sec1"
class="calibre6">16.1   History</a></p>
<p><a href="#part0021.html#ch16lev1sec2" class="calibre6">16.2   C++
Feature Evolution</a></p>
<p><a href="#part0021.html#ch16lev1sec3" class="calibre6">16.3   C/C++
Compatibility</a></p>
<p><a href="#part0021.html#ch16lev1sec4"
class="calibre6">16.4   Bibliography</a></p>
<p><a href="#part0021.html#ch16lev1sec5"
class="calibre6">16.5   Advice</a></p>
<p><a href="#part0022.html#index"
class="calibre6"><strong>Index</strong></a></p>
<p><a href="#part0023.html#credit"
class="calibre6"><strong>Credits</strong></a></p>
</section>
<p><span id="part0005.html"></span></p>
<section id="part0005.html#4OIQ1-45139367ee894f48ad66c5795ec73c38"
class="frontmatter">
<h2 class="h2a" id="part0005.html#preface"><span
id="part0005.html#page_xi"
class="calibre2 pagebreak"></span>Preface</h2>
<p><em>When you wish to instruct, be brief.</em></p>
<p><em>– Cicero</em></p>
<p>C++ feels like a new language. That is, I can express my ideas more
clearly, more simply, and more directly today than I could in C++98.
Furthermore, the resulting programs are better checked by the compiler
and run faster.</p>
<p>This book gives an overview of C++ as defined by C++17, the current
ISO C++ standard, and implemented by the major C++ suppliers. In
addition, it mentions concepts and modules, as defined in ISO Technical
Specifications and in current use, but not scheduled for inclusion into
the standard until C++20.</p>
<p>Like other modern languages, C++ is large and there are a large
number of libraries needed for effective use. This thin book aims to
give an experienced programmer an idea of what constitutes modern C++.
It covers most major language features and the major standard-library
components. This book can be read in just a few hours but, obviously,
there is much more to writing good C++ than can be learned in a day.
However, the aim here is not mastery, but to give an overview, to give
key examples, and to help a programmer get started.</p>
<p>The assumption is that you have programmed before. If not, please
consider reading a textbook, such as <em>Programming: Principles and
Practice Using C++ (Second edition)</em> [<a href="#part0021.html#ref59"
class="calibre6">Stroustrup,2014</a>], before continuing here. Even if
you have programmed before, the language you used or the applications
you wrote may be very different from the style of C++ presented
here.</p>
<p>Think of a sightseeing tour of a city, such as Copenhagen or New
York. In just a few hours, you are given a quick peek at the major
attractions, told a few background stories, and given some suggestions
about what to do next. You do <em>not</em> know the city after such a
tour. You do <em>not</em> understand all you have seen and heard. You do
<em>not</em> know how to navigate the formal and informal rules that
govern life in the city. To really know a city, you have to live in it,
often for years. However, with a bit of luck, you will have gained a bit
of an overview, a notion of what is special about the city, and ideas of
what might be of interest to you. After the tour, the real exploration
can begin.</p>
<p><span id="part0005.html#page_xii" class="pagebreak"></span>This tour
presents the major C++ language features as they support programming
styles, such as object-oriented and generic programming. It does not
attempt to provide a detailed, reference-manual, feature-by-feature view
of the language. In the best textbook tradition, I try to explain a
feature before I use it, but that is not always possible and not
everybody reads the text strictly sequentially. So, the reader is
encouraged to use the cross references and the index.</p>
<p>Similarly, this tour presents the standard libraries in terms of
examples, rather than exhaustively. It does not describe libraries
beyond those defined by the ISO standard. The reader can search out
supporting material as needed. [<a href="#part0021.html#ref58"
class="calibre6">Stroustrup,2013</a>] and [<a
href="#part0021.html#ref59" class="calibre6">Stroustrup,2014</a>] are
examples of such material, but there is an enormous amount of material
(of varying quality) available on the Web, e.g., [<a
href="#part0021.html#ref13" class="calibre6">Cppreference</a>]. For
example, when I mention a standard-library function or class, its
definition can easily be looked up, and by examining its documentation,
many related facilities can be found.</p>
<p>This tour presents C++ as an integrated whole, rather than as a layer
cake. Consequently, it does not identify language features as present in
C, part of C++98, or new in C++11, C++14, or C++17. Such information can
be found in <a href="#part0021.html#ch16" class="calibre6">Chapter
16</a> (History and Compatibility). I focus on fundamentals and try to
be brief, but I have not completely resisted the temptation to
overrepresent novel features. This also seems to satisfy the curiosity
of many readers who already know some older version of C++.</p>
<p>A programming language reference manual or standard simply states
what can be done, but programmers are often more interested in learning
how to use the language well. This aspect is partly addressed in the
selection of topics covered, partly in the text, and specifically in the
advice sections. More advice about what constitutes <em>good modern</em>
C++ can be found in the C++ Core Guidelines [<a
href="#part0021.html#ref60" class="calibre6">Stroustrup,2015</a>]. The
core guidelines can be a good source for further exploration of the
ideas presented in this book. You may note a remarkable similarity of
the advice formulation and even the numbering of advice between the Core
Guidelines and this book. One reason is that the first edition of <em>A
Tour of C++</em> was a major source of the initial Core Guidelines.</p>
<h3 class="h3a" id="part0005.html#preflev1sec1">Acknowledgments</h3>
<p>Some of the material presented here is borrowed from TC++PL4 [<a
href="#part0021.html#ref58" class="calibre6">Stroustrup,2013</a>], so
thanks to all who helped completing that book.</p>
<p>Thanks to all who help complete and correct the first edition of “A
Tour of C++.”</p>
<p>Thanks to Morgan Stanley for giving me time to write this second
edition. Thanks to the Columbia University Spring 2018 “Design Using
C++” class for finding many a typo and bug in an early draft of this
book and for making many constructive suggestions.</p>
<p>Thanks to Paul Anderson, Chuck Allison, Peter Gottschling, William
Mons, Charles Wilson, and Sergey Zubkov for reviewing the book and
suggesting many improvements.</p>
<p><em>Bjarne Stroustrup</em></p>
<p><em>Manhattan, New York</em></p>
</section>
<p><span id="part0006.html"></span></p>
<section id="part0006.html#ch01" class="h1 bodymatter">
<h2 class="h1"><span id="part0006.html#page_1"
class="calibre2 pagebreak"></span><span class="big">1</span></h2>
<p>The Basics</p>
<p><em>The first thing we do, let’s kill all the language
lawyers.</em></p>
<p><em>– Henry VI, Part II</em></p>
<ul>
<li><p><a href="#part0006.html#ch01lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0006.html#ch01lev1sec2"
class="calibre6">Programs</a></p>
<p><a href="#part0006.html#ch01lev2sec1" class="calibre6">Hello,
World!</a></p></li>
<li><p><a href="#part0006.html#ch01lev1sec3"
class="calibre6">Functions</a></p></li>
<li><p><a href="#part0006.html#ch01lev1sec4" class="calibre6">Types,
Variables, and Arithmetic</a></p>
<p><a href="#part0006.html#ch01lev2sec2"
class="calibre6">Arithmetic</a>; <a href="#part0006.html#ch01lev2sec3"
class="calibre6">Initialization</a></p></li>
<li><p><a href="#part0006.html#ch01lev1sec5" class="calibre6">Scope and
Lifetime</a></p></li>
<li><p><a href="#part0006.html#ch01lev1sec6"
class="calibre6">Constants</a></p></li>
<li><p><a href="#part0006.html#ch01lev1sec7" class="calibre6">Pointers,
Arrays, and References</a></p>
<p><a href="#part0006.html#ch01lev2sec4" class="calibre6">The Null
Pointer</a></p></li>
<li><p><a href="#part0006.html#ch01lev1sec8"
class="calibre6">Tests</a></p></li>
<li><p><a href="#part0006.html#ch01lev1sec9" class="calibre6">Mapping to
Hardware</a></p>
<p><a href="#part0006.html#ch01lev2sec5"
class="calibre6">Assignment</a>; <a href="#part0006.html#ch01lev2sec6"
class="calibre6">Initialization</a></p></li>
<li><p><a href="#part0006.html#ch01lev1sec10"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0006.html#ch01lev1sec1">1.1 Introduction</h3>
<p>This chapter informally presents the notation of C++, C++’s model of
memory and computation, and the basic mechanisms for organizing code
into a program. These are the language facilities supporting the styles
most often seen in C and sometimes called <em>procedural
programming</em>.</p>
<h3 class="h2" id="part0006.html#ch01lev1sec2"><span
id="part0006.html#page_2" class="calibre2 pagebreak"></span>1.2
Programs</h3>
<p>C++ is a compiled language. For a program to run, its source text has
to be processed by a compiler, producing object files, which are
combined by a linker yielding an executable program. A C++ program
typically consists of many source code files (usually simply called
<em>source files</em>).</p>
<figure>
<img src="images/00003.jpeg" class="calibre1" />
</figure>
<p>An executable program is created for a specific hardware/system
combination; it is not portable, say, from a Mac to a Windows PC. When
we talk about portability of C++ programs, we usually mean portability
of source code; that is, the source code can be successfully compiled
and run on a variety of systems.</p>
<p>The ISO C++ standard defines two kinds of entities:</p>
<ul>
<li><p><em>Core language features</em>, such as built-in types (e.g.,
<code class="calibre8">char</code> and <code
class="calibre8">int</code>) and loops (e.g., <code
class="calibre8">for</code>-statements and <code
class="calibre8">while</code>-statements)</p></li>
<li><p><em>Standard-library components</em>, such as containers (e.g.,
<code class="calibre8">vector</code> and <code
class="calibre8">map</code>) and I/O operations (e.g., <code
class="calibre8">&lt;&lt;</code> and <code
class="calibre8">getline()</code>)</p></li>
</ul>
<p>The standard-library components are perfectly ordinary C++ code
provided by every C++ implementation. That is, the C++ standard library
can be implemented in C++ itself and is (with very minor uses of machine
code for things such as thread context switching). This implies that C++
is sufficiently expressive and efficient for the most demanding systems
programming tasks.</p>
<p>C++ is a statically typed language. That is, the type of every entity
(e.g., object, value, name, and expression) must be known to the
compiler at its point of use. The type of an object determines the set
of operations applicable to it.</p>
<h4 class="h3" id="part0006.html#ch01lev2sec1">1.2.1 Hello, World!</h4>
<p>The minimal C++ program is</p>
<p><a href="#part0025_split_001.html#p0002_01a"
id="part0006.html#p0002_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>int main() <span class="kw">{</span> <span class="kw">}</span> <span class="fu">//</span>        the minimal <span class="dt">C</span>++ program</span></code></pre></div>
<p>This defines a function called <code class="calibre8">main</code>,
which takes no arguments and does nothing.</p>
<p>Curly braces, <code class="calibre8">{ }</code>, express grouping in
C++. Here, they indicate the start and end of the function body. The
double slash, <code class="calibre8">//</code>, begins a comment that
extends to the end of the line. A comment is for the human reader; the
compiler ignores comments.</p>
<p>Every C++ program must have exactly one global function named <code
class="calibre8">main()</code>. The program starts by executing that
function. The <code class="calibre8">int</code> integer value returned
by <code class="calibre8">main()</code>, if any, is the program’s return
value to “the system.” If no value is returned, the system will receive
a value indicating successful completion. A nonzero value from <code
class="calibre8">main()</code> indicates failure. Not every operating
system and execution environment make use of that return value:
Linux/Unix-based environments do, but Windows-based environments rarely
do.</p>
<p><span id="part0006.html#page_3" class="pagebreak"></span>Typically, a
program produces some output. Here is a program that writes <code
class="calibre8">Hello, World!</code>:</p>
<p><a href="#part0025_split_002.html#p0003_01a"
id="part0006.html#p0003_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>#<span class="al">include</span> <span class="dt">&lt;</span>iostream<span class="er">&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>int main()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>     std::cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">Hello</span><span class="ot">,</span><span class="er"> World</span><span class="ot">!</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The line <code class="calibre8">#include &lt;iostream&gt;</code>
instructs the compiler to <em>include</em> the declarations of the
standard stream I/O facilities as found in <code
class="calibre8">iostream</code>. Without these declarations, the
expression</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>std::cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">Hello</span><span class="ot">,</span><span class="er"> World</span><span class="ot">!</span><span class="ch">\n</span><span class="ot">&quot;</span></span></code></pre></div>
<p>would make no sense. The operator <code
class="calibre8">&lt;&lt;</code> (“put to”) writes its second argument
onto its first. In this case, the string literal <code
class="calibre8">"Hello, World!\n"</code> is written onto the standard
output stream <code class="calibre8">std::cout</code>. A string literal
is a sequence of characters surrounded by double quotes. In a string
literal, the backslash character <code class="calibre8">\</code>
followed by another character denotes a single “special character.” In
this case, <code class="calibre8">\n</code> is the newline character, so
that the characters written are <code
class="calibre8">Hello, World!</code> followed by a newline.</p>
<p>The <code class="calibre8">std::</code> specifies that the name <code
class="calibre8">cout</code> is to be found in the standard-library
namespace (§<a href="#part0008.html#ch03lev1sec4"
class="calibre6">3.4</a>). I usually leave out the <code
class="calibre8">std::</code> when discussing standard features; §<a
href="#part0008.html#ch03lev1sec4" class="calibre6">3.4</a> shows how to
make names from a namespace visible without explicit qualification.</p>
<p>Essentially all executable code is placed in functions and called
directly or indirectly from <code class="calibre8">main()</code>. For
example:</p>
<p><a href="#part0025_split_003.html#p0003_02a"
id="part0006.html#p0003_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>#<span class="al">include</span> <span class="dt">&lt;</span>iostream<span class="er">&gt;</span>          <span class="fu">//</span> <span class="al">include</span> (<span class="ot">&quot;</span><span class="er">import</span><span class="ot">&quot;</span>) the declarations for the <span class="dt">I</span><span class="fu">/</span><span class="dt">O</span> stream library</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>using namespace std<span class="kw">;</span>         <span class="fu">//</span> make names from std visible without std:: (<span class="er">§</span><span class="fl">3.4</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>double square(double x)      <span class="fu">//</span> square a double precision floating<span class="fu">-</span>point <span class="dt">number</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    return x<span class="fu">*</span>x<span class="kw">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>void print_square(double x)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">the square of</span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> x <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">is</span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> square(x) <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>int main()</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    print_square(<span class="fl">1.234</span>)<span class="kw">;</span>    <span class="fu">//</span> print<span class="fu">:</span> the square of <span class="fl">1.234</span> <span class="dt">is</span> <span class="fl">1.52276</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>A “return type” <code class="calibre8">void</code> indicates that a
function does not return a value.</p>
<h3 class="h2" id="part0006.html#ch01lev1sec3"><span
id="part0006.html#page_4" class="calibre2 pagebreak"></span>1.3
Functions</h3>
<p>The main way of getting something done in a C++ program is to call a
function to do it. Defining a function is the way you specify how an
operation is to be done. A function cannot be called unless it has been
previously declared.</p>
<p>A function declaration gives the name of the function, the type of
the value returned (if any), and the number and types of the arguments
that must be supplied in a call. For example:</p>
<p><a href="#part0025_split_004.html#p0004_01a"
id="part0006.html#p0004_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Elem</span><span class="fu">*</span> next_elem()<span class="kw">;</span>      <span class="fu">//</span> no argument<span class="kw">;</span> return a pointer to <span class="dt">Elem</span> (an <span class="dt">Elem</span><span class="fu">*</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>void exit(int)<span class="kw">;</span>         <span class="fu">//</span> int argument<span class="kw">;</span> return nothing</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>double sqrt(double)<span class="kw">;</span>    <span class="fu">//</span> double argument<span class="kw">;</span> return a double</span></code></pre></div>
<p>In a function declaration, the return type comes before the name of
the function and the argument types come after the name enclosed in
parentheses.</p>
<p>The semantics of argument passing are identical to the semantics of
initialization (§<a href="#part0008.html#ch03lev2sec6"
class="calibre6">3.6.1</a>). That is, argument types are checked and
implicit argument type conversion takes place when necessary (§<a
href="#part0006.html#ch01lev1sec4" class="calibre6">1.4</a>). For
example:</p>
<p><a href="#part0025_split_005.html#p0004_02a"
id="part0006.html#p0004_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>double s2 <span class="kw">=</span> sqrt(<span class="dv">2</span>)<span class="kw">;</span>           <span class="fu">//</span> <span class="kw">call</span> sqrt() with the argument double<span class="kw">{</span><span class="dv">2</span><span class="kw">}</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>double s3 <span class="kw">=</span> sqrt(<span class="ot">&quot;</span><span class="er">three</span><span class="ot">&quot;</span>)<span class="kw">;</span>     <span class="fu">//</span> error<span class="fu">:</span> sqrt() requires an argument of type double</span></code></pre></div>
<p>The value of such compile-time checking and type conversion should
not be underestimated.</p>
<p>A function declaration may contain argument names. This can be a help
to the reader of a program, but unless the declaration is also a
function definition, the compiler simply ignores such names. For
example:</p>
<p><a href="#part0025_split_006.html#p0004_03a"
id="part0006.html#p0004_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>double sqrt(double d)<span class="kw">;</span>  <span class="fu">//</span> return the square root of d</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>double square(double)<span class="kw">;</span>  <span class="fu">//</span> return the square of the argument</span></code></pre></div>
<p>The type of a function consists of its return type and the sequence
of its argument types. For example:</p>
<p><a href="#part0025_split_007.html#p0004_04a"
id="part0006.html#p0004_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>double get(const vector<span class="dt">&lt;</span>double&gt;&amp; vec<span class="kw">,</span> int index)<span class="kw">;</span>     <span class="fu">//</span> type<span class="fu">:</span> double(const vector<span class="dt">&lt;</span>double&gt;&amp;<span class="kw">,</span>int)</span></code></pre></div>
<p>A function can be the member of a class (§<a
href="#part0007.html#ch02lev1sec3" class="calibre6">2.3</a>, §<a
href="#part0009.html#ch04lev2sec1" class="calibre6">4.2.1</a>). For such
a <em>member function</em>, the name of its class is also part of the
function type. For example:</p>
<p><a href="#part0025_split_008.html#p0004_05a"
id="part0006.html#p0004_05" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>char&amp; <span class="dt">String</span>::operator[](int index)<span class="kw">;</span>                <span class="fu">//</span> type<span class="fu">:</span> char&amp; <span class="dt">String</span>::(int)</span></code></pre></div>
<p>We want our code to be comprehensible, because that is the first step
on the way to maintainability. The first step to comprehensibility is to
break computational tasks into meaningful chunks (represented as
functions and classes) and name those. Such functions then provide the
basic vocabulary of computation, just as the types (built-in and
user-defined) provide the basic vocabulary of data. The C++ standard
algorithms (e.g., <code class="calibre8">find</code>, <code
class="calibre8">sort</code>, and <code class="calibre8">iota</code>)
provide a good start (<a href="#part0017.html#ch12"
class="calibre6">Chapter 12</a>). Next, we can compose functions
representing common or specialized tasks into larger computations.</p>
<p>The number of errors in code correlates strongly with the amount of
code and the complexity of the code. Both problems can be addressed by
using more and shorter functions. Using a function to do a specific task
often saves us from writing a specific piece of code in the middle of
other code; making it a function forces us to name the activity and
document its dependencies.</p>
<p>If two functions are defined with the same name, but with different
argument types, the compiler will choose the most appropriate function
to invoke for each call. For example:</p>
<p><a href="#part0025_split_009.html#p0005_01a"
id="part0006.html#p0005_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>void print(int)<span class="kw">;</span>     <span class="fu">//</span> takes an <span class="dt">integer</span> argument</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>void print(double)<span class="kw">;</span>  <span class="fu">//</span> takes a floating<span class="fu">-</span>point argument</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>void print(string)<span class="kw">;</span>  <span class="fu">//</span> takes a string argument</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>void user()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>     print(<span class="dv">42</span>)<span class="kw">;</span>               <span class="fu">//</span> calls print(int)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>     print(<span class="fl">9.65</span>)<span class="kw">;</span>             <span class="fu">//</span> calls print(double)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>     print(<span class="ot">&quot;</span><span class="er">Barcelona</span><span class="ot">&quot;</span>)<span class="kw">;</span>      <span class="fu">//</span> calls print(string)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>If two alternative functions could be called, but neither is better
than the other, the call is deemed ambiguous and the compiler gives an
error. For example:</p>
<p><a href="#part0025_split_010.html#p0005_02a"
id="part0006.html#p0005_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>void print(int<span class="kw">,</span>double)<span class="kw">;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>void print(double<span class="kw">,</span>int)<span class="kw">;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>void user2()</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>     print(<span class="dv">0</span><span class="kw">,</span><span class="dv">0</span>)<span class="kw">;</span>     <span class="fu">//</span> error<span class="fu">:</span> ambiguous</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Defining multiple functions with the same name is known as
<em>function overloading</em> and is one of the essential parts of
generic programming (§<a href="#part0012.html#ch07lev1sec2"
class="calibre6">7.2</a>). When a function is overloaded, each function
of the same name should implement the same semantics. The <code
class="calibre8">print()</code> functions are an example of this; each
<code class="calibre8">print()</code> prints its argument.</p>
<h3 class="h2" id="part0006.html#ch01lev1sec4">1.4 Types, Variables, and
Arithmetic</h3>
<p>Every name and every expression has a type that determines the
operations that may be performed on it. For example, the declaration</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>int inch<span class="kw">;</span></span></code></pre></div>
<p>specifies that <code class="calibre8">inch</code> is of type <code
class="calibre8">int</code>; that is, <code class="calibre8">inch</code>
is an integer variable.</p>
<p>A <em>declaration</em> is a statement that introduces an entity into
the program. It specifies a type for the entity:</p>
<ul>
<li><p>A <em>type</em> defines a set of possible values and a set of
operations (for an object).</p></li>
<li><p>An <em>object</em> is some memory that holds a value of some
type.</p></li>
<li><p>A <em>value</em> is a set of bits interpreted according to a
type.</p></li>
<li><p>A <em>variable</em> is a named object.</p></li>
</ul>
<p>C++ offers a small zoo of fundamental types, but since I’m not a
zoologist, I will not list them all. You can find them all in reference
sources, such as [Stroustrup,2003] or the [<a
href="#part0021.html#ref13" class="calibre6">Cppreference</a>] on the
Web. Examples are:</p>
<p><a href="#part0025_split_011.html#p0006_01a"
id="part0006.html#p0006_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>bool         <span class="fu">//</span> <span class="dt">Boolean</span><span class="kw">,</span> possible values are <span class="kw">true</span> and <span class="kw">false</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>char         <span class="fu">//</span> character<span class="kw">,</span> for example<span class="kw">,</span> <span class="st">&#39;</span><span class="er">a</span><span class="st">&#39;</span><span class="kw">,</span> <span class="st">&#39;</span><span class="er">z</span><span class="st">&#39;</span><span class="kw">,</span> and <span class="st">&#39;9&#39;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>int          <span class="fu">//</span> <span class="dt">integer</span><span class="kw">,</span> for example<span class="kw">,</span> <span class="fu">-</span><span class="dv">273</span><span class="kw">,</span> <span class="dv">42</span><span class="kw">,</span> and <span class="dv">1066</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>double       <span class="fu">//</span> double<span class="fu">-</span>precision floating<span class="fu">-</span>point <span class="dt">number</span><span class="kw">,</span> for example<span class="kw">,</span> <span class="fu">-</span><span class="fl">273.15</span><span class="kw">,</span> <span class="fl">3.14</span><span class="kw">,</span> and <span class="fl">6.626</span>e<span class="dv">-34</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>unsigned     <span class="fu">//</span> non<span class="fu">-</span>negative <span class="dt">integer</span><span class="kw">,</span> for example<span class="kw">,</span> <span class="dv">0</span><span class="kw">,</span> <span class="dv">1</span><span class="kw">,</span> and <span class="dv">999</span> (use for bitwise logical operations)</span></code></pre></div>
<p>Each fundamental type corresponds directly to hardware facilities and
has a fixed size that determines the range of values that can be stored
in it:</p>
<figure>
<img src="images/00004.jpeg" class="calibre1" />
</figure>
<p>A <code class="calibre8">char</code> variable is of the natural size
to hold a character on a given machine (typically an 8-bit byte), and
the sizes of other types are multiples of the size of a <code
class="calibre8">char</code>. The size of a type is
implementation-defined (i.e., it can vary among different machines) and
can be obtained by the <code class="calibre8">sizeof</code> operator;
for example, <code class="calibre8">sizeof(char)</code> equals <code
class="calibre8">1</code> and <code class="calibre8">sizeof(int)</code>
is often <code class="calibre8">4</code>.</p>
<p>Numbers can be floating-point or integers.</p>
<ul>
<li><p>Floating-point numbers are recognized by a decimal point (e.g.,
<code class="calibre8">3.14</code>) or by an exponent (e.g., <code
class="calibre8">3e−2</code>).</p></li>
<li><p>Integer literals are by default decimal (e.g., <code
class="calibre8">42</code> means forty-two). A <code
class="calibre8">0b</code> prefix indicates a binary (base 2) integer
literal (e.g., <code class="calibre8">0b10101010</code>). A <code
class="calibre8">0x</code> prefix indicates a hexadecimal (base 16)
integer literal (e.g., <code class="calibre8">0xBAD1234</code>). A <code
class="calibre8">0</code> prefix indicates an octal (base 8) integer
literal (e.g., <code class="calibre8">0334</code>).</p></li>
</ul>
<p>To make long literals more readable for humans, we can use a single
quote (<code class="calibre8">'</code>) as a digit separator. For
example, <em>π</em> is about <code
class="calibre8">3.14159'26535'89793'23846'26433'83279'50288</code> or
if you prefer hexadecimal <code
class="calibre8">0x3.243F'6A88'85A3'08D3</code>.</p>
<h4 class="h3" id="part0006.html#ch01lev2sec2">1.4.1 Arithmetic</h4>
<p>The arithmetic operators can be used for appropriate combinations of
the fundamental types:</p>
<p><a href="#part0025_split_012.html#p0006_02a"
id="part0006.html#p0006_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>x<span class="fu">+</span>y     <span class="fu">//</span> plus</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">+</span>x      <span class="fu">//</span> unary plus</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>x<span class="er">−</span>y     <span class="fu">//</span> minus</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="er">−</span>x      <span class="fu">//</span> unary minus</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>x<span class="fu">*</span>y     <span class="fu">//</span> multiply</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>x<span class="fu">/</span>y     <span class="fu">//</span> divide</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>x<span class="co">%y     // remainder (modulus) for integers</span></span></code></pre></div>
<p>So can the comparison operators:</p>
<p><a href="#part0025_split_013.html#p0007_01a"
id="part0006.html#p0007_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>x<span class="fu">==</span>y     <span class="fu">//</span> equal</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>x<span class="kw">!=</span>y     <span class="fu">//</span> not equal</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>x<span class="dt">&lt;</span>y      <span class="dv">//</span> less than</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>x<span class="er">&gt;</span>y      <span class="fu">//</span> greater than</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>x&lt;=y     <span class="fu">//</span> less than or equal</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>x<span class="dt">&gt;=</span>y     <span class="dv">//</span> greater than or equal</span></code></pre></div>
<p>Furthermore, logical operators are provided:</p>
<p><a href="#part0025_split_014.html#p0007_02a"
id="part0006.html#p0007_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>x&amp;y      <span class="fu">//</span> bitwise and</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>x|y      <span class="fu">//</span> bitwise or</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>x<span class="fu">^</span>y      <span class="fu">//</span> bitwise exclusive or</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>~x       <span class="fu">//</span> bitwise complement</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>x&amp;&amp;y     <span class="fu">//</span> logical and</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>x||y     <span class="fu">//</span> logical or</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="kw">!</span>x       <span class="fu">//</span> logical not (negation)</span></code></pre></div>
<p>A bitwise logical operator yields a result of the operand type for
which the operation has been performed on each bit. The logical
operators <code class="calibre8">&amp;&amp;</code> and <code
class="calibre8">||</code> simply return <code
class="calibre8">true</code> or <code class="calibre8">false</code>
depending on the values of their operands.</p>
<p>In assignments and in arithmetic operations, C++ performs all
meaningful conversions between the basic types so that they can be mixed
freely:</p>
<p><a href="#part0025_split_015.html#p0007_03a"
id="part0006.html#p0007_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>void some_function()    <span class="fu">//</span> function that doesn<span class="st">&#39;</span><span class="er">t return a value</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ch">     </span><span class="er">double d = 2.2;    // initialize floating-point number</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="er">     int i = 7;         // initialize integer</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="er">     d = d+i;           // assign sum to d</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="er">     i = d*i;           // assign product to i; beware: truncating the double d*i to an int</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>The conversions used in expressions are called <em>the usual
arithmetic conversions</em> and aim to ensure that expressions are
computed at the highest precision of its operands. For example, an
addition of a <code class="calibre8">double</code> and an <code
class="calibre8">int</code> is calculated using double-precision
floating-point arithmetic.</p>
<p>Note that <code class="calibre8">=</code> is the assignment operator
and <code class="calibre8">==</code> tests equality.</p>
<p>In addition to the conventional arithmetic and logical operators, C++
offers more specific operations for modifying a variable:</p>
<p><a href="#part0025_split_016.html#p0007_04a"
id="part0006.html#p0007_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>x+=y     <span class="fu">//</span> x <span class="kw">=</span> x<span class="fu">+</span>y</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>++x      <span class="fu">//</span> increment<span class="fu">:</span> x <span class="kw">=</span> x<span class="fu">+</span><span class="dv">1</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>x<span class="er">−</span><span class="kw">=</span>y     <span class="fu">//</span> x <span class="kw">=</span> x<span class="fu">-</span>y</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="er">−−</span>x      <span class="fu">//</span> decrement<span class="fu">:</span> x <span class="kw">=</span> x<span class="dv">-1</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>x*=y     <span class="fu">//</span> scaling<span class="fu">:</span> x <span class="kw">=</span> x<span class="fu">*</span>y</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>x/=y     <span class="fu">//</span> scaling<span class="fu">:</span> x <span class="kw">=</span> x<span class="fu">/</span>y</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>x<span class="co">%=y     // x = x%y</span></span></code></pre></div>
<p>These operators are concise, convenient, and very frequently
used.</p>
<p>The order of evaluation of expressions is left to right, except for
assignments, which are right-to-left. The order of evaluation of
function arguments is unfortunately unspecified.</p>
<h4 class="h3" id="part0006.html#ch01lev2sec3"><span
id="part0006.html#page_8" class="calibre2 pagebreak"></span>1.4.2
Initialization</h4>
<p>Before an object can be used, it must be given a value. C++ offers a
variety of notations for expressing initialization, such as the <code
class="calibre8">=</code> used above, and a universal form based on
curly-brace-delimited initializer lists:</p>
<p><a href="#part0025_split_017.html#p0008_01a"
id="part0006.html#p0008_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>double d1 <span class="kw">=</span> <span class="fl">2.3</span><span class="kw">;</span>                 <span class="fu">//</span> initialize d1 to <span class="fl">2.3</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>double d2 <span class="kw">{</span><span class="fl">2.3</span><span class="kw">};</span>                 <span class="fu">//</span> initialize d2 to <span class="fl">2.3</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>double d3 <span class="kw">=</span> <span class="kw">{</span><span class="fl">2.3</span><span class="kw">};</span>               <span class="fu">//</span> initialize d3 to <span class="fl">2.3</span> (the <span class="kw">=</span> <span class="dt">is</span> optional with <span class="er">{</span> ... <span class="er">}</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>complex<span class="dt">&lt;</span>double<span class="er">&gt;</span> z <span class="kw">=</span> <span class="dv">1</span><span class="kw">;</span>           <span class="fu">//</span> a complex <span class="dt">number</span> with double<span class="fu">-</span>precision floating<span class="fu">-</span>point scalars</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>complex<span class="dt">&lt;</span>double<span class="er">&gt;</span> z2 <span class="kw">{</span>d1<span class="kw">,</span>d2<span class="kw">};</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>complex<span class="dt">&lt;</span>double<span class="er">&gt;</span> z3 <span class="kw">=</span> <span class="kw">{</span>d1<span class="kw">,</span>d2<span class="kw">};</span>    <span class="fu">//</span> the <span class="kw">=</span> <span class="dt">is</span> optional with <span class="er">{</span> ... <span class="er">}</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> v <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">,</span><span class="dv">4</span><span class="kw">,</span><span class="dv">5</span><span class="kw">,</span><span class="dv">6</span><span class="kw">};</span>     <span class="fu">//</span> a vector of ints</span></code></pre></div>
<p>The <code class="calibre8">=</code> form is traditional and dates
back to C, but if in doubt, use the general <code
class="calibre8">{}</code>-list form. If nothing else, it saves you from
conversions that lose information:</p>
<p><a href="#part0025_split_018.html#p0008_02a"
id="part0006.html#p0008_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>int i1 <span class="kw">=</span> <span class="fl">7.8</span><span class="kw">;</span>        <span class="fu">//</span> i1 becomes <span class="dv">7</span> (surprise?)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>int i2 <span class="kw">{</span><span class="fl">7.8</span><span class="kw">};</span>        <span class="fu">//</span> error<span class="fu">:</span> floating<span class="fu">-</span>point to <span class="dt">integer</span> conversion</span></code></pre></div>
<p>Unfortunately, conversions that lose information, <em>narrowing
conversions</em>, such as <code class="calibre8">double</code> to <code
class="calibre8">int</code> and <code class="calibre8">int</code> to
<code class="calibre8">char</code>, are allowed and implicitly applied.
The problems caused by implicit narrowing conversions are a price paid
for C compatibility (§<a href="#part0021.html#ch16lev1sec3"
class="calibre6">16.3</a>).</p>
<p>A constant (§<a href="#part0006.html#ch01lev1sec6"
class="calibre6">1.6</a>) cannot be left uninitialized and a variable
should only be left uninitialized in extremely rare circumstances. Don’t
introduce a name until you have a suitable value for it. User-defined
types (such as <code class="calibre8">string</code>, <code
class="calibre8">vector</code>, <code class="calibre8">Matrix</code>,
<code class="calibre8">Motor_controller</code>, and <code
class="calibre8">Orc_warrior</code>) can be defined to be implicitly
initialized (§<a href="#part0009.html#ch04lev2sec1"
class="calibre6">4.2.1</a>).</p>
<p>When defining a variable, you don’t need to state its type explicitly
when it can be deduced from the initializer:</p>
<p><a href="#part0025_split_019.html#p0008_03a"
id="part0006.html#p0008_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>auto b <span class="kw">=</span> <span class="kw">true;</span>       <span class="fu">//</span> a bool</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>auto ch <span class="kw">=</span> <span class="st">&#39;</span><span class="er">x</span><span class="st">&#39;</span><span class="kw">;</span>       <span class="fu">//</span> a char</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>auto i <span class="kw">=</span> <span class="dv">123</span><span class="kw">;</span>        <span class="fu">//</span> an int</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>auto d <span class="kw">=</span> <span class="fl">1.2</span><span class="kw">;</span>        <span class="fu">//</span> a double</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>auto z <span class="kw">=</span> sqrt(y)<span class="kw">;</span>    <span class="fu">//</span> z has the type of whatever sqrt(y) returns</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>auto bb <span class="kw">{true};</span>      <span class="fu">//</span> bb <span class="dt">is</span> a bool</span></code></pre></div>
<p>With <code class="calibre8">auto</code>, we tend to use the <code
class="calibre8">=</code> because there is no potentially troublesome
type conversion involved, but if you prefer to use <code
class="calibre8">{}</code> initialization consistently, you can do that
instead.</p>
<p>We use <code class="calibre8">auto</code> where we don’t have a
specific reason to mention the type explicitly. “Specific reasons”
include:</p>
<ul>
<li><p>The definition is in a large scope where we want to make the type
clearly visible to readers of our code.</p></li>
<li><p>We want to be explicit about a variable’s range or precision
(e.g., <code class="calibre8">double</code> rather than <code
class="calibre8">float</code>).</p></li>
</ul>
<p>Using <code class="calibre8">auto</code>, we avoid redundancy and
writing long type names. This is especially important in generic
programming where the exact type of an object can be hard for the
programmer to know and the type names can be quite long (§<a
href="#part0017.html#ch12lev1sec2" class="calibre6">12.2</a>).</p>
<h3 class="h2" id="part0006.html#ch01lev1sec5"><span
id="part0006.html#page_9" class="calibre2 pagebreak"></span>1.5 Scope
and Lifetime</h3>
<p>A declaration introduces its name into a scope:</p>
<ul>
<li><p><em>Local scope</em>: A name declared in a function (§<a
href="#part0006.html#ch01lev1sec3" class="calibre6">1.3</a>) or lambda
(§<a href="#part0011.html#ch06lev2sec5" class="calibre6">6.3.2</a>) is
called a <em>local name</em>. Its scope extends from its point of
declaration to the end of the block in which its declaration occurs. A
<em>block</em> is delimited by a <code class="calibre8">{ }</code> pair.
Function argument names are considered local names.</p></li>
<li><p><em>Class scope</em>: A name is called a <em>member name</em> (or
a <em>class member name</em>) if it is defined in a class (§<a
href="#part0007.html#ch02lev1sec2" class="calibre6">2.2</a>, §<a
href="#part0007.html#ch02lev1sec3" class="calibre6">2.3</a>, <a
href="#part0009.html#ch04" class="calibre6">Chapter 4</a>), outside any
function (§<a href="#part0006.html#ch01lev1sec3"
class="calibre6">1.3</a>), lambda (§<a
href="#part0011.html#ch06lev2sec5" class="calibre6">6.3.2</a>), or <code
class="calibre8">enum class</code> (§<a
href="#part0007.html#ch02lev1sec5" class="calibre6">2.5</a>). Its scope
extends from the opening <code class="calibre8">{</code> of its
enclosing declaration to the end of that declaration.</p></li>
<li><p><em>Namespace scope</em>: A name is called a <em>namespace member
name</em> if it is defined in a namespace (§<a
href="#part0008.html#ch03lev1sec4" class="calibre6">3.4</a>) outside any
function, lambda (§<a href="#part0011.html#ch06lev2sec5"
class="calibre6">6.3.2</a>), class (§<a
href="#part0007.html#ch02lev1sec2" class="calibre6">2.2</a>, §<a
href="#part0007.html#ch02lev1sec3" class="calibre6">2.3</a>, <a
href="#part0009.html#ch04" class="calibre6">Chapter 4</a>), or <code
class="calibre8">enum class</code> (§<a
href="#part0007.html#ch02lev1sec5" class="calibre6">2.5</a>). Its scope
extends from the point of declaration to the end of its
namespace.</p></li>
</ul>
<p>A name not declared inside any other construct is called a <em>global
name</em> and is said to be in the <em>global namespace</em>.</p>
<p>In addition, we can have objects without names, such as temporaries
and objects created using <code class="calibre8">new</code> (§<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>). For
example:</p>
<p><a href="#part0025_split_020.html#p0009_01a"
id="part0006.html#p0009_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> vec<span class="kw">;</span>    <span class="fu">//</span> vec <span class="dt">is</span> global (a global vector of integers)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Record</span> <span class="er">{</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>     string name<span class="kw">;</span>   <span class="fu">//</span> name <span class="dt">is</span> a member or <span class="dt">Record</span> (a string member)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>     <span class="dv">//</span> ...</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="er">}</span><span class="kw">;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>void fct(int <span class="fu">arg</span>)   <span class="fu">//</span> fct <span class="dt">is</span> global (a global function)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">//</span> arg <span class="dt">is</span> local (an integer argument)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>     string motto <span class="er">{&quot;</span><span class="dt">Who</span> dares wins<span class="er">&quot;}</span><span class="kw">;</span>  <span class="fu">//</span> motto <span class="dt">is</span> local</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>     auto p <span class="kw">=</span> new <span class="dt">Record</span><span class="kw">{</span><span class="ot">&quot;</span><span class="er">Hume</span><span class="ot">&quot;</span><span class="kw">};</span>      <span class="fu">//</span> p points to an unnamed <span class="dt">Record</span> (created by new)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>An object must be constructed (initialized) before it is used and
will be destroyed at the end of its scope. For a namespace object the
point of destruction is the end of the program. For a member, the point
of destruction is determined by the point of destruction of the object
of which it is a member. An object created by <code
class="calibre8">new</code> “lives” until destroyed by <code
class="calibre8">delete</code> (§<a href="#part0009.html#ch04lev2sec2"
class="calibre6">4.2.2</a>).</p>
<h3 class="h2" id="part0006.html#ch01lev1sec6">1.6 Constants</h3>
<p>C++ supports two notions of immutability:</p>
<ul>
<li><p><code class="calibre8">const</code>: meaning roughly “I promise
not to change this value.” This is used primarily to specify interfaces
so that data can be passed to functions using pointers and references
without fear of it being modified. The compiler enforces the promise
made by <code class="calibre8">const</code>. The value of a <code
class="calibre8">const</code> can be calculated at run time.</p></li>
<li><p><span id="part0006.html#page_10" class="pagebreak"></span><code
class="calibre8">constexpr</code>: meaning roughly “to be evaluated at
compile time.” This is used primarily to specify constants, to allow
placement of data in read-only memory (where it is unlikely to be
corrupted), and for performance. The value of a <code
class="calibre8">constexpr</code> must be calculated by the
compiler.</p></li>
</ul>
<p>For example:</p>
<p><a href="#part0025_split_021.html#p0010_01a"
id="part0006.html#p0010_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>constexprint dmv <span class="kw">=</span> <span class="dv">17</span><span class="kw">;</span>              <span class="fu">//</span> dmv <span class="dt">is</span> a named constant</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>int var <span class="kw">=</span> <span class="dv">17</span><span class="kw">;</span>                       <span class="fu">//</span> <span class="dt">var</span> <span class="dt">is</span> not a constant</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>const double sqv <span class="kw">=</span> sqrt(<span class="dt">var</span>)<span class="kw">;</span>       <span class="fu">//</span> sqv <span class="dt">is</span> a named constant<span class="kw">,</span> possibly computed at run time</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>double sum(const vector<span class="dt">&lt;</span>double&gt;&amp;)<span class="kw">;</span>              <span class="fu">//</span> sum will not modify its argument (<span class="er">§</span><span class="fl">1.7</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>double<span class="er">&gt;</span> v <span class="kw">{</span><span class="fl">1.2</span><span class="kw">,</span> <span class="fl">3.4</span><span class="kw">,</span> <span class="fl">4.5</span><span class="kw">};</span>               <span class="fu">//</span> v <span class="dt">is</span> not a constant</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>const double s1 <span class="kw">=</span> sum(v)<span class="kw">;</span>                       <span class="fu">//</span> <span class="dt">OK</span><span class="fu">:</span> sum(v) <span class="dt">is</span> evaluated at run time</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>constexpr double s2 <span class="kw">=</span> sum(v)<span class="kw">;</span>                   <span class="fu">//</span> error<span class="fu">:</span> sum(v) <span class="dt">is</span> not a constant expression</span></code></pre></div>
<p>For a function to be usable in a <em>constant expression</em>, that
is, in an expression that will be evaluated by the compiler, it must be
defined <code class="calibre8">constexpr</code>. For example:</p>
<p><a href="#part0025_split_022.html#p0010_02a"
id="part0006.html#p0010_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>constexpr double square(double x) <span class="kw">{</span> return x<span class="fu">*</span>x<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>constexpr double max1 <span class="kw">=</span> <span class="fl">1.4</span><span class="fu">*</span>square(<span class="dv">17</span>)<span class="kw">;</span>       <span class="fu">//</span> <span class="dt">OK</span> <span class="fl">1.4</span><span class="fu">*</span>square(<span class="dv">17</span>) <span class="dt">is</span> a constant expression</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>constexpr double max2 <span class="kw">=</span> <span class="fl">1.4</span><span class="fu">*</span>square(<span class="dt">var</span>)<span class="kw">;</span>      <span class="fu">//</span> error<span class="fu">:</span> <span class="dt">var</span> <span class="dt">is</span> not a constant expression</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>const double max3 <span class="kw">=</span> <span class="fl">1.4</span><span class="fu">*</span>square(<span class="dt">var</span>)<span class="kw">;</span>          <span class="fu">//</span> <span class="dt">OK</span><span class="kw">,</span> may be evaluated at run time</span></code></pre></div>
<p>A <code class="calibre8">constexpr</code> function can be used for
non-constant arguments, but when that is done the result is not a
constant expression. We allow a <code class="calibre8">constexpr</code>
function to be called with non-constant-expression arguments in contexts
that do not require constant expressions. That way, we don’t have to
define essentially the same function twice: once for constant
expressions and once for variables.</p>
<p>To be <code class="calibre8">constexpr</code>, a function must be
rather simple and cannot have side effects and can only use information
passed to it as arguments. In particular, it cannot modify non-local
variables, but it can have loops and use its own local variables. For
example:</p>
<p><a href="#part0025_split_023.html#p0010_03a"
id="part0006.html#p0010_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>constexpr double nth(double x<span class="kw">,</span> int n)   <span class="fu">//</span> assume <span class="dv">0</span>&lt;=n</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    double res <span class="kw">=</span> <span class="dv">1</span><span class="kw">;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    int i <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    while (i<span class="dt">&lt;</span>n) <span class="kw">{</span>   <span class="fu">//</span> while<span class="fu">-</span>loop<span class="fu">:</span> do while the condition <span class="dt">is</span> true (<span class="er">§</span><span class="fl">1.7</span>.<span class="dv">1</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>         res*=x<span class="kw">;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>         ++i<span class="kw">;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    return res<span class="kw">;</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>In a few places, constant expressions are required by language rules
(e.g., array bounds (§<a href="#part0006.html#ch01lev1sec7"
class="calibre6">1.7</a>), case labels (§<a
href="#part0006.html#ch01lev1sec8" class="calibre6">1.8</a>), template
value arguments (§<a href="#part0011.html#ch06lev1sec2"
class="calibre6">6.2</a>), and constants declared using <code
class="calibre8">constexpr</code>). In other cases, compile-time
evaluation is important for performance. Independently of performance
issues, the notion of immutability (an object with an unchangeable
state) is an important design concern.</p>
<h3 class="h2" id="part0006.html#ch01lev1sec7"><span
id="part0006.html#page_11" class="calibre2 pagebreak"></span>1.7
Pointers, Arrays, and References</h3>
<p>The most fundamental collection of data is a contiguously allocated
sequence of elements of the same type, called an <em>array</em>. This is
basically what the hardware offers. An array of elements of type <code
class="calibre8">char</code> can be declared like this:</p>
<p><a href="#part0025_split_024.html#p0011_01a"
id="part0006.html#p0011_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>char v[<span class="dv">6</span>]<span class="kw">;</span>        <span class="fu">//</span> array of <span class="dv">6</span> characters</span></code></pre></div>
<p>Similarly, a pointer can be declared like this:</p>
<p><a href="#part0025_split_025.html#p0011_02a"
id="part0006.html#p0011_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>char<span class="fu">*</span> p<span class="kw">;</span>        <span class="fu">//</span> pointer to character</span></code></pre></div>
<p>In declarations, <code class="calibre8">[ ]</code> means “array of”
and <code class="calibre8">*</code> means “pointer to.” All arrays have
<code class="calibre8">0</code> as their lower bound, so <code
class="calibre8">v</code> has six elements, <code
class="calibre8">v[0]</code> to <code class="calibre8">v[5]</code>. The
size of an array must be a constant expression (§<a
href="#part0006.html#ch01lev1sec6" class="calibre6">1.6</a>). A pointer
variable can hold the address of an object of the appropriate type:</p>
<p><a href="#part0025_split_026.html#p0011_03a"
id="part0006.html#p0011_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>char<span class="fu">*</span> p <span class="kw">=</span> &amp;v[<span class="dv">3</span>]<span class="kw">;</span>        <span class="fu">//</span> p points to v<span class="st">&#39;</span><span class="er">s fourth element</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="er">char x = *p;            // *p is the object that p points to</span></span></code></pre></div>
<p>In an expression, prefix unary <code class="calibre8">*</code> means
“contents of” and prefix unary <code class="calibre8">&amp;</code> means
“address of.” We can represent the result of that initialized definition
graphically:</p>
<figure>
<img src="images/00005.jpeg" class="calibre1" />
</figure>
<p>Consider copying ten elements from one array to another:</p>
<p><a href="#part0025_split_027.html#p0011_04a"
id="part0006.html#p0011_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb29"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>void copy_fct()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>     int v1[<span class="dv">10</span>] <span class="kw">=</span> <span class="kw">{</span><span class="dv">0</span><span class="kw">,</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">,</span><span class="dv">4</span><span class="kw">,</span><span class="dv">5</span><span class="kw">,</span><span class="dv">6</span><span class="kw">,</span><span class="dv">7</span><span class="kw">,</span><span class="dv">8</span><span class="kw">,</span><span class="dv">9</span><span class="kw">};</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>     int v2[<span class="dv">10</span>]<span class="kw">;</span>                 <span class="fu">//</span> to become a copy of v1</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>     for (auto i<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span><span class="dv">10</span><span class="kw">;</span> ++i)  <span class="fu">//</span> copy elements</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>           v2[i]<span class="kw">=</span>v1[i]<span class="kw">;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This <code class="calibre8">for</code>-statement can be read as “set
<code class="calibre8">i</code> to zero; while <code
class="calibre8">i</code> is not <code class="calibre8">10</code>, copy
the <code class="calibre8">i</code>th element and increment <code
class="calibre8">i</code>.” When applied to an integer or floating-point
variable, the increment operator, <code class="calibre8">++</code>,
simply adds <code class="calibre8">1</code>. C++ also offers a simpler
<code class="calibre8">for</code>-statement, called a range-<code
class="calibre8">for</code>-statement, for loops that traverse a
sequence in the simplest way:</p>
<p><a href="#part0025_split_028.html#p0012_01a"
id="part0006.html#p0012_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>void print()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>     int v[] <span class="kw">=</span> <span class="kw">{</span><span class="dv">0</span><span class="kw">,</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">,</span><span class="dv">4</span><span class="kw">,</span><span class="dv">5</span><span class="kw">,</span><span class="dv">6</span><span class="kw">,</span><span class="dv">7</span><span class="kw">,</span><span class="dv">8</span><span class="kw">,</span><span class="dv">9</span><span class="kw">};</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>     for (auto x <span class="fu">:</span> v)             <span class="fu">//</span> for each x in v</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> x <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>     for (auto x <span class="fu">:</span> <span class="kw">{</span><span class="dv">10</span><span class="kw">,</span><span class="dv">21</span><span class="kw">,</span><span class="dv">32</span><span class="kw">,</span><span class="dv">43</span><span class="kw">,</span><span class="dv">54</span><span class="kw">,</span><span class="dv">65</span><span class="kw">}</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> x <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The first range-<code class="calibre8">for</code>-statement can be
read as “for every element of <code class="calibre8">v</code>, from the
first to the last, place a copy in <code class="calibre8">x</code> and
print it.” Note that we don’t have to specify an array bound when we
initialize it with a list. The range-<code
class="calibre8">for</code>-statement can be used for any sequence of
elements (§<a href="#part0017.html#ch12lev1sec1"
class="calibre6">12.1</a>).</p>
<p>If we didn’t want to copy the values from <code
class="calibre8">v</code> into the variable <code
class="calibre8">x</code>, but rather just have <code
class="calibre8">x</code> refer to an element, we could write:</p>
<p><a href="#part0025_split_029.html#p0012_02a"
id="part0006.html#p0012_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>void increment()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>     int v[] <span class="kw">=</span> <span class="kw">{</span><span class="dv">0</span><span class="kw">,</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">,</span><span class="dv">4</span><span class="kw">,</span><span class="dv">5</span><span class="kw">,</span><span class="dv">6</span><span class="kw">,</span><span class="dv">7</span><span class="kw">,</span><span class="dv">8</span><span class="kw">,</span><span class="dv">9</span><span class="kw">};</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>     for (auto&amp; x <span class="fu">:</span> v)     <span class="fu">//</span> add <span class="dv">1</span> to each x in v</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>           ++x<span class="kw">;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>In a declaration, the unary suffix <code
class="calibre8">&amp;</code> means “reference to.” A reference is
similar to a pointer, except that you don’t need to use a prefix <code
class="calibre8">*</code> to access the value referred to by the
reference. Also, a reference cannot be made to refer to a different
object after its initialization.</p>
<p>References are particularly useful for specifying function arguments.
For example:</p>
<p><a href="#part0025_split_030.html#p0012_03a"
id="part0006.html#p0012_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>void sort(vector<span class="dt">&lt;</span>double&gt;&amp; v)<span class="kw">;</span>     <span class="fu">//</span> sort v (v <span class="dt">is</span> a vector of doubles)</span></code></pre></div>
<p>By using a reference, we ensure that for a call <code
class="calibre8">sort(my_vec)</code>, we do not copy <code
class="calibre8">my_vec</code> and that it really is <code
class="calibre8">my_vec</code> that is sorted and not a copy of it.</p>
<p>When we don’t want to modify an argument but still don’t want the
cost of copying, we use a <code class="calibre8">const</code> reference
(§<a href="#part0006.html#ch01lev1sec6" class="calibre6">1.6</a>). For
example:</p>
<p><a href="#part0025_split_031.html#p0012_04a"
id="part0006.html#p0012_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>double sum(const vector<span class="dt">&lt;</span>double&gt;&amp;)</span></code></pre></div>
<p>Functions taking <code class="calibre8">const</code> references are
very common.</p>
<p>When used in declarations, operators (such as <code
class="calibre8">&amp;</code>, <code class="calibre8">*</code>, and
<code class="calibre8">[ ]</code>) are called <em>declarator
operators</em>:</p>
<p><a href="#part0025_split_032.html#p0012_05a"
id="part0006.html#p0012_05" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="dt">T</span> a[n]    <span class="fu">//</span> <span class="dt">T</span>[n]<span class="fu">:</span> a <span class="dt">is</span> an array of n <span class="dt">Ts</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="dt">T*</span> p      <span class="dv">//</span> <span class="dt">T</span>*: p <span class="dt">is</span> a pointer to <span class="dt">T</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="dt">T</span>&amp; r      <span class="dv">//</span> <span class="dt">T</span>&amp;: r <span class="dt">is</span> a reference to <span class="dt">T</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="dt">T</span> f(<span class="dt">A</span>)    <span class="dv">//</span> <span class="dt">T</span>(<span class="dt">A</span>)<span class="fu">:</span> f <span class="dt">is</span> a function taking an argument of type <span class="dt">A</span> returning a result of type <span class="dt">T</span></span></code></pre></div>
<h4 class="h3" id="part0006.html#ch01lev2sec4"><span
id="part0006.html#page_13" class="calibre2 pagebreak"></span>1.7.1 The
Null Pointer</h4>
<p>We try to ensure that a pointer always points to an object so that
dereferencing it is valid. When we don’t have an object to point to or
if we need to represent the notion of “no object available” (e.g., for
an end of a list), we give the pointer the value <code
class="calibre8">nullptr</code> (“the null pointer”). There is only one
<code class="calibre8">nullptr</code> shared by all pointer types:</p>
<p><a href="#part0025_split_033.html#p0013_01a"
id="part0006.html#p0013_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>double<span class="fu">*</span> pd <span class="kw">=</span> nullptr<span class="kw">;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Link&lt;Record</span>&gt;* lst <span class="kw">=</span> nullptr<span class="kw">;</span>  <span class="fu">//</span> pointer to a <span class="dt">Link</span> to a <span class="dt">Record</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>int x <span class="kw">=</span> nullptr<span class="kw">;</span>              <span class="fu">//</span> error<span class="fu">:</span> nullptr <span class="dt">is</span> a pointer not an integer</span></code></pre></div>
<p>It is often wise to check that a pointer argument actually points to
something:</p>
<p><a href="#part0025_split_034.html#p0013_02a"
id="part0006.html#p0013_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>int count_x(const char<span class="fu">*</span> p<span class="kw">,</span> char x)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> count the <span class="dt">number</span> of occurrences of x in p[]</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> p <span class="dt">is</span> assumed to point to a zero<span class="dt">-</span>terminated array of char (or to nothing)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>     if (p<span class="fu">==</span>nullptr)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>           return <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>     int count <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>     for (<span class="kw">;</span> <span class="fu">*</span>p<span class="kw">!=</span><span class="dv">0</span><span class="kw">;</span> ++p)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>           if (<span class="fu">*</span>p<span class="fu">==</span>x)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                 ++count<span class="kw">;</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>     return count<span class="kw">;</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>Note how we can advance a pointer to point to the next element of an
array using <code class="calibre8">++</code> and that we can leave out
the initializer in a <code class="calibre8">for</code>-statement if we
don’t need it.</p>
<p>The definition of <code class="calibre8">count_x()</code> assumes
that the <code class="calibre8">char*</code> is a <em>C-style
string</em>, that is, that the pointer points to a zero-terminated array
of <code class="calibre8">char</code>. The characters in a string
literal are immutable, so to handle <code
class="calibre8">count_x("Hello!")</code>, I declared <code
class="calibre8">count_x()</code> a <code
class="calibre8">const char*</code> argument.</p>
<p>In older code, <code class="calibre8">0</code> or <code
class="calibre8">NULL</code> is typically used instead of <code
class="calibre8">nullptr</code>. However, using <code
class="calibre8">nullptr</code> eliminates potential confusion between
integers (such as <code class="calibre8">0</code> or <code
class="calibre8">NULL</code>) and pointers (such as <code
class="calibre8">nullptr</code>).</p>
<p>In the <code class="calibre8">count_x()</code> example, we are not
using the initializer part of the <code
class="calibre8">for</code>-statement, so we can use the simpler <code
class="calibre8">while</code>-statement:</p>
<p><a href="#part0025_split_035.html#p0013_03a"
id="part0006.html#p0013_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb37"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>int count_x(const char<span class="fu">*</span> p<span class="kw">,</span> char x)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> count the <span class="dt">number</span> of occurrences of x in p[]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> p <span class="dt">is</span> assumed to point to a zero<span class="dt">-</span>terminated array of char (or to nothing)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>     if (p<span class="fu">==</span>nullptr)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>           return <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>     int count <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>     while (<span class="fu">*</span>p) <span class="kw">{</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>           if (<span class="fu">*</span>p<span class="fu">==</span>x)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                 ++count<span class="kw">;</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>           ++p<span class="kw">;</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>     return count<span class="kw">;</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p><span id="part0006.html#page_14" class="pagebreak"></span>The <code
class="calibre8">while</code>-statement executes until its condition
becomes <code class="calibre8">false</code>.</p>
<p>A test of a numeric value (e.g., <code
class="calibre8">while (*p)</code> in <code
class="calibre8">count_x()</code>) is equivalent to comparing the value
to <code class="calibre8">0</code> (e.g., <code
class="calibre8">while (*p!=0)</code>). A test of a pointer value (e.g.,
<code class="calibre8">if (p)</code>) is equivalent to comparing the
value to <code class="calibre8">nullptr</code> (e.g., <code
class="calibre8">if (p!=nullptr)</code>).</p>
<p>There is no “null reference.” A reference must refer to a valid
object (and implementations assume that it does). There are obscure and
clever ways to violate that rule; don’t do that.</p>
<h3 class="h2" id="part0006.html#ch01lev1sec8">1.8 Tests</h3>
<p>C++ provides a conventional set of statements for expressing
selection and looping, such as <code
class="calibre8">if</code>-statements, <code
class="calibre8">switch</code>-statements, <code
class="calibre8">while</code>-loops, and <code
class="calibre8">for</code>-loops. For example, here is a simple
function that prompts the user and returns a Boolean indicating the
response:</p>
<p><a href="#part0025_split_036.html#p0014_01a"
id="part0006.html#p0014_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>bool accept()</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">Do you want to proceed </span><span class="ot">(</span><span class="er">y or n</span><span class="ot">)?</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span>     <span class="fu">//</span> <span class="fu">write</span> question</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>     char answer <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span>                                  <span class="fu">//</span> initialize to a value that will not appear on input</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>     cin <span class="al">&gt;&gt;</span> answer<span class="kw">;</span>                                    <span class="fu">//</span> <span class="fu">read</span> answer</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>     if (answer <span class="fu">==</span> <span class="st">&#39;</span><span class="er">y</span><span class="st">&#39;</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>           return <span class="kw">true;</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>     return <span class="kw">false;</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>To match the <code class="calibre8">&lt;&lt;</code> output operator
(“put to”), the <code class="calibre8">&gt;&gt;</code> operator (“get
from”) is used for input; <code class="calibre8">cin</code> is the
standard input stream (<a href="#part0015.html#ch10"
class="calibre6">Chapter 10</a>). The type of the right-hand operand of
<code class="calibre8">&gt;&gt;</code> determines what input is
accepted, and its right-hand operand is the target of the input
operation. The <code class="calibre8">\n</code> character at the end of
the output string represents a newline (§<a
href="#part0006.html#ch01lev2sec1" class="calibre6">1.2.1</a>).</p>
<p>Note that the definition of <code class="calibre8">answer</code>
appears where it is needed (and not before that). A declaration can
appear anywhere a statement can.</p>
<p>The example could be improved by taking an <code
class="calibre8">n</code> (for “no”) answer into account:</p>
<p><a href="#part0025_split_037.html#p0014_02a"
id="part0006.html#p0014_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>bool accept2()</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">Do you want to proceed </span><span class="ot">(</span><span class="er">y or n</span><span class="ot">)?</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span>     <span class="fu">//</span> <span class="fu">write</span> question</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>     char answer <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span>                                  <span class="fu">//</span> initialize to a value that will not appear on input</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>     cin <span class="al">&gt;&gt;</span> answer<span class="kw">;</span>                                    <span class="fu">//</span> <span class="fu">read</span> answer</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>     switch (answer) <span class="kw">{</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>     case <span class="st">&#39;</span><span class="er">y</span><span class="st">&#39;</span><span class="fu">:</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>          return <span class="kw">true;</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>     case <span class="st">&#39;</span><span class="er">n</span><span class="st">&#39;</span><span class="fu">:</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>          return <span class="kw">false;</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>     default<span class="fu">:</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>          cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">I</span><span class="ot">&#39;</span><span class="er">ll take that for a no</span><span class="ot">.</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>          return <span class="kw">false;</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0006.html#page_15" class="pagebreak"></span>A <code
class="calibre8">switch</code>-statement tests a value against a set of
constants. Those constants, called <code
class="calibre8">case</code>-labels, must be distinct, and if the value
tested does not match any of them, the <code
class="calibre8">default</code> is chosen. If the value doesn’t match
any <code class="calibre8">case</code>-label and no <code
class="calibre8">default</code> is provided, no action is taken.</p>
<p>We don’t have to exit a <code class="calibre8">case</code> by
returning from the function that contains its <code
class="calibre8">switch</code>-statement. Often, we just want to
continue execution with the statement following the <code
class="calibre8">switch</code>-statement. We can do that using a <code
class="calibre8">break</code> statement. As an example, consider an
overly clever, yet primitive, parser for a trivial command video
game:</p>
<p><a href="#part0025_split_038.html#p0015_01a"
id="part0006.html#p0015_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>void action()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>     while (<span class="kw">true</span>) <span class="kw">{</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>          cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">enter action</span><span class="ot">:</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span>           <span class="fu">//</span> request action</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>          string act<span class="kw">;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>          cin <span class="al">&gt;&gt;</span> act<span class="kw">;</span>          <span class="fu">//</span> <span class="fu">read</span> characters into a string</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>          <span class="dt">Point</span> delta <span class="kw">{</span><span class="dv">0</span><span class="kw">,</span><span class="dv">0</span><span class="kw">};</span>   <span class="fu">//</span> <span class="dt">Point</span> holds an <span class="kw">{</span>x<span class="kw">,</span>y<span class="kw">}</span> pair</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>          for (char ch <span class="fu">:</span> act) <span class="kw">{</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>               switch (ch) <span class="kw">{</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>               case <span class="st">&#39;</span><span class="er">u</span><span class="st">&#39;</span><span class="fu">:</span>  <span class="fu">//</span> up</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>               case <span class="st">&#39;</span><span class="er">n</span><span class="st">&#39;</span><span class="fu">:</span>  <span class="fu">//</span> north</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>                    ++delta.y<span class="kw">;</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>                    break<span class="kw">;</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>               case <span class="st">&#39;</span><span class="er">r</span><span class="st">&#39;</span><span class="fu">:</span>  <span class="fu">//</span> right</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>               case <span class="st">&#39;</span><span class="er">e</span><span class="st">&#39;</span><span class="fu">:</span>  <span class="fu">//</span> east</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>                    ++delta.x<span class="kw">;</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>                    break<span class="kw">;</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>               <span class="fu">//</span> ... more actions ...</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>               default<span class="fu">:</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>                    cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">I freeze</span><span class="ot">!</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>               <span class="kw">}</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>               move(current<span class="fu">+</span>delta<span class="fu">*</span>scale)<span class="kw">;</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>               update_display()<span class="kw">;</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>          <span class="kw">}</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Like a <code class="calibre8">for</code>-statement (§<a
href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>), an <code
class="calibre8">if</code>-statement can introduce a variable and test
it. For example:</p>
<p><a href="#part0025_split_039.html#p0015_02a"
id="part0006.html#p0015_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>void do_something(vector<span class="dt">&lt;</span>int&gt;&amp; v)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>     if (auto n <span class="kw">=</span> v<span class="al">.</span>size()<span class="kw">;</span> n<span class="kw">!=</span><span class="dv">0</span>) <span class="kw">{</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> ... we get here if n<span class="kw">!=</span><span class="dv">0</span> ...</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Here, the integer <code class="calibre8">n</code> is defined for use
within the <code class="calibre8">if</code>-statement, initialized with
<code class="calibre8">v.size()</code>, and immediately tested by the
<code class="calibre8">n!=0</code> condition after the semicolon. A name
declared in a condition is in scope on both branches of the <code
class="calibre8">if</code>-statement.</p>
<p><span id="part0006.html#page_16" class="pagebreak"></span>As with the
<code class="calibre8">for</code>-statement, the purpose of declaring a
name in the condition of an <code class="calibre8">if</code>-statement
is to keep the scope of the variable limited to improve readability and
minimize errors.</p>
<p>The most common case is testing a variable against <code
class="calibre8">0</code> (or the <code
class="calibre8">nullptr</code>). To do that, simply leave out the
explicit mention of the condition. For example:</p>
<p><a href="#part0025_split_040.html#p0016_01a"
id="part0006.html#p0016_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>void do_something(vector<span class="dt">&lt;</span>int&gt;&amp; v)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>     if (auto n <span class="kw">=</span> v<span class="al">.</span>size()) <span class="kw">{</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> ... we get here if n<span class="kw">!=</span><span class="dv">0</span> ...</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Prefer to use this terser and simpler form when you can.</p>
<h3 class="h2" id="part0006.html#ch01lev1sec9">1.9 Mapping to
Hardware</h3>
<p>C++ offers a direct mapping to hardware. When you use one of the
fundamental operations, the implementation is what the hardware offers,
typically a single machine operation. For example, adding two <code
class="calibre8">int</code>s, <code class="calibre8">x+y</code> executes
an integer add machine instruction.</p>
<p>A C++ implementation sees a machine’s memory as a sequence of memory
locations into which it can place (typed) objects and address them using
pointers:</p>
<figure>
<img src="images/00006.jpeg" class="calibre1" />
</figure>
<p>A pointer is represented in memory as a machine address, so the
numeric value of <code class="calibre8">p</code> in this figure would be
<code class="calibre8">3</code>. If this looks much like an array (§<a
href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>), that’s
because an array is C++’s basic abstraction of “a contiguous sequence of
objects in memory.”</p>
<p>The simple mapping of fundamental language constructs to hardware is
crucial for the raw low-level performance for which C and C++ have been
famous for decades. The basic machine model of C and C++ is based on
computer hardware, rather than some form of mathematics.</p>
<h4 class="h3" id="part0006.html#ch01lev2sec5">1.9.1 Assignment</h4>
<p>An assignment of a built-in type is a simple machine copy operation.
Consider:</p>
<p><a href="#part0025_split_041.html#p0016_02a"
id="part0006.html#p0016_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>int x <span class="kw">=</span> <span class="dv">2</span><span class="kw">;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>int y <span class="kw">=</span> <span class="dv">3</span><span class="kw">;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>x <span class="kw">=</span> y<span class="kw">;</span>          <span class="fu">//</span> x becomes <span class="dv">3</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> <span class="dt">Note</span><span class="fu">:</span> x<span class="fu">==</span>y</span></code></pre></div>
<p>This is obvious. We can graphically represent that like this:</p>
<figure>
<img src="images/00007.jpeg" class="calibre1" />
</figure>
<p><span id="part0006.html#page_17" class="pagebreak"></span>Note that
the two objects are independent. We can change the value of <code
class="calibre8">y</code> without affecting the value of <code
class="calibre8">x.</code> For example <code
class="calibre8">x=99</code> will not change the value of <code
class="calibre8">y</code>. Unlike Java, C#, and other languages, but
like C, that is true for all types, not just for <code
class="calibre8">int</code>s.</p>
<p>If we want different objects to refer to the same (shared) value, we
must say so. We could use pointers:</p>
<p><a href="#part0025_split_042.html#p0017_01a"
id="part0006.html#p0017_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>int x <span class="kw">=</span> <span class="dv">2</span><span class="kw">;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>int y <span class="kw">=</span> <span class="dv">3</span><span class="kw">;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>int<span class="fu">*</span> p <span class="kw">=</span> &amp;x<span class="kw">;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>int<span class="fu">*</span> q <span class="kw">=</span> &amp;y<span class="kw">;</span>    <span class="fu">//</span> now p<span class="kw">!=</span>q and <span class="fu">*</span>p<span class="kw">!</span>=*q</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>p <span class="kw">=</span> q<span class="kw">;</span>          <span class="fu">//</span> p becomes &amp;y<span class="kw">;</span> now p<span class="fu">==</span>q<span class="kw">,</span> so (obviously)<span class="fu">*</span>p <span class="fu">==</span> <span class="fu">*</span>q</span></code></pre></div>
<p>We can represent that graphically like this:</p>
<figure>
<img src="images/00008.jpeg" class="calibre1" />
</figure>
<p>I arbitrarily chose <code class="calibre8">88</code> and <code
class="calibre8">92</code> as the addresses of the <code
class="calibre8">int</code>s. Again, we can see that the assigned-to
object gets the value from the assigned object, yielding two independent
objects (here, pointers), with the same value. That is, <code
class="calibre8">p=q</code> gives <code class="calibre8">p==q</code>.
After <code class="calibre8">p=q</code>, both pointers point to <code
class="calibre8">y</code>.</p>
<p>A reference and a pointer both refer/point to an object and both are
represented in memory as a machine address. However, the language rules
for using them differ. Assignment to a reference does not change what
the reference refers to but assigns to the referenced object:</p>
<p><a href="#part0025_split_043.html#p0017_02a"
id="part0006.html#p0017_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>int x <span class="kw">=</span> <span class="dv">2</span><span class="kw">;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>int y <span class="kw">=</span> <span class="dv">3</span><span class="kw">;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>int&amp; r <span class="kw">=</span> x<span class="kw">;</span>     <span class="fu">//</span> r refers to x</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>int&amp; r2 <span class="kw">=</span> y<span class="kw">;</span>    <span class="fu">//</span> now r2 refers to y</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>r <span class="kw">=</span> r2<span class="kw">;</span>         <span class="fu">//</span> <span class="fu">read</span> through r2<span class="kw">,</span> <span class="fu">write</span> through r<span class="fu">:</span> x becomes <span class="dv">3</span></span></code></pre></div>
<p>We can represent that graphically like this:</p>
<figure>
<img src="images/00009.jpeg" class="calibre1" />
</figure>
<p>To access the value pointed to by a pointer, you use <code
class="calibre8">*</code>; that is automatically (implicitly) done for a
reference.</p>
<p>After <code class="calibre8">x=y</code>, we have <code
class="calibre8">x==y</code> for every built-in type and well-designed
user-defined type (<a href="#part0007.html#ch02"
class="calibre6">Chapter 2</a>) that offers <code
class="calibre8">=</code> (assignment) and <code
class="calibre8">==</code> (equality comparison).</p>
<h4 class="h3" id="part0006.html#ch01lev2sec6"><span
id="part0006.html#page_18" class="calibre2 pagebreak"></span>1.9.2
Initialization</h4>
<p>Initialization differs from assignment. In general, for an assignment
to work correctly, the assigned-to object must have a value. On the
other hand, the task of initialization is to make an uninitialized piece
of memory into a valid object. For almost all types, the effect of
reading from or writing to an uninitialized variable is undefined. For
built-in types, that’s most obvious for references:</p>
<p><a href="#part0025_split_044.html#p0018_01a"
id="part0006.html#p0018_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb46"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>int x <span class="kw">=</span> <span class="dv">7</span><span class="kw">;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>int&amp; r <span class="kw">{</span>x<span class="kw">};</span>    <span class="fu">//</span> bind r to x (r refers to x)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>r <span class="kw">=</span> <span class="dv">7</span><span class="kw">;</span>         <span class="fu">//</span> assign to whatever r refers to</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>int&amp; r2<span class="kw">;</span>       <span class="fu">//</span> error<span class="fu">:</span> uninitialized reference</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>r2 <span class="kw">=</span> <span class="dv">99</span><span class="kw">;</span>       <span class="fu">//</span> assign to whatever r2 refers to</span></code></pre></div>
<p>Fortunately, we cannot have an uninitialized reference; if we could,
then that <code class="calibre8">r2=99</code> would assign <code
class="calibre8">99</code> to some unspecified memory location; the
result would eventually lead to bad results or a crash.</p>
<p>You can use <code class="calibre8">=</code> to initializalize a
reference but please don’t let that confuse you. For example:</p>
<p><a href="#part0025_split_045.html#p0018_02a"
id="part0006.html#p0018_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb47"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>int&amp; r <span class="kw">=</span> x<span class="kw">;</span>     <span class="fu">//</span> bind r to x (r refers to x)</span></code></pre></div>
<p>This is still initialization and binds <code
class="calibre8">r</code> to <code class="calibre8">x</code>, rather
than any form of value copy.</p>
<p>The distinction between initialization and assignment is also crucial
to many user-defined types, such as <code class="calibre8">string</code>
and <code class="calibre8">vector</code>, where an assigned-to object
owns a resource that needs to eventually be released (§<a
href="#part0010.html#ch05lev1sec3" class="calibre6">5.3</a>).</p>
<p>The basic semantics of argument passing and function value return are
that of initialization (§<a href="#part0008.html#ch03lev1sec6"
class="calibre6">3.6</a>). For example, that’s how we get
pass-by-reference.</p>
<h3 class="h2" id="part0006.html#ch01lev1sec10">1.10 Advice</h3>
<p>The advice here is a subset of the C++ Core Guidelines [<a
href="#part0021.html#ref60" class="calibre6">Stroustrup,2015</a>].
References to guidelines look like this [CG: ES.23], meaning the 23rd
rule in the Expressions and Statement section. Generally, a core
guideline offers further rationale and examples.</p>
<p>[1] Don’t panic! All will become clear in time; §<a
href="#part0006.html#ch01lev1sec1" class="calibre6">1.1</a>; [CG:
In.0].</p>
<p>[2] Don’t use the built-in features exclusively or on their own. On
the contrary, the fundamental (built-in) features are usually best used
indirectly through libraries, such as the ISO C++ standard library (<a
href="#part0013.html#ch08" class="calibre6">Chapters 8</a>–<a
href="#part0020.html#ch15" class="calibre6">15</a>); [CG: P.10].</p>
<p>[3] You don’t have to know every detail of C++ to write good
programs.</p>
<p>[4] Focus on programming techniques, not on language features.</p>
<p>[5] For the final word on language definition issues, see the ISO C++
standard; §<a href="#part0021.html#ch16lev2sec3"
class="calibre6">16.1.3</a>; [CG: P.2].</p>
<p>[6] “Package” meaningful operations as carefully named functions; §<a
href="#part0006.html#ch01lev1sec3" class="calibre6">1.3</a>; [CG:
F.1].</p>
<p>[7] A function should perform a single logical operation; §<a
href="#part0006.html#ch01lev1sec3" class="calibre6">1.3</a> [CG:
F.2].</p>
<p>[8] Keep functions short; §<a href="#part0006.html#ch01lev1sec3"
class="calibre6">1.3</a>; [CG: F.3].</p>
<p>[9] Use overloading when functions perform conceptually the same task
on different types; §<a href="#part0006.html#ch01lev1sec3"
class="calibre6">1.3</a>.</p>
<p>[10] If a function may have to be evaluated at compile time, declare
it <code class="calibre8">constexpr</code>; §<a
href="#part0006.html#ch01lev1sec6" class="calibre6">1.6</a>; [CG:
F.4].</p>
<p><span id="part0006.html#page_19" class="pagebreak"></span>[11]
Understand how language primitives map to hardware; §<a
href="#part0006.html#ch01lev1sec4" class="calibre6">1.4</a>, §<a
href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>, §<a
href="#part0006.html#ch01lev1sec9" class="calibre6">1.9</a>, §<a
href="#part0007.html#ch02lev1sec3" class="calibre6">2.3</a>, §<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>, §<a
href="#part0009.html#ch04lev1sec4" class="calibre6">4.4</a>.</p>
<p>[12] Use digit separators to make large literals readable; §<a
href="#part0006.html#ch01lev1sec4" class="calibre6">1.4</a>; [CG:
NL.11].</p>
<p>[13] Avoid complicated expressions; [CG: ES.40].</p>
<p>[14] Avoid narrowing conversions; §<a
href="#part0006.html#ch01lev2sec3" class="calibre6">1.4.2</a>; [CG:
ES.46].</p>
<p>[15] Minimize the scope of a variable; §<a
href="#part0006.html#ch01lev1sec5" class="calibre6">1.5</a>.</p>
<p>[16] Avoid “magic constants”; use symbolic constants; §<a
href="#part0006.html#ch01lev1sec6" class="calibre6">1.6</a>; [CG:
ES.45].</p>
<p>[17] Prefer immutable data; §<a href="#part0006.html#ch01lev1sec6"
class="calibre6">1.6</a>; [CG: P.10].</p>
<p>[18] Declare one name (only) per declaration; [CG: ES.10].</p>
<p>[19] Keep common and local names short, and keep uncommon and
nonlocal names longer; [CG: ES.7].</p>
<p>[20] Avoid similar-looking names; [CG: ES.8].</p>
<p>[21] Avoid <code class="calibre8">ALL_CAPS</code> names; [CG:
ES.9].</p>
<p>[22] Prefer the <code class="calibre8">{}</code>-initializer syntax
for declarations with a named type; §<a
href="#part0006.html#ch01lev1sec4" class="calibre6">1.4</a>; [CG:
ES.23].</p>
<p>[23] Use <code class="calibre8">auto</code> to avoid repeating type
names; §<a href="#part0006.html#ch01lev2sec3"
class="calibre6">1.4.2</a>; [CG: ES.11].</p>
<p>[24] Avoid uninitialized variables; §<a
href="#part0006.html#ch01lev1sec4" class="calibre6">1.4</a>; [CG:
ES.20].</p>
<p>[25] Keep scopes small; §<a href="#part0006.html#ch01lev1sec5"
class="calibre6">1.5</a>; [CG: ES.5].</p>
<p>[26] When declaring a variable in the condition of an <code
class="calibre8">if</code>-statement, prefer the version with the
implicit test against <code class="calibre8">0</code>; §<a
href="#part0006.html#ch01lev1sec8" class="calibre6">1.8</a>.</p>
<p>[27] Use <code class="calibre8">unsigned</code> for bit manipulation
only; §<a href="#part0006.html#ch01lev1sec4" class="calibre6">1.4</a>;
[CG: ES.101] [CG: ES.106].</p>
<p>[28] Keep use of pointers simple and straightforward; §<a
href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>; [CG:
ES.42].</p>
<p>[29] Use <code class="calibre8">nullptr</code> rather than <code
class="calibre8">0</code> or <code class="calibre8">NULL</code>; §<a
href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>; [CG:
ES.47].</p>
<p>[30] Don’t declare a variable until you have a value to initialize it
with; §<a href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>,
§<a href="#part0006.html#ch01lev1sec8" class="calibre6">1.8</a>; [CG:
ES.21].</p>
<p>[31] Don’t say in comments what can be clearly stated in code; [CG:
NL.1].</p>
<p>[32] State intent in comments; [CG: NL.2].</p>
<p>[33] Maintain a consistent indentation style; [CG: NL.4].</p>
</section>
<p><span id="part0007.html"></span></p>
<section id="part0007.html#ch02" class="h1 bodymatter">
<h2 class="h1"><span id="part0007.html#page_21"
class="calibre2 pagebreak"></span><span class="big">2</span></h2>
<p>User-Defined Types</p>
<p><em>Don’t Panic!</em></p>
<p><em>– Douglas Adams</em></p>
<ul>
<li><p><a href="#part0007.html#ch02lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0007.html#ch02lev1sec2"
class="calibre6">Structures</a></p></li>
<li><p><a href="#part0007.html#ch02lev1sec3"
class="calibre6">Classes</a></p></li>
<li><p><a href="#part0007.html#ch02lev1sec4"
class="calibre6">Unions</a></p></li>
<li><p><a href="#part0007.html#ch02lev1sec5"
class="calibre6">Enumerations</a></p></li>
<li><p><a href="#part0007.html#ch02lev1sec6"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0007.html#ch02lev1sec1">2.1 Introduction</h3>
<p>We call the types that can be built from the fundamental types (§<a
href="#part0006.html#ch01lev1sec4" class="calibre6">1.4</a>), the <code
class="calibre8">const</code> modifier (§<a
href="#part0006.html#ch01lev1sec6" class="calibre6">1.6</a>), and the
declarator operators (§<a href="#part0006.html#ch01lev1sec7"
class="calibre6">1.7</a>) <em>built-in types</em>. C++’s set of built-in
types and operations is rich, but deliberately low-level. They directly
and efficiently reflect the capabilities of conventional computer
hardware. However, they don’t provide the programmer with high-level
facilities to conveniently write advanced applications. Instead, C++
augments the built-in types and operations with a sophisticated set of
<em>abstraction mechanisms</em> out of which programmers can build such
high-level facilities.</p>
<p>The C++ abstraction mechanisms are primarily designed to let
programmers design and implement their own types, with suitable
representations and operations, and for programmers to simply and
elegantly use such types. Types built out of other types using C++’s
abstraction mechanisms are called <em>user-defined types</em>. They are
referred to as <em>classes</em> and <em>enumerations</em>. User defined
types can be built out of both built-in types and other user-defined
types. Most of this book is devoted to the design, implementation, and
use of user-defined types. User-defined types are often preferred over
built-in types because they are easier to use, less error-prone, and
typically as efficient for what they do as direct use of built-in types,
or even faster.</p>
<p><span id="part0007.html#page_22" class="pagebreak"></span>The rest of
this chapter presents the simplest and most fundamental facilities for
defining and using types. <a href="#part0009.html#ch04"
class="calibre6">Chapters 4</a>–<a href="#part0012.html#ch07"
class="calibre6">7</a> are a more complete description of the
abstraction mechanisms and the programming styles they support. <a
href="#part0013.html#ch08" class="calibre6">Chapters 8</a>–<a
href="#part0020.html#ch15" class="calibre6">15</a> present an overview
of the standard library, and since the standard library mainly consists
of user-defined types, they provide examples of what can be built using
the language facilities and programming techniques presented in <a
href="#part0006.html#ch01" class="calibre6">Chapters 1</a>–<a
href="#part0012.html#ch07" class="calibre6">7</a>.</p>
<h3 class="h2" id="part0007.html#ch02lev1sec2">2.2 Structures</h3>
<p>The first step in building a new type is often to organize the
elements it needs into a data structure, a <code
class="calibre8">struct</code>:</p>
<p><a href="#part0026_split_000.html#p0022_01a"
id="part0007.html#p0022_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb48"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>     int sz<span class="kw">;</span>       <span class="fu">//</span> <span class="dt">number</span> of elements</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>     double<span class="fu">*</span> elem<span class="kw">;</span> <span class="fu">//</span> pointer to elements</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>This first version of <code class="calibre8">Vector</code> consists
of an <code class="calibre8">int</code> and a <code
class="calibre8">double*</code>.</p>
<p>A variable of type <code class="calibre8">Vector</code> can be
defined like this:</p>
<div class="sourceCode" id="cb49"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> v<span class="kw">;</span></span></code></pre></div>
<p>However, by itself that is not of much use because <code
class="calibre8">v</code>’s <code class="calibre8">elem</code> pointer
doesn’t point to anything. For it to be useful, we must give <code
class="calibre8">v</code> some elements to point to. For example, we can
construct a <code class="calibre8">Vector</code> like this:</p>
<p><a href="#part0026_split_001.html#p0022_02a"
id="part0007.html#p0022_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb50"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>void vector_init(<span class="dt">Vector</span>&amp; v<span class="kw">,</span> int s)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>     v.elem <span class="kw">=</span> new double[s]<span class="kw">;</span> <span class="fu">//</span> allocate an array of s doubles</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>     v.sz <span class="kw">=</span> s<span class="kw">;</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>That is, <code class="calibre8">v</code>’s <code
class="calibre8">elem</code> member gets a pointer produced by the <code
class="calibre8">new</code> operator and <code
class="calibre8">v</code>’s <code class="calibre8">sz</code> member gets
the number of elements. The <code class="calibre8">&amp;</code> in <code
class="calibre8">Vector&amp;</code> indicates that we pass <code
class="calibre8">v</code> by non-<code class="calibre8">const</code>
reference (§<a href="#part0006.html#ch01lev1sec7"
class="calibre6">1.7</a>); that way, <code
class="calibre8">vector_init()</code> can modify the vector passed to
it.</p>
<p>The <code class="calibre8">new</code> operator allocates memory from
an area called the <em>free store</em> (also known as <em>dynamic
memory</em> and <em>heap</em>). Objects allocated on the free store are
independent of the scope from which they are created and “live” until
they are destroyed using the <code class="calibre8">delete</code>
operator (§<a href="#part0009.html#ch04lev2sec2"
class="calibre6">4.2.2</a>).</p>
<p>A simple use of <code class="calibre8">Vector</code> looks like
this:</p>
<p><a href="#part0026_split_002.html#p0022_03a"
id="part0007.html#p0022_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb51"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>double read_and_sum(int s)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> <span class="fu">read</span> s integers from cin and return their sum<span class="kw">;</span> s <span class="dt">is</span> assumed to be positive</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> v<span class="kw">;</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>     vector_init(v<span class="kw">,</span>s)<span class="kw">;</span>               <span class="fu">//</span> allocate s elements for v</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>     for (int i<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>s<span class="kw">;</span> ++i)</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>           cin<span class="al">&gt;&gt;</span>v<span class="kw">.</span>elem[i]<span class="kw">;</span>           <span class="fu">//</span> <span class="fu">read</span> into elements</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>     double sum <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>     for (int i<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>s<span class="kw">;</span> ++i)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>           sum+=v<span class="kw">.</span>elem[i]<span class="kw">;</span>           <span class="fu">//</span> compute the sum of the elements</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>     return sum<span class="kw">;</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p><span id="part0007.html#page_23" class="pagebreak"></span>There is a
long way to go before our <code class="calibre8">Vector</code> is as
elegant and flexible as the standard-library <code
class="calibre8">vector</code>. In particular, a user of <code
class="calibre8">Vector</code> has to know every detail of <code
class="calibre8">Vector</code>’s representation. The rest of this
chapter and the next two gradually improve <code
class="calibre8">Vector</code> as an example of language features and
techniques. <a href="#part0016.html#ch11" class="calibre6">Chapter
11</a> presents the standard-library <code
class="calibre8">vector</code>, which contains many nice
improvements.</p>
<p>I use <code class="calibre8">vector</code> and other standard-library
components as examples</p>
<ul>
<li><p>to illustrate language features and design techniques,
and</p></li>
<li><p>to help you learn and use the standard-library
components.</p></li>
</ul>
<p>Don’t reinvent standard-library components such as <code
class="calibre8">vector</code> and <code class="calibre8">string</code>;
use them.</p>
<p>We use <code class="calibre8">.</code> (dot) to access <code
class="calibre8">struct</code> members through a name (and through a
reference) and <code class="calibre8">−&gt;</code> to access <code
class="calibre8">struct</code> members through a pointer. For
example:</p>
<p><a href="#part0026_split_003.html#p0023_01a"
id="part0007.html#p0023_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb52"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>void f(<span class="dt">Vector</span> v<span class="kw">,</span> <span class="dt">Vector</span>&amp; rv<span class="kw">,</span> <span class="dt">Vector</span><span class="fu">*</span> pv)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>     int i1 <span class="kw">=</span> v.sz<span class="kw">;</span>       <span class="fu">//</span> access through name</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>     int i2 <span class="kw">=</span> rv.sz<span class="kw">;</span>      <span class="fu">//</span> access through reference</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>     int i3 <span class="kw">=</span> pv<span class="er">−</span><span class="dt">&gt;</span>sz<span class="kw">;</span>     <span class="fu">//</span> access through pointer</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h3 class="h2" id="part0007.html#ch02lev1sec3">2.3 Classes</h3>
<p>Having the data specified separately from the operations on it has
advantages, such as the ability to use the data in arbitrary ways.
However, a tighter connection between the representation and the
operations is needed for a user-defined type to have all the properties
expected of a “real type.” In particular, we often want to keep the
representation inaccessible to users so as to ease use, guarantee
consistent use of the data, and allow us to later improve the
representation. To do that we have to distinguish between the interface
to a type (to be used by all) and its implementation (which has access
to the otherwise inaccessible data). The language mechanism for that is
called a <em>class</em>. A class has a set of <em>members</em>, which
can be data, function, or type members. The interface is defined by the
<code class="calibre8">public</code> members of a class, and <code
class="calibre8">private</code> members are accessible only through that
interface. For example:</p>
<p><a href="#part0026_split_004.html#p0023_02a"
id="part0007.html#p0023_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb53"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>(int s) <span class="fu">:</span>elem<span class="kw">{</span>new double[s]<span class="kw">},</span> sz<span class="kw">{</span>s<span class="kw">}</span> <span class="kw">{</span> <span class="kw">}</span>   <span class="fu">//</span> construct a <span class="dt">Vector</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>     double&amp; operator[](int i) <span class="kw">{</span> return elem[i]<span class="kw">;</span> <span class="kw">}</span>   <span class="fu">//</span> element access<span class="fu">:</span> subscripting</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>     int size() <span class="kw">{</span> return sz<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>     double<span class="fu">*</span> elem<span class="kw">;</span> <span class="fu">//</span> pointer to the elements</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>     int sz<span class="kw">;</span>       <span class="fu">//</span> the <span class="dt">number</span> of elements</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p><span id="part0007.html#page_24" class="pagebreak"></span>Given that,
we can define a variable of our new type <code
class="calibre8">Vector</code>:</p>
<p><a href="#part0026_split_005.html#p0024_01a"
id="part0007.html#p0024_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb54"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> v(<span class="dv">6</span>)<span class="kw">;</span>    <span class="fu">//</span> a <span class="dt">Vector</span> with <span class="dv">6</span> elements</span></code></pre></div>
<p>We can illustrate a <code class="calibre8">Vector</code> object
graphically:</p>
<figure>
<img src="images/00010.jpeg" class="calibre1" />
</figure>
<p>Basically, the <code class="calibre8">Vector</code> object is a
“handle” containing a pointer to the elements (<code
class="calibre8">elem</code>) and the number of elements (<code
class="calibre8">sz</code>). The number of elements (6 in the example)
can vary from <code class="calibre8">Vector</code> object to <code
class="calibre8">Vector</code> object, and a <code
class="calibre8">Vector</code> object can have a different number of
elements at different times (§<a href="#part0009.html#ch04lev2sec3"
class="calibre6">4.2.3</a>). However, the <code
class="calibre8">Vector</code> object itself is always the same size.
This is the basic technique for handling varying amounts of information
in C++: a fixed-size handle referring to a variable amount of data
“elsewhere” (e.g., on the free store allocated by <code
class="calibre8">new</code>; §<a href="#part0009.html#ch04lev2sec2"
class="calibre6">4.2.2</a>). How to design and use such objects is the
main topic of <a href="#part0009.html#ch04" class="calibre6">Chapter
4</a>.</p>
<p>Here, the representation of a <code class="calibre8">Vector</code>
(the members <code class="calibre8">elem</code> and <code
class="calibre8">sz</code>) is accessible only through the interface
provided by the <code class="calibre8">public</code> members: <code
class="calibre8">Vector()</code>, <code
class="calibre8">operator[]()</code>, and <code
class="calibre8">size()</code>. The <code
class="calibre8">read_and_sum()</code> example from §<a
href="#part0007.html#ch02lev1sec2" class="calibre6">2.2</a> simplifies
to:</p>
<p><a href="#part0026_split_006.html#p0024_02a"
id="part0007.html#p0024_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb55"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>double read_and_sum(int s)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> v(s)<span class="kw">;</span>                         <span class="fu">//</span> make a vector of s elements</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>     for (int i<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>v<span class="al">.</span>size()<span class="kw">;</span> ++i)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>           cin<span class="al">&gt;&gt;</span>v[i]<span class="kw">;</span>                     <span class="fu">//</span> <span class="fu">read</span> into elements</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>     double sum <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>     for (int i<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>v<span class="al">.</span>size()<span class="kw">;</span> ++i)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>           sum+=v[i]<span class="kw">;</span>                     <span class="fu">//</span> take the sum of the elements</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>     return sum<span class="kw">;</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>A member “function” with the same name as its class is called a
<em>constructor</em>, that is, a function used to construct objects of a
class. So, the constructor, <code class="calibre8">Vector()</code>,
replaces <code class="calibre8">vector_init()</code> from §<a
href="#part0007.html#ch02lev1sec2" class="calibre6">2.2</a>. Unlike an
ordinary function, a constructor is guaranteed to be used to initialize
objects of its class. Thus, defining a constructor eliminates the
problem of uninitialized variables for a class.</p>
<p><code class="calibre8">Vector(int)</code> defines how objects of type
<code class="calibre8">Vector</code> are constructed. In particular, it
states that it needs an integer to do that. That integer is used as the
number of elements. The constructor initializes the <code
class="calibre8">Vector</code> members using a member initializer
list:</p>
<div class="sourceCode" id="cb56"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">:</span>elem<span class="kw">{</span>new double[s]<span class="kw">},</span> sz<span class="kw">{</span>s<span class="kw">}</span></span></code></pre></div>
<p>That is, we first initialize <code class="calibre8">elem</code> with
a pointer to <code class="calibre8">s</code> elements of type <code
class="calibre8">double</code> obtained from the free store. Then, we
initialize <code class="calibre8">sz</code> to <code
class="calibre8">s</code>.</p>
<p>Access to elements is provided by a subscript function, called <code
class="calibre8">operator[]</code>. It returns a reference to the
appropriate element (a <code class="calibre8">double&amp;</code>
allowing both reading and writing).</p>
<p><span id="part0007.html#page_25" class="pagebreak"></span>The <code
class="calibre8">size()</code> function is supplied to give users the
number of elements.</p>
<p>Obviously, error handling is completely missing, but we’ll return to
that in §<a href="#part0008.html#ch03lev1sec5" class="calibre6">3.5</a>.
Similarly, we did not provide a mechanism to “give back” the array of
<code class="calibre8">double</code>s acquired by <code
class="calibre8">new</code>; §<a href="#part0009.html#ch04lev2sec2"
class="calibre6">4.2.2</a> shows how to use a destructor to elegantly do
that.</p>
<p>There is no fundamental difference between a <code
class="calibre8">struct</code> and a <code
class="calibre8">class</code>; a <code class="calibre8">struct</code> is
simply a <code class="calibre8">class</code> with members <code
class="calibre8">public</code> by default. For example, you can define
constructors and other member functions for a <code
class="calibre8">struct</code>.</p>
<h3 class="h2" id="part0007.html#ch02lev1sec4">2.4 Unions</h3>
<p>A <code class="calibre8">union</code> is a <code
class="calibre8">struct</code> in which all members are allocated at the
same address so that the <code class="calibre8">union</code> occupies
only as much space as its largest member. Naturally, a <code
class="calibre8">union</code> can hold a value for only one member at a
time. For example, consider a symbol table entry that holds a name and a
value. The value can either be a <code class="calibre8">Node*</code> or
an <code class="calibre8">int</code>:</p>
<p><a href="#part0026_split_007.html#p0025_01a"
id="part0007.html#p0025_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb57"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>enum <span class="dt">Type</span> <span class="kw">{</span> ptr<span class="kw">,</span> num <span class="kw">};</span> <span class="fu">//</span> a <span class="dt">Type</span> can hold values ptr and num (<span class="er">§</span><span class="fl">2.5</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Entry</span> <span class="kw">{</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>     string name<span class="kw">;</span>  <span class="fu">//</span> string <span class="dt">is</span> a standard<span class="dt">-</span>library type</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Type</span> t<span class="kw">;</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Node</span><span class="fu">*</span> p<span class="kw">;</span> <span class="fu">//</span> use p if t<span class="fu">==</span>ptr</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>     int i<span class="kw">;</span>   <span class="fu">//</span> use i if t<span class="fu">==</span>num</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>void f(<span class="dt">Entry</span><span class="fu">*</span> pe)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>     if (pe<span class="er">−</span><span class="dt">&gt;</span>t <span class="fu">==</span> num)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> pe<span class="er">−</span><span class="dt">&gt;</span>i<span class="kw">;</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The members <code class="calibre8">p</code> and <code
class="calibre8">i</code> are never used at the same time, so space is
wasted. It can be easily recovered by specifying that both should be
members of a <code class="calibre8">union</code>, like this:</p>
<p><a href="#part0026_split_008.html#p0025_02a"
id="part0007.html#p0025_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb58"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>union <span class="dt">Value</span> <span class="kw">{</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Node</span><span class="fu">*</span> p<span class="kw">;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>     int i<span class="kw">;</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>The language doesn’t keep track of which kind of value is held by a
<code class="calibre8">union</code>, so the programmer must do that:</p>
<p><a href="#part0026_split_009.html#p0025_03a"
id="part0007.html#p0025_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb59"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Entry</span> <span class="kw">{</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>     string name<span class="kw">;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Type</span> t<span class="kw">;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Value</span> v<span class="kw">;</span>  <span class="fu">//</span> use v.p if t<span class="fu">==</span>ptr<span class="kw">;</span> use v.i if t<span class="fu">==</span>num</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>void f(<span class="dt">Entry</span><span class="fu">*</span> pe)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>     if (pe<span class="er">−</span><span class="dt">&gt;</span>t <span class="fu">==</span> num)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> pe<span class="er">−</span><span class="dt">&gt;</span>v.i<span class="kw">;</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0007.html#page_26" class="pagebreak"></span>Maintaining
the correspondence between a <em>type field</em> (here, <code
class="calibre8">t</code>) and the type held in a <code
class="calibre8">union</code> is error-prone. To avoid errors, we can
enforce that correspondence by encapsulating the union and the type
field in a class and offer access only through member functions that use
the union correctly. At the application level, abstractions relying on
such <em>tagged unions</em> are common and useful. The use of “naked”
<code class="calibre8">union</code>s is best minimized.</p>
<p>The standard library type, <code class="calibre8">variant</code>, can
be used to eliminate most direct uses of unions. A <code
class="calibre8">variant</code> stores a value of one of a set of
alternative types (§<a href="#part0018.html#ch13lev2sec6"
class="calibre6">13.5.1</a>). For example, a <code
class="calibre8">variant&lt;Node*,int&gt;</code> can hold either a <code
class="calibre8">Node*</code> or an <code
class="calibre8">int</code>.</p>
<p>Using <code class="calibre8">variant</code>, the <code
class="calibre8">Entry</code> example could be written as:</p>
<p><a href="#part0026_split_010.html#p0026_01a"
id="part0007.html#p0026_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb60"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Entry</span> <span class="kw">{</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>     string name<span class="kw">;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>     variant<span class="dt">&lt;Node*</span><span class="kw">,</span>int<span class="dt">&gt;</span> v<span class="kw">;</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>void f(<span class="dt">Entry</span><span class="fu">*</span> pe)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>     if (holds_alternative<span class="dt">&lt;</span>int<span class="er">&gt;</span>(pe<span class="er">−</span><span class="dt">&gt;</span>v))  <span class="fu">//</span> does <span class="fu">*</span>pe hold an int? (see <span class="er">§</span><span class="fl">13.5</span><span class="al">.</span><span class="dv">1</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> get<span class="dt">&lt;</span>int<span class="er">&gt;</span>(pe<span class="er">−</span><span class="dt">&gt;</span>v)<span class="kw">;</span>      <span class="fu">//</span> get the int</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>For many uses, a <code class="calibre8">variant</code> is simpler and
safer to use than a <code class="calibre8">union</code>.</p>
<h3 class="h2" id="part0007.html#ch02lev1sec5">2.5 Enumerations</h3>
<p>In addition to classes, C++ supports a simple form of user-defined
type for which we can enumerate the values:</p>
<p><a href="#part0026_split_011.html#p0026_02a"
id="part0007.html#p0026_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb61"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>enum class <span class="dt">Color</span> <span class="kw">{</span> red<span class="kw">,</span> blue<span class="kw">,</span> green <span class="kw">};</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>enum class <span class="dt">Traffic_light</span> <span class="kw">{</span> green<span class="kw">,</span> yellow<span class="kw">,</span> red <span class="kw">};</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="dt">Color</span> col <span class="kw">=</span> <span class="dt">Color</span>::red<span class="kw">;</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="dt">Traffic_light</span> light <span class="kw">=</span> <span class="dt">Traffic_light</span>::red<span class="kw">;</span></span></code></pre></div>
<p>Note that enumerators (e.g., <code class="calibre8">red</code>) are
in the scope of their <code class="calibre8">enum class</code>, so that
they can be used repeatedly in different <code
class="calibre8">enum class</code>es without confusion. For example,
<code class="calibre8">Color::red</code> is <code
class="calibre8">Color</code>’s <code class="calibre8">red</code> which
is different from <code class="calibre8">Traffic_light::red</code>.</p>
<p>Enumerations are used to represent small sets of integer values. They
are used to make code more readable and less error-prone than it would
have been had the symbolic (and mnemonic) enumerator names not been
used.</p>
<p><span id="part0007.html#page_27" class="pagebreak"></span>The <code
class="calibre8">class</code> after the <code
class="calibre8">enum</code> specifies that an enumeration is strongly
typed and that its enumerators are scoped. Being separate types, <code
class="calibre8">enum class</code>es help prevent accidental misuses of
constants. In particular, we cannot mix <code
class="calibre8">Traffic_light</code> and <code
class="calibre8">Color</code> values:</p>
<p><a href="#part0026_split_012.html#p0027_01a"
id="part0007.html#p0027_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb62"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Color</span> x <span class="kw">=</span> red<span class="kw">;</span>                  <span class="fu">//</span> error<span class="fu">:</span> which red?</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Color</span> y <span class="kw">=</span> <span class="dt">Traffic_light</span>::red<span class="kw">;</span>   <span class="fu">//</span> error<span class="fu">:</span> that red <span class="dt">is</span> not a <span class="dt">Color</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Color</span> z <span class="kw">=</span> <span class="dt">Color</span>::red<span class="kw">;</span>           <span class="fu">//</span> <span class="dt">OK</span></span></code></pre></div>
<p>Similarly, we cannot implicitly mix <code
class="calibre8">Color</code> and integer values:</p>
<p><a href="#part0026_split_013.html#p0027_02a"
id="part0007.html#p0027_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb63"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>int i <span class="kw">=</span> <span class="dt">Color</span>::red<span class="kw">;</span>        <span class="fu">//</span> error<span class="fu">:</span> <span class="dt">Color</span>::red <span class="dt">is</span> not an int</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Color</span> c <span class="kw">=</span> <span class="dv">2</span><span class="kw">;</span>               <span class="fu">//</span> <span class="kw">initialization</span> error<span class="fu">:</span> <span class="dv">2</span> <span class="dt">is</span> not a <span class="dt">Color</span></span></code></pre></div>
<p>Catching attempted conversions to an enum is a good defense against
errors, but often we want to initialize an enum with a value from its
underlying type (by default, that’s <code class="calibre8">int</code>),
so that’s allowed, as is explicit conversion from the underlying
type:</p>
<p><a href="#part0026_split_014.html#p0027_03a"
id="part0007.html#p0027_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb64"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Color</span> x <span class="kw">=</span> <span class="dt">Color</span><span class="kw">{</span><span class="dv">5</span><span class="kw">};</span>  <span class="fu">//</span> <span class="dt">OK</span><span class="kw">,</span> but verbose</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Color</span> y <span class="kw">{</span><span class="dv">6</span><span class="kw">};</span>         <span class="fu">//</span> also <span class="dt">OK</span></span></code></pre></div>
<p>By default, an <code class="calibre8">enum class</code> has only
assignment, initialization, and comparisons (e.g., <code
class="calibre8">==</code> and <code class="calibre8">&lt;</code>; §<a
href="#part0006.html#ch01lev1sec4" class="calibre6">1.4</a>) defined.
However, an enumeration is a user-defined type, so we can define
operators for it:</p>
<p><a href="#part0026_split_015.html#p0027_04a"
id="part0007.html#p0027_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb65"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Traffic_light</span>&amp; operator++(<span class="dt">Traffic_light</span>&amp; t)         <span class="fu">//</span> prefix increment<span class="fu">:</span> ++</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>     switch (t) <span class="kw">{</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>     case <span class="dt">Traffic_light</span>::green<span class="fu">:</span>     return t<span class="kw">=</span><span class="dt">Traffic_light</span>::yellow<span class="kw">;</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>     case <span class="dt">Traffic_light</span>::yellow<span class="fu">:</span>    return t<span class="kw">=</span><span class="dt">Traffic_light</span>::red<span class="kw">;</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>     case <span class="dt">Traffic_light</span>::red<span class="fu">:</span>       return t<span class="kw">=</span><span class="dt">Traffic_light</span>::green<span class="kw">;</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="dt">Traffic_light</span> next <span class="kw">=</span> ++light<span class="kw">;</span>       <span class="fu">//</span> next becomes <span class="dt">Traffic_light</span>::green</span></code></pre></div>
<p>If you don’t want to explicitly qualify enumerator names and want
enumerator values to be <code class="calibre8">int</code>s (without the
need for an explicit conversion), you can remove the <code
class="calibre8">class</code> from <code
class="calibre8">enum class</code> to get a “plain” <code
class="calibre8">enum</code>. The enumerators from a “plain” <code
class="calibre8">enum</code> are entered into the same scope as the name
of their <code class="calibre8">enum</code> and implicitly converts to
their integer value. For example:</p>
<p><a href="#part0026_split_016.html#p0027_05a"
id="part0007.html#p0027_05" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb66"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>enum <span class="dt">Color</span> <span class="kw">{</span> red<span class="kw">,</span> green<span class="kw">,</span> blue <span class="kw">};</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>int col <span class="kw">=</span> green<span class="kw">;</span></span></code></pre></div>
<p>Here <code class="calibre8">col</code> gets the value <code
class="calibre8">1</code>. By default, the integer values of enumerators
start with <code class="calibre8">0</code> and increase by one for each
additional enumerator. The “plain” <code class="calibre8">enum</code>s
have been in C++ (and C) since the earliest days, so even though they
are less well behaved, they are common in current code.</p>
<h3 class="h2" id="part0007.html#ch02lev1sec6">2.6 Advice</h3>
<p>[1] Prefer well-defined user-defined types over built-in types when
the built-in types are too low-level; §<a
href="#part0007.html#ch02lev1sec1" class="calibre6">2.1</a>.</p>
<p><span id="part0007.html#page_28" class="pagebreak"></span>[2]
Organize related data into structures (<code
class="calibre8">struct</code>sor <code
class="calibre8">class</code>es); §<a href="#part0007.html#ch02lev1sec2"
class="calibre6">2.2</a>; [CG: C.1].</p>
<p>[3] Represent the distinction between an interface and an
implementation using a <code class="calibre8">class</code>; §<a
href="#part0007.html#ch02lev1sec3" class="calibre6">2.3</a>; [CG:
C.3].</p>
<p>[4] A <code class="calibre8">struct</code> is simply a <code
class="calibre8">class</code> with its members <code
class="calibre8">public</code> by default; §<a
href="#part0007.html#ch02lev1sec3" class="calibre6">2.3</a>.</p>
<p>[5] Define constructors to guarantee and simplify initialization of
<code class="calibre8">class</code>es; §<a
href="#part0007.html#ch02lev1sec3" class="calibre6">2.3</a>; [CG:
C.2].</p>
<p>[6] Avoid “naked” <code class="calibre8">union</code>s; wrap them in
a class together with a type field; §<a
href="#part0007.html#ch02lev1sec4" class="calibre6">2.4</a>; [CG:
C.181].</p>
<p>[7] Use enumerations to represent sets of named constants; §<a
href="#part0007.html#ch02lev1sec5" class="calibre6">2.5</a>; [CG:
Enum.2].</p>
<p>[8] Prefer <code class="calibre8">class enum</code>s over “plain”
<code class="calibre8">enum</code>s to minimize surprises; §<a
href="#part0007.html#ch02lev1sec5" class="calibre6">2.5</a>; [CG:
Enum.3].</p>
<p>[9] Define operations on enumerations for safe and simple use; §<a
href="#part0007.html#ch02lev1sec5" class="calibre6">2.5</a>; [CG:
Enum.4].</p>
</section>
<p><span id="part0008.html"></span></p>
<section id="part0008.html#ch03" class="h1 bodymatter">
<h2 class="h1"><span id="part0008.html#page_29"
class="calibre2 pagebreak"></span><span class="big">3</span></h2>
<p>Modularity</p>
<p><em>Don’t interrupt me while I’m interrupting.</em></p>
<p><em>– Winston S. Churchill</em></p>
<ul>
<li><p><a href="#part0008.html#ch03lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0008.html#ch03lev1sec2" class="calibre6">Separate
Compilation</a></p></li>
<li><p><a href="#part0008.html#ch03lev1sec3"
class="calibre6">Modules</a></p></li>
<li><p><a href="#part0008.html#ch03lev1sec4"
class="calibre6">Namespaces</a></p></li>
<li><p><a href="#part0008.html#ch03lev1sec5" class="calibre6">Error
Handling</a></p>
<p><a href="#part0008.html#ch03lev2sec1"
class="calibre6">Exceptions</a>; <a href="#part0008.html#ch03lev2sec2"
class="calibre6">Invariants</a>; <a href="#part0008.html#ch03lev2sec3"
class="calibre6">Error-Handling Alternatives</a>; <a
href="#part0008.html#ch03lev2sec4" class="calibre6">Contracts</a>; <a
href="#part0008.html#ch03lev2sec5" class="calibre6">Static
Assertions</a></p></li>
<li><p><a href="#part0008.html#ch03lev1sec6" class="calibre6">Function
Arguments and Return Values</a></p>
<p><a href="#part0008.html#ch03lev2sec6" class="calibre6">Argument
Passing</a>; <a href="#part0008.html#ch03lev2sec7"
class="calibre6">Value Return</a>; <a href="#part0008.html#ch03lev2sec8"
class="calibre6">Structured Binding</a></p></li>
<li><p><a href="#part0008.html#ch03lev1sec7"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0008.html#ch03lev1sec1">3.1 Introduction</h3>
<p>A C++ program consists of many separately developed parts, such as
functions (§<a href="#part0006.html#ch01lev2sec1"
class="calibre6">1.2.1</a>), user-defined types (<a
href="#part0007.html#ch02" class="calibre6">Chapter 2</a>), class
hierarchies (§<a href="#part0009.html#ch04lev1sec5"
class="calibre6">4.5</a>), and templates (<a href="#part0011.html#ch06"
class="calibre6">Chapter 6</a>). The key to managing this is to clearly
define the interactions among those parts. The first and most important
step is to distinguish between the interface to a part and its
implementation. At the language level, C++ represents interfaces by
declarations. A <em>declaration</em> specifies all that’s needed to use
a function or a type. For example:</p>
<p><a href="#part0027_split_000.html#p0029_01a"
id="part0008.html#p0029_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb67"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>double sqrt(double)<span class="kw">;</span>     <span class="fu">//</span> the square root function takes a double and returns a double</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>(int s)<span class="kw">;</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>     double&amp; operator[](int i)<span class="kw">;</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>     int size()<span class="kw">;</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>     double<span class="fu">*</span> elem<span class="kw">;</span> <span class="fu">//</span> elem points to an array of sz doubles</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>     int sz<span class="kw">;</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p><span id="part0008.html#page_30" class="pagebreak"></span>The key
point here is that the function bodies, the function
<em>definitions</em>, are “elsewhere.” For this example, we might like
for the representation of <code class="calibre8">Vector</code> to be
“elsewhere” also, but we will deal with that later (abstract types; §<a
href="#part0009.html#ch04lev1sec3" class="calibre6">4.3</a>). The
definition of <code class="calibre8">sqrt()</code> will look like
this:</p>
<p><a href="#part0027_split_001.html#p0030_01a"
id="part0008.html#p0030_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb68"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>double sqrt(double d)        <span class="fu">//</span> definition of sqrt()</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... algorithm as found in math textbook ...</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>For <code class="calibre8">Vector</code>, we need to define all three
member functions:</p>
<p><a href="#part0027_split_002.html#p0030_02a"
id="part0008.html#p0030_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb69"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span>::<span class="dt">Vector</span>(int s)                  <span class="fu">//</span> definition of the constructor</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">:</span>elem<span class="kw">{</span>new double[s]<span class="kw">},</span> sz<span class="kw">{</span>s<span class="kw">}</span>       <span class="fu">//</span> initialize members</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>double&amp; <span class="dt">Vector</span>::operator[](int i)      <span class="fu">//</span> definition of subscripting</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>     return elem[i]<span class="kw">;</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>int <span class="dt">Vector</span>::size()                     <span class="fu">//</span> definition of size()</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>     return sz<span class="kw">;</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>We must define <code class="calibre8">Vector</code>’s functions, but
not <code class="calibre8">sqrt()</code> because it is part of the
standard library. However, that makes no real difference: a library is
simply “some other code we happen to use” written with the same language
facilities we use.</p>
<p>There can be many declarations for an entity, such as a function, but
only one definition.</p>
<h3 class="h2" id="part0008.html#ch03lev1sec2">3.2 Separate
Compilation</h3>
<p>C++ supports a notion of separate compilation where user code sees
only declarations of the types and functions used. The definitions of
those types and functions are in separate source files and are compiled
separately. This can be used to organize a program into a set of
semi-independent code fragments. Such separation can be used to minimize
compilation times and to strictly enforce separation of logically
distinct parts of a program (thus minimizing the chance of errors). A
library is often a collection of separately compiled code fragments
(e.g., functions).</p>
<p>Typically, we place the declarations that specify the interface to a
module in a file with a name indicating its intended use. For
example:</p>
<p><a href="#part0027_split_003.html#p0031_01a"
id="part0008.html#p0031_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb70"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> <span class="dt">Vector</span><span class="kw">.</span>h<span class="fu">:</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>(int s)<span class="kw">;</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>     double&amp; operator[](int i)<span class="kw">;</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>     int size()<span class="kw">;</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>     double<span class="fu">*</span> elem<span class="kw">;</span>      <span class="fu">//</span> elem points to an array of sz doubles</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>     int sz<span class="kw">;</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>This declaration would be placed in a file <code
class="calibre8">Vector.h</code>. Users then <em>include</em> that file,
called a <em>header file</em>, to access that interface. For
example:</p>
<p><a href="#part0027_split_004.html#p0031_02a"
id="part0008.html#p0031_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb71"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> user<span class="kw">.</span>cpp<span class="fu">:</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>#<span class="al">include</span> <span class="ot">&quot;</span><span class="er">Vector</span><span class="ot">.</span><span class="er">h</span><span class="ot">&quot;</span>    <span class="fu">//</span> get <span class="dt">Vector</span><span class="st">&#39;</span><span class="er">s interface</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="er">#include &lt;cmath&gt;       // get the standard-library math function interface including sqrt()</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="er">double sqrt_sum(Vector&amp; v)</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="ch">     </span><span class="er">double sum = 0;</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="er">     for (int i=0; i!=v.size(); ++i)</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="er">           sum+=std::sqrt(v[i]);              // sum of square roots</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="er">     return sum;</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>To help the compiler ensure consistency, the <code
class="calibre8">.cpp</code> file providing the implementation of <code
class="calibre8">Vector</code> will also include the <code
class="calibre8">.h</code> file providing its interface:</p>
<p><a href="#part0027_split_005.html#p0031_03a"
id="part0008.html#p0031_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb72"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> <span class="dt">Vector</span><span class="kw">.</span>cpp<span class="fu">:</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>#<span class="al">include</span> <span class="ot">&quot;</span><span class="er">Vector</span><span class="ot">.</span><span class="er">h</span><span class="ot">&quot;</span> <span class="fu">//</span> get <span class="dt">Vector</span><span class="st">&#39;</span><span class="er">s interface</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="er">Vector::Vector(int s)</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="er">     :elem{new double[s]}, sz{s}      // initialize members</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="er">double&amp; Vector::operator[](int i)</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="ch">     </span><span class="er">return elem[i];</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a><span class="er">int Vector::size()</span></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a><span class="ch">     </span><span class="er">return sz;</span></span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>The code in <code class="calibre8">user.cpp</code> and <code
class="calibre8">Vector.cpp</code> shares the <code
class="calibre8">Vector</code> interface information presented in <code
class="calibre8">Vector.h</code>, <span id="part0008.html#page_32"
class="pagebreak"></span>but the two files are otherwise independent and
can be separately compiled. Graphically, the program fragments can be
represented like this:</p>
<figure>
<img src="images/00011.jpeg" class="calibre1" />
</figure>
<p>Strictly speaking, using separate compilation isn’t a language issue;
it is an issue of how best to take advantage of a particular language
implementation. However, it is of great practical importance. The best
approach to program organization is to think of the program as a set of
modules with well-defined dependencies, represent that modularity
logically through language features, and then exploit the modularity
physically through files for effective separate compilation.</p>
<p>A <code class="calibre8">.cpp</code> file that is compiled by itself
(including the <code class="calibre8">h</code> files it <code
class="calibre8">#include</code>s) is called a <em>translation
unit</em>. A program can consist of many thousand translation units.</p>
<h3 class="h2" id="part0008.html#ch03lev1sec3">3.3 Modules (C++20)</h3>
<p>The use of <code class="calibre8">#include</code>s is a very old,
error-prone, and rather expensive way of composing programs out of
parts. If you <code class="calibre8">#include header.h</code> in 101
translation units, the text of <code class="calibre8">header.h</code>
will be processed by the compiler 101 times. If you <code
class="calibre8">#include header1.h</code> before <code
class="calibre8">header2.h</code> the declarations and macros in <code
class="calibre8">header1.h</code> might affect the meaning of the code
in <code class="calibre8">header2.h</code>. If instead you <code
class="calibre8">#include header2.h</code> before <code
class="calibre8">header1.h</code>, it is <code
class="calibre8">header2.h</code> that might affect the code in <code
class="calibre8">header1.h</code>. Obviously, this is not ideal, and in
fact it has been a major source of cost and bugs since 1972 when this
mechanism was first introduced into C.</p>
<p>We are finally about to get a better way of expressing physical
modules in C++. The language feature, called <code
class="calibre8">module</code>s is not yet ISO C++, but it is an ISO
Technical Specification [<a href="#part0021.html#ref34"
class="calibre6">ModulesTS</a>]. Implementations are in use, so I risk
recommending it here even though details are likely to change and it may
be years before everybody can use it in production code. Old code, in
this case code using <code class="calibre8">#include</code>, can “live”
for a very long time because it can be costly and time consuming to
update.</p>
<p>Consider how to express the <code class="calibre8">Vector</code> and
<code class="calibre8">use()</code> example from §<a
href="#part0008.html#ch03lev1sec2" class="calibre6">3.2</a> using <code
class="calibre8">module</code>s:</p>
<p><a href="#part0027_split_006.html#p0032_01a"
id="part0008.html#p0032_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb73"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> file <span class="dt">Vector</span><span class="kw">.</span>cpp<span class="fu">:</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>module<span class="kw">;</span>  <span class="fu">//</span> this compilation will define a module</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> ... here we put stuff that <span class="dt">Vector</span> might need for its implementation ...</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>export module <span class="dt">Vector</span><span class="kw">;</span>  <span class="fu">//</span> defining the module called <span class="ot">&quot;</span><span class="er">Vector</span><span class="ot">&quot;</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>export class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>(int s)<span class="kw">;</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>     double&amp; operator[](int i)<span class="kw">;</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>     int size()<span class="kw">;</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>     double<span class="fu">*</span> elem<span class="kw">;</span>     <span class="fu">//</span> elem points to an array of sz doubles</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>     int sz<span class="kw">;</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span>::<span class="dt">Vector</span>(int s)</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>     <span class="fu">:</span>elem<span class="kw">{</span>new double[s]<span class="kw">},</span> sz<span class="kw">{</span>s<span class="kw">}</span>        <span class="fu">//</span> initialize members</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>double&amp; <span class="dt">Vector</span>::operator[](int i)</span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>     return elem[i]<span class="kw">;</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>int <span class="dt">Vector</span>::size()</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>     return sz<span class="kw">;</span></span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>export int size(const <span class="dt">Vector</span>&amp; v) <span class="kw">{</span> return v.size()<span class="kw">;</span> <span class="kw">}</span></span></code></pre></div>
<p><span id="part0008.html#page_33" class="pagebreak"></span>This
defines a <code class="calibre8">module</code> called <code
class="calibre8">Vector</code>, which exports the class <code
class="calibre8">Vector</code>, all its member functions, and the
non-member function <code class="calibre8">size()</code>.</p>
<p>The way we use this <code class="calibre8">module</code> is to <code
class="calibre8">import</code> it where we need it. For example:</p>
<p><a href="#part0027_split_007.html#p0033_01a"
id="part0008.html#p0033_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb74"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> file user<span class="kw">.</span>cpp<span class="fu">:</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>import <span class="dt">Vector</span><span class="kw">;</span>         <span class="fu">//</span> get <span class="dt">Vector</span><span class="st">&#39;</span><span class="er">s interface</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="er">#include &lt;cmath&gt;       // get the standard-library math function interface including sqrt()</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="er">double sqrt_sum(Vector&amp; v)</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="ch">     </span><span class="er">double sum = 0;</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="er">     for (int i=0; i!=v.size(); ++i)</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="er">           sum+=std::sqrt(v[i]);        // sum of square roots</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="er">     return sum;</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>I could have <code class="calibre8">import</code>ed the standard
library mathematical functions also, but I used the old-fashioned <code
class="calibre8">#include</code> just to show that you can mix old and
new. Such mixing is essential for gradually upgrading older code from
using <code class="calibre8">#include</code> to <code
class="calibre8">import</code>.</p>
<p><span id="part0008.html#page_34" class="pagebreak"></span>The
differences between headers and modules are not just syntactic.</p>
<ul>
<li><p>A module is compiled once only (rather than in each translation
unit in which it is used).</p></li>
<li><p>Two modules can be <code class="calibre8">import</code>ed in
either order without changing their meaning.</p></li>
<li><p>If you import something into a module, users of your module do
not implicitly gain access to (and are not bothered by) what you
imported: <code class="calibre8">import</code> is not
transitive.</p></li>
</ul>
<p>The effects on maintainability and compile-time performance can be
spectacular.</p>
<h3 class="h2" id="part0008.html#ch03lev1sec4">3.4 Namespaces</h3>
<p>In addition to functions (§<a href="#part0006.html#ch01lev1sec3"
class="calibre6">1.3</a>), classes (§<a
href="#part0007.html#ch02lev1sec3" class="calibre6">2.3</a>), and
enumerations (§<a href="#part0007.html#ch02lev1sec5"
class="calibre6">2.5</a>), C++ offers <em>namespaces</em> as a mechanism
for expressing that some declarations belong together and that their
names shouldn’t clash with other names. For example, I might want to
experiment with my own complex number type (§<a
href="#part0009.html#ch04lev2sec1" class="calibre6">4.2.1</a>, §<a
href="#part0019.html#ch14lev1sec4" class="calibre6">14.4</a>):</p>
<p><a href="#part0027_split_008.html#p0034_01a"
id="part0008.html#p0034_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb75"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>namespace <span class="dt">My_code</span> <span class="kw">{</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    class complex <span class="kw">{</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">//</span> ...</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">};</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>    complex sqrt(complex)<span class="kw">;</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">//</span> ...</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    int main()<span class="kw">;</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>int <span class="dt">My_code</span>::main()</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    complex z <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">};</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>    auto z2 <span class="kw">=</span> sqrt(z)<span class="kw">;</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>    std::cout <span class="al">&lt;&lt;</span> <span class="st">&#39;{&#39;</span> <span class="al">&lt;&lt;</span> z2.real() <span class="al">&lt;&lt;</span> <span class="st">&#39;,&#39;</span> <span class="al">&lt;&lt;</span> z2.imag() <span class="al">&lt;&lt;</span> <span class="ot">&quot;}</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">//</span> ...</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>int main()</span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>    return <span class="dt">My_code</span>::main()<span class="kw">;</span></span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>By putting my code into the namespace <code
class="calibre8">My_code</code>, I make sure that my names do not
conflict with the standard-library names in namespace <code
class="calibre8">std</code> (§<a href="#part0008.html#ch03lev1sec4"
class="calibre6">3.4</a>). That precaution is wise, because the standard
library does provide support for <code class="calibre8">complex</code>
arithmetic (§<a href="#part0009.html#ch04lev2sec1"
class="calibre6">4.2.1</a>, §<a href="#part0019.html#ch14lev1sec4"
class="calibre6">14.4</a>).</p>
<p>The simplest way to access a name in another namespace is to qualify
it with the namespace name (e.g., <code
class="calibre8">std::cout</code> and <code
class="calibre8">My_code::main</code>). The “real <code
class="calibre8">main()</code>” is defined in the global namespace, that
is, not local to a defined namespace, class, or function.</p>
<p>If repeatedly qualifying a name becomes tedious or distracting, we
can bring the name into a scope with a <code
class="calibre8">using</code>-declaration:</p>
<p><a href="#part0027_split_009.html#p0035_01a"
id="part0008.html#p0035_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb76"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>void my_code(vector<span class="dt">&lt;</span>int&gt;&amp; x<span class="kw">,</span> vector<span class="dt">&lt;</span>int&gt;&amp; y)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>     using std::swap<span class="kw">;</span>        <span class="fu">//</span> use the standard<span class="fu">-</span>library swap</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>     swap(x<span class="kw">,</span>y)<span class="kw">;</span>              <span class="fu">//</span> std::swap()</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>     other::swap(x<span class="kw">,</span>y)<span class="kw">;</span>       <span class="fu">//</span> some other swap()</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>A <code class="calibre8">using</code>-declaration makes a name from a
namespace usable as if it was declared in the scope in which it appears.
After <code class="calibre8">using std::swap</code>, it is exactly as if
<code class="calibre8">swap</code> had been declared in <code
class="calibre8">my_code()</code>.</p>
<p>To gain access to all names in the standard-library namespace, we can
use a <code class="calibre8">using</code>-directive:</p>
<div class="sourceCode" id="cb77"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>using namespace std<span class="kw">;</span></span></code></pre></div>
<p>A <code class="calibre8">using</code>-directive makes unqualified
names from the named namespace accessible from the scope in which we
placed the directive. So after the <code
class="calibre8">using</code>-directive for <code
class="calibre8">std</code>, we can simply write <code
class="calibre8">cout</code> rather than <code
class="calibre8">std::cout</code>. By using a <code
class="calibre8">using</code>-directive, we lose the ability to
selectively use names from that namespace, so this facility should be
used carefully, usually for a library that’s pervasive in an application
(e.g., <code class="calibre8">std</code>) or during a transition for an
application that didn’t use <code
class="calibre8">namespace</code>s.</p>
<p>Namespaces are primarily used to organize larger program components,
such as libraries. They simplify the composition of a program out of
separately developed parts.</p>
<h3 class="h2" id="part0008.html#ch03lev1sec5">3.5 Error Handling</h3>
<p>Error handling is a large and complex topic with concerns and
ramifications that go far beyond language facilities into programming
techniques and tools. However, C++ provides a few features to help. The
major tool is the type system itself. Instead of painstakingly building
up our applications from the built-in types (e.g., <code
class="calibre8">char</code>, <code class="calibre8">int,</code> and
<code class="calibre8">double</code>) and statements (e.g., <code
class="calibre8">if</code>, <code class="calibre8">while,</code> and
<code class="calibre8">for</code>), we build types (e.g., <code
class="calibre8">string</code>, <code class="calibre8">map</code>, and
<code class="calibre8">regex</code>) and algorithms (e.g., <code
class="calibre8">sort()</code>, <code class="calibre8">find_if()</code>,
and <code class="calibre8">draw_all()</code>) that are appropriate for
our applications. Such higher-level constructs simplify our programming,
limit our opportunities for mistakes (e.g., you are unlikely to try to
apply a tree traversal to a dialog box), and increase the compiler’s
chances of catching errors. The majority of C++ language constructs are
dedicated to the design and implementation of elegant and efficient
abstractions (e.g., user-defined types and algorithms using them). One
effect of such abstraction is that the point where a run-time error can
be detected is separated from the point where it can be handled. As
programs grow, and especially when libraries are used extensively,
standards for handling errors become important. It is a good idea to
articulate a strategy for error handling early on in the development of
a program.</p>
<h4 class="h3" id="part0008.html#ch03lev2sec1">3.5.1 Exceptions</h4>
<p>Consider again the <code class="calibre8">Vector</code> example. What
<em>ought</em> to be done when we try to access an element that is out
of range for the vector from §<a href="#part0007.html#ch02lev1sec3"
class="calibre6">2.3</a>?</p>
<ul>
<li><p>The writer of <code class="calibre8">Vector</code> doesn’t know
what the user would like to have done in this case (the writer of <code
class="calibre8">Vector</code> typically doesn’t even know in which
program the vector will be running).</p></li>
<li><p><span id="part0008.html#page_36" class="pagebreak"></span>The
user of <code class="calibre8">Vector</code> cannot consistently detect
the problem (if the user could, the out-of-range access wouldn’t happen
in the first place).</p></li>
</ul>
<p>Assuming that out-of-range access is a kind of error that we want to
recover from, the solution is for the <code
class="calibre8">Vector</code> implementer to detect the attempted
out-of-range access and tell the user about it. The user can then take
appropriate action. For example, <code
class="calibre8">Vector::operator[]()</code> can detect an attempted
out-of-range access and throw an <code
class="calibre8">out_of_range</code> exception:</p>
<p><a href="#part0027_split_010.html#p0036_01a"
id="part0008.html#p0036_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb78"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>double&amp; <span class="dt">Vector</span>::operator[](int i)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>     if (i<span class="dt">&lt;</span><span class="dv">0</span> || size()&lt;=i)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>           <span class="kw">throw</span> out_of_range<span class="kw">{</span><span class="ot">&quot;</span><span class="er">Vector</span><span class="ot">::</span><span class="er">operator</span><span class="ot">[]&quot;</span><span class="kw">};</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>     return elem[i]<span class="kw">;</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The <code class="calibre8">throw</code> transfers control to a
handler for exceptions of type <code
class="calibre8">out_of_range</code> in some function that directly or
indirectly called <code class="calibre8">Vector::operator[]()</code>. To
do that, the implementation will <em>unwind</em> the function call stack
as needed to get back to the context of that caller. That is, the
exception handling mechanism will exit scopes and functions as needed to
get back to a caller that has expressed interest in handling that kind
of exception, invoking destructors (§<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>) along the
way as needed. For example:</p>
<p><a href="#part0027_split_011.html#p0036_02a"
id="part0008.html#p0036_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb79"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>void f(<span class="dt">Vector</span>&amp; v)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>     try<span class="kw">{</span> <span class="fu">//</span> exceptions here are handled by the handler defined below</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>          v[v.size()] <span class="kw">=</span> <span class="dv">7</span><span class="kw">;</span> <span class="fu">//</span> try to access beyond the end of v</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">catch</span> (out_of_range&amp; err) <span class="kw">{</span>   <span class="fu">//</span> oops<span class="fu">:</span> out_of_range error</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> ... handle range error ...</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>          cerr <span class="al">&lt;&lt;</span> err.what() <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>We put code for which we are interested in handling exceptions into a
<code class="calibre8">try</code>-block. The attempted assignment to
<code class="calibre8">v[v.size()]</code> will fail. Therefore, the
<code class="calibre8">catch</code>-clause providing a handler for
exceptions of type <code class="calibre8">out_of_range</code> will be
entered. The <code class="calibre8">out_of_range</code> type is defined
in the standard library (in <code
class="calibre8">&lt;stdexcept&gt;</code>) and is in fact used by some
standard-library container access functions.</p>
<p>I caught the exception by reference to avoid copying and used the
<code class="calibre8">what()</code> function to print the error message
put into it at the <code class="calibre8">throw</code>-point.</p>
<p>Use of the exception-handling mechanisms can make error handling
simpler, more systematic, and more readable. To achieve that, don’t
overuse <code class="calibre8">try</code>-statements. The main technique
for making error handling simple and systematic (called <em>Resource
Acquisition Is Initialization; RAII</em>) is explained in §<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>. The basic
idea behind RAII is for a constructor to acquire all resources necessary
for a class to operate and have the destructor release all resources,
thus making resource release guaranteed and implicit.</p>
<p><span id="part0008.html#page_37" class="pagebreak"></span>A function
that should never throw an exception can be declared <code
class="calibre8">noexcept</code>. For example:</p>
<p><a href="#part0027_split_012.html#p0037_01a"
id="part0008.html#p0037_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb80"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>void user(int sz) noexcept</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> v(sz)<span class="kw">;</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>     iota(&amp;v[<span class="dv">0</span>]<span class="kw">,</span>&amp;v[sz]<span class="kw">,</span><span class="dv">1</span>)<span class="kw">;</span>     <span class="fu">//</span> fill v with <span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">,</span><span class="dv">4</span>... (see <span class="er">§</span><span class="fl">14.3</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>If all good intent and planning fails, so that <code
class="calibre8">user()</code> still throws, <code
class="calibre8">std::terminate()</code> is called to immediately
terminate the program.</p>
<h4 class="h3" id="part0008.html#ch03lev2sec2">3.5.2 Invariants</h4>
<p>The use of exceptions to signal out-of-range access is an example of
a function checking its argument and refusing to act because a basic
assumption, a <em>precondition</em>, didn’t hold. Had we formally
specified <code class="calibre8">Vector</code>’s subscript operator, we
would have said something like “the index must be in the [<code
class="calibre8">0</code>:<code class="calibre8">size()</code>) range,”
and that was in fact what we tested in our <code
class="calibre8">operator[]()</code>. The [<code
class="calibre8">a</code>:<code class="calibre8">b</code>) notation
specifies a half-open range, meaning that <code
class="calibre8">a</code> is part of the range, but <code
class="calibre8">b</code> is not. Whenever we define a function, we
should consider what its preconditions are and consider whether to test
them (§<a href="#part0008.html#ch03lev2sec3"
class="calibre6">3.5.3</a>). For most applications it is a good idea to
test simple invariants; see also §<a href="#part0008.html#ch03lev2sec4"
class="calibre6">3.5.4</a>.</p>
<p>However, <code class="calibre8">operator[]()</code> operates on
objects of type <code class="calibre8">Vector</code> and nothing it does
makes any sense unless the members of <code
class="calibre8">Vector</code> have “reasonable” values. In particular,
we did say “<code class="calibre8">elem</code> points to an array of
<code class="calibre8">sz</code> doubles” but we only said that in a
comment. Such a statement of what is assumed to be true for a class is
called a <em>class invariant</em>, or simply an <em>invariant</em>. It
is the job of a constructor to establish the invariant for its class (so
that the member functions can rely on it) and for the member functions
to make sure that the invariant holds when they exit. Unfortunately, our
<code class="calibre8">Vector</code> constructor only partially did its
job. It properly initialized the <code class="calibre8">Vector</code>
members, but it failed to check that the arguments passed to it made
sense. Consider:</p>
<div class="sourceCode" id="cb81"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> v(<span class="er">−</span><span class="dv">27</span>)<span class="kw">;</span></span></code></pre></div>
<p>This is likely to cause chaos.</p>
<p>Here is a more appropriate definition:</p>
<p><a href="#part0027_split_013.html#p0037_02a"
id="part0008.html#p0037_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb82"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span>::<span class="dt">Vector</span>(int s)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>     if (s<span class="dt">&lt;</span><span class="dv">0</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>           <span class="kw">throw</span> length_error<span class="kw">{</span><span class="ot">&quot;</span><span class="er">Vector constructor</span><span class="ot">:</span><span class="er"> negative size</span><span class="ot">&quot;</span><span class="kw">};</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>     elem <span class="kw">=</span> new double[s]<span class="kw">;</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>     sz <span class="kw">=</span> s<span class="kw">;</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>I use the standard-library exception <code
class="calibre8">length_error</code> to report a non-positive number of
elements because some standard-library operations use that exception to
report problems of this kind. If operator <code
class="calibre8">new</code> can’t find memory to allocate, it throws a
<code class="calibre8">std::bad_alloc</code>. We can now write:</p>
<p><a href="#part0027_split_014.html#p0038_01a"
id="part0008.html#p0038_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb83"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>void test()</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>     try<span class="kw">{</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>          <span class="dt">Vector</span> v(<span class="er">−</span><span class="dv">27</span>)<span class="kw">;</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">catch</span> (std::length_error&amp; err) <span class="kw">{</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> handle negative size</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>     <span class="kw">catch</span> (std::bad_alloc&amp; err) <span class="kw">{</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> handle memory exhaustion</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>You can define your own classes to be used as exceptions and have
them carry arbitrary information from a point where an error is detected
to a point where it can be handled (§<a
href="#part0008.html#ch03lev2sec1" class="calibre6">3.5.1</a>).</p>
<p>Often, a function has no way of completing its assigned task after an
exception is thrown. Then, “handling” an exception means doing some
minimal local cleanup and rethrowing the exception. For example:</p>
<p><a href="#part0027_split_015.html#p0038_02a"
id="part0008.html#p0038_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb84"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>void test()</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>     try<span class="kw">{</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>          <span class="dt">Vector</span> v(<span class="er">−</span><span class="dv">27</span>)<span class="kw">;</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">catch</span> (std::length_error&amp;) <span class="kw">{</span>   <span class="fu">//</span> do something and rethrow</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>          cerr <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">test failed</span><span class="ot">:</span><span class="er"> length error</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>          <span class="kw">throw;</span>   <span class="fu">//</span> rethrow</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>     <span class="kw">catch</span> (std::bad_alloc&amp;) <span class="kw">{</span>      <span class="fu">//</span> <span class="dt">Ouch</span><span class="kw">!</span> this program <span class="dt">is</span> not designed to handle memory exhaustion</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>          std::terminate()<span class="kw">;</span>   <span class="fu">//</span> terminate the program</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>In well-designed code <code class="calibre8">try</code>-blocks are
rare. Avoid overuse by systematically using the RAII technique (§<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>, §<a
href="#part0010.html#ch05lev1sec3" class="calibre6">5.3</a>).</p>
<p>The notion of invariants is central to the design of classes, and
preconditions serve a similar role in the design of functions.
Invariants</p>
<ul>
<li><p>help us to understand precisely what we want</p></li>
<li><p>force us to be specific; that gives us a better chance of getting
our code correct (after debugging and testing).</p></li>
</ul>
<p>The notion of invariants underlies C++’s notions of resource
management supported by constructors (<a href="#part0009.html#ch04"
class="calibre6">Chapter 4</a>) and destructors (§<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>, §<a
href="#part0018.html#ch13lev1sec2" class="calibre6">13.2</a>).</p>
<h4 class="h3" id="part0008.html#ch03lev2sec3">3.5.3 Error-Handling
Alternatives</h4>
<p>Error handling is a major issue in all real-world software, so
naturally there are a variety of approaches. If an error is detected and
it cannot be handled locally in a function, the function must somehow
communicate the problem to some caller. Throwing an exception is C++’s
most general mechanism for that.</p>
<p><span id="part0008.html#page_39" class="pagebreak"></span>There are
languages where exceptions are designed simply to provide an alternate
mechanism for returning values. C++ is not such a language: exceptions
are designed to be used to report failure to complete a given task.
Exceptions are integrated with constructors and destructors to provide a
coherent framework for error handling and resource management (§<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>, §<a
href="#part0010.html#ch05lev1sec3" class="calibre6">5.3</a>). Compilers
are optimized to make returning a value much cheaper than throwing the
same value as an exception.</p>
<p>Throwing an exception is not the only way of reporting an error that
cannot be handled locally. A function can indicate that it cannot
perform its alotted task by:</p>
<ul>
<li><p>throwing an exception</p></li>
<li><p>somehow return a value indicating failure</p></li>
<li><p>terminating the program (by invoking a function like <code
class="calibre8">terminate()</code>, <code
class="calibre8">exit()</code>, or <code
class="calibre8">abort()</code>).</p></li>
</ul>
<p>We return an error indicator (an “error code”) when:</p>
<ul>
<li><p>A failure is normal and expected. For example, it is quite normal
for a request to open a file to fail (maybe there is no file of that
name or maybe the file cannot be opened with the permissions
requested).</p></li>
<li><p>An immediate caller can reasonably be expected to handle the
failure.</p></li>
</ul>
<p>We throw an exception when:</p>
<ul>
<li><p>An error is so rare that a programmer is likely to forget to
check for it. For example, when did you last check the return value of
<code class="calibre8">printf()</code>?</p></li>
<li><p>An error cannot be handled by an immediate caller. Instead, the
error has to percolate back to an ultimate caller. For example, it is
infeasible to have every function in an application reliably handle
every allocation failure or network outage.</p></li>
<li><p>New kinds of errors can be added in lower-modules of an
application so that higher-level modules are not written to cope with
such errors. For example, when a previously single-threaded application
is modified to use multiple threads or resources are placed remotely to
be accessed over a network.</p></li>
<li><p>No suitable return path for errors codes are available. For
example, a constructor does not have a return value for a “caller” to
check. In particular, constructors may be invoked for several local
variables or in a partially constructed complex object so that clean-up
based on error codes would be quite complicated.</p></li>
<li><p>The return path of a function is made more complicated or
expensive by a need to pass both a value and an error indicator back
(e.g., a <code class="calibre8">pair</code>; §<a
href="#part0018.html#ch13lev2sec5" class="calibre6">13.4.3</a>),
possibly leading to the use of out-parameters, non-local error-status
indicators, or other workarounds.</p></li>
<li><p>The error has to be transmitted up a call chain to an “ultimate
caller.” Repeatedly checking an error-code would be tedious, expensive,
and error-prone.</p></li>
<li><p>The recovery from errors depends on the results of several
function calls, leading to the need to maintain local state between
calls and complicated control structures.</p></li>
<li><p>The function that found the error was a callback (a function
argument), so the immediate caller may not even know what function was
called.</p></li>
<li><p>An error implies that some “undo action” is needed.</p></li>
</ul>
<p>We terminate when</p>
<ul>
<li><p>An error is of a kind from which we cannot recover. For example,
for many – but not all – systems there is no reasonable way to recover
from memory exhaustion.</p></li>
<li><p>The system is one where error-handling is based on restarting a
thread, process, or computer whenever a non-trivial error is
detected.</p></li>
</ul>
<p><span id="part0008.html#page_40" class="pagebreak"></span>One way to
ensure termination is to add <code class="calibre8">noexcept</code> to a
function so that a <code class="calibre8">throw</code> from anywhere in
the function’s implementation will turn into a <code
class="calibre8">terminate()</code>. Note that there are applications
that can’t accept unconditional terminations, so alternatives must be
used.</p>
<p>Unfortunately, these conditions are not always logically disjoint and
easy to apply. The size and complexity of a program matters. Sometimes
the tradeoffs change as an application evolves. Experience is required.
When in doubt, prefer exceptions because their use scales better, and
don’t require external tools to check that all errors are handled.</p>
<p>Don’t believe that all error codes or all exceptions are bad; there
are clear uses for both. Furthermore, do not believe the myth that
exception handling is slow; it is often faster than correct handling of
complex or rare error conditions, and of repeated tests of error
codes.</p>
<p>RAII (§<a href="#part0009.html#ch04lev2sec2"
class="calibre6">4.2.2</a>, §<a href="#part0010.html#ch05lev1sec3"
class="calibre6">5.3</a>) is essential for simple and efficient
error-handling using exceptions. Code littered with <code
class="calibre8">try</code>-blocks often simply reflects the worst
aspects of error-handling strategies conceived for error codes.</p>
<h4 class="h3" id="part0008.html#ch03lev2sec4">3.5.4 Contracts</h4>
<p>There is currently no general and standard way of writing optional
run-time tests of invariants, preconditions, etc. A contract mechanism
is proposed for C++20 [<a href="#part0021.html#ref20"
class="calibre6">Garcia,2016</a>] [<a href="#part0021.html#ref21"
class="calibre6">Garcia,2018</a>]. The aim is to support users who want
to rely on testing to get programs right – running with extensive
run-time checks – but then deploy code with minimal checks. This is
popular in high-performance applications in organizations that rely on
systematic and extensive checking.</p>
<p>For now, we have to rely on ad hoc mechanisms. For example, we could
use a command-line macro to control a run-time check:</p>
<p><a href="#part0027_split_016.html#p0040_01a"
id="part0008.html#p0040_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb85"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>double&amp; <span class="dt">Vector</span>::operator[](int i)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>     if (<span class="dt">RANGE_CHECK</span> &amp;&amp; (i<span class="dt">&lt;</span><span class="dv">0</span> || size()&lt;=i))</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>          <span class="kw">throw</span> out_of_range<span class="kw">{</span><span class="ot">&quot;</span><span class="er">Vector</span><span class="ot">::</span><span class="er">operator</span><span class="ot">[]&quot;</span><span class="kw">};</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>     return elem[i]<span class="kw">;</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The standard library offers the debug macro, <code
class="calibre8">assert()</code>, to assert that a condition must hold
at run time. For example:</p>
<p><a href="#part0027_split_017.html#p0040_02a"
id="part0008.html#p0040_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb86"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>void f(const char<span class="fu">*</span> p)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>     assert(p<span class="kw">!=</span>nullptr)<span class="kw">;</span>  <span class="fu">//</span> p must not be the nullptr</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>If the condition of an <code class="calibre8">assert()</code> fails
in “debug mode,” the program terminates. If we are not in debug mode,
the <code class="calibre8">assert()</code> is not checked. That’s pretty
crude and inflexible, but often sufficient.</p>
<h4 class="h3" id="part0008.html#ch03lev2sec5">3.5.5 Static
Assertions</h4>
<p>Exceptions report errors found at run time. If an error can be found
at compile time, it is usually preferable to do so. That’s what much of
the type system and the facilities for specifying the interfaces to
user-defined types are for. However, we can also perform simple checks
on most <span id="part0008.html#page_41"
class="pagebreak"></span>properties that are known at compile time and
report failures to meet our expectations as compiler error messages. For
example:</p>
<p><a href="#part0027_split_018.html#p0041_01a"
id="part0008.html#p0041_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb87"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>static_assert(<span class="dv">4</span>&lt;=sizeof(int)<span class="kw">,</span> <span class="ot">&quot;</span><span class="er">integers are too small</span><span class="ot">&quot;</span>)<span class="kw">;</span>  <span class="fu">//</span> check <span class="dt">integer</span> size</span></code></pre></div>
<p>This will write <code class="calibre8">integers are too small</code>
if <code class="calibre8">4&lt;=sizeof(int)</code> does not hold; that
is, if an <code class="calibre8">int</code> on this system does not have
at least 4 bytes. We call such statements of expectations
<em>assertions</em>.</p>
<p>The <code class="calibre8">static_assert</code> mechanism can be used
for anything that can be expressed in terms of constant expressions (§<a
href="#part0006.html#ch01lev1sec6" class="calibre6">1.6</a>). For
example:</p>
<p><a href="#part0027_split_019.html#p0041_02a"
id="part0008.html#p0041_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb88"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>constexpr double <span class="dt">C</span> <span class="kw">=</span> <span class="fl">299792.458</span><span class="kw">;</span>                       <span class="fu">//</span> km<span class="fu">/</span>s</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>void f(double speed)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>     constexpr double local_max <span class="kw">=</span> <span class="fl">160.0</span><span class="fu">/</span>(<span class="dv">60</span><span class="fu">*</span><span class="dv">60</span>)<span class="kw">;</span>       <span class="fu">//</span> <span class="dv">160</span> km<span class="fu">/</span>h <span class="fu">==</span> <span class="fl">160.0</span><span class="fu">/</span>(<span class="dv">60</span><span class="fu">*</span><span class="dv">60</span>) km<span class="fu">/</span>s</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>     static_assert(speed<span class="dt">&lt;C</span><span class="kw">,</span><span class="ot">&quot;</span><span class="er">can</span><span class="ot">&#39;</span><span class="er">t go that fast</span><span class="ot">&quot;</span>)<span class="kw">;</span>      <span class="fu">//</span> error<span class="fu">:</span> speed must be a constant</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>     static_assert(local_max<span class="dt">&lt;C</span><span class="kw">,</span><span class="ot">&quot;</span><span class="er">can</span><span class="ot">&#39;</span><span class="er">t go that fast</span><span class="ot">&quot;</span>)<span class="kw">;</span>  <span class="fu">//</span> <span class="dt">OK</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>In general, <code class="calibre8">static_assert(A,S)</code> prints
<code class="calibre8">S</code> as a compiler error message if <code
class="calibre8">A</code> is not <code class="calibre8">true</code>. If
you don’t want a specific message printed, leave out the <code
class="calibre8">S</code> and the compiler will supply a default
message:</p>
<p><a href="#part0027_split_020.html#p0041_03a"
id="part0008.html#p0041_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb89"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>static_assert(<span class="dv">4</span>&lt;=sizeof(int))<span class="kw">;</span>     <span class="fu">//</span> use default message</span></code></pre></div>
<p>The default message is typically the source location of the <code
class="calibre8">static_assert</code> plus a character representation of
the asserted predicate.</p>
<p>The most important uses of <code
class="calibre8">static_assert</code> come when we make assertions about
types used as parameters in generic programming (§<a
href="#part0012.html#ch07lev1sec2" class="calibre6">7.2</a>, §<a
href="#part0018.html#ch13lev1sec9" class="calibre6">13.9</a>).</p>
<h3 class="h2" id="part0008.html#ch03lev1sec6">3.6 Function Arguments
and Return Values</h3>
<p>The primary and recommended way of passing information from one part
of a program to another is through a function call. Information needed
to perform a task is passed as arguments to a function and the results
produced are passed back as return values. For example:</p>
<p><a href="#part0027_split_021.html#p0041_04a"
id="part0008.html#p0041_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb90"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>int sum(const vector<span class="dt">&lt;</span>int&gt;&amp; v)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>     int s <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>     for (const int i <span class="fu">:</span> v)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>          s += i<span class="kw">;</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>     return s<span class="kw">;</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>vector fib <span class="kw">=</span> <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">,</span><span class="dv">5</span><span class="kw">,</span><span class="dv">8</span><span class="kw">,</span><span class="dv">13</span><span class="kw">,</span><span class="dv">21</span><span class="kw">};</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>int x <span class="kw">=</span> sum(fib)<span class="kw">;</span>          <span class="fu">//</span> x becomes <span class="dv">53</span></span></code></pre></div>
<p><span id="part0008.html#page_42" class="pagebreak"></span>There are
other paths through which information can be passed between functions,
such as global variables (§<a href="#part0006.html#ch01lev1sec5"
class="calibre6">1.5</a>), pointer and reference parameters (§<a
href="#part0008.html#ch03lev2sec6" class="calibre6">3.6.1</a>), and
shared state in a class object (<a href="#part0009.html#ch04"
class="calibre6">Chapter 4</a>). Global variables are strongly
discouraged as a known source of errors, and state should typically be
shared only between functions jointly implementing a well-defined
abstraction (e.g., member functions of a class; §<a
href="#part0007.html#ch02lev1sec3" class="calibre6">2.3</a>).</p>
<p>Given the importance of passing information to and from functions, it
is not surprising that there are a variety of ways of doing it. Key
concerns are:</p>
<ul>
<li><p>Is an object copied or shared?</p></li>
<li><p>If an object is shared, is it mutable?</p></li>
<li><p>Is an object moved, leaving an “empty object” behind (§<a
href="#part0010.html#ch05lev2sec5" class="calibre6">5.2.2</a>)?</p></li>
</ul>
<p>The default behavior for both argument passing and value return is
“copy” (§<a href="#part0006.html#ch01lev1sec9"
class="calibre6">1.9</a>), but some copies can implicitly be optimized
to moves.</p>
<p>In the <code class="calibre8">sum()</code> example, the resulting
<code class="calibre8">int</code> is copied out of <code
class="calibre8">sum()</code> but it would be inefficient and pointless
to copy the potentially very large <code class="calibre8">vector</code>
into <code class="calibre8">sum()</code>, so the argument is passed by
reference (indicated by the <code class="calibre8">&amp;</code>; §<a
href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>).</p>
<p>The <code class="calibre8">sum()</code> has no reason to modify its
argument. This immutability is indicated by declaring the <code
class="calibre8">vector</code> argument <code
class="calibre8">const</code> (§<a href="#part0006.html#ch01lev1sec6"
class="calibre6">1.6</a>), so the <code class="calibre8">vector</code>
is passed by <code class="calibre8">const</code>-reference.</p>
<h4 class="h3" id="part0008.html#ch03lev2sec6">3.6.1 Argument
Passing</h4>
<p>First consider how to get values into a function. By default we copy
(“pass-by-value”) and if we want to refer to an object in the caller’s
environment, we use a reference (“pass-by-reference”). For example:</p>
<p><a href="#part0027_split_022.html#p0042_01a"
id="part0008.html#p0042_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb91"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>void test(vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> v<span class="kw">,</span> vector<span class="dt">&lt;</span>int&gt;&amp; rv)       <span class="fu">//</span> v <span class="dt">is</span> passed by value<span class="kw">;</span> rv <span class="dt">is</span> passed by reference</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>     v<span class="er">[</span><span class="dv">1</span><span class="er">]</span> <span class="kw">=</span> <span class="dv">99</span><span class="kw">;</span>     <span class="fu">//</span> modify v (a local variable)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>     rv[<span class="dv">2</span>] <span class="kw">=</span> <span class="dv">66</span><span class="kw">;</span>    <span class="fu">//</span> modify whatever rv refers to</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>int main()</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>     vector fib <span class="kw">=</span> <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">,</span><span class="dv">5</span><span class="kw">,</span><span class="dv">8</span><span class="kw">,</span><span class="dv">13</span><span class="kw">,</span><span class="dv">21</span><span class="kw">};</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>     test(fib<span class="kw">,</span>fib)<span class="kw">;</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> fib[<span class="dv">1</span>] <span class="al">&lt;&lt;</span> <span class="st">&#39;&#39;</span> <span class="al">&lt;&lt;</span> fib[<span class="dv">2</span>] <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span>     <span class="fu">//</span> prints <span class="dv">2</span> <span class="dv">66</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>When we care about performance, we usually pass small values by-value
and larger ones by-reference. Here “small” means “something that’s
really cheap to copy.” Exactly what “small” means depends on machine
architecture, but “the size of two or three pointers or less” is a good
rule of thumb.</p>
<p>If we want to pass by reference for performance reasons but don’t
need to modify the argument, we pass-by-<code
class="calibre8">const</code>-reference as in the <code
class="calibre8">sum()</code> example. This is by far the most common
case in ordinary good code: it is fast and not error-prone.</p>
<p>It is not uncommon for a function argument to have a default value;
that is, a value that is considered preferred or just the most common.
We can specify such a default by a <em>default function argument</em>.
For example:</p>
<p><a href="#part0027_split_023.html#p0043_01a"
id="part0008.html#p0043_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb92"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>void print(int value<span class="kw">,</span> int base <span class="kw">=</span><span class="dv">10</span>)<span class="kw">;</span>  <span class="fu">//</span> print value in base <span class="ot">&quot;</span><span class="er">base</span><span class="ot">&quot;</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>print(x<span class="kw">,</span><span class="dv">16</span>)<span class="kw">;</span>    <span class="fu">//</span> hexadecimal</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>print(x<span class="kw">,</span><span class="dv">60</span>)<span class="kw">;</span>    <span class="fu">//</span> sexagesimal (<span class="dt">Sumerian</span>)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>print(x)<span class="kw">;</span>       <span class="fu">//</span> use the dafault<span class="fu">:</span> decimal</span></code></pre></div>
<p>This is a notationally simpler alternative to overloading:</p>
<p><a href="#part0027_split_024.html#p0043_02a"
id="part0008.html#p0043_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb93"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>void print(int value<span class="kw">,</span> int base)<span class="kw">;</span>    <span class="fu">//</span> print value in base <span class="ot">&quot;</span><span class="er">base</span><span class="ot">&quot;</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>void print(int value)               <span class="fu">//</span> print value in base <span class="dv">10</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>     print(value<span class="kw">,</span><span class="dv">10</span>)<span class="kw">;</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h4 class="h3" id="part0008.html#ch03lev2sec7">3.6.2 Value Return</h4>
<p>Once we have computed a result, we need to get it out of the function
and back to the caller. Again, the default for value return is to copy
and for small objects that’s ideal. We return “by reference” only when
we want to grant a caller access to something that is not local to the
function. For example:</p>
<p><a href="#part0027_split_025.html#p0043_03a"
id="part0008.html#p0043_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb94"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>     double&amp; operator[](int i) <span class="kw">{</span> return elem[i]<span class="kw">;</span> <span class="kw">}</span>    <span class="fu">//</span> return reference to ith element</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>     double<span class="fu">*</span> elem<span class="kw">;</span>     <span class="fu">//</span> elem points to an array of sz</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>The <code class="calibre8">i</code>th element of a <code
class="calibre8">Vector</code> exists independently of the call of the
subscript operator, so we can return a reference to it.</p>
<p>On the other hand, a local variable disappears when the function
returns, so we should not return a pointer or reference to it:</p>
<p><a href="#part0027_split_026.html#p0043_04a"
id="part0008.html#p0043_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb95"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>int&amp; bad()</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>     int x<span class="kw">;</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>     return x<span class="kw">;</span>  <span class="fu">//</span> bad<span class="fu">:</span> return a reference to the local variable x</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Fortunately, all major C++ compilers will catch the obvious error in
<code class="calibre8">bad()</code>.</p>
<p>Returning a reference or a value of a “small” type is efficient, but
how do we pass large amounts of information out of a function?
Consider:</p>
<p><a href="#part0027_split_027.html#p0044_01a"
id="part0008.html#p0044_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb96"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Matrix</span> operator<span class="fu">+</span>(const <span class="dt">Matrix</span>&amp; x<span class="kw">,</span> const <span class="dt">Matrix</span>&amp; y)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Matrix</span> res<span class="kw">;</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... for all res[i,j]<span class="kw">,</span> res[i,j] <span class="kw">=</span> x[i,j]<span class="fu">+</span>y[i,j] ...</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>     return res<span class="kw">;</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="dt">Matrix</span> m1<span class="kw">,</span> m2<span class="kw">;</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> ...</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a><span class="dt">Matrix</span> m3 <span class="kw">=</span> m1<span class="fu">+</span>m2<span class="kw">;</span>     <span class="fu">//</span> no copy</span></code></pre></div>
<p>A <code class="calibre8">Matrix</code> may be <em>very</em> large and
expensive to copy even on modern hardware. So we don’t copy, we give
<code class="calibre8">Matrix</code> a move constructor (§<a
href="#part0010.html#ch05lev2sec5" class="calibre6">5.2.2</a>) and very
cheaply move the <code class="calibre8">Matrix</code> out of <code
class="calibre8">operator+()</code>. We do <em>not</em> need to regress
to using manual memory management:</p>
<p><a href="#part0027_split_028.html#p0044_02a"
id="part0008.html#p0044_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb97"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Matrix</span><span class="fu">*</span> add(const <span class="dt">Matrix</span>&amp; x<span class="kw">,</span> const <span class="dt">Matrix</span>&amp; y)     <span class="fu">//</span> complicated and error<span class="fu">-</span>prone <span class="er">20th</span> century style</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Matrix</span><span class="fu">*</span> p <span class="kw">=</span> new <span class="dt">Matrix</span><span class="kw">;</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... for all <span class="fu">*</span>p[i,j]<span class="kw">,</span> <span class="fu">*</span>p[i,j] <span class="kw">=</span> x[i,j]<span class="fu">+</span>y[i,j] ...</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>     return p<span class="kw">;</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="dt">Matrix</span> m1<span class="kw">,</span> m2<span class="kw">;</span></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> ...</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="dt">Matrix</span><span class="fu">*</span> m3 <span class="kw">=</span> add(m1<span class="kw">,</span>m2)<span class="kw">;</span>     <span class="fu">//</span> just copy a pointer</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> ...</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>delete m3<span class="kw">;</span>                   <span class="fu">//</span> easily forgotten</span></code></pre></div>
<p>Unfortunately, returning large objects by returning a pointer to it
is common in older code and a major source of hard-to-find errors. Don’t
write such code. Note that <code class="calibre8">operator+()</code> is
as efficient as <code class="calibre8">add()</code>, but far easier to
define, easier to use, and less error-prone.</p>
<p>If a function cannot perform its required task, it can throw an
exception (§<a href="#part0008.html#ch03lev2sec1"
class="calibre6">3.5.1</a>). This can help avoid code from being
littered with error-code tests for “exceptional problems.”</p>
<p>The return type of a function can be deduced from its return value.
For example:</p>
<p><a href="#part0027_split_029.html#p0044_03a"
id="part0008.html#p0044_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb98"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>auto mul(int i<span class="kw">,</span> double d) <span class="kw">{</span> return i<span class="fu">*</span>d<span class="kw">;</span> <span class="kw">}</span>       <span class="fu">//</span> here<span class="kw">,</span> <span class="ot">&quot;</span><span class="er">auto</span><span class="ot">&quot;</span> means <span class="ot">&quot;</span><span class="er">deduce the return type</span><span class="ot">&quot;</span></span></code></pre></div>
<p>This can be convenient, especially for generic functions (function
templates; §<a href="#part0011.html#ch06lev2sec4"
class="calibre6">6.3.1</a>) and lambdas (§<a
href="#part0011.html#ch06lev2sec6" class="calibre6">6.3.3</a>), but
should be used carefully because a deduced type does not offer a stable
interface: a change to the implementation of the function (or lambda)
can change the type.</p>
<h4 class="h3" id="part0008.html#ch03lev2sec8">3.6.3 Structured
Binding</h4>
<p>A function can return only a single value, but that value can be a
class object with many members. This allows us to efficiently return
many values. For example:</p>
<p><a href="#part0027_split_030.html#p0044_04a"
id="part0008.html#p0044_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb99"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Entry</span> <span class="kw">{</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>     string name<span class="kw">;</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>     int value<span class="kw">;</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="dt">Entry</span> read_entry(istream&amp; <span class="dt">is</span>)     <span class="fu">//</span> naive <span class="fu">read</span> function (for a better version<span class="kw">,</span> see <span class="er">§</span><span class="fl">10.5</span>)</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>     string s<span class="kw">;</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>     int i<span class="kw">;</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>     <span class="dt">is</span> <span class="al">&gt;&gt;</span> s <span class="al">&gt;&gt;</span> i<span class="kw">;</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>     return <span class="kw">{</span>s<span class="kw">,</span>i<span class="kw">};</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>auto e <span class="kw">=</span> read_entry(cin)<span class="kw">;</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;{</span><span class="er"> </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> e<span class="kw">.</span>name <span class="al">&lt;&lt;</span> <span class="ot">&quot;,&quot;</span> <span class="al">&lt;&lt;</span> e<span class="kw">.</span>value <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er"> </span><span class="ot">}</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span></code></pre></div>
<p><span id="part0008.html#page_45" class="pagebreak"></span>Here, <code
class="calibre8">{s,i}</code> is used to construct the <code
class="calibre8">Entry</code> return value. Similarly, we can “unpack”
an <code class="calibre8">Entry</code>’s members into local
variables:</p>
<p><a href="#part0027_split_031.html#p0045_01a"
id="part0008.html#p0045_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb100"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>auto [n,v] <span class="kw">=</span> read_entry(<span class="dt">is</span>)<span class="kw">;</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;{</span><span class="er"> </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> n <span class="al">&lt;&lt;</span> <span class="ot">&quot;,&quot;</span> <span class="al">&lt;&lt;</span> v <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er"> </span><span class="ot">}</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span></code></pre></div>
<p>The <code class="calibre8">auto [n,v]</code> declares two local
variables <code class="calibre8">n</code> and <code
class="calibre8">v</code> with their types deduced from <code
class="calibre8">read_entry()</code>’s return type. This mechanism for
giving local names to members of a class object is called <em>structured
binding</em>.</p>
<p>Consider another example:</p>
<p><a href="#part0027_split_032.html#p0045_02a"
id="part0008.html#p0045_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb101"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>map<span class="dt">&lt;</span>string<span class="kw">,</span>int<span class="dt">&gt;</span> m<span class="kw">;</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> ... fill m ...</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>for (const auto [key,value] <span class="fu">:</span> m)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>      cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;{&quot;</span> <span class="al">&lt;&lt;</span> key <span class="ot">&quot;,&quot;</span> <span class="al">&lt;&lt;</span> value <span class="al">&lt;&lt;</span> <span class="ot">&quot;}</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span></code></pre></div>
<p>As usual, we can decorate <code class="calibre8">auto</code> with
<code class="calibre8">const</code> and <code
class="calibre8">&amp;</code>. For example:</p>
<p><a href="#part0027_split_033.html#p0045_03a"
id="part0008.html#p0045_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb102"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>void incr(map<span class="dt">&lt;</span>string<span class="kw">,</span>int&gt;&amp; m)     <span class="fu">//</span> increment the value of each element of m</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>     for (auto&amp; [key,value] <span class="fu">:</span> m)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>           ++value<span class="kw">;</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>When structured binding is used for a class with no private data, it
is easy to see how the binding is done: there must be the same number of
names defined for the binding as there are nonstatic data members of the
class, and each name introduced in the binding names the corresponding
member. There will not be any difference in the object code quality
compared to explicitly using a composite object; the use of structured
binding is all about how best to express an idea.</p>
<p>It is also possible to handle classes where access is through member
functions. For example:</p>
<p><a href="#part0027_split_034.html#p0045_04a"
id="part0008.html#p0045_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb103"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>complex<span class="dt">&lt;</span>double<span class="er">&gt;</span> z <span class="kw">=</span> <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">};</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>auto [re,im] <span class="kw">=</span> z<span class="fu">+</span><span class="dv">2</span><span class="kw">;</span>         <span class="fu">//</span> re<span class="kw">=</span><span class="dv">3</span><span class="kw">;</span> im<span class="kw">=</span><span class="dv">2</span></span></code></pre></div>
<p>A <code class="calibre8">complex</code> has two data members, but its
interface consists of access functions, such as <code
class="calibre8">real()</code> and <code class="calibre8">imag()</code>.
Mapping a <code class="calibre8">complex&lt;double&gt;</code> to two
local variables, such as <code class="calibre8">re</code> and <code
class="calibre8">im</code> is feasible and efficient, but the technique
for doing so is beyond the scope of this book.</p>
<h3 class="h2" id="part0008.html#ch03lev1sec7"><span
id="part0008.html#page_46" class="calibre2 pagebreak"></span>3.7
Advice</h3>
<p>[1] Distinguish between declarations (used as interfaces) and
definitions (used as implementations); §<a
href="#part0008.html#ch03lev1sec1" class="calibre6">3.1</a>.</p>
<p>[2] Use header files to represent interfaces and to emphasize logical
structure; §<a href="#part0008.html#ch03lev1sec2"
class="calibre6">3.2</a>; [CG: SF.3].</p>
<p>[3] <code class="calibre8">#include</code> a header in the source
file that implements its functions; §<a
href="#part0008.html#ch03lev1sec2" class="calibre6">3.2</a>; [CG:
SF.5].</p>
<p>[4] Avoid non-inline function definitions in headers; §<a
href="#part0008.html#ch03lev1sec2" class="calibre6">3.2</a>; [CG:
SF.2].</p>
<p>[5] Prefer <code class="calibre8">module</code>s over headers (where
<code class="calibre8">module</code>s are supported); §<a
href="#part0008.html#ch03lev1sec3" class="calibre6">3.3</a>.</p>
<p>[6] Use namespaces to express logical structure; §<a
href="#part0008.html#ch03lev1sec4" class="calibre6">3.4</a>; [CG:
SF.20].</p>
<p>[7] Use <code class="calibre8">using</code>-directives for
transition, for foundational libraries (such as <code
class="calibre8">std</code>), or within a local scope; §<a
href="#part0008.html#ch03lev1sec4" class="calibre6">3.4</a>; [CG: SF.6]
[CG: SF.7].</p>
<p>[8] Don’t put a <code class="calibre8">using</code>-directive in a
header file; §<a href="#part0008.html#ch03lev1sec4"
class="calibre6">3.4</a>; [CG: SF.7].</p>
<p>[9] Throw an exception to indicate that you cannot perform an
assigned task; §<a href="#part0008.html#ch03lev1sec5"
class="calibre6">3.5</a>; [CG: E.2].</p>
<p>[10] Use exceptions for error handling only; §<a
href="#part0008.html#ch03lev2sec3" class="calibre6">3.5.3</a>; [CG:
E.3].</p>
<p>[11] Use error codes when an immediate caller is expected to handle
the error; §<a href="#part0008.html#ch03lev2sec3"
class="calibre6">3.5.3</a>.</p>
<p>[12] Throw an exception if the error is expected to perculate up
through many function calls; §<a href="#part0008.html#ch03lev2sec3"
class="calibre6">3.5.3</a>.</p>
<p>[13] If in doubt whether to use an exception or an error code, prefer
exceptions; §<a href="#part0008.html#ch03lev2sec3"
class="calibre6">3.5.3</a>.</p>
<p>[14] Develop an error-handling strategy early in a design; §<a
href="#part0008.html#ch03lev1sec5" class="calibre6">3.5</a>; [CG:
E.12].</p>
<p>[15] Use purpose-designed user-defined types as exceptions (not
built-in types); §<a href="#part0008.html#ch03lev2sec1"
class="calibre6">3.5.1</a>.</p>
<p>[16] Don’t try to catch every exception in every function; §<a
href="#part0008.html#ch03lev1sec5" class="calibre6">3.5</a>; [CG:
E.7].</p>
<p>[17] Prefer RAII to explicit <code
class="calibre8">try</code>-blocks; §<a
href="#part0008.html#ch03lev2sec1" class="calibre6">3.5.1</a>, §<a
href="#part0008.html#ch03lev2sec2" class="calibre6">3.5.2</a>; [CG:
E.6].</p>
<p>[18] If your function may not throw, declare it <code
class="calibre8">noexcept</code>; §<a href="#part0008.html#ch03lev1sec5"
class="calibre6">3.5</a>; [CG: E.12].</p>
<p>[19] Let a constructor establish an invariant, and throw if it
cannot; §<a href="#part0008.html#ch03lev2sec2"
class="calibre6">3.5.2</a>; [CG: E.5].</p>
<p>[20] Design your error-handling strategy around invariants; §<a
href="#part0008.html#ch03lev2sec2" class="calibre6">3.5.2</a>; [CG:
E.4].</p>
<p>[21] What can be checked at compile time is usually best checked at
compile time; §<a href="#part0008.html#ch03lev2sec5"
class="calibre6">3.5.5</a> [CG: P.4] [CG: P.5].</p>
<p>[22] Pass “small” values by value and “large“ values by references;
§<a href="#part0008.html#ch03lev2sec6" class="calibre6">3.6.1</a>; [CG:
F.16].</p>
<p>[23] Prefer pass-by-<code class="calibre8">const</code>-reference
over plain pass-by-reference; _module.arguments_; [CG: F.17].</p>
<p>[24] Return values as function-return values (rather than by
out-parameters); §<a href="#part0008.html#ch03lev2sec7"
class="calibre6">3.6.2</a>; [CG: F.20] [CG: F.21].</p>
<p>[25] Don’t overuse return-type deduction; §<a
href="#part0008.html#ch03lev2sec7" class="calibre6">3.6.2</a>.</p>
<p>[26] Don’t overuse structured binding; using a named return type is
often clearer documentation; §<a href="#part0008.html#ch03lev2sec8"
class="calibre6">3.6.3</a>.</p>
</section>
<p><span id="part0009.html"></span></p>
<section id="part0009.html#ch04" class="h1 bodymatter">
<h2 class="h1"><span id="part0009.html#page_47"
class="calibre2 pagebreak"></span><span class="big">4</span></h2>
<p>Classes</p>
<p><em>Those types are not “abstract”; they are as real as</em> <code
class="calibre11">int</code> <em>and</em> <code
class="calibre11">float</code>.</p>
<p><em>– Doug McIlroy</em></p>
<ul>
<li><p><a href="#part0009.html#ch04lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0009.html#ch04lev1sec2" class="calibre6">Concrete
Types</a></p>
<p><a href="#part0009.html#ch04lev2sec1" class="calibre6">An Arithmetic
Type</a>; <a href="#part0009.html#ch04lev2sec2" class="calibre6">A
Container</a>; <a href="#part0009.html#ch04lev2sec3"
class="calibre6">Initializing Containers</a></p></li>
<li><p><a href="#part0009.html#ch04lev1sec3" class="calibre6">Abstract
Types</a></p></li>
<li><p><a href="#part0009.html#ch04lev1sec4" class="calibre6">Virtual
Functions</a></p></li>
<li><p><a href="#part0009.html#ch04lev1sec5" class="calibre6">Class
Hierarchies</a></p>
<p><a href="#part0009.html#ch04lev2sec4" class="calibre6">Benefits from
Hierarchies</a>; <a href="#part0009.html#ch04lev2sec5"
class="calibre6">Hierarchy Navigation</a>; <a
href="#part0009.html#ch04lev2sec6" class="calibre6">Avoiding Resource
Leaks</a></p></li>
<li><p><a href="#part0009.html#ch04lev1sec6"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0009.html#ch04lev1sec1">4.1 Introduction</h3>
<p>This chapter and the next three aim to give you an idea of C++’s
support for abstraction and resource management without going into a lot
of detail:</p>
<ul>
<li><p>This chapter informally presents ways of defining and using new
types (<em>user-defined types</em>). In particular, it presents the
basic properties, implementation techniques, and language facilities
used for <em>concrete classes</em>, <em>abstract classes</em>, and
<em>class hierarchies</em>.</p></li>
<li><p><a href="#part0010.html#ch05" class="calibre6">Chapter 5</a>
presents the operations that have defined meaning in C++, such as
constructors, destructors, and assignments. It outlines the rules for
using those in combination to control the life cycle of objects and to
support simple, efficient, and complete resource management.</p></li>
<li><p><a href="#part0011.html#ch06" class="calibre6">Chapter 6</a>
introduces templates as a mechanism for parameterizing types and
algorithms with (other) types and algorithms. Computations on
user-defined and built-in types are represented as functions, sometimes
generalized to <em>template functions</em> and <em>function
objects</em>.</p></li>
<li><p><a href="#part0012.html#ch07" class="calibre6">Chapter 7</a>
gives an overview of the concepts, techniques, and language features
that underlie generic programming. The focus is on the definition and
use of <em>concepts</em> for precisely <span id="part0009.html#page_48"
class="pagebreak"></span>specifying interfaces to templates and guide
design. <em>Variadic templates</em> are introduced for specifying the
most general and most flexible interfaces.</p></li>
</ul>
<p>These are the language facilities supporting the programming styles
known as <em>object-oriented programming</em> and <em>generic
programming</em>. <a href="#part0013.html#ch08"
class="calibre6">Chapters 8</a>–<a href="#part0020.html#ch15"
class="calibre6">15</a> follow up by presenting examples of
standard-library facilities and their use.</p>
<p>The central language feature of C++ is the <em>class</em>. A class is
a user-defined type provided to represent a concept in the code of a
program. Whenever our design for a program has a useful concept, idea,
entity, etc., we try to represent it as a class in the program so that
the idea is there in the code, rather than just in our heads, in a
design document, or in some comments. A program built out of a
well-chosen set of classes is far easier to understand and get right
than one that builds everything directly in terms of the built-in types.
In particular, classes are often what libraries offer.</p>
<p>Essentially all language facilities beyond the fundamental types,
operators, and statements exist to help define better classes or to use
them more conveniently. By “better,” I mean more correct, easier to
maintain, more efficient, more elegant, easier to use, easier to read,
and easier to reason about. Most programming techniques rely on the
design and implementation of specific kinds of classes. The needs and
tastes of programmers vary immensely. Consequently, the support for
classes is extensive. Here, we will just consider the basic support for
three important kinds of classes:</p>
<ul>
<li><p>Concrete classes (§<a href="#part0009.html#ch04lev1sec2"
class="calibre6">4.2</a>)</p></li>
<li><p>Abstract classes (§<a href="#part0009.html#ch04lev1sec3"
class="calibre6">4.3</a>)</p></li>
<li><p>Classes in class hierarchies (§<a
href="#part0009.html#ch04lev1sec5" class="calibre6">4.5</a>)</p></li>
</ul>
<p>An astounding number of useful classes turn out to be of one of these
three kinds. Even more classes can be seen as simple variants of these
kinds or are implemented using combinations of the techniques used for
these.</p>
<h3 class="h2" id="part0009.html#ch04lev1sec2">4.2 Concrete Types</h3>
<p>The basic idea of <em>concrete classes</em> is that they behave “just
like built-in types.” For example, a complex number type and an
infinite-precision integer are much like built-in <code
class="calibre8">int</code>, except of course that they have their own
semantics and sets of operations. Similarly, a <code
class="calibre8">vector</code> and a <code
class="calibre8">string</code> are much like built-in arrays, except
that they are better behaved (§<a href="#part0014.html#ch09lev1sec2"
class="calibre6">9.2</a>, §<a href="#part0015.html#ch10lev1sec3"
class="calibre6">10.3</a>, §<a href="#part0016.html#ch11lev1sec2"
class="calibre6">11.2</a>).</p>
<p>The defining characteristic of a concrete type is that its
representation is part of its definition. In many important cases, such
as a <code class="calibre8">vector</code>, that representation is only
one or more pointers to data stored elsewhere, but that representation
is present in each object of a concrete class. That allows
implementations to be optimally efficient in time and space. In
particular, it allows us to</p>
<ul>
<li><p>place objects of concrete types on the stack, in statically
allocated memory, and in other objects (§<a
href="#part0006.html#ch01lev1sec5" class="calibre6">1.5</a>);</p></li>
<li><p>refer to objects directly (and not just through pointers or
references);</p></li>
<li><p>initialize objects immediately and completely (e.g., using
constructors; §<a href="#part0007.html#ch02lev1sec3"
class="calibre6">2.3</a>); and</p></li>
<li><p>copy and move objects (§<a href="#part0010.html#ch05lev1sec2"
class="calibre6">5.2</a>).</p></li>
</ul>
<p>The representation can be private (as it is for <code
class="calibre8">Vector</code>; §<a href="#part0007.html#ch02lev1sec3"
class="calibre6">2.3</a>) and accessible only through the member
functions, but it is present. Therefore, if the representation changes
in any significant way, a user must recompile. This is the price to pay
for having concrete types behave exactly like built-in <span
id="part0009.html#page_49" class="pagebreak"></span>types. For types
that don’t change often, and where local variables provide much-needed
clarity and efficiency, this is acceptable and often ideal. To increase
flexibility, a concrete type can keep major parts of its representation
on the free store (dynamic memory, heap) and access them through the
part stored in the class object itself. That’s the way <code
class="calibre8">vector</code> and <code class="calibre8">string</code>
are implemented; they can be considered resource handles with carefully
crafted interfaces.</p>
<h4 class="h3" id="part0009.html#ch04lev2sec1">4.2.1 An Arithmetic
Type</h4>
<p>The “classical user-defined arithmetic type” is <code
class="calibre8">complex</code>:</p>
<p><a href="#part0028_split_000.html#p0049_01a"
id="part0009.html#p0049_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb104"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>class complex <span class="kw">{</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>     double re<span class="kw">,</span> im<span class="kw">;</span> <span class="fu">//</span> representation<span class="fu">:</span> two doubles</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>     complex(double r<span class="kw">,</span> double i) <span class="fu">:</span>re<span class="kw">{</span>r<span class="kw">},</span> im<span class="kw">{</span>i<span class="kw">}</span> <span class="kw">{}</span>    <span class="fu">//</span> construct complex from two scalars</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>     complex(double r) <span class="fu">:</span>re<span class="kw">{</span>r<span class="kw">},</span> im<span class="kw">{</span><span class="dv">0</span><span class="kw">}</span> <span class="kw">{}</span>              <span class="fu">//</span> construct complex from one scalar</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>     complex() <span class="fu">:</span>re<span class="kw">{</span><span class="dv">0</span><span class="kw">},</span> im<span class="kw">{</span><span class="dv">0</span><span class="kw">}</span> <span class="kw">{}</span>                      <span class="fu">//</span> default complex<span class="fu">:</span> <span class="kw">{</span><span class="dv">0</span><span class="kw">,</span><span class="dv">0</span><span class="kw">}</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>     double real() const <span class="kw">{</span> return re<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>     void real(double d) <span class="kw">{</span> re<span class="kw">=</span>d<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>     double imag() const <span class="kw">{</span> return im<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>     void imag(double d) <span class="kw">{</span> im<span class="kw">=</span>d<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>     complex&amp; operator+=(complex z)</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>         re+=z.re<span class="kw">;</span>         <span class="fu">//</span> add to re and im</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>         im+=z.im<span class="kw">;</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>         return <span class="fu">*</span>this<span class="kw">;</span>     <span class="fu">//</span> and return the result</span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>     complex&amp; operator<span class="er">−</span><span class="kw">=</span>(complex z)</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>         re<span class="er">−</span><span class="kw">=</span>z.re<span class="kw">;</span></span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>         im<span class="er">−</span><span class="kw">=</span>z.im<span class="kw">;</span></span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>         return <span class="fu">*</span>this<span class="kw">;</span></span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}}</span></span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a>     complex&amp; operator*=(complex)<span class="kw">;</span>    <span class="fu">//</span> defined out<span class="fu">-</span>of<span class="fu">-</span>class somewhere</span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a>     complex&amp; operator/=(complex)<span class="kw">;</span>    <span class="fu">//</span> defined out<span class="fu">-</span>of<span class="fu">-</span>class somewhere</span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a><span class="er">}</span><span class="kw">;</span></span></code></pre></div>
<p>This is a slightly simplified version of the standard-library <code
class="calibre8">complex</code> (§<a href="#part0019.html#ch14lev1sec4"
class="calibre6">14.4</a>). The class definition itself contains only
the operations requiring access to the representation. The
representation is simple and conventional. For practical reasons, it has
to be compatible with what Fortran provided 60 years ago, and we need a
conventional set of operators. In addition to the logical demands, <code
class="calibre8">complex</code> must be efficient or it will remain
unused. This implies that simple operations must be inlined. That is,
simple operations (such as constructors, <code
class="calibre8">+=</code>, and <code class="calibre8">imag()</code>)
must be implemented without function calls in the generated machine
code. Functions defined in a class are inlined by default. It is
possible to explicitly request inlining by preceding a function
declaration with the keyword <code class="calibre8">inline</code>. <span
id="part0009.html#page_50" class="pagebreak"></span>An
industrial-strength <code class="calibre8">complex</code> (like the
standard-library one) is carefully implemented to do appropriate
inlining.</p>
<p>A constructor that can be invoked without an argument is called a
<em>default constructor</em>. Thus, <code
class="calibre8">complex()</code> is <code
class="calibre8">complex</code>’s default constructor. By defining a
default constructor you eliminate the possibility of uninitialized
variables of that type.</p>
<p>The <code class="calibre8">const</code> specifiers on the functions
returning the real and imaginary parts indicate that these functions do
not modify the object for which they are called. A <code
class="calibre8">const</code> member function can be invoked for both
<code class="calibre8">const</code> and non-<code
class="calibre8">const</code> objects, but a non-<code
class="calibre8">const</code> member function can only be invoked for
non-<code class="calibre8">const</code> objects. For example:</p>
<p><a href="#part0028_split_001.html#p0050_01a"
id="part0009.html#p0050_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb105"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>complex z <span class="kw">=</span> <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">0</span><span class="kw">};</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>const complex cz <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">3</span><span class="kw">};</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>z <span class="kw">=</span> cz<span class="kw">;</span>                  <span class="fu">//</span> <span class="dt">OK</span><span class="fu">:</span> assigning to a non<span class="fu">-</span>const variable</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>cz <span class="kw">=</span> z<span class="kw">;</span>                  <span class="fu">//</span> error<span class="fu">:</span> complex::operator<span class="kw">=</span>() <span class="dt">is</span> a non<span class="dt">-</span>const member function</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>double x <span class="kw">=</span> z<span class="kw">.</span>real()<span class="kw">;</span>     <span class="fu">//</span> <span class="dt">OK</span><span class="fu">:</span> complex::real() <span class="dt">is</span> a const member function</span></code></pre></div>
<p>Many useful operations do not require direct access to the
representation of <code class="calibre8">complex</code>, so they can be
defined separately from the class definition:</p>
<p><a href="#part0028_split_002.html#p0050_02a"
id="part0009.html#p0050_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb106"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>complex operator<span class="fu">+</span>(complex a<span class="kw">,</span> complex b) <span class="kw">{</span> return a+=b<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>complex operator<span class="er">−</span>(complex a<span class="kw">,</span> complex b) <span class="kw">{</span> return a<span class="er">−</span><span class="kw">=</span>b<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>complex operator<span class="er">−</span>(complex a) <span class="kw">{</span> return <span class="kw">{</span><span class="er">−</span>a.real()<span class="kw">,</span> <span class="er">−</span>a.imag()<span class="kw">};</span> <span class="kw">}</span>    <span class="fu">//</span> unary minus</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>complex operator<span class="fu">*</span>(complex a<span class="kw">,</span> complex b) <span class="kw">{</span> return a*=b<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>complex operator<span class="fu">/</span>(complex a<span class="kw">,</span> complex b) <span class="kw">{</span> return a/=b<span class="kw">;</span> <span class="kw">}</span></span></code></pre></div>
<p>Here, I use the fact that an argument passed by value is copied so
that I can modify an argument without affecting the caller’s copy and
use the result as the return value.</p>
<p>The definitions of <code class="calibre8">==</code> and <code
class="calibre8">!=</code> are straightforward:</p>
<p><a href="#part0028_split_003.html#p0050_03a"
id="part0009.html#p0050_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb107"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>bool operator<span class="fu">==</span>(complex a<span class="kw">,</span> complex b)     <span class="fu">//</span> equal</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>     return a.real()<span class="fu">==</span>b.real() &amp;&amp; a.imag()<span class="fu">==</span>b.imag()<span class="kw">;</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>bool operator<span class="kw">!=</span>(complex a<span class="kw">,</span> complex b)     <span class="fu">//</span> not equal</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>     return <span class="kw">!</span>(a<span class="fu">==</span>b)<span class="kw">;</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>complex sqrt(complex)<span class="kw">;</span>     <span class="fu">//</span> the definition <span class="dt">is</span> elsewhere</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="dv">//</span> ...</span></code></pre></div>
<p>Class <code class="calibre8">complex</code> can be used like
this:</p>
<p><a href="#part0028_split_004.html#p0050_04a"
id="part0009.html#p0050_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb108"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>void f(complex z)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>     complex a <span class="kw">{</span><span class="fl">2.3</span><span class="kw">};</span>       <span class="fu">//</span> construct <span class="kw">{</span><span class="fl">2.3</span><span class="kw">,</span><span class="fl">0.0</span><span class="kw">}</span> from <span class="fl">2.3</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>     complex b <span class="kw">{</span><span class="dv">1</span><span class="fu">/</span>a<span class="kw">};</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>     complex c <span class="kw">{</span>a<span class="fu">+</span>z<span class="fu">*</span>complex<span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="fl">2.3</span><span class="kw">}};</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>     if (c <span class="kw">!=</span> b)</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>            c <span class="kw">=</span> <span class="er">−</span>(b<span class="fu">/</span>a)<span class="fu">+</span><span class="dv">2</span><span class="fu">*</span>b<span class="kw">;</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0009.html#page_51" class="pagebreak"></span>The
compiler converts operators involving <code
class="calibre8">complex</code> numbers into appropriate function calls.
For example, <code class="calibre8">c!=b</code> means <code
class="calibre8">operator!=(c,b)</code> and <code
class="calibre8">1/a</code> means <code
class="calibre8">operator/(complex{1},a)</code>.</p>
<p>User-defined operators (“overloaded operators”) should be used
cautiously and conventionally. The syntax is fixed by the language, so
you can’t define a unary <code class="calibre8">/</code>. Also, it is
not possible to change the meaning of an operator for built-in types, so
you can’t redefine <code class="calibre8">+</code> to subtract <code
class="calibre8">int</code>s.</p>
<h4 class="h3" id="part0009.html#ch04lev2sec2">4.2.2 A Container</h4>
<p>A <em>container</em> is an object holding a collection of elements.
We call class <code class="calibre8">Vector</code> a container because
objects of type <code class="calibre8">Vector</code> are containers. As
defined in §<a href="#part0007.html#ch02lev1sec3"
class="calibre6">2.3</a>, <code class="calibre8">Vector</code> isn’t an
unreasonable container of <code class="calibre8">double</code>s: it is
simple to understand, establishes a useful invariant (§<a
href="#part0008.html#ch03lev2sec2" class="calibre6">3.5.2</a>), provides
range-checked access (§<a href="#part0008.html#ch03lev2sec1"
class="calibre6">3.5.1</a>), and provides <code
class="calibre8">size()</code> to allow us to iterate over its elements.
However, it does have a fatal flaw: it allocates elements using <code
class="calibre8">new</code> but never deallocates them. That’s not a
good idea because although C++ defines an interface for a garbage
collector (§<a href="#part0010.html#ch05lev1sec3"
class="calibre6">5.3</a>), it is not guaranteed that one is available to
make unused memory available for new objects. In some environments you
can’t use a collector, and often you prefer more precise control of
destruction for logical or performance reasons. We need a mechanism to
ensure that the memory allocated by the constructor is deallocated; that
mechanism is a <em>destructor</em>:</p>
<p><a href="#part0028_split_005.html#p0051_01a"
id="part0009.html#p0051_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb109"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>(int s) <span class="fu">:</span>elem<span class="kw">{</span>new double[s]<span class="kw">},</span> sz<span class="kw">{</span>s<span class="kw">}</span>     <span class="fu">//</span> constructor<span class="fu">:</span> acquire resources</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>          for (int i<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>s<span class="kw">;</span> ++i)      <span class="fu">//</span> initialize elements</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>                elem[i]<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>     ~<span class="dt">Vector</span>() <span class="kw">{</span> delete[] elem<span class="kw">;</span> <span class="kw">}</span>                  <span class="fu">//</span> destructor<span class="fu">:</span> release resources</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>     double&amp; operator[](int i)<span class="kw">;</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>     int size() const<span class="kw">;</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>     double<span class="fu">*</span> elem<span class="kw">;</span>     <span class="fu">//</span> elem points to an array of sz doubles</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>     int sz<span class="kw">;</span></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>The name of a destructor is the complement operator, <code
class="calibre8">~</code>, followed by the name of the class; it is the
complement of a constructor. <code class="calibre8">Vector</code>’s
constructor allocates some memory on the free store (also called the
<em>heap</em> or <em>dynamic store</em>) using the <code
class="calibre8">new</code> operator. The destructor cleans up by
freeing that memory using the <code class="calibre8">delete[]</code>
operator. Plain <code class="calibre8">delete</code> deletes an
individual object, <code class="calibre8">delete[]</code> deletes an
array.</p>
<p>This is all done without intervention by users of <code
class="calibre8">Vector.</code> The users simply create and use <code
class="calibre8">Vector</code>s much as they would variables of built-in
types. For example:</p>
<p><a href="#part0028_split_006.html#p0052_01a"
id="part0009.html#p0052_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb110"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>void fct(int n)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> v(n)<span class="kw">;</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... use v ...</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>          <span class="dt">Vector</span> v2(<span class="dv">2</span><span class="fu">*</span>n)<span class="kw">;</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> ... use v and v2 ...</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span><span class="fu">//</span> v2 <span class="dt">is</span> destroyed here</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>     <span class="dv">//</span> ... use v ..</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span><span class="fu">//</span> v <span class="dt">is</span> destroyed here</span></code></pre></div>
<p><code class="calibre8">Vector</code> obeys the same rules for naming,
scope, allocation, lifetime, etc. (§<a
href="#part0006.html#ch01lev1sec5" class="calibre6">1.5</a>), as does a
built-in type, such as <code class="calibre8">int</code> and <code
class="calibre8">char</code>. This <code class="calibre8">Vector</code>
has been simplified by leaving out error handling; see §<a
href="#part0008.html#ch03lev1sec5" class="calibre6">3.5</a>.</p>
<p>The constructor/destructor combination is the basis of many elegant
techniques. In particular, it is the basis for most C++ general resource
management techniques (§<a href="#part0010.html#ch05lev1sec3"
class="calibre6">5.3</a>, §<a href="#part0018.html#ch13lev1sec2"
class="calibre6">13.2</a>). Consider a graphical illustration of a <code
class="calibre8">Vector</code>:</p>
<figure>
<img src="images/00012.jpeg" class="calibre1" />
</figure>
<p>The constructor allocates the elements and initializes the <code
class="calibre8">Vector</code> members appropriately. The destructor
deallocates the elements. This <em>handle-to-data model</em> is very
commonly used to manage data that can vary in size during the lifetime
of an object. The technique of acquiring resources in a constructor and
releasing them in a destructor, known as <em>Resource Acquisition Is
Initialization</em> or <em>RAII</em>, allows us to eliminate “naked
<code class="calibre8">new</code> operations,” that is, to avoid
allocations in general code and keep them buried inside the
implementation of well-behaved abstractions. Similarly, “naked <code
class="calibre8">delete</code> operations” should be avoided. Avoiding
naked <code class="calibre8">new</code> and naked <code
class="calibre8">delete</code> makes code far less error-prone and far
easier to keep free of resource leaks (§<a
href="#part0018.html#ch13lev1sec2" class="calibre6">13.2</a>).</p>
<h4 class="h3" id="part0009.html#ch04lev2sec3">4.2.3 Initializing
Containers</h4>
<p>A container exists to hold elements, so obviously we need convenient
ways of getting elements into a container. We can create a <code
class="calibre8">Vector</code> with an appropriate number of elements
and then assig to them, but typically other ways are more elegant. Here,
I just mention two favorites:</p>
<ul>
<li><p><em>Initializer-list constructor</em>: Initialize with a list of
elements.</p></li>
<li><p><code class="calibre8">push_back()</code>: Add a new element at
the end of (at the back of) the sequence.</p></li>
</ul>
<p>These can be declared like this:</p>
<p><a href="#part0028_split_007.html#p0052_02a"
id="part0009.html#p0052_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb111"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>(std::initializer_list<span class="dt">&lt;</span>double<span class="er">&gt;</span>)<span class="kw">;</span>     <span class="fu">//</span> initialize with a list of doubles</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>     void push_back(double)<span class="kw">;</span>                    <span class="fu">//</span> add element at end<span class="kw">,</span> increasing the size by one</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p><span id="part0009.html#page_53" class="pagebreak"></span>The <code
class="calibre8">push_back()</code> is useful for input of arbitrary
numbers of elements. For example:</p>
<p><a href="#part0028_split_008.html#p0053_01a"
id="part0009.html#p0053_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb112"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> <span class="fu">read</span>(istream&amp; <span class="dt">is</span>)</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> v<span class="kw">;</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>     for (double d<span class="kw">;</span> <span class="dt">is</span><span class="al">&gt;&gt;</span>d<span class="kw">;</span>)        <span class="fu">//</span> <span class="fu">read</span> floating<span class="fu">-</span>point values into d</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>           v.push_back(d)<span class="kw">;</span>         <span class="fu">//</span> add d to v</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>     return v<span class="kw">;</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The input loop is terminated by an end-of-file or a formatting error.
Until that happens, each number read is added to the <code
class="calibre8">Vector</code> so that at the end, <code
class="calibre8">v</code>’s size is the number of elements read. I used
a <code class="calibre8">for</code>-statement rather than the more
conventional <code class="calibre8">while</code>-statement to keep the
scope of <code class="calibre8">d</code> limited to the loop. The way to
provide <code class="calibre8">Vector</code> with a move constructor, so
that returning a potentially huge amount of data from <code
class="calibre8">read()</code> is cheap, is explained in §<a
href="#part0010.html#ch05lev2sec5" class="calibre6">5.2.2</a>:</p>
<p><a href="#part0028_split_009.html#p0053_02a"
id="part0009.html#p0053_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb113"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> v <span class="kw">=</span> <span class="fu">read</span>(cin)<span class="kw">;</span>     <span class="fu">//</span> no copy of <span class="dt">Vector</span> elements here</span></code></pre></div>
<p>The way that <code class="calibre8">std::vector</code> is represented
to make <code class="calibre8">puch_back()</code> and other operations
that change a <code class="calibre8">vector's</code> size efficient is
presented in §<a href="#part0016.html#ch11lev1sec2"
class="calibre6">11.2</a>.</p>
<p>The <code class="calibre8">std::initializer_list</code> used to
define the initializer-list constructor is a standard-library type known
to the compiler: when we use a <code class="calibre8">{}</code>-list,
such as <code class="calibre8">{1,2,3,4}</code>, the compiler will
create an object of type <code class="calibre8">initializer_list</code>
to give to the program. So, we can write:</p>
<p><a href="#part0028_split_010.html#p0053_03a"
id="part0009.html#p0053_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb114"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> v1 <span class="kw">=</span> <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">,</span><span class="dv">4</span><span class="kw">,</span><span class="dv">5</span><span class="kw">};</span>              <span class="fu">//</span> v1 has <span class="dv">5</span> elements</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> v2 <span class="kw">=</span> <span class="kw">{</span><span class="fl">1.23</span><span class="kw">,</span> <span class="fl">3.45</span><span class="kw">,</span> <span class="fl">6.7</span><span class="kw">,</span> <span class="dv">8</span><span class="kw">};</span>     <span class="fu">//</span> v2 has <span class="dv">4</span> elements</span></code></pre></div>
<p><code class="calibre8">Vector</code>’s initializer-list constructor
might be defined like this:</p>
<p><a href="#part0028_split_011.html#p0053_04a"
id="part0009.html#p0053_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb115"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span>::<span class="dt">Vector</span>(std::initializer_list<span class="dt">&lt;</span>double<span class="er">&gt;</span> lst)    <span class="fu">//</span> initialize with a list</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">:</span>elem<span class="kw">{</span>new double[lst.size()]<span class="kw">},</span> sz<span class="kw">{</span>static_cast<span class="dt">&lt;</span>int<span class="er">&gt;</span>(lst<span class="al">.</span>size())<span class="kw">}</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>     copy(lst<span class="al">.</span>begin()<span class="kw">,</span>lst<span class="al">.</span>end()<span class="kw">,</span>elem)<span class="kw">;</span>        <span class="fu">//</span> copy from lst into elem (<span class="er">§</span><span class="fl">12.6</span>)</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Unfortunately, the standard-library uses <code
class="calibre8">unsigned</code> integers for sizes and subscripts, so I
need to use the ugly <code class="calibre8">static_cast</code> to
explicitly convert the size of the initializer list to an <code
class="calibre8">int</code>. This is pedantic because the chance that
the number of elements in a handwritten list is larger than the largest
integer (32,767 for 16-bit integers and 2,147,483,647 for 32-bit
integers) is rather low. However, the type system has no common sense.
It knows about the possible values of variables, rather than actual
values, so it might complain where there is no actual violation. Such
warnings can occasionally save the programmer from a bad error.</p>
<p>A <code class="calibre8">static_cast</code> does not check the value
it is converting; the programmer is trusted to use it correctly. This is
not always a good assumption, so if in doubt, check the value. Explicit
type conversions (often called <em>casts</em> to remind you that they
are used to prop up something broken) are best avoided. Try to use
unchecked casts only for at the lowest level of a system. They are
error-prone.</p>
<p>Other casts are <code class="calibre8">reinterpret_cast</code> for
threating an object as simply a sequence of bytes and <code
class="calibre8">const_cast</code> for “casting away <code
class="calibre8">const</code>.” Judicious use of the type system and
well-designed libraries allow us to eliminate unchecked casts in
higher-level software.</p>
<h3 class="h2" id="part0009.html#ch04lev1sec3"><span
id="part0009.html#page_54" class="calibre2 pagebreak"></span>4.3
Abstract Types</h3>
<p>Types such as <code class="calibre8">complex</code> and <code
class="calibre8">Vector</code> are called <em>concrete types</em>
because their representation is part of their definition. In that, they
resemble built-in types. In contrast, an <em>abstract type</em> is a
type that completely insulates a user from implementation details. To do
that, we decouple the interface from the representation and give up
genuine local variables. Since we don’t know anything about the
representation of an abstract type (not even its size), we must allocate
objects on the free store (§<a href="#part0009.html#ch04lev2sec2"
class="calibre6">4.2.2</a>) and access them through references or
pointers (§<a href="#part0006.html#ch01lev1sec7"
class="calibre6">1.7</a>, §<a href="#part0018.html#ch13lev2sec1"
class="calibre6">13.2.1</a>).</p>
<p>First, we define the interface of a class <code
class="calibre8">Container</code>, which we will design as a more
abstract version of our <code class="calibre8">Vector</code>:</p>
<p><a href="#part0028_split_012.html#p0054_01a"
id="part0009.html#p0054_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb116"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Container</span> <span class="kw">{</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>     virtual double&amp; operator[](int) <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span>     <span class="fu">//</span> pure virtual function</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>     virtual int size() const <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span>            <span class="fu">//</span> const member function (<span class="er">§</span><span class="fl">4.2</span><span class="al">.</span><span class="dv">1</span>)</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>     virtual ~<span class="dt">Container</span>() <span class="kw">{}</span>                  <span class="fu">//</span> destructor (<span class="er">§</span><span class="fl">4.2</span><span class="al">.</span><span class="dv">2</span>)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>This class is a pure interface to specific containers defined later.
The word <code class="calibre8">virtual</code> means “may be redefined
later in a class derived from this one.” Unsurprisingly, a function
declared <code class="calibre8">virtual</code> is called a <em>virtual
function</em>. A class derived from <code
class="calibre8">Container</code> provides an implementation for the
<code class="calibre8">Container</code> interface. The curious <code
class="calibre8">=0</code> syntax says the function is <em>pure
virtual</em>; that is, some class derived from <code
class="calibre8">Container</code> <em>must</em> define the function.
Thus, it is not possible to define an object that is just a <code
class="calibre8">Container</code>. For example:</p>
<p><a href="#part0028_split_013.html#p0054_02a"
id="part0009.html#p0054_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb117"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Container</span> c<span class="kw">;</span>                                <span class="fu">//</span> error<span class="fu">:</span> there can be no objects of an abstract class</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Container</span><span class="fu">*</span> p <span class="kw">=</span> new <span class="dt">Vector_container</span>(<span class="dv">10</span>)<span class="kw">;</span>    <span class="fu">//</span> <span class="dt">OK</span><span class="fu">:</span> <span class="dt">Container</span> <span class="dt">is</span> an interface</span></code></pre></div>
<p>A <code class="calibre8">Container</code> can only serve as the
interface to a class that implements its <code
class="calibre8">operator[]()</code> and <code
class="calibre8">size()</code> functions. A class with a pure virtual
function is called an <em>abstract class</em>.</p>
<p>This <code class="calibre8">Container</code> can be used like
this:</p>
<p><a href="#part0028_split_014.html#p0054_03a"
id="part0009.html#p0054_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb118"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>void use(<span class="dt">Container</span>&amp; c)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>     const int sz <span class="kw">=</span> c.size()<span class="kw">;</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>     for (int i<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>sz<span class="kw">;</span> ++i)</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> c[i] <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Note how <code class="calibre8">use()</code> uses the <code
class="calibre8">Container</code> interface in complete ignorance of
implementation details. It uses <code class="calibre8">size()</code> and
<code class="calibre8">[ ]</code> without any idea of exactly which type
provides their implementation. A class that provides the interface to a
variety of other classes is often called a <em>polymorphic
type</em>.</p>
<p>As is common for abstract classes, <code
class="calibre8">Container</code> does not have a constructor. After
all, it does not have any data to initialize. On the other hand, <code
class="calibre8">Container</code> does have a destructor and that
destructor is <code class="calibre8">virtual</code>, so that classes
derived from <code class="calibre8">Container</code> can provide
implementations. Again, that is common for abstract classes because they
tend to be manipulated through references or pointers, and someone
destroying a <code class="calibre8">Container</code> through a pointer
has no idea what resources are owned by its implementation; see also §<a
href="#part0009.html#ch04lev1sec5" class="calibre6">4.5</a>.</p>
<p><span id="part0009.html#page_55" class="pagebreak"></span>The
abstract class <code class="calibre8">Container</code> defines only an
interface and no implementation. For <code
class="calibre8">Container</code> to be useful, we have to implement a
container that implements the functions required by its interface. For
that, we could use the concrete class <code
class="calibre8">Vector</code>:</p>
<p><a href="#part0028_split_015.html#p0055_01a"
id="part0009.html#p0055_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb119"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector_container</span> <span class="fu">:</span> public <span class="dt">Container</span> <span class="kw">{</span>   <span class="fu">//</span> <span class="dt">Vector_container</span> implements <span class="dt">Container</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector_container</span>(int s) <span class="fu">:</span> v(s) <span class="kw">{</span> <span class="kw">}</span>   <span class="fu">//</span> <span class="dt">Vector</span> of s elements</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>     ~<span class="dt">Vector_container</span>() <span class="kw">{}</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>     double&amp; operator[](int i) override <span class="kw">{</span> return v[i]<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>     int size() const override <span class="kw">{</span> return v.size()<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> v<span class="kw">;</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>The <code class="calibre8">:public</code> can be read as “is derived
from” or “is a subtype of.” Class <code
class="calibre8">Vector_container</code> is said to be <em>derived</em>
from class <code class="calibre8">Container</code>, and class <code
class="calibre8">Container</code> is said to be a <em>base</em> of class
<code class="calibre8">Vector_container</code>. An alternative
terminology calls <code class="calibre8">Vector_container</code> and
<code class="calibre8">Container</code> <em>subclass</em> and
<em>superclass</em>, respectively. The derived class is said to inherit
members from its base class, so the use of base and derived classes is
commonly referred to as <em>inheritance</em>.</p>
<p>The members <code class="calibre8">operator[]()</code> and <code
class="calibre8">size()</code> are said to <em>override</em> the
corresponding members in the base class <code
class="calibre8">Container</code>. I used the explicit <code
class="calibre8">override</code> to make clear what’s intended. The use
of <code class="calibre8">override</code> is optional, but being
explicit allows the compiler to catch mistakes, such as misspellings of
function names or slight differences between the type of a <code
class="calibre8">virtual</code> function and its intended overrider. The
explicit use of <code class="calibre8">override</code> is particularly
useful in larger class hiearchies where it can otherwise be hard to know
what is supposed to override what.</p>
<p>The destructor (<code class="calibre8">~Vector_container()</code>)
overrides the base class destructor (<code
class="calibre8">~Container()</code>). Note that the member destructor
(<code class="calibre8">~Vector()</code>) is implicitly invoked by its
class’s destructor (<code
class="calibre8">~Vector_container()</code>).</p>
<p>For a function like <code class="calibre8">use(Container&amp;)</code>
to use a <code class="calibre8">Container</code> in complete ignorance
of implementation details, some other function will have to make an
object on which it can operate. For example:</p>
<p><a href="#part0028_split_016.html#p0055_02a"
id="part0009.html#p0055_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb120"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>void g()</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector_container</span> vc(<span class="dv">10</span>)<span class="kw">;</span>     <span class="fu">//</span> <span class="dt">Vector</span> of ten elements</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... fill vc ...</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>     use(vc)<span class="kw">;</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Since <code class="calibre8">use()</code> doesn’t know about <code
class="calibre8">Vector_container</code>s but only knows the <code
class="calibre8">Container</code> interface, it will work just as well
for a different implementation of a <code
class="calibre8">Container</code>. For example:</p>
<p><a href="#part0028_split_017.html#p0055_03a"
id="part0009.html#p0055_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb121"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">List_container</span> <span class="fu">:</span> public <span class="dt">Container</span> <span class="kw">{</span>     <span class="fu">//</span> <span class="dt">List_container</span> implements <span class="dt">Container</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">List_container</span>() <span class="kw">{</span> <span class="kw">}</span>      <span class="fu">//</span> empty <span class="dt">List</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">List_container</span>(initializer_list<span class="dt">&lt;</span>double<span class="er">&gt;</span> il) <span class="fu">:</span> ld<span class="kw">{</span>il<span class="kw">}</span> <span class="kw">{</span> <span class="kw">}</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>     ~<span class="dt">List_container</span>() <span class="kw">{}</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>     double&amp; operator[](int i) override<span class="kw">;</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>     int size() const override <span class="kw">{</span> return ld.size()<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>     std::list<span class="dt">&lt;</span>double<span class="er">&gt;</span> ld<span class="kw">;</span>     <span class="fu">//</span> (standard<span class="fu">-</span>library) list of doubles (<span class="er">§</span><span class="fl">11.3</span>)</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a>double&amp; <span class="dt">List_container</span>::operator[](int i)</span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>     for (auto&amp; x <span class="fu">:</span> ld) <span class="kw">{</span></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>           if (i<span class="fu">==</span><span class="dv">0</span>)</span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a>                 return x<span class="kw">;</span></span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a>           <span class="er">−−</span>i<span class="kw">;</span></span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a>     <span class="kw">throw</span> out_of_range<span class="kw">{</span><span class="ot">&quot;</span><span class="er">List container</span><span class="ot">&quot;</span><span class="kw">};</span></span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0009.html#page_56" class="pagebreak"></span>Here, the
representation is a standard-library <code
class="calibre8">list&lt;double&gt;</code>. Usually, I would not
implement a container with a subscript operation using a <code
class="calibre8">list</code>, because performance of <code
class="calibre8">list</code> subscripting is atrocious compared to <code
class="calibre8">vector</code> subscripting. However, here I just wanted
to show an implementation that is radically different from the usual
one.</p>
<p>A function can create a <code class="calibre8">List_container</code>
and have <code class="calibre8">use()</code> use it:</p>
<p><a href="#part0028_split_018.html#p0056_01a"
id="part0009.html#p0056_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb122"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>void h()</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">List_container</span> lc <span class="kw">=</span> <span class="kw">{</span> <span class="dv">1</span><span class="kw">,</span> <span class="dv">2</span><span class="kw">,</span> <span class="dv">3</span><span class="kw">,</span> <span class="dv">4</span><span class="kw">,</span> <span class="dv">5</span><span class="kw">,</span> <span class="dv">6</span><span class="kw">,</span> <span class="dv">7</span><span class="kw">,</span> <span class="dv">8</span><span class="kw">,</span> <span class="dv">9</span> <span class="kw">};</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>     use(lc)<span class="kw">;</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The point is that <code class="calibre8">use(Container&amp;)</code>
has no idea if its argument is a <code
class="calibre8">Vector_container</code>, a <code
class="calibre8">List_container</code>, or some other kind of container;
it doesn’t need to know. It can use any kind of <code
class="calibre8">Container</code>. It knows only the interface defined
by <code class="calibre8">Container</code>. Consequently, <code
class="calibre8">use(Container&amp;)</code> needn’t be recompiled if the
implementation of <code class="calibre8">List_container</code> changes
or a brand-new class derived from <code
class="calibre8">Container</code> is used.</p>
<p>The flip side of this flexibility is that objects must be manipulated
through pointers or references (§<a href="#part0010.html#ch05lev1sec2"
class="calibre6">5.2</a>, §<a href="#part0018.html#ch13lev2sec1"
class="calibre6">13.2.1</a>).</p>
<h3 class="h2" id="part0009.html#ch04lev1sec4">4.4 Virtual
Functions</h3>
<p>Consider again the use of <code
class="calibre8">Container</code>:</p>
<p><a href="#part0028_split_019.html#p0056_02a"
id="part0009.html#p0056_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb123"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>void use(<span class="dt">Container</span>&amp; c)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>     const int sz <span class="kw">=</span> c.size()<span class="kw">;</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>     for (int i<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>sz<span class="kw">;</span> ++i)</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> c[i] <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>How is the call <code class="calibre8">c[i]</code> in <code
class="calibre8">use()</code> resolved to the right <code
class="calibre8">operator[]()</code>? When <code
class="calibre8">h()</code> calls <code class="calibre8">use()</code>,
<code class="calibre8">List_container</code>’s <code
class="calibre8">operator[]()</code> must be called. When <code
class="calibre8">g()</code> calls <code class="calibre8">use()</code>,
<code class="calibre8">Vector_container</code>’s <code
class="calibre8">operator[]()</code> must be called. To <span
id="part0009.html#page_57" class="pagebreak"></span>achieve this
resolution, a <code class="calibre8">Container</code> object must
contain information to allow it to select the right function to call at
run time. The usual implementation technique is for the compiler to
convert the name of a virtual function into an index into a table of
pointers to functions. That table is usually called the <em>virtual
function table</em> or simply the <code class="calibre8">vtbl</code>.
Each class with virtual functions has its own <code
class="calibre8">vtbl</code> identifying its virtual functions. This can
be represented graphically like this:</p>
<figure>
<img src="images/00013.jpeg" class="calibre1" />
</figure>
<p>The functions in the <code class="calibre8">vtbl</code> allow the
object to be used correctly even when the size of the object and the
layout of its data are unknown to the caller. The implementation of the
caller needs only to know the location of the pointer to the <code
class="calibre8">vtbl</code> in a <code
class="calibre8">Container</code> and the index used for each virtual
function. This virtual call mechanism can be made almost as efficient as
the “normal function call” mechanism (within 25%). Its space overhead is
one pointer in each object of a class with virtual functions plus one
<code class="calibre8">vtbl</code> for each such class.</p>
<h3 class="h2" id="part0009.html#ch04lev1sec5">4.5 Class
Hierarchies</h3>
<p>The <code class="calibre8">Container</code> example is a very simple
example of a class hierarchy. A <em>class hierarchy</em> is a set of
classes ordered in a lattice created by derivation (e.g., <code
class="calibre8">: public</code>). We use class hierarchies to represent
concepts that have hierarchical relationships, such as “A fire engine is
a kind of a truck which is a kind of a vehicle” and “A smiley face is a
kind of a circle which is a kind of a shape.” Huge hierarchies, with
hundreds of classes, that are both deep and wide are common. As a
semi-realistic classic example, let’s consider shapes on a screen:</p>
<figure>
<img src="images/00014.jpeg" class="calibre1" />
</figure>
<p>The arrows represent inheritance relationships. For example, class
<code class="calibre8">Circle</code> is derived from class <span
id="part0009.html#page_58" class="pagebreak"></span><code
class="calibre8">Shape</code>. To represent that simple diagram in code,
we must first specify a class that defines the general properties of all
shapes:</p>
<p><a href="#part0028_split_020.html#p0058_01a"
id="part0009.html#p0058_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb124"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Shape</span> <span class="kw">{</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>     virtual <span class="dt">Point</span> center() const <span class="kw">=</span><span class="dv">0</span><span class="kw">;</span>     <span class="fu">//</span> pure virtual</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>     virtual void move(<span class="dt">Point</span> to) <span class="kw">=</span><span class="dv">0</span><span class="kw">;</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>     virtual void draw() const <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span>       <span class="fu">//</span> draw on current <span class="ot">&quot;</span><span class="er">Canvas</span><span class="ot">&quot;</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>     virtual void rotate(int angle) <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>     virtual ~<span class="dt">Shape</span>() <span class="kw">{}</span>                  <span class="fu">//</span> destructor</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>Naturally, this interface is an abstract class: as far as
representation is concerned, <em>nothing</em> (except the location of
the pointer to the <code class="calibre8">vtbl</code>) is common for
every <code class="calibre8">Shape</code>. Given this definition, we can
write general functions manipulating vectors of pointers to shapes:</p>
<p><a href="#part0028_split_021.html#p0058_02a"
id="part0009.html#p0058_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb125"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>void rotate_all(vector<span class="dt">&lt;Shape</span>*&gt;&amp; v<span class="kw">,</span> int angle) <span class="fu">//</span> rotate v<span class="st">&#39;</span><span class="er">s elements by angle degrees</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="ch">     </span><span class="er">for (auto p : v)</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="er">           p−&gt;rotate(angle);</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>To define a particular shape, we must say that it is a <code
class="calibre8">Shape</code> and specify its particular properties
(including its virtual functions):</p>
<p><a href="#part0028_split_022.html#p0058_03a"
id="part0009.html#p0058_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb126"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Circle</span> <span class="fu">:</span> public <span class="dt">Shape</span> <span class="kw">{</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Circle</span>(<span class="dt">Point</span> p<span class="kw">,</span> int rad)<span class="kw">;</span>       <span class="fu">//</span> constructor</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Point</span> center() const override</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>          return x<span class="kw">;</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>     void move(<span class="dt">Point</span> to) override</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span></span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>          x <span class="kw">=</span> to<span class="kw">;</span></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>     void draw() const override<span class="kw">;</span></span>
<span id="cb126-15"><a href="#cb126-15" aria-hidden="true" tabindex="-1"></a>     void rotate(int) override <span class="kw">{}</span>         <span class="fu">//</span> nice simple algorithm</span>
<span id="cb126-16"><a href="#cb126-16" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb126-17"><a href="#cb126-17" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Point</span> x<span class="kw">;</span>   <span class="fu">//</span> center</span>
<span id="cb126-18"><a href="#cb126-18" aria-hidden="true" tabindex="-1"></a>     int r<span class="kw">;</span>     <span class="fu">//</span> radius</span>
<span id="cb126-19"><a href="#cb126-19" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>So far, the <code class="calibre8">Shape</code> and <code
class="calibre8">Circle</code> example provides nothing new compared to
the <code class="calibre8">Container</code> and <code
class="calibre8">Vector_container</code> example, but we can build
further:</p>
<p><a href="#part0028_split_023.html#p0059_01a"
id="part0009.html#p0059_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb127"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Smiley</span> <span class="fu">:</span> public <span class="dt">Circle</span> <span class="kw">{</span>  <span class="fu">//</span> use the circle as the base for a face</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Smiley</span>(<span class="dt">Point</span> p<span class="kw">,</span> int rad) <span class="fu">:</span> <span class="dt">Circle</span><span class="kw">{</span>p<span class="kw">,</span>r<span class="kw">},</span> mouth<span class="kw">{</span>nullptr<span class="kw">}</span> <span class="kw">{</span> <span class="kw">}</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>     ~<span class="dt">Smiley</span>()</span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span></span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>          delete mouth<span class="kw">;</span></span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>          for (auto p <span class="fu">:</span> eyes)</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>                delete p<span class="kw">;</span></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true" tabindex="-1"></a>     void move(<span class="dt">Point</span> to) override<span class="kw">;</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true" tabindex="-1"></a>     void draw() const override<span class="kw">;</span></span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true" tabindex="-1"></a>     void rotate(int) override<span class="kw">;</span></span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true" tabindex="-1"></a>     void add_eye(<span class="dt">Shape</span><span class="fu">*</span> s)</span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span></span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true" tabindex="-1"></a>          eyes.push_back(s)<span class="kw">;</span></span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true" tabindex="-1"></a>     void set_mouth(<span class="dt">Shape</span><span class="fu">*</span> s)<span class="kw">;</span></span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true" tabindex="-1"></a>     virtual void wink(int i)<span class="kw">;</span>     <span class="fu">//</span> wink eye <span class="dt">number</span> i</span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-24"><a href="#cb127-24" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb127-25"><a href="#cb127-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-26"><a href="#cb127-26" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb127-27"><a href="#cb127-27" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;Shape</span>*&gt; eyes<span class="kw">;</span>          <span class="fu">//</span> usually two eyes</span>
<span id="cb127-28"><a href="#cb127-28" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Shape</span><span class="fu">*</span> mouth<span class="kw">;</span></span>
<span id="cb127-29"><a href="#cb127-29" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>The <code class="calibre8">push_back()</code> member of <code
class="calibre8">vector</code> copies its argument into the <code
class="calibre8">vector</code> (here, <code
class="calibre8">eyes</code>) as the last element, increasing that
vector’s size by one.</p>
<p>We can now define <code class="calibre8">Smiley::draw()</code> using
calls to <code class="calibre8">Smiley</code>’s base and member <code
class="calibre8">draw()</code>s:</p>
<p><a href="#part0028_split_024.html#p0059_02a"
id="part0009.html#p0059_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb128"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>void <span class="dt">Smiley</span>::draw() const</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Circle</span>::draw()<span class="kw">;</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>     for (auto p <span class="fu">:</span> eyes)</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>           p<span class="er">−</span><span class="dt">&gt;</span>draw()<span class="kw">;</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>     mouth<span class="er">−</span><span class="dt">&gt;</span>draw()<span class="kw">;</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Note the way that <code class="calibre8">Smiley</code> keeps its eyes
in a standard-library <code class="calibre8">vector</code> and deletes
them in its destructor. <code class="calibre8">Shape</code>’s destructor
is <code class="calibre8">virtual</code> and <code
class="calibre8">Smiley</code>’s destructor overrides it. A virtual
destructor is essential for an abstract class because an object of a
derived class is usually manipulated through the interface provided by
its abstract base class. In particular, it may be deleted through a
pointer to a base class. Then, the virtual function call mechanism
ensures that the proper destructor is called. That destructor then
implicitly invokes the destructors of its bases and members.</p>
<p><span id="part0009.html#page_60" class="pagebreak"></span>In this
simplified example, it is the programmer’s task to place the eyes and
mouth appropriately within the circle representing the face.</p>
<p>We can add data members, operations, or both as we define a new class
by derivation. This gives great flexibility with corresponding
opportunities for confusion and poor design.</p>
<h4 class="h3" id="part0009.html#ch04lev2sec4">4.5.1 Benefits from
Hierarchies</h4>
<p>A class hierarchy offers two kinds of benefits:</p>
<ul>
<li><p><em>Interface inheritance</em>: An object of a derived class can
be used wherever an object of a base class is required. That is, the
base class acts as an interface for the derived class. The <code
class="calibre8">Container</code> and <code
class="calibre8">Shape</code> classes are examples. Such classes are
often abstract classes.</p></li>
<li><p><em>Implementation inheritance</em>: A base class provides
functions or data that simplifies the implementation of derived classes.
<code class="calibre8">Smiley</code>’s uses of <code
class="calibre8">Circle</code>’s constructor and of <code
class="calibre8">Circle::draw()</code> are examples. Such base classes
often have data members and constructors.</p></li>
</ul>
<p>Concrete classes – especially classes with small representations –
are much like built-in types: we define them as local variables, access
them using their names, copy them around, etc. Classes in class
hierarchies are different: we tend to allocate them on the free store
using <code class="calibre8">new</code>, and we access them through
pointers or references. For example, consider a function that reads data
describing shapes from an input stream and constructs the appropriate
<code class="calibre8">Shape</code> objects:</p>
<p><a href="#part0028_split_025.html#p0060_01a"
id="part0009.html#p0060_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb129"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>enum class <span class="dt">Kind</span> <span class="kw">{</span> circle<span class="kw">,</span> triangle<span class="kw">,</span> smiley <span class="kw">};</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Shape</span><span class="fu">*</span> read_shape(istream&amp; <span class="dt">is</span>)   <span class="fu">//</span> <span class="fu">read</span> shape descriptions from input stream <span class="dt">is</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>     <span class="dv">//</span> ... read shape header from <span class="dt">is</span> and find its <span class="dt">Kind</span> k ...</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>     switch (k) <span class="er">{</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>     case <span class="dt">Kind</span>::circle<span class="fu">:</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>          <span class="dv">//</span> read circle data <span class="er">{</span><span class="dt">Point</span><span class="kw">,</span>int<span class="er">}</span> into p and r</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>          return new <span class="dt">Circle</span><span class="kw">{</span>p<span class="kw">,</span>r<span class="kw">};</span></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>     case <span class="dt">Kind</span>::triangle<span class="fu">:</span></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> <span class="fu">read</span> triangle data <span class="kw">{</span><span class="dt">Point</span><span class="kw">,</span><span class="dt">Point</span><span class="kw">,</span><span class="dt">Point</span><span class="kw">}</span> into p1<span class="kw">,</span> p2<span class="kw">,</span> and p3</span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a>          return new <span class="dt">Triangle</span><span class="kw">{</span>p1<span class="kw">,</span>p2<span class="kw">,</span>p3<span class="kw">};</span></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>     case <span class="dt">Kind</span>::smiley<span class="fu">:</span></span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> <span class="fu">read</span> smiley data <span class="kw">{</span><span class="dt">Point</span><span class="kw">,</span>int<span class="kw">,</span><span class="dt">Shape</span><span class="kw">,</span><span class="dt">Shape</span><span class="kw">,</span><span class="dt">Shape</span><span class="kw">}</span> into p<span class="kw">,</span> r<span class="kw">,</span> e1<span class="kw">,</span> e2<span class="kw">,</span> and m</span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a>          <span class="dt">Smiley</span><span class="fu">*</span> ps <span class="kw">=</span> new <span class="dt">Smiley</span><span class="kw">{</span>p<span class="kw">,</span>r<span class="kw">};</span></span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a>          ps<span class="er">−</span><span class="dt">&gt;</span>add_eye(e1)<span class="kw">;</span></span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a>          ps<span class="er">−</span><span class="dt">&gt;</span>add_eye(e2)<span class="kw">;</span></span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a>          ps<span class="er">−</span><span class="dt">&gt;</span>set_mouth(m)<span class="kw">;</span></span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a>          return ps<span class="kw">;</span></span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a>     <span class="er">}</span></span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>A program may use that shape reader like this:</p>
<p><a href="#part0028_split_026.html#p0061_01a"
id="part0009.html#p0061_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb130"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>void user()</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>     std::vector<span class="dt">&lt;Shape</span>*&gt;v<span class="kw">;</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>     while (cin)</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>          v.push_back(read_shape(cin))<span class="kw">;</span></span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>     draw_all(v)<span class="kw">;</span>                <span class="fu">//</span> <span class="kw">call</span> draw() for each element</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>     rotate_all(v<span class="kw">,</span><span class="dv">45</span>)<span class="kw">;</span>           <span class="fu">//</span> <span class="kw">call</span> rotate(<span class="dv">45</span>) for each element</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>     for (auto p <span class="fu">:</span> v)            <span class="fu">//</span> remember to delete elements</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>           delete p<span class="kw">;</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Obviously, the example is simplified – especially with respect to
error handling – but it vividly illustrates that <code
class="calibre8">user()</code> has absolutely no idea of which kinds of
shapes it manipulates. The <code class="calibre8">user()</code> code can
be compiled once and later used for new <code
class="calibre8">Shape</code>s added to the program. Note that there are
no pointers to the shapes outside <code class="calibre8">user()</code>,
so <code class="calibre8">user()</code> is responsible for deallocating
them. This is done with the <code class="calibre8">delete</code>
operator and relies critically on <code class="calibre8">Shape</code>’s
virtual destructor. Because that destructor is virtual, <code
class="calibre8">delete</code> invokes the destructor for the most
derived class. This is crucial because a derived class may have acquired
all kinds of resources (such as file handles, locks, and output streams)
that need to be released. In this case, a <code
class="calibre8">Smiley</code> deletes its <code
class="calibre8">eyes</code> and <code class="calibre8">mouth</code>
objects. Once it has done that, it calls <code
class="calibre8">Circle</code>’s destructor. Objects are constructed
“bottom up” (base first) by constructors and destroyed “top down”
(derived first) by destructors.</p>
<h4 class="h3" id="part0009.html#ch04lev2sec5">4.5.2 Hierarchy
Navigation</h4>
<p>The <code class="calibre8">read_shape()</code> function returns <code
class="calibre8">Shape*</code> so that we can treat all <code
class="calibre8">Shapes</code> alike. However, what can we do if we want
to use a member function that is only provided by a particular derived
class, such as <code class="calibre8">Smiley</code>’s <code
class="calibre8">wink()</code>? We can ask “is this <code
class="calibre8">Shape</code> a kind of <code
class="calibre8">Smiley</code>?” using the <code
class="calibre8">dynamic_cast</code> operator:</p>
<p><a href="#part0028_split_027.html#p0061_02a"
id="part0009.html#p0061_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb131"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Shape</span><span class="fu">*</span> ps <span class="kw">{</span>read_shape(cin)<span class="kw">};</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>if (<span class="dt">Smiley</span><span class="fu">*</span> p <span class="kw">=</span> dynamic_cast<span class="dt">&lt;Smiley</span>*&gt;(ps)) <span class="kw">{</span> <span class="fu">//</span> ... does ps point to a <span class="dt">Smiley</span>? ...</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... a <span class="dt">Smiley</span><span class="kw">;</span> use it</span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>else <span class="kw">{</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... not a <span class="dt">Smiley</span><span class="kw">,</span> try something else ...</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>If at run time the object pointed to by the argument of <code
class="calibre8">dynamic_cast</code> (here, <code
class="calibre8">ps</code>) is not of the expected type (here, <code
class="calibre8">Smiley</code>) or a class derived from the expected
type, <code class="calibre8">dynamic_cast</code> returns <code
class="calibre8">nullptr</code>.</p>
<p>We use <code class="calibre8">dynamic_cast</code> to a pointer type
when a pointer to an object of a different derived class is a valid
argument. We then test whether the result is <code
class="calibre8">nullptr</code>. This test can often conveniently be
placed in the initialization of a variable in a condition.</p>
<p>When a different type is unacceptable, we can simply <code
class="calibre8">dynamic_cast</code> to a reference type. If the object
is not of the expected type, <code class="calibre8">dynamic_cast</code>
throws a <code class="calibre8">bad_cast</code> exception:</p>
<p><a href="#part0028_split_028.html#p0061_03a"
id="part0009.html#p0061_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb132"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Shape</span><span class="fu">*</span> ps <span class="kw">{</span>read_shape(cin)<span class="kw">};</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Smiley</span>&amp; r <span class="kw">{</span>dynamic_cast<span class="dt">&lt;Smiley</span>&amp;&gt;(<span class="dt">*</span>ps)<span class="kw">};</span>   <span class="fu">//</span> somewhere<span class="kw">,</span> <span class="kw">catch</span> std::bad_cast</span></code></pre></div>
<p>Code is cleaner when <code class="calibre8">dynamic_cast</code> is
used with restraint. If we can avoid using type information, <span
id="part0009.html#page_62" class="pagebreak"></span>we can write simpler
and more efficient code, but occasionally type information is lost and
must be recovered. This typically happens when we pass an object to some
system that accepts an interface specified by a base class. When that
system later passes the object back to us, we might have to recover the
original type. Operations similar to <code
class="calibre8">dynamic_cast</code> are known as “is kind of” and “is
instance of” operations.</p>
<h4 class="h3" id="part0009.html#ch04lev2sec6">4.5.3 Avoiding Resource
Leaks</h4>
<p>Experienced programmers will have noticed that I left open three
opportunities for mistakes:</p>
<ul>
<li><p>The implementer of <code class="calibre8">Smiley</code> may fail
to <code class="calibre8">delete</code> the pointer to <code
class="calibre8">mouth</code>.</p></li>
<li><p>A user of <code class="calibre8">read_shape()</code> might fail
to <code class="calibre8">delete</code> the pointer returned.</p></li>
<li><p>The owner of a container of <code class="calibre8">Shape</code>
pointers might fail to <code class="calibre8">delete</code> the objects
pointed to.</p></li>
</ul>
<p>In that sense, pointers to objects allocated on the free store is
dangerous: a “plain old pointer” should not be used to represent
ownership. For example:</p>
<p><a href="#part0028_split_029.html#p0062_01a"
id="part0009.html#p0062_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb133"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>void user(int x)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Shape</span><span class="fu">*</span> p <span class="kw">=</span> new <span class="dt">Circle</span><span class="kw">{</span><span class="dt">Point</span><span class="kw">{</span><span class="dv">0</span><span class="kw">,</span><span class="dv">0</span><span class="kw">},</span><span class="dv">10</span><span class="kw">};</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>     if (x<span class="dt">&lt;</span><span class="dv">0</span>) <span class="kw">throw</span> <span class="dt">Bad_x</span><span class="kw">{};</span>   <span class="fu">//</span> potential leak</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>     if (x<span class="fu">==</span><span class="dv">0</span>) return<span class="kw">;</span>         <span class="fu">//</span> potential leak</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>     delete p<span class="kw">;</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This will leak unless <code class="calibre8">x</code> is positive.
Assigning the result of <code class="calibre8">new</code> to a “naked
pointer” is asking for trouble.</p>
<p>One simple solution to such problems is to use a standard-library
<code class="calibre8">unique_ptr</code> (§<a
href="#part0018.html#ch13lev2sec1" class="calibre6">13.2.1</a>) rather
than a “naked pointer” when deletion is required:</p>
<p><a href="#part0028_split_030.html#p0062_02a"
id="part0009.html#p0062_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb134"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Smiley</span> <span class="fu">:</span> public <span class="dt">Circle</span> <span class="kw">{</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>unique_ptr<span class="er">&lt;</span><span class="dt">Shape</span><span class="al">&gt;&gt;</span> eyes<span class="kw">;</span> <span class="fu">//</span> usually two eyes</span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>     unique_ptr<span class="dt">&lt;Shape</span><span class="er">&gt;</span> mouth<span class="kw">;</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>This is an example of a simple, general, and efficient technique for
resource management (§<a href="#part0010.html#ch05lev1sec3"
class="calibre6">5.3</a>).</p>
<p>As a pleasant side effect of this change, we no longer need to define
a destructor for <code class="calibre8">Smiley</code>. The compiler will
implicitly generate one that does the required destruction of the <code
class="calibre8">unique_ptr</code>s (§<a
href="#part0010.html#ch05lev1sec3" class="calibre6">5.3</a>) in the
<code class="calibre8">vector</code>. The code using <code
class="calibre8">unique_ptr</code> will be exactly as efficient as code
using the raw pointers correctly.</p>
<p>Now consider users of <code class="calibre8">read_shape()</code>:</p>
<p><a href="#part0028_split_031.html#p0062_03a"
id="part0009.html#p0062_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb135"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>unique_ptr<span class="dt">&lt;Shape</span><span class="er">&gt;</span> read_shape(istream&amp; <span class="dt">is</span>) <span class="fu">//</span> <span class="fu">read</span> shape descriptions from input stream <span class="dt">is</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>     <span class="dv">//</span> read shape header from <span class="dt">is</span> and find its <span class="dt">Kind</span> k</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>     switch (k) <span class="er">{</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>     case <span class="dt">Kind</span>::circle<span class="fu">:</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>          <span class="dv">//</span> read circle data <span class="er">{</span><span class="dt">Point</span><span class="kw">,</span>int<span class="er">}</span> into p and r</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>          return unique_ptr<span class="dt">&lt;Shape</span><span class="er">&gt;</span><span class="kw">{</span>new <span class="dt">Circle</span><span class="kw">{</span>p<span class="kw">,</span>r<span class="kw">}};</span>       <span class="fu">//</span> <span class="er">§</span><span class="fl">13.2</span><span class="kw">.</span><span class="dv">1</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>void user()</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>unique_ptr<span class="er">&lt;</span><span class="dt">Shape</span><span class="al">&gt;&gt;</span> v<span class="kw">;</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>     while (cin)</span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>          v.push_back(read_shape(cin))<span class="kw">;</span></span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a>     draw_all(v)<span class="kw">;</span>               <span class="fu">//</span> <span class="kw">call</span> draw() for each element</span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>     rotate_all(v<span class="kw">,</span><span class="dv">45</span>)<span class="kw">;</span>          <span class="fu">//</span> <span class="kw">call</span> rotate(<span class="dv">45</span>) for each element</span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span><span class="fu">//</span> all <span class="dt">Shapes</span> implicitly destroyed</span></code></pre></div>
<p><span id="part0009.html#page_63" class="pagebreak"></span>Now each
object is owned by a <code class="calibre8">unique_ptr</code> that will
<code class="calibre8">delete</code> the object when it is no longer
needed, that is, when its <code class="calibre8">unique_ptr</code> goes
out of scope.</p>
<p>For the <code class="calibre8">unique_ptr</code> version of <code
class="calibre8">user()</code> to work, we need versions of <code
class="calibre8">draw_all()</code> and <code
class="calibre8">rotate_all()</code> that accept <code
class="calibre8">vector&lt;unique_ptr&lt;Shape&gt;&gt;</code>s. Writing
many such <code class="calibre8">_all()</code> functions could become
tedious, so §<a href="#part0011.html#ch06lev2sec5"
class="calibre6">6.3.2</a> shows an alternative.</p>
<h3 class="h2" id="part0009.html#ch04lev1sec6">4.6 Advice</h3>
<p>[1] Express ideas directly in code; §<a
href="#part0009.html#ch04lev1sec1" class="calibre6">4.1</a>; [CG:
P.1].</p>
<p>[2] A concrete type is the simplest kind of class. Where applicable,
prefer a concrete type over more complicated classes and over plain data
structures; §<a href="#part0009.html#ch04lev1sec2"
class="calibre6">4.2</a>; [CG: C.10].</p>
<p>[3] Use concrete classes to represent simple concepts; §<a
href="#part0009.html#ch04lev1sec2" class="calibre6">4.2</a>.</p>
<p>[4] Prefer concerete classes over class hierarchies for
performance-critical components; §<a href="#part0009.html#ch04lev1sec2"
class="calibre6">4.2</a>.</p>
<p>[5] Define constructors to handle initialization of objects; §<a
href="#part0009.html#ch04lev2sec1" class="calibre6">4.2.1</a>, §<a
href="#part0010.html#ch05lev2sec1" class="calibre6">5.1.1</a>; [CG:
C.40] [CG: C.41].</p>
<p>[6] Make a function a member only if it needs direct access to the
representation of a class; §<a href="#part0009.html#ch04lev2sec1"
class="calibre6">4.2.1</a>; [CG: C.4].</p>
<p>[7] Define operators primarily to mimic conventional usage; §<a
href="#part0009.html#ch04lev2sec1" class="calibre6">4.2.1</a>; [CG:
C.160].</p>
<p>[8] Use nonmember functions for symmetric operators; §<a
href="#part0009.html#ch04lev2sec1" class="calibre6">4.2.1</a>; [CG:
C.161].</p>
<p>[9] Declare a member function that does not modify the state of its
object <code class="calibre8">const</code>; §<a
href="#part0009.html#ch04lev2sec1" class="calibre6">4.2.1</a>.</p>
<p>[10] If a constructor acquires a resource, its class needs a
destructor to release the resource; §<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>; [CG:
C.20].</p>
<p>[11] Avoid “naked” <code class="calibre8">new</code> and <code
class="calibre8">delete</code> operations; §<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>; [CG:
R.11].</p>
<p>[12] Use resource handles and RAII to manage resources; §<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>; [CG:
R.1].</p>
<p>[13] If a class is a container, give it an initializer-list
constructor; §<a href="#part0009.html#ch04lev2sec3"
class="calibre6">4.2.3</a>; [CG: C.103].</p>
<p>[14] Use abstract classes as interfaces when complete separation of
interface and implementation is needed; §<a
href="#part0009.html#ch04lev1sec3" class="calibre6">4.3</a>; [CG:
C.122].</p>
<p>[15] Access polymorphic objects through pointers and references; §<a
href="#part0009.html#ch04lev1sec3" class="calibre6">4.3</a>.</p>
<p>[16] An abstract class typically doesn’t need a constructor; §<a
href="#part0009.html#ch04lev1sec3" class="calibre6">4.3</a>; [CG:
C.126].</p>
<p>[17] Use class hierarchies to represent concepts with inherent
hierarchical structure; §<a href="#part0009.html#ch04lev1sec5"
class="calibre6">4.5</a>.</p>
<p><span id="part0009.html#page_64" class="pagebreak"></span>[18] A
class with a virtual function should have a virtual destructor; §<a
href="#part0009.html#ch04lev1sec5" class="calibre6">4.5</a>; [CG:
C.127].</p>
<p>[19] Use <code class="calibre8">override</code> to make overriding
explicit in large class hierarchies; §<a
href="#part0009.html#ch04lev2sec4" class="calibre6">4.5.1</a>; [CG:
C.128].</p>
<p>[20] When designing a class hierarchy, distinguish between
implementation inheritance and interface inheritance; §<a
href="#part0009.html#ch04lev2sec4" class="calibre6">4.5.1</a>; [CG:
C.129].</p>
<p>[21] Use <code class="calibre8">dynamic_cast</code> where class
hierarchy navigation is unavoidable; §<a
href="#part0009.html#ch04lev2sec5" class="calibre6">4.5.2</a>; [CG:
C.146].</p>
<p>[22] Use <code class="calibre8">dynamic_cast</code> to a reference
type when failure to find the required class is considered a failure;
§<a href="#part0009.html#ch04lev2sec5" class="calibre6">4.5.2</a>; [CG:
C.147].</p>
<p>[23] Use <code class="calibre8">dynamic_cast</code> to a pointer type
when failure to find the required class is considered a valid
alternative; §<a href="#part0009.html#ch04lev2sec5"
class="calibre6">4.5.2</a>; [CG: C.148].</p>
<p>[24] Use <code class="calibre8">unique_ptr</code> or <code
class="calibre8">shared_ptr</code> to avoid forgetting to <code
class="calibre8">delete</code> objects created using <code
class="calibre8">new</code>; §<a href="#part0009.html#ch04lev2sec6"
class="calibre6">4.5.3</a>; [CG: C.149].</p>
</section>
<p><span id="part0010.html"></span></p>
<section id="part0010.html#ch05" class="h1 bodymatter">
<h2 class="h1"><span id="part0010.html#page_65"
class="calibre2 pagebreak"></span><span class="big">5</span></h2>
<p>Essential Operations</p>
<p><em>When someone says I want a programming language in which I need
only say what I wish done, give him a lollipop.</em></p>
<p><em>– Alan Perlis</em></p>
<ul>
<li><p><a href="#part0010.html#ch05lev1sec1"
class="calibre6">Introduction</a></p>
<p><a href="#part0010.html#ch05lev2sec1" class="calibre6">Essential
Operations</a>; <a href="#part0010.html#ch05lev2sec2"
class="calibre6">Conversions</a>; <a href="#part0010.html#ch05lev2sec3"
class="calibre6">Member Initializers</a></p></li>
<li><p><a href="#part0010.html#ch05lev1sec2" class="calibre6">Copy and
Move</a></p>
<p><a href="#part0010.html#ch05lev2sec4" class="calibre6">Copying
Containers</a>; <a href="#part0010.html#ch05lev2sec5"
class="calibre6">Moving Containers</a></p></li>
<li><p><a href="#part0010.html#ch05lev1sec3" class="calibre6">Resource
Management</a></p></li>
<li><p><a href="#part0010.html#ch05lev1sec4"
class="calibre6">Conventional Operations</a></p>
<p><a href="#part0010.html#ch05lev2sec6"
class="calibre6">Comparisons</a>; <a href="#part0010.html#ch05lev2sec7"
class="calibre6">Container Operations</a>; <a
href="#part0010.html#ch05lev2sec8" class="calibre6">Input and Output
Operators</a>; <a href="#part0010.html#ch05lev2sec9"
class="calibre6">User-Defined Literals</a>; <a
href="#part0010.html#ch05lev2sec10" class="calibre6"><code
class="calibre8">swap()</code></a>; <a
href="#part0010.html#ch05lev2sec11" class="calibre6"><code
class="calibre8">hash&lt;&gt;</code></a></p></li>
<li><p><a href="#part0010.html#ch05lev1sec5"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0010.html#ch05lev1sec1">5.1 Introduction</h3>
<p>Some operations, such as initialization, assignment, copy, and move,
are fundamental in the sense that language rules make assumptions about
them. Other operations, such as <code class="calibre8">==</code> and
<code class="calibre8">&lt;&lt;</code>, have conventional meanings that
are perilous to ignore.</p>
<h4 class="h3" id="part0010.html#ch05lev2sec1">5.1.1 Essential
Operations</h4>
<p>Construction of objects plays a key role in many designs. This wide
variety of uses is reflected in the range and flexibility of the
language features supporting initialization.</p>
<p>Constructors, destructors, and copy and move operations for a type
are not logically separate. We must define them as a matched set or
suffer logical or performance problems. If a class <code
class="calibre8">X</code> has a <span id="part0010.html#page_66"
class="pagebreak"></span>destructor that performs a nontrivial task,
such as free-store deallocation or lock release, the class is likely to
need the full complement of functions:</p>
<p><a href="#part0029_split_000.html#p0066_01a"
id="part0010.html#p0066_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb136"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">X</span> <span class="kw">{</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">X</span>(<span class="dt">Sometype</span>)<span class="kw">;</span>            <span class="fu">//</span> <span class="ot">&quot;</span><span class="er">ordinary constructor</span><span class="ot">&quot;</span><span class="fu">:</span> create an object</span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">X</span>()<span class="kw">;</span>                    <span class="fu">//</span> default constructor</span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">X</span>(const <span class="dt">X</span>&amp;)<span class="kw">;</span>            <span class="fu">//</span> copy constructor</span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a>     <span class="dt">X</span>(<span class="dt">X</span>&amp;&amp;)<span class="kw">;</span>                 <span class="fu">//</span> move constructor</span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a>     <span class="dt">X</span>&amp; operator<span class="kw">=</span>(const <span class="dt">X</span>&amp;)<span class="kw">;</span> <span class="fu">//</span> copy assignment<span class="fu">:</span> clean up target and copy</span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a>     <span class="dt">X</span>&amp; operator<span class="kw">=</span>(<span class="dt">X</span>&amp;&amp;)<span class="kw">;</span>      <span class="fu">//</span> move assignment<span class="fu">:</span> clean up target and move</span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a>     ~<span class="dt">X</span>()<span class="kw">;</span>                   <span class="fu">//</span> destructor<span class="fu">:</span> clean up</span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>There are five situations in which an object can be copied or
moved:</p>
<ul>
<li><p>As the source of an assignment</p></li>
<li><p>As an object initializer</p></li>
<li><p>As a function argument</p></li>
<li><p>As a function return value</p></li>
<li><p>As an exception</p></li>
</ul>
<p>An assignment uses a copy or move assignment operator. In principle,
the other cases use a copy or move constructor. However, a copy or move
constructor invocation is often optimized away by constructing the
object used to initialize right in the target object. For example:</p>
<div class="sourceCode" id="cb137"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="dt">X</span> make(<span class="dt">Sometype</span>)<span class="kw">;</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="dt">X</span> x <span class="kw">=</span> make(value)<span class="kw">;</span></span></code></pre></div>
<p>Here, a compiler will typically construct the <code
class="calibre8">X</code> from <code class="calibre8">make()</code>
directly in <code class="calibre8">x</code>; thus eliminating
(“eliding”) a copy.</p>
<p>In addition to the initialization of named objects and of objects on
the free store, constructors are used to initialize temporary objects
and to implement explicit type conversion.</p>
<p>Except for the “ordinary constructor,” these special member functions
will be generated by the compiler as needed. If you want to be explicit
about generating default implementations, you can:</p>
<p><a href="#part0029_split_001.html#p0066_02a"
id="part0010.html#p0066_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb138"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Y</span> <span class="kw">{</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Y</span>(<span class="dt">Sometype</span>)<span class="kw">;</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Y</span>(const <span class="dt">Y</span>&amp;) <span class="kw">=</span> default<span class="kw">;</span>   <span class="fu">//</span> <span class="dt">I</span> really do want the default copy constructor</span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Y</span>(<span class="dt">Y</span>&amp;&amp;) <span class="kw">=</span> default<span class="kw">;</span>        <span class="fu">//</span> and the default move constructor</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>If you are explicit about some defaults, other default definitions
will not be generated.</p>
<p>When a class has a pointer member, it is usually a good idea to be
explicit about copy and move operations. The reason is that a pointer
may point to something that the class needs to <code
class="calibre8">delete</code>, in which case the default memberwise
copy would be wrong. Alternatively, it might point to something that the
class must <em>not</em> <code class="calibre8">delete</code>. In either
case, a reader of the code would like to know. For an example, see §<a
href="#part0010.html#ch05lev2sec4" class="calibre6">5.2.1</a>.</p>
<p><span id="part0010.html#page_67" class="pagebreak"></span>A good rule
of thumb (sometimes called <em>the rule of zero</em>) is to either
define all of the essential operations or none (using the default for
all). For example:</p>
<p><a href="#part0029_split_002.html#p0067_01a"
id="part0010.html#p0067_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb139"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Z</span> <span class="kw">{</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> v<span class="kw">;</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>     string s<span class="kw">;</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="dt">Z</span> z1<span class="kw">;</span>          <span class="fu">//</span> default initialize z1<span class="kw">.</span>v and z1<span class="kw">.</span>s</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="dt">Z</span> z2 <span class="kw">=</span> z1<span class="kw">;</span>     <span class="fu">//</span> default copy z1<span class="kw">.</span>v and z1<span class="kw">.</span>s</span></code></pre></div>
<p>Here, the compiler will synthesize memberwise default construction,
copy, move, and destructor as needed, and all with the correct
semantics.</p>
<p>To complement <code class="calibre8">=default</code>, we have <code
class="calibre8">=delete</code> to indicate that an operation is not to
be generated. A base class in a class hierarchy is the classical example
where we don’t want to allow a memberwise copy. For example:</p>
<p><a href="#part0029_split_003.html#p0067_02a"
id="part0010.html#p0067_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb140"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Shape</span> <span class="kw">{</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Shape</span>(const <span class="dt">Shape</span>&amp;) <span class="kw">=</span>delete<span class="kw">;</span>            <span class="fu">//</span> no copy operations</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Shape</span>&amp; operator<span class="kw">=</span>(const <span class="dt">Shape</span>&amp;) <span class="kw">=</span>delete<span class="kw">;</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>void copy(<span class="dt">Shape</span>&amp; s1<span class="kw">,</span> const <span class="dt">Shape</span>&amp; s2)</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a>     s1 <span class="kw">=</span> s2<span class="kw">;</span>  <span class="fu">//</span> error<span class="fu">:</span> <span class="dt">Shape</span> copy <span class="dt">is</span> deleted</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>A <code class="calibre8">=delete</code> makes an attempted use of the
<code class="calibre8">delete</code>d function a compile-time error;
<code class="calibre8">=delete</code> can be used to suppress any
function, not just essential member functions.</p>
<h4 class="h3" id="part0010.html#ch05lev2sec2">5.1.2 Conversions</h4>
<p>A constructor taking a single argument defines a conversion from its
argument type. For example, <code class="calibre8">complex</code> (§<a
href="#part0009.html#ch04lev2sec1" class="calibre6">4.2.1</a>) provides
a constructor from a <code class="calibre8">double</code>:</p>
<p><a href="#part0029_split_004.html#p0067_03a"
id="part0010.html#p0067_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb141"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>complex z1 <span class="kw">=</span> <span class="fl">3.14</span><span class="kw">;</span>  <span class="fu">//</span> z1 becomes <span class="kw">{</span><span class="fl">3.14</span><span class="kw">,</span><span class="fl">0.0</span><span class="kw">}</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>complex z2 <span class="kw">=</span> z1<span class="fu">*</span><span class="dv">2</span><span class="kw">;</span>  <span class="fu">//</span> z2 becomes z1<span class="fu">*</span><span class="kw">{</span><span class="fl">2.0</span><span class="kw">,</span><span class="dv">0</span><span class="kw">}</span> <span class="fu">==</span> <span class="kw">{</span><span class="fl">6.28</span><span class="kw">,</span><span class="fl">0.0</span><span class="kw">}</span></span></code></pre></div>
<p>This implicit conversion is sometimes ideal, but not always. For
example, <code class="calibre8">Vector</code> (§<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>) provides
a constructor from an <code class="calibre8">int</code>:</p>
<p><a href="#part0029_split_005.html#p0067_04a"
id="part0010.html#p0067_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb142"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> v1 <span class="kw">=</span> <span class="dv">7</span><span class="kw">;</span> <span class="fu">//</span> <span class="dt">OK</span><span class="fu">:</span> v1 has <span class="dv">7</span> elements</span></code></pre></div>
<p>This is typically considered unfortunate, and the standard-library
<code class="calibre8">vector</code> does not allow this <code
class="calibre8">int</code>-to-<code class="calibre8">vector</code>
“conversion.”</p>
<p>The way to avoid this problem is to say that only explicit
“conversion” is allowed; that is, we can define the constructor like
this:</p>
<p><a href="#part0029_split_006.html#p0068_01a"
id="part0010.html#p0068_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb143"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>     explicit <span class="dt">Vector</span>(int s)<span class="kw">;</span>    <span class="fu">//</span> no implicit conversion from int to <span class="dt">Vector</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>That gives us:</p>
<p><a href="#part0029_split_007.html#p0068_02a"
id="part0010.html#p0068_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb144"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> v1(<span class="dv">7</span>)<span class="kw">;</span>   <span class="fu">//</span> <span class="dt">OK</span><span class="fu">:</span> v1 has <span class="dv">7</span> elements</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> v2 <span class="kw">=</span> <span class="dv">7</span><span class="kw">;</span>  <span class="fu">//</span> error<span class="fu">:</span> no implicit conversion from int to <span class="dt">Vector</span></span></code></pre></div>
<p>When it comes to conversions, more types are like <code
class="calibre8">Vector</code> than are like <code
class="calibre8">complex</code>, so use <code
class="calibre8">explicit</code> for constructors that take a single
argument unless there is a good reason not to.</p>
<h4 class="h3" id="part0010.html#ch05lev2sec3">5.1.3 Member
Initializers</h4>
<p>When a data member of a class is defined, we can supply a default
initializer called a <em>default member initializer</em>. Consider a
revision of <code class="calibre8">complex</code> (§<a
href="#part0009.html#ch04lev2sec1" class="calibre6">4.2.1</a>):</p>
<p><a href="#part0029_split_008.html#p0068_03a"
id="part0010.html#p0068_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb145"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>class complex <span class="kw">{</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>     double re <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>     double im <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span> <span class="fu">//</span> representation<span class="fu">:</span> two doubles with default value <span class="fl">0.0</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>     complex(double r<span class="kw">,</span> double i) <span class="fu">:</span>re<span class="kw">{</span>r<span class="kw">},</span> im<span class="kw">{</span>i<span class="kw">}</span> <span class="kw">{}</span>    <span class="fu">//</span> construct complex from two scalars<span class="fu">:</span> <span class="kw">{</span>r<span class="kw">,</span>i<span class="kw">}</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>     complex(double r) <span class="fu">:</span>re<span class="kw">{</span>r<span class="kw">}</span> <span class="kw">{}</span>                     <span class="fu">//</span> construct complex from one scalar<span class="fu">:</span> <span class="kw">{</span>r<span class="kw">,</span><span class="dv">0</span><span class="kw">}</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>     complex() <span class="kw">{}</span>                                    <span class="fu">//</span> default complex<span class="fu">:</span> <span class="kw">{</span><span class="dv">0</span><span class="kw">,</span><span class="dv">0</span><span class="kw">}</span></span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The default value is used whenever a constructor doesn’t provide a
value. This simplifies code and helps us to avoid accidentally leaving a
member uninitialized.</p>
<h3 class="h2" id="part0010.html#ch05lev1sec2">5.2 Copy and Move</h3>
<p>By default, objects can be copied. This is true for objects of
user-defined types as well as for built-in types. The default meaning of
copy is memberwise copy: copy each member. For example, using <code
class="calibre8">complex</code> from §<a
href="#part0009.html#ch04lev2sec1" class="calibre6">4.2.1</a>:</p>
<p><a href="#part0029_split_009.html#p0068_04a"
id="part0010.html#p0068_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb146"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>void test(complex z1)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>     complex z2 <span class="kw">{</span>z1<span class="kw">};</span>    <span class="fu">//</span> copy <span class="kw">initialization</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>     complex z3<span class="kw">;</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>     z3 <span class="kw">=</span> z2<span class="kw">;</span>            <span class="fu">//</span> copy assignment</span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Now <code class="calibre8">z1</code>, <code
class="calibre8">z2</code>, and <code class="calibre8">z3</code> have
the same value because both the assignment and the initialization copied
both members.</p>
<p>When we design a class, we must always consider if and how an object
might be copied. For simple concrete types, memberwise copy is often
exactly the right semantics for copy. For some <span
id="part0010.html#page_69" class="pagebreak"></span>sophisticated
concrete types, such as <code class="calibre8">Vector</code>, memberwise
copy is not the right semantics for copy; for abstract types it almost
never is.</p>
<h4 class="h3" id="part0010.html#ch05lev2sec4">5.2.1 Copying
Containers</h4>
<p>When a class is a <em>resource handle</em> – that is, when the class
is responsible for an object accessed through a pointer – the default
memberwise copy is typically a disaster. Memberwise copy would violate
the resource handle’s invariant (§<a href="#part0008.html#ch03lev2sec2"
class="calibre6">3.5.2</a>). For example, the default copy would leave a
copy of a <code class="calibre8">Vector</code> referring to the same
elements as the original:</p>
<p><a href="#part0029_split_010.html#p0069_01a"
id="part0010.html#p0069_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb147"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>void bad_copy(<span class="dt">Vector</span> v1)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> v2 <span class="kw">=</span> v1<span class="kw">;</span>    <span class="fu">//</span> copy v1<span class="st">&#39;</span><span class="er">s representation into v2</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="er">     v1[0] = 2;         // v2[0] is now also 2!</span></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="er">     v2[1] = 3;         // v1[1] is now also 3!</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>Assuming that <code class="calibre8">v1</code> has four elements, the
result can be represented graphically like this:</p>
<figure>
<img src="images/00015.jpeg" class="calibre1" />
</figure>
<p>Fortunately, the fact that <code class="calibre8">Vector</code> has a
destructor is a strong hint that the default (memberwise) copy semantics
is wrong and the compiler should at least warn against this example. We
need to define better copy semantics.</p>
<p>Copying of an object of a class is defined by two members: a <em>copy
constructor</em> and a <em>copy assignment</em>:</p>
<p><a href="#part0029_split_011.html#p0069_02a"
id="part0010.html#p0069_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb148"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>     double<span class="fu">*</span> elem<span class="kw">;</span> <span class="fu">//</span> elem points to an array of sz doubles</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>     int sz<span class="kw">;</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>(int s)<span class="kw">;</span>                         <span class="fu">//</span> constructor<span class="fu">:</span> establish invariant<span class="kw">,</span> acquire resources</span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>     ~<span class="dt">Vector</span>() <span class="kw">{</span> delete[] elem<span class="kw">;</span> <span class="kw">}</span>           <span class="fu">//</span> destructor<span class="fu">:</span> release resources</span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>(const <span class="dt">Vector</span>&amp; a)<span class="kw">;</span>               <span class="fu">//</span> copy constructor</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>&amp; operator<span class="kw">=</span>(const <span class="dt">Vector</span>&amp; a)<span class="kw">;</span>    <span class="fu">//</span> copy assignment</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>     double&amp; operator[](int i)<span class="kw">;</span></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>     const double&amp; operator[](int i) const<span class="kw">;</span></span>
<span id="cb148-14"><a href="#cb148-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-15"><a href="#cb148-15" aria-hidden="true" tabindex="-1"></a>     int size() const<span class="kw">;</span></span>
<span id="cb148-16"><a href="#cb148-16" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>A suitable definition of a copy constructor for <code
class="calibre8">Vector</code> allocates the space for the required
number of <span id="part0010.html#page_70"
class="pagebreak"></span>elements and then copies the elements into it
so that after a copy each <code class="calibre8">Vector</code> has its
own copy of the elements:</p>
<p><a href="#part0029_split_012.html#p0070_01a"
id="part0010.html#p0070_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb149"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span>::<span class="dt">Vector</span>(const <span class="dt">Vector</span>&amp; a)   <span class="fu">//</span> copy constructor</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">:</span>elem<span class="kw">{</span>new double[a.sz]<span class="kw">},</span>     <span class="fu">//</span> allocate space for elements</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>     sz<span class="kw">{</span>a.sz<span class="kw">}</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>     for (int i<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>sz<span class="kw">;</span> ++i)    <span class="fu">//</span> copy elements</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>           elem[i] <span class="kw">=</span> a.elem[i]<span class="kw">;</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The result of the <code class="calibre8">v2=v1</code> example can now
be presented as:</p>
<figure>
<img src="images/00016.jpeg" class="calibre1" />
</figure>
<p>Of course, we need a copy assignment in addition to the copy
constructor:</p>
<p><a href="#part0029_split_013.html#p0070_02a"
id="part0010.html#p0070_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb150"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span>&amp; <span class="dt">Vector</span>::operator<span class="kw">=</span>(const <span class="dt">Vector</span>&amp; a)     <span class="fu">//</span> copy assignment</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>     double<span class="fu">*</span> p <span class="kw">=</span> new double[a.sz]<span class="kw">;</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>     for (int i<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>a<span class="al">.</span>sz<span class="kw">;</span> ++i)</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>           p[i] <span class="kw">=</span> a.elem[i]<span class="kw">;</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>     delete[] elem<span class="kw">;</span>         <span class="fu">//</span> delete old elements</span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>     elem <span class="kw">=</span> p<span class="kw">;</span></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>     sz <span class="kw">=</span> a.sz<span class="kw">;</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>     return <span class="fu">*</span>this<span class="kw">;</span></span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The name <code class="calibre8">this</code> is predefined in a member
function and points to the object for which the member function is
called.</p>
<h4 class="h3" id="part0010.html#ch05lev2sec5">5.2.2 Moving
Containers</h4>
<p>We can control copying by defining a copy constructor and a copy
assignment, but copying can be costly for large containers. We avoid the
cost of copying when we pass objects to a function by using references,
but we can’t return a reference to a local object as the result (the
local object would be destroyed by the time the caller got a chance to
look at it). Consider:</p>
<p><a href="#part0029_split_014.html#p0070_03a"
id="part0010.html#p0070_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb151"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> operator<span class="fu">+</span>(const <span class="dt">Vector</span>&amp; a<span class="kw">,</span> const <span class="dt">Vector</span>&amp; b)</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>     if (a<span class="al">.</span>size()<span class="kw">!=</span>b<span class="al">.</span>size())</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>           <span class="kw">throw</span> <span class="dt">Vector_size_mismatch</span><span class="kw">{};</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> res(a<span class="al">.</span>size())<span class="kw">;</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>     for (int i<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>a<span class="al">.</span>size()<span class="kw">;</span> ++i)</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>           res[i]<span class="kw">=</span>a[i]<span class="fu">+</span>b[i]<span class="kw">;</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>     return res<span class="kw">;</span></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0010.html#page_71" class="pagebreak"></span>Returning
from a <code class="calibre8">+</code> involves copying the result out
of the local variable <code class="calibre8">res</code> and into some
place where the caller can access it. We might use this <code
class="calibre8">+</code> like this:</p>
<p><a href="#part0029_split_015.html#p0071_01a"
id="part0010.html#p0071_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb152"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>void f(const <span class="dt">Vector</span>&amp; x<span class="kw">,</span> const <span class="dt">Vector</span>&amp; y<span class="kw">,</span> const <span class="dt">Vector</span>&amp; z)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> r<span class="kw">;</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>     r <span class="kw">=</span> x<span class="fu">+</span>y<span class="fu">+</span>z<span class="kw">;</span></span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb152-7"><a href="#cb152-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>That would be copying a <code class="calibre8">Vector</code> at least
twice (one for each use of the <code class="calibre8">+</code>
operator). If a <code class="calibre8">Vector</code> is large, say,
10,000 <code class="calibre8">double</code>s, that could be
embarrassing. The most embarrassing part is that <code
class="calibre8">res</code> in <code class="calibre8">operator+()</code>
is never used again after the copy. We didn’t really want a copy; we
just wanted to get the result out of a function: we wanted to
<em>move</em> a <code class="calibre8">Vector</code> rather than
<em>copy</em> it. Fortunately, we can state that intent:</p>
<p><a href="#part0029_split_016.html#p0071_02a"
id="part0010.html#p0071_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb153"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>(const <span class="dt">Vector</span>&amp; a)<span class="kw">;</span>               <span class="fu">//</span> copy constructor</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>&amp; operator<span class="kw">=</span>(const <span class="dt">Vector</span>&amp; a)<span class="kw">;</span>    <span class="fu">//</span> copy assignment</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>(<span class="dt">Vector</span>&amp;&amp; a)<span class="kw">;</span>                    <span class="fu">//</span> move constructor</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>&amp; operator<span class="kw">=</span>(<span class="dt">Vector</span>&amp;&amp; a)<span class="kw">;</span>         <span class="fu">//</span> move assignment</span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>Given that definition, the compiler will choose the <em>move
constructor</em> to implement the transfer of the return value out of
the function. This means that <code class="calibre8">r=x+y+z</code> will
involve no copying of <code class="calibre8">Vector</code>s. Instead,
<code class="calibre8">Vector</code>s are just moved.</p>
<p>As is typical, <code class="calibre8">Vector</code>’s move
constructor is trivial to define:</p>
<p><a href="#part0029_split_017.html#p0071_03a"
id="part0010.html#p0071_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb154"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span>::<span class="dt">Vector</span>(<span class="dt">Vector</span>&amp;&amp; a)</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">:</span>elem<span class="kw">{</span>a.elem<span class="kw">},</span>          <span class="fu">//</span> <span class="ot">&quot;</span><span class="er">grab the elements</span><span class="ot">&quot;</span> from a</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>     sz<span class="kw">{</span>a.sz<span class="kw">}</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>     a.elem <span class="kw">=</span> nullptr<span class="kw">;</span>       <span class="fu">//</span> now a has no elements</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>     a.sz <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The <code class="calibre8">&amp;&amp;</code> means “rvalue reference”
and is a reference to which we can bind an rvalue. The word “rvalue” is
intended to complement “lvalue,” which roughly means “something that can
appear on the left-hand side of an assignment.” So an rvalue is – to a
first approximation – a value that you can’t assign to, such as an
integer returned by a function call. Thus, an rvalue reference is a
reference to something that <em>nobody else</em> can assign to, so we
can safely “steal” its value. The <code class="calibre8">res</code>
local variable in <code class="calibre8">operator+()</code> for <code
class="calibre8">Vector</code>s is an example.</p>
<p><span id="part0010.html#page_72" class="pagebreak"></span>A move
constructor does <em>not</em> take a <code class="calibre8">const</code>
argument: after all, a move constructor is supposed to remove the value
from its argument. A <em>move assignment</em> is defined similarly.</p>
<p>A move operation is applied when an rvalue reference is used as an
initializer or as the right-hand side of an assignment.</p>
<p>After a move, a moved-from object should be in a state that allows a
destructor to be run. Typically, we also allow assignment to a
moved-from object. The standard-library algorithms (<a
href="#part0017.html#ch12" class="calibre6">Chapter 12</a>) assumes
that. Our <code class="calibre8">Vector</code> does that.</p>
<p>Where the programmer knows that a value will not be used again, but
the compiler can’t be expected to be smart enough to figure that out,
the programmer can be specific:</p>
<p><a href="#part0029_split_018.html#p0072_01a"
id="part0010.html#p0072_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb155"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> f()</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> x(<span class="dv">1000</span>)<span class="kw">;</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> y(<span class="dv">2000</span>)<span class="kw">;</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> z(<span class="dv">3000</span>)<span class="kw">;</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>     z <span class="kw">=</span> x<span class="kw">;</span>              <span class="fu">//</span> we get a copy (x might be used later in f())</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>     y <span class="kw">=</span> std::move(x)<span class="kw">;</span>   <span class="fu">//</span> we get a move (move assignment)</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... better not use x here ...</span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>     return z<span class="kw">;</span>           <span class="fu">//</span> we get a move</span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The standard-library function <code class="calibre8">move()</code>
doesn’t actually move anything. Instead, it returns a reference to its
argument from which we may move – an <em>rvalue reference</em>; it is a
kind of cast (_hist.cast_).</p>
<p>Just before the <code class="calibre8">return</code> we have:</p>
<figure>
<img src="images/00017.jpeg" class="calibre1" />
</figure>
<p>When we return from <code class="calibre8">f()</code>, <code
class="calibre8">z</code> is destroyed after it’s elements has been
moved out of <code class="calibre8">f()</code> by the <code
class="calibre8">return</code>. However, <code
class="calibre8">y</code>’s destructor will <code
class="calibre8">delete[]</code> its elements.</p>
<p>The compiler is obliged (by the C++ standard) to eliminate most
copies associated with initialization, so move constructors are not
invoked as often as you might imagine. This <em>copy elision</em>
eliminates even the very minor overhead of a move. On the other hand, it
is typically not possible to implicitly eliminate copy or move
operations from assignments, so move assignments can be critical for
performance.</p>
<h3 class="h2" id="part0010.html#ch05lev1sec3">5.3 Resource
Management</h3>
<p>By defining constructors, copy operations, move operations, and a
destructor, a programmer can provide complete control of the lifetime of
a contained resource (such as the elements of a container). Furthermore,
a move constructor allows an object to move simply and cheaply from one
scope to another. That way, objects that we cannot or would not want to
copy out of a scope can be <span id="part0010.html#page_73"
class="pagebreak"></span>simply and cheaply moved out instead. Consider
a standard-library <code class="calibre8">thread</code> representing a
concurrent activity (§<a href="#part0020.html#ch15lev1sec2"
class="calibre6">15.2</a>) and a <code class="calibre8">Vector</code> of
a million <code class="calibre8">double</code>s. We can’t copy the
former and don’t want to copy the latter.</p>
<p><a href="#part0029_split_019.html#p0073_01a"
id="part0010.html#p0073_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb156"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>std::vector<span class="dt">&lt;</span>thread<span class="er">&gt;</span> my_threads<span class="kw">;</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> init(int n)</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>     thread t <span class="kw">{</span>heartbeat<span class="kw">};</span>                 <span class="fu">//</span> run heartbeat concurrently (in a separate thread)</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>     my_threads.push_back(std::move(t))<span class="kw">;</span>   <span class="fu">//</span> move t into my_threads (<span class="er">§</span><span class="fl">13.2</span><span class="al">.</span><span class="dv">2</span>)</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... more <span class="kw">initialization</span> ...</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span> vec(n)<span class="kw">;</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>     for (int i<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>vec<span class="al">.</span>size()<span class="kw">;</span> ++i)</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>           vec[i] <span class="kw">=</span> <span class="dv">777</span><span class="kw">;</span></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>     return vec<span class="kw">;</span>                      <span class="fu">//</span> move vec out of init()</span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>auto v <span class="kw">=</span> init(<span class="dv">1</span><span class="st">&#39;000&#39;</span><span class="dv">000</span>)<span class="kw">;</span>     <span class="fu">//</span> start heartbeat and initialize v</span></code></pre></div>
<p>Resource handles, such as <code class="calibre8">Vector</code> and
<code class="calibre8">thread</code>, are superior alternatives to
direct use of built-in pointers in many cases. In fact, the
standard-library “smart pointers,” such as <code
class="calibre8">unique_ptr</code>, are themselves resource handles (§<a
href="#part0018.html#ch13lev2sec1" class="calibre6">13.2.1</a>).</p>
<p>I used the standard-library <code class="calibre8">vector</code> to
hold the <code class="calibre8">thread</code>s because we don’t get to
parameterize our simple <code class="calibre8">Vector</code> with an
element type until §<a href="#part0011.html#ch06lev1sec2"
class="calibre6">6.2</a>.</p>
<p>In very much the same way that <code class="calibre8">new</code> and
<code class="calibre8">delete</code> disappear from application code, we
can make pointers disappear into resource handles. In both cases, the
result is simpler and more maintainable code, without added overhead. In
particular, we can achieve <em>strong resource safety</em>; that is, we
can eliminate resource leaks for a general notion of a resource.
Examples are <code class="calibre8">vector</code>s holding memory, <code
class="calibre8">thread</code>s holding system threads, and <code
class="calibre8">fstream</code>s holding file handles.</p>
<p>In many languages, resource management is primarily delegated to a
garbage collector. C++ also offers a garbage collection interface so
that you can plug in a garbage collector. However, I consider garbage
collection the last choice after cleaner, more general, and better
localized alternatives to resource management have been exhausted. My
ideal is not to create any garbage, thus eliminating the need for a
garbage collector: Do not litter!</p>
<p>Garbage collection is fundamentally a global memory management
scheme. Clever implementations can compensate, but as systems are
getting more distributed (think caches, multicores, and clusters),
locality is more important than ever.</p>
<p>Also, memory is not the only resource. A resource is anything that
has to be acquired and (explicitly or implicitly) released after use.
Examples are memory, locks, sockets, file handles, and thread handles.
Unsurprisingly, a resource that is not just memory is called a
<em>non-memory resource</em>. A good resource management system handles
all kinds of resources. Leaks must be avoided in any long-running
system, but excessive resource retention can be almost as bad as a leak.
For example, if a system holds on to memory, locks, files, etc. for
twice as long, the system needs to be provisioned with potentially twice
as many resources.</p>
<p>Before resorting to garbage collection, systematically use resource
handles: let each resource have an owner in some scope and by default be
released at the end of its owners scope. In C++, <span
id="part0010.html#page_74" class="pagebreak"></span>this is known as
<em>RAII</em> (<em>Resource Acquisition Is Initialization</em>) and is
integrated with error handling in the form of exceptions. Resources can
be moved from scope to scope using move semantics or “smart pointers,”
and shared ownership can be represented by “shared pointers” (§<a
href="#part0018.html#ch13lev2sec1" class="calibre6">13.2.1</a>).</p>
<p>In the C++ standard library, RAII is pervasive: for example, memory
(<code class="calibre8">string</code>, <code
class="calibre8">vector</code>, <code class="calibre8">map</code>, <code
class="calibre8">unordered_map</code>, etc.), files (<code
class="calibre8">ifstream</code>, <code
class="calibre8">ofstream</code>, etc.), threads (<code
class="calibre8">thread</code>), locks (<code
class="calibre8">lock_guard</code>, <code
class="calibre8">unique_lock</code>, etc.), and general objects (through
<code class="calibre8">unique_ptr</code> and <code
class="calibre8">shared_ptr</code>). The result is implicit resource
management that is invisible in common use and leads to low resource
retention durations.</p>
<h3 class="h2" id="part0010.html#ch05lev1sec4">5.4 Conventional
Operations</h3>
<p>Some operations have conventional meanings when defined for a type.
These conventional meanings are often assumed by programmers and
libraries (notably, the standard library), so it is wise to conform to
them when designing new types for which the operations make sense.</p>
<ul>
<li><p>Comparisons: <code class="calibre8">==</code>, <code
class="calibre8">!=</code>, <code class="calibre8">&lt;</code>, <code
class="calibre8">&lt;=</code>, <code class="calibre8">&gt;</code>, and
<code class="calibre8">&gt;=</code> (§<a
href="#part0010.html#ch05lev2sec6" class="calibre6">5.4.1</a>)</p></li>
<li><p>Container operations: <code class="calibre8">size()</code>, <code
class="calibre8">begin()</code>, and <code class="calibre8">end()</code>
(§<a href="#part0010.html#ch05lev2sec7"
class="calibre6">5.4.2</a>)</p></li>
<li><p>Input and output operations: <code
class="calibre8">&gt;&gt;</code> and <code
class="calibre8">&lt;&lt;</code> (§<a href="#part0010.html#ch05lev2sec8"
class="calibre6">5.4.3</a>)</p></li>
<li><p>User-defined literals (§<a href="#part0010.html#ch05lev2sec9"
class="calibre6">5.4.4</a>)</p></li>
<li><p><code class="calibre8">swap()</code> (§<a
href="#part0010.html#ch05lev2sec10" class="calibre6">5.4.5</a>)</p></li>
<li><p>Hash functions: <code class="calibre8">hash&lt;&gt;</code> (§<a
href="#part0010.html#ch05lev2sec11" class="calibre6">5.4.6</a>)</p></li>
</ul>
<h4 class="h3" id="part0010.html#ch05lev2sec6">5.4.1 Comparisons</h4>
<p>The meaning of the equality comparisons (<code
class="calibre8">==</code> and <code class="calibre8">!=</code>) is
closely related to copying. After a copy, the copies should compare
equal:</p>
<p><a href="#part0029_split_020.html#p0074_01a"
id="part0010.html#p0074_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb157"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="dt">X</span> a <span class="kw">=</span> something<span class="kw">;</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="dt">X</span> b <span class="kw">=</span> a<span class="kw">;</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>assert(a<span class="fu">==</span>b)<span class="kw">;</span>  <span class="fu">//</span> if a<span class="kw">!=</span>b here<span class="kw">,</span> something <span class="dt">is</span> very odd (<span class="er">§</span><span class="fl">3.5</span>.<span class="dv">4</span>)<span class="kw">.</span></span></code></pre></div>
<p>When defining <code class="calibre8">==</code>, also define <code
class="calibre8">!=</code> and make sure that <code
class="calibre8">a!=b</code> means <code
class="calibre8">!(a==b)</code>.</p>
<p>Similarly, if you define <code class="calibre8">&lt;</code>, also
define <code class="calibre8">&lt;=</code>, <code
class="calibre8">&gt;</code>, <code class="calibre8">&gt;=</code>, and
make sure that the usual equivalences hold:</p>
<ul>
<li><p><code class="calibre8">a&lt;=b</code> means <code
class="calibre8">(a&lt;b)||(a==b)</code> and <code
class="calibre8">!(b&lt;a)</code>.</p></li>
<li><p><code class="calibre8">a&gt;b</code> means <code
class="calibre8">b&lt;a</code>.</p></li>
<li><p><code class="calibre8">a&gt;=b</code> means <code
class="calibre8">(a&gt;b)||(a==b)</code> and <code
class="calibre8">!(b&lt;a)</code>.</p></li>
</ul>
<p>To give identical treatment to both operands of a binary operator,
such as <code class="calibre8">==</code>, it is best defined as a
free-standing function in the namespace of its class. For example:</p>
<p><a href="#part0029_split_021.html#p0074_02a"
id="part0010.html#p0074_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb158"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>namespace <span class="dt">NX</span> <span class="kw">{</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>    class <span class="dt">X</span> <span class="kw">{</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">//</span> ...</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">};</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>    bool operator<span class="fu">==</span>(const <span class="dt">X</span>&amp;<span class="kw">,</span> const <span class="dt">X</span>&amp;)<span class="kw">;</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">//</span> ...</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<h4 class="h3" id="part0010.html#ch05lev2sec7"><span
id="part0010.html#page_75" class="calibre2 pagebreak"></span>5.4.2
Container Operations</h4>
<p>Unless there is a really good reason not to, design containers in the
style of the standard-library containers (<a href="#part0016.html#ch11"
class="calibre6">Chapter 11</a>). In particular, make the container
resource safe by implementing it as a handle with appropriate essential
operations (§<a href="#part0010.html#ch05lev2sec1"
class="calibre6">5.1.1</a>, §<a href="#part0010.html#ch05lev1sec2"
class="calibre6">5.2</a>).</p>
<p>The standard-library containers all know their number of elements and
we can obtain it by calling <code class="calibre8">size()</code>. For
example:</p>
<p><a href="#part0029_split_022.html#p0075_01a"
id="part0010.html#p0075_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb159"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>for (size_t i <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span> i<span class="dt">&lt;</span>c<span class="al">.</span>size()<span class="kw">;</span> ++i)    <span class="fu">//</span> size_t <span class="dt">is</span> the name of the type returned by a standard<span class="dt">-</span>library size()</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>      c<span class="er">[</span>i<span class="er">]</span> <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span></code></pre></div>
<p>However, rather than traversing containers using indices from <code
class="calibre8">0</code> to <code class="calibre8">size()</code>, the
standard algorithms (<a href="#part0017.html#ch12"
class="calibre6">Chapter 12</a>) rely on the notion of
<em>sequence</em>s delimited by pairs of <em>iterator</em>s:</p>
<p><a href="#part0029_split_023.html#p0075_02a"
id="part0010.html#p0075_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb160"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>for (auto p <span class="kw">=</span> c<span class="al">.</span>begin()<span class="kw">;</span> p<span class="kw">!=</span>c<span class="al">.</span>end()<span class="kw">;</span> ++p)</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">*</span>p <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span></code></pre></div>
<p>Here, <code class="calibre8">c.begin()</code> is an iterator pointing
to the first element of <code class="calibre8">c</code> and <code
class="calibre8">c.end()</code> points one-beyond-the-last element of
<code class="calibre8">c</code>. Like pointers, iterators support <code
class="calibre8">++</code> to move to the next element and <code
class="calibre8">*</code> to access the value of the element pointed to.
This <em>iterator model</em> (§<a href="#part0017.html#ch12lev1sec3"
class="calibre6">12.3</a>) allows for great generality and efficiency.
Iterators are used to pass sequences to standard-library algorithms. For
example:</p>
<div class="sourceCode" id="cb161"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>sort(v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end())<span class="kw">;</span></span></code></pre></div>
<p>For details and more container operations, see <a
href="#part0016.html#ch11" class="calibre6">Chapter 11</a> and <a
href="#part0017.html#ch12" class="calibre6">Chapter 12</a>.</p>
<p>Another way of using the number of elements implicitly is a
range-<code class="calibre8">for</code> loop:</p>
<div class="sourceCode" id="cb162"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>for (auto&amp; x <span class="fu">:</span> c)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>      x <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span></code></pre></div>
<p>This uses <code class="calibre8">c.begin()</code> and <code
class="calibre8">c.end()</code> implicitly and is roughly equivalent to
the more explicit loop.</p>
<h4 class="h3" id="part0010.html#ch05lev2sec8">5.4.3 Input and Output
Operations</h4>
<p>For pairs of integers, <code class="calibre8">&lt;&lt;</code> means
left-shift and <code class="calibre8">&gt;&gt;</code> means right-shift.
However, for <code class="calibre8">iostreams</code>, they are the
output and input operator, respectively (§<a
href="#part0006.html#ch01lev1sec8" class="calibre6">1.8</a>, <a
href="#part0015.html#ch10" class="calibre6">Chapter 10</a>). For details
and more I/O operations, see <a href="#part0015.html#ch10"
class="calibre6">Chapter 10</a>.</p>
<h4 class="h3" id="part0010.html#ch05lev2sec9">5.4.4 User-Defined
Literals</h4>
<p>One purpose of classes was to enable the programmer to design and
implement types to closely mimic built-in types. Constructors provide
initialization that equals or exceeds the flexibility and efficiency of
built-in type initialization, but for built-in types, we have
literals:</p>
<ul>
<li><p><code class="calibre8">123</code> is an <code
class="calibre8">int</code>.</p></li>
<li><p><code class="calibre8">0xFF00u</code> is an <code
class="calibre8">unsigned int</code>.</p></li>
<li><p><code class="calibre8">123.456</code> is a <code
class="calibre8">double</code>.</p></li>
<li><p><code class="calibre8">"Surprise!"</code> is a <code
class="calibre8">const char[10]</code>.</p></li>
</ul>
<p>It can be useful to provide such literals for a user-defined type
also. This is done by defining the meaning of a suitable suffix to a
literal, so we can get</p>
<ul>
<li><p><span id="part0010.html#page_76" class="pagebreak"></span><code
class="calibre8">"Surprise!"s</code> is a <code
class="calibre8">std::string</code>.</p></li>
<li><p><code class="calibre8">123s</code> is <code
class="calibre8">second</code>s.</p></li>
<li><p><code class="calibre8">12.7i</code> is <code
class="calibre8">imaginary</code> so that <code
class="calibre8">12.7i+47</code> is a <code
class="calibre8">complex number</code> (i.e., <code
class="calibre8">{47,12.7}</code>).</p></li>
</ul>
<p>In particular, we can get these examples from the standard library by
using suitable headers and namespaces:</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="3" class="calibre14"><p><strong>Standard-Library Suffixes
for Literals</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;chrono&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">std::literals::chrono_literals</code></p></td>
<td class="calibre14"><p><code class="calibre8">h</code>, <code
class="calibre8">min</code>, <code class="calibre8">s</code>, <code
class="calibre8">ms</code>, <code class="calibre8">us</code>, <code
class="calibre8">ns</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;string&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">std::literals::string_literals</code></p></td>
<td class="calibre14"><p><code class="calibre8">s</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;string_view&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">std::literals::string_literals</code></p></td>
<td class="calibre14"><p><code class="calibre8">sv</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;complex&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">std::literals::complex_literals</code></p></td>
<td class="calibre14"><p><code class="calibre8">i</code>, <code
class="calibre8">il</code>, <code class="calibre8">if</code></p></td>
</tr>
</tbody>
</table>
<p>Unsurprisingly, literals with user-defined suffixes are called
<em>user-defined literals</em> or <em>UDL</em>s. Such literals are
defined using <em>literal operators</em>. A literal operator converts a
literal of its argument type, followed by a subscript, into its return
type. For example, the <code class="calibre8">i</code> for <code
class="calibre8">imaginary</code> suffix might be implemented like
this:</p>
<p><a href="#part0029_split_024.html#p0076_01a"
id="part0010.html#p0076_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb163"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>constexpr complex<span class="dt">&lt;</span>double<span class="er">&gt;</span> operator<span class="ot">&quot;&quot;</span>i(long double <span class="fu">arg</span>)     <span class="fu">//</span> imaginary literal</span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>    return <span class="kw">{</span><span class="dv">0</span><span class="kw">,</span><span class="fu">arg</span><span class="kw">};</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Here</p>
<ul>
<li><p>The <code class="calibre8">operator""</code> indicates that we
are defining a literal operator.</p></li>
<li><p>The <code class="calibre8">i</code> after the “literal indicator”
<code class="calibre8">""</code> is the suffix to which the operator
gives a meaning.</p></li>
<li><p>The argument type, <code class="calibre8">long double</code>,
indicates that the suffix (<code class="calibre8">i</code>) is being
defined for a floating-point literal.</p></li>
<li><p>The return type, <code
class="calibre8">complex&lt;double&gt;</code>, specifies the type of the
resulting literal.</p></li>
</ul>
<p>Given that, we can write</p>
<p><a href="#part0029_split_025.html#p0076_02a"
id="part0010.html#p0076_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb164"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>complex<span class="dt">&lt;</span>double<span class="er">&gt;</span> z <span class="kw">=</span> <span class="fl">2.7182818</span><span class="fu">+</span><span class="fl">6.283185</span>i<span class="kw">;</span></span></code></pre></div>
<h4 class="h3" id="part0010.html#ch05lev2sec10">5.4.5 <code
class="calibre16">swap()</code></h4>
<p>Many algorithms, most notably <code class="calibre8">sort()</code>,
use a <code class="calibre8">swap()</code> function that exchanges the
values of two objects. Such algorithms generally assume that <code
class="calibre8">swap()</code> is very fast and doesn’t throw an
exception. The standard-library provides a <code
class="calibre8">std::swap(a,b)</code> implemented as three move
operations: <code class="calibre8">(tmp=a, a=b, b=tmp)</code>. If you
design a type that is expensive to copy and could plausibly be swapped
(e.g., by a sort function), then give it move operations or a <code
class="calibre8">swap()</code> or both. Note that the standard-library
containers (<a href="#part0016.html#ch11" class="calibre6">Chapter
11</a>) and <code class="calibre8">string</code> (§<a
href="#part0014.html#ch09lev2sec1" class="calibre6">9.2.1</a>) have fast
move operations.</p>
<h4 class="h3" id="part0010.html#ch05lev2sec11">5.4.6 <code
class="calibre16">hash&lt;&gt;</code></h4>
<p>The standard-library <code
class="calibre8">unordered_map&lt;K,V&gt;</code> is a hash table with
<code class="calibre8">K</code> as the key type and <code
class="calibre8">V</code> as the value type (§<a
href="#part0016.html#ch11lev1sec5" class="calibre6">11.5</a>). To use a
type <code class="calibre8">X</code> as a key, we must define <code
class="calibre8">hash&lt;X&gt;</code>. The standard library does that
for us for common types, such as <code
class="calibre8">std::string</code>.</p>
<h3 class="h2" id="part0010.html#ch05lev1sec5"><span
id="part0010.html#page_77" class="calibre2 pagebreak"></span>5.5
Advice</h3>
<p>[1] Control construction, copy, move, and destruction of objects; §<a
href="#part0010.html#ch05lev2sec1" class="calibre6">5.1.1</a>; [CG:
R.1].</p>
<p>[2] Design constructors, assignments, and the destructor as a matched
set of operations; §<a href="#part0010.html#ch05lev2sec1"
class="calibre6">5.1.1</a>; [CG: C.22].</p>
<p>[3] Define all essential operations or none; §<a
href="#part0010.html#ch05lev2sec1" class="calibre6">5.1.1</a>; [CG:
C.21].</p>
<p>[4] If a default constructor, assignment, or destructor is
appropriate, let the compiler generate it (don’t rewrite it yourself);
§<a href="#part0010.html#ch05lev2sec1" class="calibre6">5.1.1</a>; [CG:
C.20].</p>
<p>[5] If a class has a pointer member, it probably needs a user-defined
or deleted destructor, copy and move; §<a
href="#part0010.html#ch05lev2sec1" class="calibre6">5.1.1</a>; [CG:
C.32] [CG: C.33].</p>
<p>[6] If a class has a destructor, it probably needs user-defined or
deleted copy and move; §<a href="#part0010.html#ch05lev2sec4"
class="calibre6">5.2.1</a>.</p>
<p>[7] By default, declare single-argument constructors <code
class="calibre8">explicit</code>; §<a href="#part0010.html#ch05lev2sec1"
class="calibre6">5.1.1</a>; [CG: C.46].</p>
<p>[8] If a class member has a reasonable default value, provide it as a
data member initializer; §<a href="#part0010.html#ch05lev2sec3"
class="calibre6">5.1.3</a>; [CG: C.48].</p>
<p>[9] Redefine or prohibit copying if the default is not appropriate
for a type; §<a href="#part0010.html#ch05lev2sec4"
class="calibre6">5.2.1</a>, §4.6.5; [CG: C.61].</p>
<p>[10] Return containers by value (relying on move for efficiency); §<a
href="#part0010.html#ch05lev2sec5" class="calibre6">5.2.2</a>; [CG:
F.20].</p>
<p>[11] For large operands, use <code class="calibre8">const</code>
reference argument types; §<a href="#part0010.html#ch05lev2sec5"
class="calibre6">5.2.2</a>; [CG: F.16].</p>
<p>[12] Provide strong resource safety; that is, never leak anything
that you think of as a resource; §<a href="#part0010.html#ch05lev1sec3"
class="calibre6">5.3</a>; [CG: R.1].</p>
<p>[13] If a class is a resource handle, it needs a user-defined
constructor, a destructor, and non-default copy operations; §<a
href="#part0010.html#ch05lev1sec3" class="calibre6">5.3</a>; [CG:
R.1].</p>
<p>[14] Overload operations to mimic conventional usage; §<a
href="#part0010.html#ch05lev1sec4" class="calibre6">5.4</a>; [CG:
C.160].</p>
<p>[15] Follow the standard-library container design; §<a
href="#part0010.html#ch05lev2sec7" class="calibre6">5.4.2</a>; [CG:
C.100].</p>
</section>
<p><span id="part0011.html"></span></p>
<section id="part0011.html#ch06" class="h1 bodymatter">
<h2 class="h1"><span id="part0011.html#page_79"
class="calibre2 pagebreak"></span><span class="big">6</span></h2>
<p>Templates</p>
<p><em>Your quote here.</em></p>
<p><em>– B. Stroustrup</em></p>
<ul>
<li><p><a href="#part0011.html#ch06lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0011.html#ch06lev1sec2"
class="calibre6">Parameterized Types</a></p>
<p><a href="#part0011.html#ch06lev2sec1" class="calibre6">Constrained
Template Arguments</a>; <a href="#part0011.html#ch06lev2sec2"
class="calibre6">Value Template Arguments</a>; <a
href="#part0011.html#ch06lev2sec3" class="calibre6">Template Argument
Deduction</a></p></li>
<li><p><a href="#part0011.html#ch06lev1sec3"
class="calibre6">Parameterized Operations</a></p>
<p><a href="#part0011.html#ch06lev2sec4" class="calibre6">Function
Templates</a>; <a href="#part0011.html#ch06lev2sec5"
class="calibre6">Function Objects</a>; <a
href="#part0011.html#ch06lev2sec6" class="calibre6">Lambda
Expressions</a></p></li>
<li><p><a href="#part0011.html#ch06lev1sec4" class="calibre6">Template
Mechanisms</a></p>
<p><a href="#part0011.html#ch06lev2sec7" class="calibre6">Variable
Templates</a>; <a href="#part0011.html#ch06lev2sec8"
class="calibre6">Aliases</a>; <a href="#part0011.html#ch06lev2sec9"
class="calibre6">Compile-Time <code
class="calibre8">if</code></a></p></li>
<li><p><a href="#part0011.html#ch06lev1sec5"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0011.html#ch06lev1sec1">6.1 Introduction</h3>
<p>Someone who wants a vector is unlikely always to want a vector of
<code class="calibre8">double</code>s. A vector is a general concept,
independent of the notion of a floating-point number. Consequently, the
element type of a vector ought to be represented independently. A
<em>template</em> is a class or a function that we parameterize with a
set of types or values. We use templates to represent ideas that are
best understood as something general from which we can generate specific
types and functions by specifying arguments, such as the <code
class="calibre8">vector</code>’s element type <code
class="calibre8">double</code>.</p>
<h3 class="h2" id="part0011.html#ch06lev1sec2">6.2 Parameterized
Types</h3>
<p>We can generalize our vector-of-doubles type to a vector-of-anything
type by making it a <code class="calibre8">template</code> and replacing
the specific type <code class="calibre8">double</code> with a type
parameter. For example:</p>
<p><a href="#part0030_split_000.html#p0080_01a"
id="part0011.html#p0080_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb165"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">T</span><span class="fu">*</span> elem<span class="kw">;</span>  <span class="fu">//</span> elem points to an array of sz elements of type <span class="dt">T</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>     int sz<span class="kw">;</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>     explicit <span class="dt">Vector</span>(int s)<span class="kw">;</span>          <span class="fu">//</span> constructor<span class="fu">:</span> establish invariant<span class="kw">,</span> acquire resources</span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>     ~<span class="dt">Vector</span>() <span class="kw">{</span> delete[] elem<span class="kw">;</span> <span class="kw">}</span>     <span class="fu">//</span> destructor<span class="fu">:</span> release resources</span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... copy and move operations ...</span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a>     <span class="dt">T</span>&amp; operator[](int i)<span class="kw">;</span>                     <span class="fu">//</span> for non<span class="fu">-</span>cost <span class="dt">Vectors</span></span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a>     const <span class="dt">T</span>&amp; operator[](int i) const<span class="kw">;</span>         <span class="fu">//</span> for const <span class="dt">Vectors</span> (<span class="er">§</span><span class="fl">4.2</span><span class="al">.</span><span class="dv">1</span>)</span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a>     int size() const <span class="kw">{</span> return sz<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>The <code class="calibre8">template&lt;typename T&gt;</code> prefix
makes <code class="calibre8">T</code> a parameter of the declaration it
prefixes. It is C++’s version of the mathematical “for all T” or more
precisely “for all types T.” If you want the mathematical “for all T,
such that P(T),” you need concepts (§<a
href="#part0011.html#ch06lev2sec1" class="calibre6">6.2.1</a>, §<a
href="#part0012.html#ch07lev1sec2" class="calibre6">7.2</a>). Using
<code class="calibre8">class</code> to introduce a type parameter is
equivalent to using <code class="calibre8">typename</code>, and in older
code we often see <code class="calibre8">template&lt;class T&gt;</code>
as the prefix.</p>
<p>The member functions might be defined similarly:</p>
<p><a href="#part0030_split_001.html#p0080_02a"
id="part0011.html#p0080_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb166"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector&lt;T</span>&gt;::<span class="dt">Vector</span>(int s)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>     if (s<span class="er">&lt;</span><span class="dv">0</span><span class="er">)</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>           <span class="kw">throw</span> <span class="dt">Negative_size</span><span class="kw">{};</span></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>     elem <span class="kw">=</span> new <span class="dt">T</span>[s]<span class="kw">;</span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>     sz <span class="kw">=</span> s<span class="kw">;</span></span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>const <span class="dt">T</span>&amp; <span class="dt">Vector&lt;T</span>&gt;::operator<span class="er">[]</span>(int i) const</span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>     if (i<span class="dt">&lt;</span><span class="dv">0</span> || size()&lt;=i)</span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a>           <span class="kw">throw</span> out_of_range<span class="kw">{</span><span class="ot">&quot;</span><span class="er">Vector</span><span class="ot">::</span><span class="er">operator</span><span class="ot">[]&quot;</span><span class="kw">};</span></span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>     return elem[i]<span class="kw">;</span></span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Given these definitions, we can define <code
class="calibre8">Vector</code>s like this:</p>
<p><a href="#part0030_split_002.html#p0080_03a"
id="part0011.html#p0080_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb167"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector&lt;</span>char<span class="er">&gt;</span> vc(<span class="dv">200</span>)<span class="kw">;</span>          <span class="fu">//</span> vector of <span class="dv">200</span> characters</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector&lt;</span>string<span class="er">&gt;</span> vs(<span class="dv">17</span>)<span class="kw">;</span>         <span class="fu">//</span> vector of <span class="dv">17</span> strings</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector&lt;</span>list<span class="er">&lt;</span>int<span class="al">&gt;&gt;</span> vli(<span class="dv">45</span>)<span class="kw">;</span>     <span class="fu">//</span> vector of <span class="dv">45</span> lists of integers</span></code></pre></div>
<p>The <code class="calibre8">&gt;&gt;</code> in <code
class="calibre8">Vector&lt;list&lt;int&gt;&gt;</code> terminates the
nested template arguments; it is not a misplaced input operator.</p>
<p>We can use <code class="calibre8">Vector</code>s like this:</p>
<p><a href="#part0030_split_003.html#p0081_01a"
id="part0011.html#p0081_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb168"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>void <span class="fu">write</span>(const <span class="dt">Vector&lt;</span>string&gt;&amp; vs)        <span class="fu">//</span> <span class="dt">Vector</span> of some strings</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>     for (int i <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>vs<span class="al">.</span>size()<span class="kw">;</span> ++i)</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> vs[i] <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>To support the range-<code class="calibre8">for</code> loop for our
<code class="calibre8">Vector</code>, we must define suitable <code
class="calibre8">begin()</code> and <code class="calibre8">end()</code>
functions:</p>
<p><a href="#part0030_split_004.html#p0081_02a"
id="part0011.html#p0081_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb169"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="dt">T</span><span class="fu">*</span> begin(<span class="dt">Vector&lt;T</span>&gt;&amp; x)</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>    return x.size() ? &amp;x[<span class="dv">0</span>] <span class="fu">:</span> nullptr<span class="kw">;</span>     <span class="fu">//</span> pointer to first element or nullptr</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a><span class="dt">T</span><span class="fu">*</span> end(<span class="dt">Vector&lt;T</span>&gt;&amp; x)</span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>    return x.size() ? &amp;x[<span class="dv">0</span>]<span class="fu">+</span>x.size() <span class="fu">:</span> nullptr<span class="kw">;</span>     <span class="fu">//</span> pointer to one<span class="fu">-</span>past<span class="fu">-</span>last element</span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Given those, we can write:</p>
<p><a href="#part0030_split_005.html#p0081_03a"
id="part0011.html#p0081_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb170"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>void f2(<span class="dt">Vector&lt;</span>string&gt;&amp; vs)   <span class="fu">//</span> <span class="dt">Vector</span> of some strings</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>     for (auto&amp; s <span class="fu">:</span> vs)</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> s <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Similarly, we can define lists, vectors, maps (that is, associative
arrays), unordered maps (that is, hash tables), etc., as templates (<a
href="#part0016.html#ch11" class="calibre6">Chapter 11</a>).</p>
<p>Templates are a compile-time mechanism, so their use incurs no
run-time overhead compared to hand-crafted code. In fact, the code
generated for <code class="calibre8">Vector&lt;double&gt;</code> is
identical to the code generated for the version of <code
class="calibre8">Vector</code> from <a href="#part0009.html#ch04"
class="calibre6">Chapter 4</a>. Furthermore, the code generated for the
standard-library <code class="calibre8">vector&lt;double&gt;</code> is
likely to be better (because more effort has gone into its
implementation).</p>
<p>A template plus a set of template arguments is called an
<em>instantiation</em> or a <em>specialization</em>. Late in the
compilation process, at <em>instantiation time</em>, code is generated
for each instantiation used in a program (§<a
href="#part0012.html#ch07lev1sec5" class="calibre6">7.5</a>). The code
generated is type checked so that the generated code is as type safe as
handwritten code. Unfortunately, that type check often occurs late in
the compilation process, at instantiation time.</p>
<h4 class="h3" id="part0011.html#ch06lev2sec1">6.2.1 Constrained
Template Arguments (C++20)</h4>
<p>Most often, a template will make sense only for template arguments
that meet certain criteria. For example, a <code
class="calibre8">Vector</code> typically offers a copy operation, and if
it does, it must require that its elements must be copyable. That is, we
must require that <code class="calibre8">Vector</code>’s template
argument is not just a <code class="calibre8">typename</code> but an
<code class="calibre8">Element</code> where “<code
class="calibre8">Element</code>” specifies the requirements of a type
that can be an element:</p>
<p><a href="#part0030_split_006.html#p0082_01a"
id="part0011.html#p0082_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb171"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;Element</span> <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">T</span><span class="fu">*</span> elem<span class="kw">;</span>  <span class="fu">//</span> elem points to an array of sz elements of type <span class="dt">T</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>     int sz<span class="kw">;</span></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>This <code class="calibre8">template&lt;Element T&gt;</code> prefix
is C++’s version of mathematic’s “for all T such that <code
class="calibre8">Element(T)</code>”; that is, <code
class="calibre8">Element</code> is a predicate that checks whether <code
class="calibre8">T</code> has all the properties that a <code
class="calibre8">Vector</code> requires. Such a predicate is called a
<em>concept</em> (§<a href="#part0012.html#ch07lev1sec2"
class="calibre6">7.2</a>). A template argument for which a concept is
specified is called a <em>constrained argument</em> and a template for
which an argument is constrained is called a <em>constrained
template</em>.</p>
<p>It is a compile-time error to try to instantiate a template with a
type that does not meet its requirements. For example:</p>
<p><a href="#part0030_split_007.html#p0082_02a"
id="part0011.html#p0082_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb172"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector&lt;</span>int<span class="er">&gt;</span> v1<span class="kw">;</span>     <span class="fu">//</span> <span class="dt">OK</span><span class="fu">:</span> we can copy an int</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector&lt;</span>thread<span class="er">&gt;</span> v2<span class="kw">;</span>  <span class="fu">//</span> error<span class="fu">:</span> we can<span class="st">&#39;</span><span class="er">t copy a standard thread (§15.2)</span></span></code></pre></div>
<p>Since C++ does not officially support concepts before C++20, older
code uses unconstrained template arguments and leaves requirements to
documentation.</p>
<h4 class="h3" id="part0011.html#ch06lev2sec2">6.2.2 Value Template
Arguments</h4>
<p>In addition to type arguments, a template can take value arguments.
For example:</p>
<p><a href="#part0030_split_008.html#p0082_03a"
id="part0011.html#p0082_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb173"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="kw">,</span> int <span class="dt">N&gt;</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Buffer</span> <span class="er">{</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>     using value_type <span class="kw">=</span> <span class="dt">T</span><span class="kw">;</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>     constexprint size() <span class="kw">{</span> return <span class="dt">N</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">T</span>[<span class="dt">N</span>]<span class="kw">;</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a><span class="er">}</span><span class="kw">;</span></span></code></pre></div>
<p>The alias (<code class="calibre8">value_type</code>) and the <code
class="calibre8">constexpr</code> function are provided to allow users
(read-only) access to the template arguments.</p>
<p>Value arguments are useful in many contexts. For example, <code
class="calibre8">Buffer</code> allows us to create arbitrarily sized
buffers with no use of the free store (dynamic memory):</p>
<p><a href="#part0030_split_009.html#p0082_04a"
id="part0011.html#p0082_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb174"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Buffer&lt;</span>char<span class="kw">,</span><span class="dv">1024</span><span class="dt">&gt;</span> glob<span class="kw">;</span>  <span class="fu">//</span> global buffer of characters (statically allocated)</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>void fct()</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Buffer&lt;</span>int<span class="kw">,</span><span class="dv">10</span><span class="dt">&gt;</span> buf<span class="kw">;</span> <span class="fu">//</span> local buffer of integers (on the stack)</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>A template value argument must be a constant expression.</p>
<h4 class="h3" id="part0011.html#ch06lev2sec3"><span
id="part0011.html#page_83" class="calibre2 pagebreak"></span>6.2.3
Template Argument Deduction</h4>
<p>Consider using the standard-library template <code
class="calibre8">pair</code>:</p>
<div class="sourceCode" id="cb175"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>pair<span class="dt">&lt;</span>int<span class="kw">,</span>double<span class="dt">&gt;</span> p <span class="kw">=</span> <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="fl">5.2</span><span class="kw">};</span></span></code></pre></div>
<p>Many have found the need to specify the template argument types
tedious, so the standard library offers a function, <code
class="calibre8">make_pair()</code>, that deduces the template arguments
of the <code class="calibre8">pair</code> it returns from its function
arguments:</p>
<p><a href="#part0030_split_010.html#p0083_01a"
id="part0011.html#p0083_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb176"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>auto p <span class="kw">=</span> make_pair(<span class="dv">1</span><span class="kw">,</span><span class="fl">5.2</span>)<span class="kw">;</span>    <span class="fu">//</span> p <span class="dt">is</span> a pair<span class="er">&lt;</span>int<span class="kw">,</span>double<span class="dt">&gt;</span></span></code></pre></div>
<p>This leads to the obvious question “Why can’t we just deduce template
parameters from constructor arguments?” So, in C++17, we can. That
is:</p>
<p><a href="#part0030_split_011.html#p0083_02a"
id="part0011.html#p0083_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb177"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>pair p <span class="kw">=</span> <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="fl">5.2</span><span class="kw">};</span>    <span class="fu">//</span> p <span class="dt">is</span> a pair<span class="er">&lt;</span>int<span class="kw">,</span>double<span class="dt">&gt;</span></span></code></pre></div>
<p>This is not just a problem with <code class="calibre8">pair</code>;
<code class="calibre8">make_</code> functions are very common. Consider
a simple example:</p>
<p><a href="#part0030_split_012.html#p0083_03a"
id="part0011.html#p0083_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb178"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>(int)<span class="kw">;</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector</span>(initializer_list<span class="dt">&lt;T</span><span class="er">&gt;</span>)<span class="kw">;</span>     <span class="fu">//</span> initializer<span class="fu">-</span>list constructor</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> v1 <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">};</span>   <span class="fu">//</span> deduce v1<span class="st">&#39;</span><span class="er">s element type from the initializer element type</span></span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a><span class="er">Vector v2 </span><span class="st">=</span><span class="er"> v1</span><span class="st">;</span><span class="er">      </span><span class="st">//</span><span class="er"> deduce v2</span><span class="st">&#39;</span>s element type from v1<span class="st">&#39;</span><span class="er">s element type</span></span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a><span class="er">auto p = new Vector{1,2,3};   // p points to a Vector&lt;int&gt;</span></span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a><span class="er">Vector&lt;int&gt; v3(1);  // here we need to be explicit about the element type (no element type is mentioned)</span></span></code></pre></div>
<p>Clearly, this simplifies notation and can eliminate annoyances caused
by mistyping redundant template argument types. However, it is not a
panacea. Deduction can cause surprises (both for <code
class="calibre8">make_</code> functions and constructors). Consider:</p>
<p><a href="#part0030_split_013.html#p0083_04a"
id="part0011.html#p0083_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb179"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector&lt;</span>string<span class="er">&gt;</span> vs1 <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Hello</span><span class="ot">&quot;</span><span class="kw">,</span> <span class="ot">&quot;</span><span class="er">World</span><span class="ot">&quot;</span><span class="kw">};</span>  <span class="fu">//</span> <span class="dt">Vector&lt;</span>string<span class="er">&gt;</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> vs <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Hello</span><span class="ot">&quot;</span><span class="kw">,</span> <span class="ot">&quot;</span><span class="er">World</span><span class="ot">&quot;</span><span class="kw">};</span>           <span class="fu">//</span> deduces to <span class="dt">Vector&lt;</span>const char*&gt; (<span class="dt">Surprise</span>?)</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> vs2 <span class="er">{&quot;</span><span class="dt">Hello</span><span class="er">&quot;</span>s<span class="kw">,</span> <span class="ot">&quot;</span><span class="er">World</span><span class="ot">&quot;</span>s<span class="er">}</span><span class="kw">;</span>        <span class="fu">//</span> deduces to <span class="dt">Vector&lt;</span>string<span class="er">&gt;</span></span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector</span> vs3 <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Hello</span><span class="ot">&quot;</span>s<span class="kw">,</span> <span class="ot">&quot;</span><span class="er">World</span><span class="ot">&quot;</span><span class="kw">};</span>         <span class="fu">//</span> error<span class="fu">:</span> the initializer list <span class="dt">is</span> not homogenous</span></code></pre></div>
<p>The type of a C-style string literal is <code
class="calibre8">const char*</code> (§<a
href="#part0006.html#ch01lev2sec4" class="calibre6">1.7.1</a>). If that
was not what was intended, use the <code class="calibre8">s</code>
suffix to make it a proper <code class="calibre8">string</code> (§<a
href="#part0014.html#ch09lev1sec2" class="calibre6">9.2</a>). If
elements of an initializer list have differing types, we cannot deduce a
unique element type, so we get an error.</p>
<p>When a template argument cannot be deduced from the constructor
arguments, we can help by providing a <em>deduction guide</em>.
Consider:</p>
<p><a href="#part0030_split_014.html#p0084_01a"
id="part0011.html#p0084_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb180"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector2</span> <span class="kw">{</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>     using value_type <span class="kw">=</span> <span class="dt">T</span><span class="kw">;</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector2</span>(initializer_list<span class="dt">&lt;T</span><span class="er">&gt;</span>)<span class="kw">;</span>   <span class="fu">//</span> initializer<span class="fu">-</span>list constructor</span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a>     template<span class="dt">&lt;</span>typename <span class="dt">Iter</span><span class="er">&gt;</span></span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a>          <span class="dt">Vector2</span>(<span class="dt">Iter</span> b<span class="kw">,</span> <span class="dt">Iter</span> e)<span class="kw">;</span>   <span class="fu">//</span> [b<span class="fu">:</span>e<span class="er">)</span> range constructor</span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a><span class="er">}</span><span class="kw">;</span></span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector2</span> v1 {<span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">,</span><span class="dv">4</span><span class="kw">,</span><span class="dv">5</span><span class="kw">};</span>              <span class="fu">//</span> element type <span class="dt">is</span> int</span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a><span class="dt">Vector2</span> v2(v1.begin()<span class="er">,</span>v1.begin()<span class="dt">+</span><span class="dv">2</span>)<span class="kw">;</span></span></code></pre></div>
<p>Obviously, <code class="calibre8">v2</code> should be a <code
class="calibre8">Vector2&lt;int&gt;</code>, but without help, the
compiler cannot deduce that. The code only states that there is a
constructor from a pair of values of the same type. Without language
support for concepts (§<a href="#part0012.html#ch07lev1sec2"
class="calibre6">7.2</a>), the compiler cannot assume anything about
that type. To allow deduction, we can add a “deduction guide” after the
declaration of <code class="calibre8">Vector</code>:</p>
<p><a href="#part0030_split_015.html#p0084_02a"
id="part0011.html#p0084_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb181"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Iter</span><span class="er">&gt;</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Vector2</span>(<span class="dt">Iter</span><span class="kw">,</span><span class="dt">Iter</span>) <span class="er">−</span><span class="dt">&gt;</span> <span class="dt">Vector2</span><span class="er">&lt;</span>typename <span class="dt">Iter</span>::value_type<span class="dt">&gt;</span><span class="kw">;</span></span></code></pre></div>
<p>That is, if we see a <code class="calibre8">Vector2</code>
initialized by a pair of iterators, we should deduce <code
class="calibre8">Vector2::value_type</code> to be the iterator’s value
type.</p>
<p>The effects of deduction guides are often subtle, so it is best to
design class templates so that deduction guides are not needed. However,
the standard library is full of classes that don’t (yet) use <code
class="calibre8">concept</code>s (§<a href="#part0012.html#ch07lev1sec2"
class="calibre6">7.2</a>) and have such ambiguities, so it uses quite a
few deduction guides.</p>
<h3 class="h2" id="part0011.html#ch06lev1sec3">6.3 Parameterized
Operations</h3>
<p>Templates have many more uses than simply parameterizing a container
with an element type. In particular, they are extensively used for
parameterization of both types and algorithms in the standard library
(§<a href="#part0016.html#ch11lev1sec6" class="calibre6">11.6</a>, §<a
href="#part0017.html#ch12lev1sec6" class="calibre6">12.6</a>).</p>
<p>There are three ways of expressing an operation parameterized by
types or values:</p>
<ul>
<li><p>A function template</p></li>
<li><p>A function object: an object that can carry data and be called
like a function</p></li>
<li><p>A lambda expression: a shorthand notation for a function
object</p></li>
</ul>
<h4 class="h3" id="part0011.html#ch06lev2sec4">6.3.1 Function
Templates</h4>
<p>We can write a function that calculates the sum of the element values
of any sequence that a range-<code class="calibre8">for</code> can
traverse (e.g., a container) like this:</p>
<p><a href="#part0030_split_016.html#p0085_01a"
id="part0011.html#p0085_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb182"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Sequence</span><span class="kw">,</span> typename <span class="dt">Value&gt;</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Value</span> sum(const <span class="dt">Sequence</span>&amp; s<span class="er">,</span> <span class="dt">Value</span> v)</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>     for (auto x <span class="fu">:</span> s)</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>           v+=x<span class="kw">;</span></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>     return v<span class="kw">;</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>The <code class="calibre8">Value</code> template argument and the
function argument <code class="calibre8">v</code> are there to allow the
caller to specify the type and initial value of the accumulator (the
variable in which to accumulate the sum):</p>
<p><a href="#part0030_split_017.html#p0085_02a"
id="part0011.html#p0085_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb183"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>void user(<span class="dt">Vector&lt;</span>int&gt;&amp; vi<span class="kw">,</span> list<span class="dt">&lt;</span>double&gt;&amp; ld<span class="kw">,</span> vector<span class="dt">&lt;</span>complex<span class="er">&lt;</span>double&gt;&gt;&amp; vc)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>     int x <span class="kw">=</span> sum(vi<span class="kw">,</span><span class="dv">0</span>)<span class="kw">;</span>                     <span class="fu">//</span> the sum of a vector of ints (add ints)</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>     double d <span class="kw">=</span> sum(vi<span class="kw">,</span><span class="fl">0.0</span>)<span class="kw">;</span>                <span class="fu">//</span> the sum of a vector of ints (add doubles)</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>     double dd <span class="kw">=</span> sum(ld<span class="kw">,</span><span class="fl">0.0</span>)<span class="kw">;</span>               <span class="fu">//</span> the sum of a list of doubles</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>     auto z <span class="kw">=</span> sum(vc<span class="kw">,</span>complex<span class="kw">{</span><span class="fl">0.0</span><span class="kw">,</span><span class="fl">0.0</span><span class="kw">}</span>)<span class="kw">;</span>     <span class="fu">//</span> the sum of a vector of complex<span class="dt">&lt;</span>double<span class="er">&gt;</span>s</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The point of adding <code class="calibre8">int</code>s in a <code
class="calibre8">double</code> would be to gracefully handle a number
larger than the largest <code class="calibre8">int</code>. Note how the
types of the template arguments for <code
class="calibre8">sum&lt;Sequence,Value&gt;</code> are deduced from the
function arguments. Fortunately, we do not need to explicitly specify
those types.</p>
<p>This <code class="calibre8">sum()</code> is a simplified version of
the standard-library <code class="calibre8">accumulate()</code> (§<a
href="#part0019.html#ch14lev1sec3" class="calibre6">14.3</a>).</p>
<p>A function template can be a member function, but not a <code
class="calibre8">virtual</code> member. The compiler would not know all
instantiations of such a template in a program, so it could not generate
a <code class="calibre8">vtbl</code> (§<a
href="#part0009.html#ch04lev1sec4" class="calibre6">4.4</a>).</p>
<h4 class="h3" id="part0011.html#ch06lev2sec5">6.3.2 Function
Objects</h4>
<p>One particularly useful kind of template is the <em>function
object</em> (sometimes called a <em>functor</em>), which is used to
define objects that can be called like functions. For example:</p>
<p><a href="#part0030_split_018.html#p0085_03a"
id="part0011.html#p0085_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb184"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Less_than</span> <span class="kw">{</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>     const <span class="dt">T</span> val<span class="kw">;</span>   <span class="fu">//</span> value to <span class="fu">compare</span> against</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Less_than</span>(const <span class="dt">T</span>&amp; v) <span class="fu">:</span>val<span class="kw">{</span>v<span class="kw">}</span> <span class="kw">{</span> <span class="kw">}</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>     bool operator()(const <span class="dt">T</span>&amp; x) const <span class="kw">{</span> return x<span class="dt">&lt;</span>val<span class="kw">;</span> <span class="kw">}</span> <span class="fu">//</span> <span class="kw">call</span> operator</span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>The function called <code class="calibre8">operator()</code>
implements the “function call,” “call,” or “application” operator <code
class="calibre8">()</code>.</p>
<p>We can define named variables of type <code
class="calibre8">Less_than</code> for some argument type:</p>
<p><a href="#part0030_split_019.html#p0085_04a"
id="part0011.html#p0085_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb185"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Less_than</span> lti <span class="kw">{</span><span class="dv">42</span><span class="kw">};</span>                <span class="fu">//</span> lti(i) will <span class="fu">compare</span> i to <span class="dv">42</span> using <span class="dt">&lt;</span> (i<span class="er">&lt;</span><span class="dv">42</span><span class="er">)</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Less_than</span> lts <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Backus</span><span class="ot">&quot;</span>s<span class="kw">};</span>         <span class="fu">//</span> lts(s) will <span class="fu">compare</span> s to <span class="ot">&quot;</span><span class="er">Backus</span><span class="ot">&quot;</span> using <span class="dt">&lt;</span> (s<span class="er">&lt;&quot;</span><span class="dt">Backus</span><span class="er">&quot;)</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Less_than&lt;</span>string<span class="er">&gt;</span> lts2 <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Naur</span><span class="ot">&quot;</span><span class="kw">};</span>   <span class="fu">//</span> <span class="ot">&quot;</span><span class="er">Naur</span><span class="ot">&quot;</span> <span class="dt">is</span> a <span class="dt">C-</span>style string<span class="kw">,</span> so we need <span class="dt">&lt;</span>string<span class="er">&gt;</span> to get the right <span class="dt">&lt;</span></span></code></pre></div>
<p>We can call such an object, just as we call a function:</p>
<p><a href="#part0030_split_020.html#p0086_01a"
id="part0011.html#p0086_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb186"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>void fct(int n<span class="kw">,</span> const string &amp; s)</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>     bool b1 <span class="kw">=</span> lti(n)<span class="kw">;</span>    <span class="fu">//</span> <span class="kw">true</span> if n<span class="dt">&lt;</span><span class="dv">42</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>     bool b2 <span class="kw">=</span> lts(s)<span class="kw">;</span>    <span class="fu">//</span> <span class="kw">true</span> if s<span class="dt">&lt;</span><span class="er">&quot;</span><span class="dt">Backus</span><span class="er">&quot;</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>     <span class="dv">//</span> ...</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Such function objects are widely used as arguments to algorithms. For
example, we can count the occurrences of values for which a predicate
returns <code class="calibre8">true</code>:</p>
<p><a href="#part0030_split_021.html#p0086_02a"
id="part0011.html#p0086_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb187"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">C</span><span class="kw">,</span> typename <span class="dt">P&gt;</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>     <span class="dv">//</span> requires <span class="dt">Sequence</span><span class="er">&lt;</span><span class="dt">C&gt;</span> &amp;&amp; <span class="dt">Callable</span><span class="er">&lt;</span><span class="dt">P</span><span class="kw">,</span><span class="dt">Value_type&lt;P</span><span class="al">&gt;&gt;</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>int count(const <span class="dt">C</span>&amp; c<span class="er">,</span> <span class="dt">P</span> pred)</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>     int cnt <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>     for (const auto&amp; x <span class="fu">:</span> c)</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>           if (pred(x))</span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>                 ++cnt<span class="kw">;</span></span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>     return cnt<span class="kw">;</span></span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>A <em>predicate</em> is something that we can invoke to return <code
class="calibre8">true</code> or <code class="calibre8">false</code>. For
example:</p>
<p><a href="#part0030_split_022.html#p0086_03a"
id="part0011.html#p0086_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb188"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>void f(const <span class="dt">Vector&lt;</span>int&gt;&amp; vec<span class="kw">,</span> const list<span class="dt">&lt;</span>string&gt;&amp; lst<span class="kw">,</span> int x<span class="kw">,</span> const string&amp; s)</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">number of values less than </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> x <span class="al">&lt;&lt;</span> <span class="ot">&quot;:</span><span class="er"> </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> count(vec<span class="kw">,</span><span class="dt">Less_than</span><span class="kw">{</span>x<span class="kw">}</span>) <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">number of values less than </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> s <span class="al">&lt;&lt;</span> <span class="ot">&quot;:</span><span class="er"> </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> count(lst<span class="kw">,</span><span class="dt">Less_than</span><span class="kw">{</span>s<span class="kw">}</span>) <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Here, <code class="calibre8">Less_than{x}</code> constructs an object
of type <code class="calibre8">Less_than&lt;int&gt;</code>, for which
the call operator compares to the <code class="calibre8">int</code>
called <code class="calibre8">x</code>; <code
class="calibre8">Less_than{s}</code> constructs an object that compares
to the <code class="calibre8">string</code> called <code
class="calibre8">s</code>. The beauty of these function objects is that
they carry the value to be compared against with them. We don’t have to
write a separate function for each value (and each type), and we don’t
have to introduce nasty global variables to hold values. Also, for a
simple function object like <code class="calibre8">Less_than</code>,
inlining is simple, so a call of <code class="calibre8">Less_than</code>
is far more efficient than an indirect function call. The ability to
carry data plus their efficiency makes function objects particularly
useful as arguments to algorithms.</p>
<p>Function objects used to specify the meaning of key operations of a
general algorithm (such as <code class="calibre8">Less_than</code> for
<code class="calibre8">count()</code>) are often referred to as
<em>policy objects</em>.</p>
<h4 class="h3" id="part0011.html#ch06lev2sec6">6.3.3 Lambda
Expressions</h4>
<p>In §<a href="#part0011.html#ch06lev2sec5" class="calibre6">6.3.2</a>,
we defined <code class="calibre8">Less_than</code> separately from its
use. That can be inconvenient. Consequently, there is a notation for
implicitly generating function objects:</p>
<p><a href="#part0030_split_023.html#p0086_04a"
id="part0011.html#p0086_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb189"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>void f(const <span class="dt">Vector&lt;</span>int&gt;&amp; vec<span class="kw">,</span> const list<span class="dt">&lt;</span>string&gt;&amp; lst<span class="kw">,</span> int x<span class="kw">,</span> const string&amp; s)</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">number of values less than </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> x</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>          <span class="al">&lt;&lt;</span> <span class="ot">&quot;:</span><span class="er"> </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> count(vec<span class="kw">,</span>[&amp;](int a)<span class="kw">{</span> return a<span class="dt">&lt;</span>x<span class="kw">;</span> <span class="kw">}</span>)</span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>          <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">number of values less than </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> s</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>          <span class="al">&lt;&lt;</span> <span class="ot">&quot;:</span><span class="er"> </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> count(lst<span class="kw">,</span>[&amp;](const string&amp; a)<span class="kw">{</span> return a<span class="dt">&lt;</span>s<span class="kw">;</span> <span class="kw">}</span>)</span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>          <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0011.html#page_87" class="pagebreak"></span>The
notation <code class="calibre8">[&amp;](int a){ return a&lt;x; }</code>
is called a <em>lambda expression</em>. It generates a function object
exactly like <code class="calibre8">Less_than&lt;int&gt;{x}</code>. The
<code class="calibre8">[&amp;]</code> is a <em>capture list</em>
specifying that all local names used in the lambda body (such as <code
class="calibre8">x</code>) will be accessed through references. Had we
wanted to “capture” only <code class="calibre8">x</code>, we could have
said so: <code class="calibre8">[&amp;x]</code>. Had we wanted to give
the generated object a copy of <code class="calibre8">x</code>, we could
have said so: <code class="calibre8">[=x]</code>. Capture nothing is
<code class="calibre8">[ ]</code>, capture all local names used by
reference is <code class="calibre8">[&amp;]</code>, and capture all
local names used by value is <code class="calibre8">[=]</code>.</p>
<p>Using lambdas can be convenient and terse, but also obscure. For
nontrivial actions (say, more than a simple expression), I prefer to
name the operation so as to more clearly state its purpose and to make
it available for use in several places in a program.</p>
<p>In §<a href="#part0009.html#ch04lev2sec6" class="calibre6">4.5.3</a>,
we noted the annoyance of having to write many functions to perform
operations on elements of <code class="calibre8">vector</code>s of
pointers and <code class="calibre8">unique_ptr</code>s, such as <code
class="calibre8">draw_all()</code> and <code
class="calibre8">rotate_all()</code>. Function objects (in particular,
lambdas) can help by allowing us to separate the traversal of the
container from the specification of what is to be done with each
element.</p>
<p>First, we need a function that applies an operation to each object
pointed to by the elements of a container of pointers:</p>
<p><a href="#part0030_split_024.html#p0087_01a"
id="part0011.html#p0087_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb190"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">C</span><span class="kw">,</span> typename <span class="dt">Oper&gt;</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>void for_all(<span class="dt">C</span>&amp; c<span class="er">,</span> <span class="dt">Oper</span> op)       <span class="dv">//</span> assume that <span class="dt">C</span> <span class="dt">is</span> a container of pointers</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>     <span class="dv">//</span> requires <span class="dt">Sequence</span><span class="er">&lt;</span><span class="dt">C</span><span class="er">&gt;</span> &amp;&amp; <span class="dt">Callable&lt;Oper</span><span class="kw">,</span><span class="dt">Value_type&lt;C</span><span class="al">&gt;&gt;</span> (see <span class="er">§</span><span class="fl">7.2</span>.<span class="dv">1</span>)</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>     for (auto&amp; x <span class="fu">:</span> c)</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>           op(x)<span class="kw">;</span>       <span class="fu">//</span> pass <span class="fu">op</span>() a reference to each element pointed to</span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>Now, we can write a version of <code class="calibre8">user()</code>
from §<a href="#part0009.html#ch04lev1sec5" class="calibre6">4.5</a>
without writing a set of <code class="calibre8">_all</code>
functions:</p>
<p><a href="#part0030_split_025.html#p0087_02a"
id="part0011.html#p0087_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb191"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>void user2()</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>unique_ptr<span class="er">&lt;</span><span class="dt">Shape</span><span class="al">&gt;&gt;</span> v<span class="kw">;</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>     while (cin)</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>          v.push_back(read_shape(cin))<span class="kw">;</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>     for_all(v<span class="kw">,</span>[](unique_ptr<span class="dt">&lt;Shape</span>&gt;&amp; ps)<span class="kw">{</span> ps<span class="er">−</span><span class="dt">&gt;</span>draw()<span class="kw">;</span> <span class="kw">}</span>)<span class="kw">;</span>        <span class="fu">//</span> draw_all()</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>     for_all(v<span class="kw">,</span>[](unique_ptr<span class="dt">&lt;Shape</span>&gt;&amp; ps)<span class="kw">{</span> ps<span class="er">−</span><span class="dt">&gt;</span>rotate(<span class="dv">45</span>)<span class="kw">;</span> <span class="kw">}</span>)<span class="kw">;</span>    <span class="fu">//</span> rotate_all(<span class="dv">45</span>)</span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>I pass a <code class="calibre8">unique_ptr&lt;Shape&gt;&amp;</code>
to a lambda so that <code class="calibre8">for_all()</code> doesn’t have
to care exactly how the objects are stored. In particular, those <code
class="calibre8">for_all()</code> calls do not affect the lifetime of
the <code class="calibre8">Shape</code>s passed and the bodies of the
lambdas use the argument just as if were been a plain-old pointers.</p>
<p>Like a function, a lambda can be generic. For example:</p>
<p><a href="#part0030_split_026.html#p0087_03a"
id="part0011.html#p0087_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb192"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>class <span class="dt">S</span><span class="er">&gt;</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>void rotate_and_draw(vector<span class="dt">&lt;S</span>&gt;&amp; v<span class="kw">,</span> int r)</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>     for_all(v<span class="kw">,</span>[](auto&amp; s)<span class="kw">{</span> s<span class="er">−</span><span class="dt">&gt;</span>rotate(r)<span class="kw">;</span> s<span class="er">−</span><span class="dt">&gt;</span>draw()<span class="kw">;</span> <span class="kw">}</span>)<span class="kw">;</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0011.html#page_88" class="pagebreak"></span>Here, like
in variable declarations, <code class="calibre8">auto</code> means that
any type is accepted as an initializer (an argument is considered to
initialize the formal parameter in a call). This makes a lambda with an
<code class="calibre8">auto</code> parameter a template, a <em>generic
lambda</em>. For reasons lost in standards committee politics, this use
of <code class="calibre8">auto</code> is not currently allowed for
function arguments.</p>
<p>We can call this generic <code
class="calibre8">rotate_and_draw()</code> with any container of objects
that you can <code class="calibre8">draw()</code> and <code
class="calibre8">rotate()</code>. For example:</p>
<p><a href="#part0030_split_027.html#p0088_01a"
id="part0011.html#p0088_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb193"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>void user4()</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>unique_ptr<span class="er">&lt;</span><span class="dt">Shape</span><span class="al">&gt;&gt;</span> v1<span class="kw">;</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;Shape</span>*&gt; v2<span class="kw">;</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>     rotate_and_draw(v1<span class="kw">,</span><span class="dv">45</span>)<span class="kw">;</span></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>     rotate_and_draw(v2<span class="kw">,</span><span class="dv">90</span>)<span class="kw">;</span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Using a lambda, we can turn any statement into an expression. This is
mostly used to provide an operation to compute a value as an argument
value, but the ability is general. Consider a complicated
initialization:</p>
<p><a href="#part0030_split_028.html#p0088_02a"
id="part0011.html#p0088_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb194"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>enum class <span class="dt">Init_mode</span> <span class="kw">{</span> zero<span class="kw">,</span> seq<span class="kw">,</span> cpy<span class="kw">,</span> patrn <span class="kw">};</span>     <span class="fu">//</span> initializer alternatives</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> messy code<span class="fu">:</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> int n<span class="kw">,</span> <span class="dt">Init_mode</span> m<span class="kw">,</span> vector<span class="dt">&lt;</span>int&gt;&amp; arg<span class="kw">,</span> and iterators p and q are defined somewhere</span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> v<span class="kw">;</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>switch (m) <span class="kw">{</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>case zero<span class="fu">:</span></span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>     v <span class="kw">=</span> vector<span class="dt">&lt;</span>int<span class="er">&gt;</span>(n)<span class="kw">;</span>  <span class="fu">//</span> n elements initialized to <span class="dv">0</span></span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a>     break<span class="kw">;</span></span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a>case cpy<span class="fu">:</span></span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a>     v <span class="kw">=</span> <span class="fu">arg</span><span class="kw">;</span></span>
<span id="cb194-15"><a href="#cb194-15" aria-hidden="true" tabindex="-1"></a>     break<span class="kw">;</span></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> ...</span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a>if (m <span class="fu">==</span> seq)</span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a>      v<span class="kw">.</span>assign(p<span class="kw">,</span>q)<span class="kw">;</span>      <span class="fu">//</span> copy from sequence [p<span class="fu">:</span>q<span class="er">)</span></span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> ...</span></code></pre></div>
<p>This is a stylized example, but unfortunately not atypical. We need
to select among a set of alternatives for initializing a data structure
(here <code class="calibre8">v</code>) and we need to do different
computations for different alternatives. Such code is often messy,
deemed essential “for efficiency,” and a source of bugs:</p>
<ul>
<li><p>The variable could be used before it gets its intended
value.</p></li>
<li><p>The “initialization code” could be mixed with other code, making
it hard to comprehend.</p></li>
<li><p><span id="part0011.html#page_89" class="pagebreak"></span>When
“initialization code” is mixed with other code it is easier to forget a
case.</p></li>
<li><p>This isn’t initialization, it’s assignment.</p></li>
</ul>
<p>Instead, we could convert it to a lambda used as an initializer:</p>
<p><a href="#part0030_split_029.html#p0089_01a"
id="part0011.html#p0089_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb195"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> int n<span class="kw">,</span> <span class="dt">Init_mode</span> m<span class="kw">,</span> vector<span class="dt">&lt;</span>int&gt;&amp; arg<span class="kw">,</span> and iterators p and q are defined somewhere</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> v <span class="kw">=</span> [&amp;] <span class="kw">{</span></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>     switch (m) <span class="kw">{</span></span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>     case zero<span class="fu">:</span></span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>          return vector<span class="dt">&lt;</span>int<span class="er">&gt;</span>(n)<span class="kw">;</span>       <span class="fu">//</span> n elements initialized to <span class="dv">0</span></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>     case seq<span class="fu">:</span></span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>          return vector<span class="dt">&lt;</span>int<span class="er">&gt;</span><span class="kw">{</span>p<span class="kw">,</span>q<span class="kw">};</span>     <span class="fu">//</span> copy from sequence [p<span class="fu">:</span>q<span class="er">)</span></span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>     case cpy<span class="fu">:</span></span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a>          return <span class="fu">arg</span><span class="kw">;</span></span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a>     <span class="er">}</span></span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a><span class="er">}</span><span class="kw">;</span></span>
<span id="cb195-13"><a href="#cb195-13" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> ...</span></code></pre></div>
<p>I still “forgot” a <code class="calibre8">case</code>, but now that’s
easily spotted.</p>
<h3 class="h2" id="part0011.html#ch06lev1sec4">6.4 Template
Mechanisms</h3>
<p>To define good templates, we need some supporting language
facilities:</p>
<ul>
<li><p>Values dependent on a type: <em>variable templates</em> (§<a
href="#part0011.html#ch06lev2sec7" class="calibre6">6.4.1</a>).</p></li>
<li><p>Aliases for types and templates: <em>alias templates</em> (§<a
href="#part0011.html#ch06lev2sec8" class="calibre6">6.4.2</a>).</p></li>
<li><p>A compile-time selection mechanism: <code
class="calibre8">if constexpr</code> (§<a
href="#part0011.html#ch06lev2sec9" class="calibre6">6.4.3</a>).</p></li>
<li><p>A compile-time mechanism to inquire about properties of types and
expressions: <code class="calibre8">requires</code>-expressions (§<a
href="#part0012.html#ch07lev2sec3" class="calibre6">7.2.3</a>).</p></li>
</ul>
<p>In addition, <code class="calibre8">constexpr</code> functions (§<a
href="#part0006.html#ch01lev1sec6" class="calibre6">1.6</a>) and <code
class="calibre8">static_asserts</code> (§<a
href="#part0008.html#ch03lev2sec5" class="calibre6">3.5.5</a>) often
take part in template design and use.</p>
<p>These basic mechanisms are primarily tools for building general,
foundational abstractions.</p>
<h4 class="h3" id="part0011.html#ch06lev2sec7">6.4.1 Variable
Templates</h4>
<p>When we use a type, we often want constants and values of that type.
This is of course also the case when we use a class template: when we
define a <code class="calibre8">C&lt;T&gt;</code>, we often want
constants and variables of type <code class="calibre8">T</code> and
other types depending on <code class="calibre8">T</code>. Here is an
example from a fluid dynamic simulation [<a href="#part0021.html#ref19"
class="calibre6">Garcia,2015</a>]:</p>
<p><a href="#part0030_split_030.html#p0089_02a"
id="part0011.html#p0089_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb196"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>template <span class="dt">&lt;</span>class <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>     constexpr <span class="dt">T</span> viscosity <span class="kw">=</span> <span class="fl">0.4</span><span class="kw">;</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>template <span class="dt">&lt;</span>class <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>     constexpr space_vector<span class="dt">&lt;T</span><span class="er">&gt;</span> external_acceleration <span class="kw">=</span> <span class="kw">{</span> <span class="dt">T</span><span class="kw">{},</span> <span class="dt">T</span><span class="kw">{</span><span class="er">−</span><span class="fl">9.8</span><span class="kw">},</span> <span class="dt">T</span><span class="kw">{}</span> <span class="kw">};</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>auto vis2 <span class="kw">=</span> <span class="dv">2</span><span class="fu">*</span>viscosity<span class="dt">&lt;</span>double<span class="er">&gt;</span><span class="kw">;</span></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>auto acc <span class="kw">=</span> external_acceleration<span class="dt">&lt;</span><span class="fl">float</span><span class="er">&gt;</span><span class="kw">;</span></span></code></pre></div>
<p>Here, <code class="calibre8">space_vector</code> is a
three-dimensional vector.</p>
<p><span id="part0011.html#page_90" class="pagebreak"></span>Naturally,
we can use arbitrary expressions of suitable type as initializers.
Consider:</p>
<p><a href="#part0030_split_031.html#p0090_01a"
id="part0011.html#p0090_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb197"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="kw">,</span> typename <span class="dt">T2&gt;</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>     constexpr bool <span class="dt">Assignable</span> <span class="kw">=</span> is_assignable<span class="dt">&lt;T</span>&amp;<span class="kw">,</span><span class="dt">T2</span>&gt;::value<span class="kw">;</span>  <span class="fu">//</span> is_assignable <span class="dt">is</span> a type trait (<span class="er">§</span><span class="fl">13.9</span>.<span class="dv">1</span>)</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>template<span class="er">&lt;</span>typename <span class="dt">T&gt;</span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>void testing()</span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>     static_assert(<span class="dt">Assignable</span><span class="er">&lt;</span><span class="dt">T</span>&amp;<span class="kw">,</span>double<span class="dt">&gt;</span><span class="kw">,</span> <span class="ot">&quot;</span><span class="er">can</span><span class="ot">&#39;</span><span class="er">t assign a double</span><span class="ot">&quot;</span><span class="er">)</span><span class="kw">;</span></span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>     static_assert(<span class="dt">Assignable&lt;T</span>&amp;<span class="kw">,</span>string<span class="dt">&gt;</span><span class="kw">,</span> <span class="ot">&quot;</span><span class="er">can</span><span class="ot">&#39;</span><span class="er">t assign a string</span><span class="ot">&quot;</span>)<span class="kw">;</span></span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>After some significant mutations, this idea becomes the heart of
concept definitions (§<a href="#part0012.html#ch07lev1sec2"
class="calibre6">7.2</a>).</p>
<h4 class="h3" id="part0011.html#ch06lev2sec8">6.4.2 Aliases</h4>
<p>Surprisingly often, it is useful to introduce a synonym for a type or
a template. For example, the standard header <code
class="calibre8">&lt;cstddef&gt;</code> contains a definition of the
alias <code class="calibre8">size_t</code>, maybe:</p>
<div class="sourceCode" id="cb198"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>using size_t <span class="kw">=</span> unsigned int<span class="kw">;</span></span></code></pre></div>
<p>The actual type named <code class="calibre8">size_t</code> is
implementation-dependent, so in another implementation <code
class="calibre8">size_t</code> may be an <code
class="calibre8">unsigned long</code>. Having the alias <code
class="calibre8">size_t</code> allows the programmer to write portable
code.</p>
<p>It is very common for a parameterized type to provide an alias for
types related to their template arguments. For example:</p>
<p><a href="#part0030_split_032.html#p0090_02a"
id="part0011.html#p0090_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb199"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>     using value_type <span class="kw">=</span> <span class="dt">T</span><span class="kw">;</span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>In fact, every standard-library container provides <code
class="calibre8">value_type</code> as the name of its value type (<a
href="#part0016.html#ch11" class="calibre6">Chapter 11</a>). This allows
us to write code that will work for every container that follows this
convention. For example:</p>
<p><a href="#part0030_split_033.html#p0090_03a"
id="part0011.html#p0090_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb200"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">C</span><span class="er">&gt;</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>using <span class="dt">Value_type</span> <span class="kw">=</span> typename <span class="dt">C</span>::value_type<span class="kw">;</span>     <span class="fu">//</span> the type of <span class="dt">C</span><span class="st">&#39;</span><span class="er">s elements</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="er">template&lt;typename Container&gt;</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a><span class="er">void algo(Container&amp; c)</span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="ch">     </span><span class="er">Vector&lt;Value_type&lt;Container&gt;&gt; vec;        // keep results here</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="er">     // ...</span></span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>The aliasing mechanism can be used to define a new template by
binding some or all template arguments. For example:</p>
<p><a href="#part0030_split_034.html#p0091_01a"
id="part0011.html#p0091_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb201"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Key</span><span class="kw">,</span> typename <span class="dt">Value&gt;</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Map</span> <span class="er">{</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>     <span class="dv">//</span> ...</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a><span class="er">}</span><span class="kw">;</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Value</span><span class="er">&gt;</span></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>using <span class="dt">String_map</span> <span class="kw">=</span> <span class="dt">Map&lt;</span>string<span class="kw">,</span><span class="dt">Value&gt;</span><span class="kw">;</span></span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a><span class="dt">String_map&lt;</span>int<span class="er">&gt;</span> m<span class="kw">;</span>     <span class="fu">//</span> m <span class="dt">is</span> a <span class="dt">Map</span><span class="er">&lt;</span>string<span class="kw">,</span>int<span class="dt">&gt;</span></span></code></pre></div>
<h4 class="h3" id="part0011.html#ch06lev2sec9">6.4.3 Compile-Time <code
class="calibre16">if</code></h4>
<p>Consider writing an operation that can use one of two operations
<code class="calibre8">slow_and_safe(T)</code> or <code
class="calibre8">simple_and_fast(T)</code>. Such problems abound in
foundational code where generality and optional performance are
essential. The traditional solution is to write a pair of overloaded
functions and select the most appropriate based on a trait (§<a
href="#part0018.html#ch13lev2sec12" class="calibre6">13.9.1</a>), such
as the standard-library <code class="calibre8">is_pod</code>. If a class
hierarchy is involved, a base class can provide the <code
class="calibre8">slow_and_safe</code> general operation and a derived
class can override with a <code class="calibre8">simple_and_fast</code>
implementation.</p>
<p>In C++17, we can use a compile-time <code
class="calibre8">if</code>:</p>
<p><a href="#part0030_split_035.html#p0091_02a"
id="part0011.html#p0091_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb202"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>void update(<span class="dt">T</span>&amp; target)</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a>     if constexpr(is_pod<span class="dt">&lt;T</span>&gt;::value)</span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a>          simple_and_fast(target)<span class="kw">;</span> <span class="fu">//</span> for <span class="ot">&quot;</span><span class="er">plain old data</span><span class="ot">&quot;</span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>     else</span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>          slow_and_safe(target)<span class="kw">;</span></span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The <code class="calibre8">is_pod&lt;T&gt;</code> is a type trait
(§<a href="#part0018.html#ch13lev2sec12" class="calibre6">13.9.1</a>)
that tells us whether a type can be trivially copied.</p>
<p>Only the selected branch of an <code
class="calibre8">if constexpr</code> is instantiated. This solution
offers optimal performance and locality of the optimization.</p>
<p>Importantly, an <code class="calibre8">if constexpr</code> is not a
text-manipulation mechanism and cannot be used to break the usual rules
of grammar, type, and scope. For example:</p>
<p><a href="#part0030_split_036.html#p0091_03a"
id="part0011.html#p0091_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb203"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>void bad(<span class="dt">T</span> <span class="fu">arg</span>)</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>     if constexpr(<span class="dt">Something&lt;T</span>&gt;::value)</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>          try<span class="kw">{</span>                         <span class="fu">//</span> syntax error</span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a>     g(<span class="fu">arg</span>)<span class="kw">;</span></span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a>     if constexpr(<span class="dt">Something&lt;T</span>&gt;::value)</span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a>          <span class="kw">}</span> <span class="kw">catch</span>(...) <span class="kw">{</span> <span class="co">/* ... */</span> <span class="kw">}</span>   <span class="fu">//</span> syntax error</span>
<span id="cb203-11"><a href="#cb203-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0011.html#page_92" class="pagebreak"></span>Allowing
such text manipulation could seriously compromise readability of code
and create problems for tools relying on modern program representation
techniques (such as “abstract syntax trees”).</p>
<h3 class="h2" id="part0011.html#ch06lev1sec5">6.5 Advice</h3>
<p>[1] Use templates to express algorithms that apply to many argument
types; §<a href="#part0011.html#ch06lev1sec1" class="calibre6">6.1</a>;
[CG: T.2].</p>
<p>[2] Use templates to express containers; §<a
href="#part0011.html#ch06lev1sec2" class="calibre6">6.2</a>; [CG:
T.3].</p>
<p>[3] Use templates to raise the level of abstraction of code; §<a
href="#part0011.html#ch06lev1sec2" class="calibre6">6.2</a>; [CG:
T.1].</p>
<p>[4] Templates are type safe, but checking happens too late; §<a
href="#part0011.html#ch06lev1sec2" class="calibre6">6.2</a>.</p>
<p>[5] Let constructors or function templates deduce class template
argument types; §<a href="#part0011.html#ch06lev2sec3"
class="calibre6">6.2.3</a>.</p>
<p>[6] Use function objects as arguments to algorithms; §<a
href="#part0011.html#ch06lev2sec5" class="calibre6">6.3.2</a>; [CG:
T.40].</p>
<p>[7] Use a lambda if you need a simple function object in one place
only; §<a href="#part0011.html#ch06lev2sec5"
class="calibre6">6.3.2</a>.</p>
<p>[8] A virtual function member cannot be a template member function;
§<a href="#part0011.html#ch06lev2sec4" class="calibre6">6.3.1</a>.</p>
<p>[9] Use template aliases to simplify notation and hide implementation
details; §<a href="#part0011.html#ch06lev2sec8"
class="calibre6">6.4.2</a>.</p>
<p>[10] To use a template, make sure its definition (not just its
declaration) is in scope; §<a href="#part0012.html#ch07lev1sec5"
class="calibre6">7.5</a>.</p>
<p>[11] Templates offer compile-time “duck typing”; §<a
href="#part0012.html#ch07lev1sec5" class="calibre6">7.5</a>.</p>
<p>[12] There is no separate compilation of templates: <code
class="calibre8">#include</code> template definitions in every
translation unit that uses them.</p>
</section>
<p><span id="part0012.html"></span></p>
<section id="part0012.html#ch07" class="h1 bodymatter">
<h2 class="h1"><span id="part0012.html#page_93"
class="calibre2 pagebreak"></span><span class="big">7</span></h2>
<p>Concepts and Generic Programming</p>
<p><em>Programming: you have to start with interesting
algorithms.</em></p>
<p><em>– Alex Stepanov</em></p>
<ul>
<li><p><a href="#part0012.html#ch07lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0012.html#ch07lev1sec2"
class="calibre6">Concepts</a></p>
<p><a href="#part0012.html#ch07lev2sec1" class="calibre6">Use of
Concepts</a>; <a href="#part0012.html#ch07lev2sec2"
class="calibre6">Concept-Based Overloading</a>; <a
href="#part0012.html#ch07lev2sec3" class="calibre6">Valid Code</a>; <a
href="#part0012.html#ch07lev2sec4" class="calibre6">Definition of
Concepts</a></p></li>
<li><p><a href="#part0012.html#ch07lev1sec3" class="calibre6">Generic
Programming</a></p>
<p><a href="#part0012.html#ch07lev2sec5" class="calibre6">Use of
Concepts</a>; <a href="#part0012.html#ch07lev2sec6"
class="calibre6">Abstraction Using Templates</a></p></li>
<li><p><a href="#part0012.html#ch07lev1sec4" class="calibre6">Variadic
Templates</a></p>
<p><a href="#part0012.html#ch07lev2sec7" class="calibre6">Fold
Expressions</a>; <a href="#part0012.html#ch07lev2sec8"
class="calibre6">Forwarding Arguments</a></p></li>
<li><p><a href="#part0012.html#ch07lev1sec5" class="calibre6">Template
Compilation Model</a></p></li>
<li><p><a href="#part0012.html#ch07lev1sec6"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0012.html#ch07lev1sec1">7.1 Introduction</h3>
<p>What are templates for? In other words, what programming techniques
are effective when you use templates? Templates offer:</p>
<ul>
<li><p>The ability to pass types (as well as values and templates) as
arguments without loss of information. This implies excellent
opportunities for inlining, of which current implementations take great
advantage.</p></li>
<li><p>Opportunities to weave together information from different
contexts at instantiation time. This implies optimization
opportunities.</p></li>
<li><p>The ability to pass constant values as arguments. This implies
the ability to do compile-time computation.</p></li>
</ul>
<p>In other words, templates provide a powerful mechanism for
compile-time computation and type manipulation that can lead to very
compact and efficient code. Remember that types (classes) can contain
both code (§<a href="#part0011.html#ch06lev2sec5"
class="calibre6">6.3.2</a>) and values (§<a
href="#part0011.html#ch06lev2sec2" class="calibre6">6.2.2</a>).</p>
<p><span id="part0012.html#page_94" class="pagebreak"></span>The first
and most common use of templates is to support <em>generic
programming</em>, that is, programming focused on the design,
implementation, and use of general algorithms. Here, “general” means
that an algorithm can be designed to accept a wide variety of types as
long as they meet the algorithm’s requirements on its arguments.
Together with concepts, the template is C++’s main support for generic
programming. Templates provide (compile-time) parametric
polymorphism.</p>
<h3 class="h2" id="part0012.html#ch07lev1sec2">7.2 Concepts (C++20)</h3>
<p>Consider the <code class="calibre8">sum()</code> from §<a
href="#part0011.html#ch06lev2sec4" class="calibre6">6.3.1</a>:</p>
<p><a href="#part0031_split_000.html#p0094_01a"
id="part0012.html#p0094_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb204"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Seq</span><span class="kw">,</span> typename <span class="dt">Num&gt;</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Num</span> sum(<span class="dt">Seq</span> s<span class="er">,</span> <span class="dt">Num</span> v)</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>     for (const auto&amp; x <span class="fu">:</span> s)</span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>           v+=x<span class="kw">;</span></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>     return v<span class="kw">;</span></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>It can be invoked for any data structure that supports <code
class="calibre8">begin()</code> and <code class="calibre8">end()</code>
so that the range-<code class="calibre8">for</code> will work. Such
structures include the standard-library <code
class="calibre8">vector</code>, <code class="calibre8">list</code>, and
<code class="calibre8">map.</code> Furthermore, the element type of the
data structure is limited only by its use: it must be a type that we can
add to the <code class="calibre8">Value</code> argument. Examples are
<code class="calibre8">int</code>s, <code
class="calibre8">double</code>s, and <code
class="calibre8">Matrix</code>es (for any reasonable definition of <code
class="calibre8">Matrix</code>). We could say that the <code
class="calibre8">sum()</code> algorithm is generic in two dimensions:
the type of the data structure used to store elements (“the sequence”)
and the type of elements.</p>
<p>So, <code class="calibre8">sum()</code> requires that its first
template argument is some kind of sequence and its second template
argument is some kind of number. We call such requirements
<em>concepts</em>.</p>
<p>Language support for concepts is not yet ISO C++, but it is an ISO
Technical Specification [<a href="#part0021.html#ref11"
class="calibre6">ConceptsTS</a>]. Implementations are in use, so I risk
recommending it here even though details are likely to change and it may
be years before everybody can use it in production code.</p>
<h4 class="h3" id="part0012.html#ch07lev2sec1">7.2.1 Use of
Concepts</h4>
<p>Most template arguments must meet specific requirements for the
template to compile properly and for the generated code to work
properly. That is, most templates must be constrained templates (§<a
href="#part0011.html#ch06lev2sec1" class="calibre6">6.2.1</a>). The
type-name introducer <code class="calibre8">typename</code> is the least
constraining, requiring only that the argument be a type. Usually, we
can do better than that. Consider that <code
class="calibre8">sum()</code> again:</p>
<p><a href="#part0031_split_001.html#p0094_02a"
id="part0012.html#p0094_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb205"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;Sequence</span> <span class="dt">Seq</span><span class="kw">,</span> <span class="dt">Number</span> <span class="dt">Num&gt;</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Num</span> sum(<span class="dt">Seq</span> s<span class="er">,</span> <span class="dt">Num</span> v)</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>     for (const auto&amp; x <span class="fu">:</span> s)</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>           v+=x<span class="kw">;</span></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>     return v<span class="kw">;</span></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>That’s much clearer. Once we have defined what the concepts <code
class="calibre8">Sequence</code> and <code
class="calibre8">Number</code> mean, the compiler can reject bad calls
by looking at <code class="calibre8">sum()</code>’s interface only,
rather than looking at its implementation. This improves error
reporting.</p>
<p><span id="part0012.html#page_95" class="pagebreak"></span>However,
the specification of <code class="calibre8">sum()</code>’s interface is
not complete: I “forgot” to say that we should be able to add elements
of a <code class="calibre8">Sequence</code> to a <code
class="calibre8">Number</code>. We can do that:</p>
<p><a href="#part0031_split_002.html#p0095_01a"
id="part0012.html#p0095_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb206"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;Sequence</span> <span class="dt">Seq</span><span class="kw">,</span> <span class="dt">Number</span> <span class="dt">Num&gt;</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>    requires <span class="dt">Arithmetic</span><span class="er">&lt;</span><span class="dt">Value_type&lt;Seq</span><span class="er">&gt;</span><span class="kw">,</span><span class="dt">Num&gt;</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Num</span> sum(<span class="dt">Seq</span> s<span class="er">,</span> <span class="dt">Num</span> n)<span class="kw">;</span></span></code></pre></div>
<p>The <code class="calibre8">Value_type</code> of a sequence is the
type of the elements in the sequence. <code
class="calibre8">Arithmetic&lt;X,Y&gt;</code> is a concept specifying
that we can do arithmetic with numbers of types <code
class="calibre8">X</code> and <code class="calibre8">Y</code>. This
saves us from accidentally trying to calculate the <code
class="calibre8">sum()</code> of a <code
class="calibre8">vector&lt;string&gt;</code> or a <code
class="calibre8">vector&lt;int*&gt;</code> while still accepting <code
class="calibre8">vector&lt;int&gt;</code> and <code
class="calibre8">vector&lt;complex&lt;double&gt;&gt;</code>.</p>
<p>In this example, we needed only <code class="calibre8">+=</code>, but
for simplicity and flexibility, we should not constrain our template
argument too tightly. In particular, we might someday want to express
<code class="calibre8">sum()</code> in terms of <code
class="calibre8">+</code> and <code class="calibre8">=</code> rather
than <code class="calibre8">+=</code>, and then we’d be happy that we
used a general concept (here, <code class="calibre8">Arithmetic</code>)
rather than a narrow requirement to “have <code
class="calibre8">+=</code>.”</p>
<p>Partial specifications, as in the first <code
class="calibre8">sum()</code> using concepts, can be very useful. Unless
the specification is complete, some errors will not be found until
instantiation time. However, partial specifications can help a lot,
express intent, and are essential for smooth incremental development
where we don’t initially recognize all the requirements we need. With
mature libraries of concepts, initial specifications will be close to
perfect.</p>
<p>Unsurprisingly, <code
class="calibre8">requires Arithmetic&lt;Value_type&lt;Seq&gt;,Num&gt;</code>
is called a <code class="calibre8">requirements</code>-clause. The <code
class="calibre8">template&lt;Sequence Seq&gt;</code> notation is simply
a shorthand for an explicit use of <code
class="calibre8">requires Sequence&lt;Seq&gt;</code>. If I liked
verbosity, I could equivalently have written</p>
<p><a href="#part0031_split_003.html#p0095_02a"
id="part0012.html#p0095_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb207"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Seq</span><span class="kw">,</span> typename <span class="dt">Num&gt;</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>    requires <span class="dt">Sequence</span><span class="er">&lt;</span><span class="dt">Seq&gt;</span> &amp;&amp; <span class="dt">Number</span><span class="er">&lt;</span><span class="dt">Num&gt;</span> &amp;&amp; <span class="dt">Arithmetic</span><span class="er">&lt;</span><span class="dt">Value_type&lt;Seq</span><span class="er">&gt;</span><span class="kw">,</span><span class="dt">Num&gt;</span></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Num</span> sum(<span class="dt">Seq</span> s<span class="er">,</span> <span class="dt">Num</span> n)<span class="kw">;</span></span></code></pre></div>
<p>On the other hand, we could also use the equivalence between the two
notations to write:</p>
<p><a href="#part0031_split_004.html#p0095_03a"
id="part0012.html#p0095_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb208"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;Sequence</span> <span class="dt">Seq</span><span class="kw">,</span> <span class="dt">Arithmetic&lt;Value_type</span><span class="er">&lt;</span><span class="dt">Seq</span><span class="al">&gt;&gt;</span> <span class="dt">Num&gt;</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Num</span> sum(<span class="dt">Seq</span> s<span class="er">,</span> <span class="dt">Num</span> n)<span class="kw">;</span></span></code></pre></div>
<p>Where we cannot yet use concepts, we have to make do with naming
conventions and comments, such as:</p>
<p><a href="#part0031_split_005.html#p0095_04a"
id="part0012.html#p0095_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb209"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Sequence</span><span class="kw">,</span> typename <span class="dt">Number&gt;</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">//</span> requires <span class="dt">Arithmetic</span><span class="er">&lt;</span><span class="dt">Value_type&lt;Sequence</span><span class="er">&gt;</span><span class="kw">,</span><span class="dt">Number&gt;</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Numer</span> sum(<span class="dt">Sequence</span> s<span class="er">,</span> <span class="dt">Number</span> n)<span class="kw">;</span></span></code></pre></div>
<p>Whatever notation we chose, it is important to design a template with
semantically meaningful constraints on its arguments (§<a
href="#part0012.html#ch07lev2sec4" class="calibre6">7.2.4</a>).</p>
<h4 class="h3" id="part0012.html#ch07lev2sec2">7.2.2 Concept-based
Overloading</h4>
<p>Once we have properly specified templates with their interfaces, we
can overload based on their properties, much as we do for functions.
Consider a slightly simplified standard-library function <code
class="calibre8">advance()</code> that advances an iterator (§<a
href="#part0017.html#ch12lev1sec3" class="calibre6">12.3</a>):</p>
<p><a href="#part0031_split_006.html#p0096_01a"
id="part0012.html#p0096_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb210"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;Forward_iterator</span> <span class="dt">Iter</span><span class="er">&gt;</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>void advance(<span class="dt">Iter</span> p<span class="kw">,</span> int n)        <span class="fu">//</span> move p n elements forward</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>     for (<span class="er">−−</span>n)</span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>           ++p<span class="kw">;</span>    <span class="fu">//</span> a forward iterator has ++<span class="kw">,</span> but not <span class="fu">+</span> or +=</span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;Random_access_iterator</span> <span class="dt">Iter</span><span class="kw">,</span> int n<span class="dt">&gt;</span></span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a>void advance(<span class="dt">Iter</span> p<span class="er">,</span> int n)        <span class="dv">//</span> move p n elements forward</span>
<span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb210-11"><a href="#cb210-11" aria-hidden="true" tabindex="-1"></a>     p+=n<span class="kw">;</span>        <span class="fu">//</span> a random<span class="fu">-</span>access iterator has +=</span>
<span id="cb210-12"><a href="#cb210-12" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>The compiler will select the template with the strongest requirements
met by the arguments. In this case, a <code class="calibre8">list</code>
only supplies forward iterators, but a <code
class="calibre8">vector</code> offers random-access iterators, so we
get:</p>
<p><a href="#part0031_split_007.html#p0096_02a"
id="part0012.html#p0096_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb211"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>void user(vector<span class="dt">&lt;</span>int&gt;::iterator vip<span class="kw">,</span> list<span class="dt">&lt;</span>string&gt;::iterator lsp)</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>     advance(vip<span class="kw">,</span><span class="dv">10</span>)<span class="kw">;</span>   <span class="fu">//</span> use the fast advance()</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>     advance(lsp<span class="kw">,</span><span class="dv">10</span>)<span class="kw">;</span>   <span class="fu">//</span> use the slow advance()</span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Like other overloading, this is a compile-time mechanism implying no
run-time cost, and where the compiler does not find a best choice, it
gives an ambiguity error. The rules for concept-based overloading are
far simpler than the rules for general overloading (§<a
href="#part0006.html#ch01lev1sec3" class="calibre6">1.3</a>). Consider
first a single argument for several alternative functions:</p>
<ul>
<li><p>If the argument doesn’t match the concept, that alternative
cannot be chosen.</p></li>
<li><p>If the argument matches the concept for just one alternative,
that alternative is chosen.</p></li>
<li><p>If arguments from two alternatives are equally good matches for a
concept, we have an ambiguity.</p></li>
<li><p>If arguments from two alternatives match a concept and one is
stricter than the other (match all the requirements of the other and
more), that alternative is chosen.</p></li>
</ul>
<p>For an alternative to be chosen it has to be</p>
<ul>
<li><p>a match for all of its arguments, and</p></li>
<li><p>at least an equally good match for all arguments as other
alternatives, and</p></li>
<li><p>a better match for at least one argument.</p></li>
</ul>
<h4 class="h3" id="part0012.html#ch07lev2sec3">7.2.3 Valid Code</h4>
<p>The question of whether a set of template arguments offers what a
template requires of its template parameters ultoimately boils down to
whether some expressions are valid.</p>
<p>Using a <code class="calibre8">requires</code>-expression, we can
check if a set of expressions is valid. For example:</p>
<p><a href="#part0031_split_008.html#p0096_03a"
id="part0012.html#p0096_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb212"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;Forward_iterator</span> <span class="dt">Iter</span><span class="er">&gt;</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>void advance(<span class="dt">Iter</span> p<span class="kw">,</span> int n)        <span class="fu">//</span> move p n elements forward</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>     for (<span class="er">−−</span>n)</span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>           ++p<span class="kw">;</span>    <span class="fu">//</span> a forward iterator has ++<span class="kw">,</span> but not <span class="fu">+</span> or +=</span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;Forward_iterator</span> <span class="dt">Iter</span><span class="kw">,</span> int n<span class="dt">&gt;</span></span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>     requires requires(<span class="dt">Iter</span> p<span class="er">,</span> int i) <span class="er">{</span> p<span class="er">[</span>i<span class="er">]</span><span class="kw">;</span> p<span class="fu">+</span>i<span class="kw">;</span> <span class="er">}</span>     <span class="fu">//</span> <span class="dt">Iter</span> has subscripting and addition</span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a>void advance(<span class="dt">Iter</span> p<span class="kw">,</span> int n)            <span class="fu">//</span> move p n elements forward</span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a>     p+=n<span class="kw">;</span>           <span class="fu">//</span> a random<span class="fu">-</span>access iterator has +=</span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0012.html#page_97" class="pagebreak"></span>No, that
<code class="calibre8">requires requires</code> is not a typo. The first
<code class="calibre8">requires</code> starts the <code
class="calibre8">requirements</code>-clause and the second <code
class="calibre8">requires</code> starts the <code
class="calibre8">requires</code>-expression</p>
<div class="sourceCode" id="cb213"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>requires(<span class="dt">Iter</span> p<span class="kw">,</span> int i) <span class="kw">{</span> p[i]<span class="kw">;</span> p<span class="fu">+</span>i<span class="kw">;</span> <span class="kw">}</span></span></code></pre></div>
<p>A <code class="calibre8">requires</code>-expression is a predicate
that is <code class="calibre8">true</code> if the statements in it are
valid code and <code class="calibre8">false</code> if they are not.</p>
<p>I consider <code class="calibre8">requires</code>-expressions the
assembly code of generic programming. Like ordinary assembly code, <code
class="calibre8">requires</code>-expressions are extremely flexible and
impose no programming discipline. In some form or other, they are at the
bottom of most interesting generic code, just as assembly code is at the
bottom of most interesting ordinary code. Like assembly code, <code
class="calibre8">requires</code>-expressions should not be seen in
“ordinary code.” If you see <code
class="calibre8">requires requires</code> in your code, it is probably
too low level.</p>
<p>The use of <code class="calibre8">requires requires</code> in <code
class="calibre8">advance()</code> is deliberately inelegant and hackish.
Note that I “forgot” to specify <code class="calibre8">+=</code> and the
required return types for the operations. You have been warned! Prefer
named concepts for which the name indicates its semantic meaning.</p>
<p>Prefer use of properly named concepts with well-specified semantics
(§<a href="#part0012.html#ch07lev2sec4" class="calibre6">7.2.4</a>) and
use <code class="calibre8">requires</code>-expressions in the definition
of those.</p>
<h4 class="h3" id="part0012.html#ch07lev2sec4">7.2.4 Definition of
Concepts</h4>
<p>Eventually, we expect to find useful concepts, such as <code
class="calibre8">Sequence</code> and <code
class="calibre8">Arithmetic</code> in libraries, including the standard
library. The Ranges Technical Specification [<a
href="#part0021.html#ref37" class="calibre6">RangesTS</a>] already
offers a set for constraining standard-library algorithms (§<a
href="#part0017.html#ch12lev1sec7" class="calibre6">12.7</a>). However,
simple concepts are not hard to define.</p>
<p>A concept is a compile-time predicate specifying how one or more
types can be used. Consider first one of the simplest examples:</p>
<p><a href="#part0031_split_009.html#p0097_01a"
id="part0012.html#p0097_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb214"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>concept <span class="dt">Equality_comparable</span> <span class="kw">=</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>    requires (<span class="dt">T</span> a<span class="kw">,</span> <span class="dt">T</span> b) <span class="kw">{</span></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>         <span class="kw">{</span> a <span class="fu">==</span> b <span class="kw">}</span> <span class="er">−</span><span class="dt">&gt;</span> bool<span class="kw">;</span>   <span class="fu">//</span> <span class="fu">compare</span> <span class="dt">Ts</span> with <span class="fu">==</span></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>         <span class="kw">{</span> a <span class="kw">!=</span> b <span class="kw">}</span> <span class="er">−</span><span class="dt">&gt;</span> bool<span class="kw">;</span>   <span class="fu">//</span> <span class="fu">compare</span> <span class="dt">Ts</span> with <span class="kw">!=</span></span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">};</span></span></code></pre></div>
<p><code class="calibre8">Equality_comparable</code> is the concept we
use to ensure that we can compare values of a type equal and non-equal.
We simply say that, given two values of the type, they must be
comparable using <code class="calibre8">==</code> and <code
class="calibre8">!=</code> and the result of those operations must be
convertible to <code class="calibre8">bool.</code> For example:</p>
<p><a href="#part0031_split_010.html#p0097_02a"
id="part0012.html#p0097_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb215"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>static_assert(<span class="dt">Equality_comparable&lt;</span>int<span class="er">&gt;</span>)<span class="kw">;</span>   <span class="fu">//</span> succeeds</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">S</span> <span class="kw">{</span> int a<span class="kw">;</span> <span class="kw">};</span></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>static_assert(<span class="dt">Equality_comparable&lt;S</span><span class="er">&gt;</span>)<span class="kw">;</span>     <span class="fu">//</span> fails because structs don<span class="st">&#39;</span><span class="er">t automatically get == and !=</span></span></code></pre></div>
<p><span id="part0012.html#page_98" class="pagebreak"></span>The
definition of the concept <code
class="calibre8">Equality_comparable</code> is exactly equivalent to the
English description and no longer. The value of a <code
class="calibre8">concept</code> is always <code
class="calibre8">bool</code>.</p>
<p>Defining <code class="calibre8">Equality_comparable</code> to handle
nonhomogeneous comparisons is almost as easy:</p>
<p><a href="#part0031_split_011.html#p0098_01a"
id="part0012.html#p0098_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb216"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="kw">,</span> typename <span class="dt">T2</span> <span class="kw">=</span><span class="dt">T&gt;</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>concept <span class="dt">Equality_comparable</span> <span class="kw">=</span></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>    requires (<span class="dt">T</span> a<span class="kw">,</span> <span class="dt">T2</span> b) <span class="kw">{</span></span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>         <span class="kw">{</span> a <span class="fu">==</span> b <span class="kw">}</span> <span class="er">−</span><span class="dt">&gt;</span> bool<span class="kw">;</span>  <span class="fu">//</span> <span class="fu">compare</span> a <span class="dt">T</span> to a <span class="dt">T2</span> with <span class="fu">==</span></span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>         <span class="kw">{</span> a <span class="kw">!=</span> b <span class="kw">}</span> <span class="er">−</span><span class="dt">&gt;</span> bool<span class="kw">;</span>  <span class="fu">//</span> <span class="fu">compare</span> a <span class="dt">T</span> to a <span class="dt">T2</span> with <span class="kw">!=</span></span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>         <span class="kw">{</span> b <span class="fu">==</span> a <span class="kw">}</span> <span class="er">−</span><span class="dt">&gt;</span> bool<span class="kw">;</span>  <span class="fu">//</span> <span class="fu">compare</span> a <span class="dt">T2</span> to a <span class="dt">T</span> with <span class="fu">==</span></span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>         <span class="kw">{</span> b <span class="kw">!=</span> a <span class="kw">}</span> <span class="er">−</span><span class="dt">&gt;</span> bool<span class="kw">;</span>  <span class="fu">//</span> <span class="fu">compare</span> a <span class="dt">T2</span> to a <span class="dt">T</span> with <span class="kw">!=</span></span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">};</span></span></code></pre></div>
<p>The <code class="calibre8">typename T2 =T</code> says that if we
don’t specify a second template argument, <code
class="calibre8">T2</code> will be the same as <code
class="calibre8">T</code>; <code class="calibre8">T</code> is a
<em>default template argument</em>.</p>
<p>We can test <code class="calibre8">Equality_comparable</code> like
this:</p>
<p><a href="#part0031_split_012.html#p0098_02a"
id="part0012.html#p0098_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb217"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>static_assert(<span class="dt">Equality_comparable&lt;</span>int<span class="kw">,</span>double<span class="dt">&gt;</span>)<span class="kw">;</span>  <span class="fu">//</span> succeeds</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>static_assert(<span class="dt">Equality_comparable&lt;</span>int<span class="er">&gt;</span>)<span class="kw">;</span>         <span class="fu">//</span> succeeds (<span class="dt">T2</span> <span class="dt">is</span> defaulted to int)</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>static_assert(<span class="dt">Equality_comparable&lt;</span>int<span class="kw">,</span>string<span class="dt">&gt;</span>)<span class="kw">;</span>  <span class="fu">//</span> fails</span></code></pre></div>
<p>For a more complex example, consider a sequence:</p>
<p><a href="#part0031_split_013.html#p0098_03a"
id="part0012.html#p0098_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb218"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">S</span><span class="er">&gt;</span></span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>concept <span class="dt">Sequence</span> <span class="kw">=</span> requires(<span class="dt">S</span> a) <span class="kw">{</span></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>     typename <span class="dt">Value_type&lt;S</span><span class="er">&gt;</span><span class="kw">;</span>             <span class="fu">//</span> <span class="dt">S</span> must have a value type.</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>     typename <span class="dt">Iterator_type&lt;S</span><span class="er">&gt;</span><span class="kw">;</span>          <span class="fu">//</span> <span class="dt">S</span> must have an iterator type.</span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span> begin(a) <span class="kw">}</span> <span class="er">−</span><span class="dt">&gt;</span> <span class="dt">Iterator_type</span><span class="er">&lt;</span><span class="dt">S&gt;</span><span class="kw">;</span>   <span class="fu">//</span> begin(a) must return an iterator</span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span> end(a) <span class="kw">}</span> <span class="er">−</span><span class="dt">&gt;</span> <span class="dt">Iterator_type</span><span class="er">&lt;</span><span class="dt">S&gt;</span><span class="kw">;</span>     <span class="fu">//</span> end(a) must return an iterator</span>
<span id="cb218-8"><a href="#cb218-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-9"><a href="#cb218-9" aria-hidden="true" tabindex="-1"></a>     requires <span class="dt">Same_type&lt;Value_type</span><span class="er">&lt;</span><span class="dt">S&gt;</span><span class="kw">,</span><span class="dt">Value_type&lt;Iterator_type</span><span class="er">&lt;</span><span class="dt">S</span>&gt;&gt;&gt;<span class="kw">;</span></span>
<span id="cb218-10"><a href="#cb218-10" aria-hidden="true" tabindex="-1"></a>     requires <span class="dt">Input_iterator&lt;Iterator_type</span><span class="er">&lt;</span><span class="dt">S</span><span class="al">&gt;&gt;</span><span class="kw">;</span></span>
<span id="cb218-11"><a href="#cb218-11" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>For a type <code class="calibre8">S</code> to be a <code
class="calibre8">Sequence</code>, it must provide a <code
class="calibre8">Value_type</code> (the type of its elements) and an
<code class="calibre8">Iterator_type</code> (the type of its iterators;
see §<a href="#part0017.html#ch12lev1sec1" class="calibre6">12.1</a>).
It must also ensure that there exist <code
class="calibre8">begin()</code> and <code class="calibre8">end()</code>
functions that return iterators, as is idiomatic for standard-library
containers (§<a href="#part0016.html#ch11lev1sec3"
class="calibre6">11.3</a>). Finally, the <code
class="calibre8">Iterator_type</code> really must be an <code
class="calibre8">input_iterator</code> with elements of the same type as
the elements of <code class="calibre8">S</code>.</p>
<p>The hardest concepts to define are the ones that represent
fundamental language concepts. Consequently, it is best to use a set
from an established library. For a useful collection, see §<a
href="#part0017.html#ch12lev1sec7" class="calibre6">12.7</a>.</p>
<h3 class="h2" id="part0012.html#ch07lev1sec3">7.3 Generic
Programming</h3>
<p>The form of <em>generic programming</em> supported by C++ centers
around the idea of abstracting from concrete, efficient algorithms to
obtain generic algorithms that can be combined with different data
representations to produce a wide variety of useful software
[Stepanov,1989]. The abstractions representing the fundamental
operations and data structures are called <em>concepts</em>; they appear
as requirements for template parameters.</p>
<h4 class="h3" id="part0012.html#ch07lev2sec5"><span
id="part0012.html#page_99" class="calibre2 pagebreak"></span>7.3.1 Use
of Concepts</h4>
<p>Good, useful concepts are fundamental and are discovered more than
they are designed. Examples are integer and floating-point number (as
defined even in Classic C), sequence, and more general mathematical
concepts, such as field and vector space. They represent the fundamental
concepts of a field of application. That is why they are called
“concepts.” Identifying and formalizing concepts to the degree necessary
for effective generic programming can be a challenge.</p>
<p>For basic use, consider the concept <code
class="calibre8">Regular</code> (§<a href="#part0017.html#ch12lev1sec7"
class="calibre6">12.7</a>). A type is regular when it behaves much like
an <code class="calibre8">int</code> or a <code
class="calibre8">vector</code>. An object of a regular type</p>
<ul>
<li><p>can be default constructed.</p></li>
<li><p>can be copied (with the usual semantics of copy, yielding two
objects that are independent and compare equal) using a constructor or
an assignment.</p></li>
<li><p>can be compared using <code class="calibre8">==</code> and <code
class="calibre8">!=</code>.</p></li>
<li><p>doesn’t suffer technical problems from overly clever programming
tricks.</p></li>
</ul>
<p>A <code class="calibre8">string</code> is another example of a
regular type. Like <code class="calibre8">int</code>, <code
class="calibre8">string</code> is also <code
class="calibre8">StrictTotallyOrdered</code> (§<a
href="#part0017.html#ch12lev1sec7" class="calibre6">12.7</a>). That is,
two strings can be compared using <code class="calibre8">&lt;</code>,
<code class="calibre8">&lt;=</code>, <code class="calibre8">&gt;</code>,
and <code class="calibre8">&gt;=</code> with the appropriate
semantics.</p>
<p>A concept is not just a syntactic notion, it is fundamentally about
semantics. For example, don’t define <code class="calibre8">+</code> to
divide; that would not match the requirements for any reasonable number.
Unfortunately, we do not yet have any language support for expressing
semantics, so we have to rely on expert knowledge and common sense to
get semantically meaningful concepts. Do not define semantically
meaningless concepts, such as <code class="calibre8">Addable</code> and
<code class="calibre8">Subtractable</code>. Instead, rely on domain
knowledge to define concepts that match fundamental concepts in an
application domain.</p>
<h4 class="h3" id="part0012.html#ch07lev2sec6">7.3.2 Abstraction Using
Templates</h4>
<p>Good abstractions are carefully grown from concrete examples. It is
not a good idea to try to “abstract” by trying to prepare for every
conceivable need and technique; in that direction lies inelegance and
code bloat. Instead, start with one – and preferably more – concrete
examples from real use and try to eliminate inessential details.
Consider:</p>
<p><a href="#part0031_split_014.html#p0099_01a"
id="part0012.html#p0099_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb219"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>double sum(const vector<span class="dt">&lt;</span>int&gt;&amp; v)</span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a>    double res <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a>    for (auto x <span class="fu">:</span> v)</span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a>         res += x<span class="kw">;</span></span>
<span id="cb219-6"><a href="#cb219-6" aria-hidden="true" tabindex="-1"></a>    return res<span class="kw">;</span></span>
<span id="cb219-7"><a href="#cb219-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This is obviously one of many ways to compute the sum of a sequence
of numbers.</p>
<p>Consider what makes this code less general than it needs to be:</p>
<ul>
<li><p>Why just <code class="calibre8">int</code>s?</p></li>
<li><p>Why just <code class="calibre8">vector</code>s?</p></li>
<li><p>Why accumulate in a <code
class="calibre8">double</code>?</p></li>
<li><p>Why start at <code class="calibre8">0</code>?</p></li>
<li><p>Why add?</p></li>
</ul>
<p>Answering the first four questions by making the concrete types into
template arguments, we get the simplest form of the standard-library
<code class="calibre8">accumulate</code> algorithm:</p>
<p><a href="#part0031_split_015.html#p0100_01a"
id="part0012.html#p0100_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb220"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Iter</span><span class="kw">,</span> typename <span class="dt">Val&gt;</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Val</span> accumulate(<span class="dt">Iter</span> first<span class="er">,</span> <span class="dt">Iter</span> last<span class="er">,</span> <span class="dt">Val</span> res)</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>     for (auto p <span class="fu">=</span> first<span class="fu">;</span> p!<span class="fu">=</span>last<span class="fu">;</span> ++p)</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>           res += <span class="dt">*</span>p<span class="kw">;</span></span>
<span id="cb220-6"><a href="#cb220-6" aria-hidden="true" tabindex="-1"></a>     return res<span class="kw">;</span></span>
<span id="cb220-7"><a href="#cb220-7" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>Here, we have:</p>
<ul>
<li><p>The data structure to be traversed has been abstracted into a
pair of iterators representing a sequence (§<a
href="#part0017.html#ch12lev1sec1" class="calibre6">12.1</a>).</p></li>
<li><p>The type of the accumulator has been made into a
parameter.</p></li>
<li><p>The initial value is now an input; the type of the accumulator is
the type of this initial value.</p></li>
</ul>
<p>A quick examination or – even better – measurement will show that the
code generated for calls with a variety of data structures is identical
to what you get from the hand-coded original example. For example:</p>
<p><a href="#part0031_split_016.html#p0100_02a"
id="part0012.html#p0100_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb221"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>void use(const vector<span class="dt">&lt;</span>int&gt;&amp; vec<span class="kw">,</span> const list<span class="dt">&lt;</span>double&gt;&amp; lst)</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>     auto sum <span class="kw">=</span> accumulate(begin(vec)<span class="kw">,</span>end(vec)<span class="kw">,</span><span class="fl">0.0</span>)<span class="kw">;</span> <span class="fu">//</span> accumulate in a double</span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>     auto sum2 <span class="kw">=</span> accumulate(begin(lst)<span class="kw">,</span>end(lst)<span class="kw">,</span>sum)<span class="kw">;</span></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span></span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The process of generalizing from a concrete piece of code (and
preferably from several) while preserving performance is called
<em>lifting</em>. Conversely, the best way to develop a template is
often to</p>
<ul>
<li><p>first, write a concrete version</p></li>
<li><p>then, debug, test, and measure it</p></li>
<li><p>finally, replace the concrete types with template
arguments.</p></li>
</ul>
<p>Naturally, the repetition of <code class="calibre8">begin()</code>
and <code class="calibre8">end()</code> is tedious, so we can simplify
the user interface a bit:</p>
<p><a href="#part0031_split_017.html#p0100_03a"
id="part0012.html#p0100_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb222"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;Range</span> <span class="dt">R</span><span class="kw">,</span> <span class="dt">Number</span> <span class="dt">Val&gt;</span>   <span class="dv">//</span> a <span class="dt">Range</span> <span class="dt">is</span> something with begin() and end()</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Val</span> accumulate(<span class="dt">R</span> r<span class="er">,</span> <span class="dt">Val</span> res <span class="fu">=</span> <span class="dv">0</span>)</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>     for (auto p <span class="fu">=</span> begin(r)<span class="fu">;</span> p!<span class="fu">=</span>end(r)<span class="fu">;</span> ++p)</span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>           res += <span class="dt">*</span>p<span class="kw">;</span></span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a>     return res<span class="kw">;</span></span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>For full generality, we can abstract the <code
class="calibre8">+=</code> operation also; see §<a
href="#part0019.html#ch14lev1sec3" class="calibre6">14.3</a>.</p>
<h3 class="h2" id="part0012.html#ch07lev1sec4">7.4 Variadic
Templates</h3>
<p>A template can be defined to accept an arbitrary number of arguments
of arbitrary types. Such a template is called a <em>variadic
template</em>. Consider a simple function to write out values of any
type that has a <code class="calibre8">&lt;&lt;</code> operator:</p>
<p><a href="#part0031_split_018.html#p0101_01a"
id="part0012.html#p0101_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb223"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>void user()</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>     print(<span class="ot">&quot;</span><span class="er">first</span><span class="ot">:</span><span class="er"> </span><span class="ot">&quot;</span><span class="kw">,</span> <span class="dv">1</span><span class="kw">,</span> <span class="fl">2.2</span><span class="kw">,</span> <span class="ot">&quot;</span><span class="er">hello</span><span class="ch">\n</span><span class="ot">&quot;</span>s)<span class="kw">;</span>              <span class="fu">//</span> first<span class="fu">:</span> <span class="dv">1</span> <span class="fl">2.2</span> hello</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>     print(<span class="ot">&quot;</span><span class="ch">\n</span><span class="er">second</span><span class="ot">:</span><span class="er"> </span><span class="ot">&quot;</span><span class="kw">,</span> <span class="fl">0.2</span><span class="kw">,</span> <span class="st">&#39;</span><span class="er">c</span><span class="st">&#39;</span><span class="kw">,</span> <span class="ot">&quot;</span><span class="er">yuck</span><span class="ot">!&quot;</span>s<span class="kw">,</span> <span class="dv">0</span><span class="kw">,</span> <span class="dv">1</span><span class="kw">,</span> <span class="dv">2</span><span class="kw">,</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)<span class="kw">;</span>   <span class="fu">//</span> second<span class="fu">:</span> <span class="fl">0.2</span> c yuck<span class="kw">!</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">2</span></span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Traditionally, implementing a variadic template has been to separate
the first argument from the rest and then recursively call the variadic
template for the tail of the arguments:</p>
<p><a href="#part0031_split_019.html#p0101_02a"
id="part0012.html#p0101_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb224"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>void print()</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> what we do for no arguments<span class="fu">:</span> nothing</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="kw">,</span> typename ... <span class="dt">Tail&gt;</span></span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>void print(<span class="dt">T</span> head<span class="er">,</span> <span class="dt">Tail</span>... tail)</span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a>     <span class="dv">//</span> what we do for each argument<span class="kw">,</span> e<span class="kw">.</span>g<span class="kw">.,</span></span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> head <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="er"> </span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>     print(tail...)<span class="kw">;</span></span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>The <code class="calibre8">typename ...</code> indicates that <code
class="calibre8">Tail</code> is a sequence of types. The <code
class="calibre8">Tail...</code> indicates that <code
class="calibre8">tail</code> is a sequence of values of the types in
<code class="calibre8">Tail</code>. A parameter declared with a <code
class="calibre8">...</code> is called a <em>parameter pack</em>. Here,
<code class="calibre8">tail</code> is a (function argument) parameter
pack where the elements are of the types found in the (template
argument) parameter pack <code class="calibre8">Tail</code>. So, <code
class="calibre8">print()</code> can take any number of arguments of any
types.</p>
<p>A call of <code class="calibre8">print()</code> separates the
arguments into a head (the first) and a tail (the rest). The head is
printed and then <code class="calibre8">print()</code> is called for the
tail. Eventually, of course, <code class="calibre8">tail</code> will
become empty, so we need the no-argument version of <code
class="calibre8">print()</code> to deal with that. If we don’t want to
allow the zero-argument case, we can eliminate that <code
class="calibre8">print()</code> using a compile-time <code
class="calibre8">if</code>:</p>
<p><a href="#part0031_split_020.html#p0101_03a"
id="part0012.html#p0101_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb225"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="kw">,</span> typename ... <span class="dt">Tail&gt;</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>void print(<span class="dt">T</span> head<span class="er">,</span> <span class="dt">Tail</span>... tail)</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> head <span class="al">&lt;&lt;</span> <span class="er">&#39;</span> <span class="er">&#39;</span><span class="kw">;</span></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>     if constexpr(sizeof...(tail)<span class="dt">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>          print(tail...)<span class="kw">;</span></span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>I used a compile-time <code class="calibre8">if</code> (§<a
href="#part0011.html#ch06lev2sec9" class="calibre6">6.4.3</a>), rather
than a plain run-time <code class="calibre8">if</code> to avoid a final,
never called, call <code class="calibre8">print()</code> from being
generated.</p>
<p>The strength of variadic templates (sometimes just called
<em>variadics</em>) is that they can accept any arguments you care to
give them. Weaknesses include</p>
<ul>
<li><p>The recursive implementations can be tricky to get
right.</p></li>
<li><p>The recursive implementations can be surprisingly expensive in
compile time.</p></li>
<li><p>The type checking of the interface is a possibly elaborate
template program.</p></li>
</ul>
<p>Because of their flexibility, variadic templates are widely used in
the standard library, and occasionally wildly overused.</p>
<h4 class="h3" id="part0012.html#ch07lev2sec7"><span
id="part0012.html#page_102" class="calibre2 pagebreak"></span>7.4.1 Fold
Expressions</h4>
<p>To simplify the implementation of simple variadic templates, C++17
offers a limited form of iteration over elements of a parameter pack.
For example:</p>
<p><a href="#part0031_split_021.html#p0102_01a"
id="part0012.html#p0102_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb226"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;Number</span>... <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>int sum(<span class="dt">T</span>... v)</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>  return (v <span class="fu">+</span> ... <span class="fu">+</span> <span class="dv">0</span>)<span class="kw">;</span>     <span class="fu">//</span> add all elements of v starting with <span class="dv">0</span></span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Here, <code class="calibre8">sum()</code> can take any number of
arguments of any types. Assuming that <code
class="calibre8">sum()</code> really adds its arguments, we get:</p>
<p><a href="#part0031_split_022.html#p0102_02a"
id="part0012.html#p0102_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb227"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>int x <span class="kw">=</span> sum(<span class="dv">1</span><span class="kw">,</span> <span class="dv">2</span><span class="kw">,</span> <span class="dv">3</span><span class="kw">,</span> <span class="dv">4</span><span class="kw">,</span> <span class="dv">5</span>)<span class="kw">;</span>  <span class="fu">//</span> x becomes <span class="dv">15</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>int y <span class="kw">=</span> sum(<span class="st">&#39;</span><span class="er">a</span><span class="st">&#39;</span><span class="kw">,</span> <span class="fl">2.4</span><span class="kw">,</span> x)<span class="kw">;</span>    <span class="fu">//</span> y becomes <span class="dv">114</span> (<span class="fl">2.4</span> <span class="dt">is</span> truncated and the value of <span class="er">&#39;</span>a<span class="er">&#39;</span> <span class="dt">is</span> <span class="dv">97</span>)</span></code></pre></div>
<p>The body of <code class="calibre8">sum</code> uses a fold
expression:</p>
<p><a href="#part0031_split_023.html#p0102_03a"
id="part0012.html#p0102_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb228"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>return (v <span class="fu">+</span> ... <span class="fu">+</span> <span class="dv">0</span>)<span class="kw">;</span>   <span class="fu">//</span> add all elements of v to <span class="dv">0</span></span></code></pre></div>
<p>Here, <code class="calibre8">(v+...+0)</code> means add all the
elements of <code class="calibre8">v</code> starting with the initial
value <code class="calibre8">0</code>. The first element to be added is
the “rightmost” (the one with the highest index): <code
class="calibre8">(v[0]+(v[1]+(v[2]+(v[3]+(v[4]+0)))))</code>. That is,
starting from the right where the <code class="calibre8">0</code> is. It
is called a <em>right fold</em>. Alternatively, we could have used a
<em>left fold</em>:</p>
<p><a href="#part0031_split_024.html#p0102_04a"
id="part0012.html#p0102_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb229"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename ... <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>int sum2(<span class="dt">T</span>... v)</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>  return (<span class="dv">0</span> <span class="fu">+</span> ... <span class="fu">+</span> v)<span class="kw">;</span> <span class="fu">//</span> add all elements of v to <span class="dv">0</span></span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Now, the first element to be added is the “leftmost” (the one with
the lowest index): <code
class="calibre8">(((((0+v[0])+v[1])+v[2])+v[3])+v[4])</code>. That is,
starting from the left where the <code class="calibre8">0</code> is.</p>
<p><em>Fold</em> is a very powerful abstraction, clearly related to the
standard-library <code class="calibre8">accumulate()</code>, with a
variety of names in different languages and communities. In C++, the
fold expressions are currently restricted to simplify the implementation
of variadic templates. A fold does not have to perform numeric
computations. Consider a famous example:</p>
<p><a href="#part0031_split_025.html#p0102_05a"
id="part0012.html#p0102_05" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb230"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename ...<span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>void print(<span class="dt">T</span>&amp;&amp;... args)</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>  (std::cout <span class="al">&lt;&lt;</span> ... <span class="al">&lt;&lt;</span> args) <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span>  <span class="fu">//</span> print all arguments</span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>print(<span class="ot">&quot;</span><span class="er">Hello</span><span class="ot">!&quot;</span>s<span class="kw">,</span><span class="st">&#39;</span><span class="er"> </span><span class="st">&#39;</span><span class="kw">,</span><span class="ot">&quot;</span><span class="er">World </span><span class="ot">&quot;</span><span class="kw">,</span><span class="dv">2017</span>)<span class="kw">;</span>    <span class="fu">//</span> (((((std::cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">Hello</span><span class="ot">!&quot;</span>s) <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="er"> </span><span class="st">&#39;</span>) <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">World </span><span class="ot">&quot;</span>) <span class="al">&lt;&lt;</span> <span class="dv">2017</span>) <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>)<span class="kw">;</span></span></code></pre></div>
<p>Many use cases simply involve a set of values that can be converted
to a common type. In such cases, simply copying the arguments into a
vector or the desired type often simplifies further use:</p>
<p><a href="#part0031_split_026.html#p0103_01a"
id="part0012.html#p0103_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb231"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Res</span><span class="kw">,</span> typename... <span class="dt">Ts&gt;</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>vector<span class="er">&lt;</span><span class="dt">Res&gt;</span> to_vector(<span class="dt">Ts</span>&amp;&amp;... ts)</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>     vector<span class="er">&lt;</span><span class="dt">Res&gt;</span> res<span class="kw">;</span></span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>     (res<span class="al">.</span>push_back(ts) ...)<span class="kw">;</span>   <span class="fu">//</span> no initial value needed</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>     return res<span class="kw">;</span></span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>We can use <code class="calibre8">to_vector</code> like this:</p>
<p><a href="#part0031_split_027.html#p0103_02a"
id="part0012.html#p0103_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb232"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>auto x <span class="kw">=</span> to_vector<span class="dt">&lt;</span>double<span class="er">&gt;</span>(<span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="fl">4.5</span><span class="kw">,</span><span class="st">&#39;</span><span class="er">a</span><span class="st">&#39;</span>)<span class="kw">;</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename ... <span class="dt">Ts</span><span class="er">&gt;</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>int fct(<span class="dt">Ts</span>&amp;&amp;... ts)</span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>     auto args <span class="kw">=</span> to_vector<span class="dt">&lt;</span>string<span class="er">&gt;</span>(ts...)<span class="kw">;</span>    <span class="fu">//</span> args[i] <span class="dt">is</span> the ith argument</span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a>     <span class="dv">//</span> ... use args here ...</span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a>int y <span class="kw">=</span> fct(<span class="ot">&quot;</span><span class="er">foo</span><span class="ot">&quot;</span><span class="kw">,</span> <span class="ot">&quot;</span><span class="er">bar</span><span class="ot">&quot;</span><span class="kw">,</span> s)<span class="kw">;</span></span></code></pre></div>
<h4 class="h3" id="part0012.html#ch07lev2sec8">7.4.2 Forwarding
Arguments</h4>
<p>Passing arguments unchanged through an interface is an important use
of variadic templates. Consider a notion of a network input channel for
which the actual method of moving values is a parameter. Different
transport mechanisms have different sets of constructor parameters:</p>
<p><a href="#part0031_split_028.html#p0103_03a"
id="part0012.html#p0103_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb233"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Transport</span><span class="er">&gt;</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>  requires concepts::<span class="dt">InputTransport&lt;Transport</span><span class="er">&gt;</span></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>class <span class="dt">InputChannel</span> <span class="kw">{</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">InputChannel</span>(<span class="dt">TransportArgs</span>&amp;&amp;... transportArgs)</span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">:</span> <span class="dt">_transport</span>(std::forward<span class="dt">&lt;TransportArgs</span><span class="er">&gt;</span>(transportArgs)...)</span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>   <span class="kw">{}</span></span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">//</span> ...</span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a>   <span class="dt">Transport</span> <span class="dt">_transport</span><span class="kw">;</span></span>
<span id="cb233-11"><a href="#cb233-11" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>The standard-library function <code class="calibre8">forward()</code>
(§<a href="#part0018.html#ch13lev2sec2" class="calibre6">13.2.2</a>) is
used to move the arguments unchanged from the <code
class="calibre8">InputChannel</code> constructor to the <code
class="calibre8">Transport</code> constructor.</p>
<p>The point here is that the writer of <code
class="calibre8">InputChannel</code> can construct an object of type
<code class="calibre8">Transport</code> without having to know what
arguments are required to construct a particular <code
class="calibre8">Transport</code>. The implementer of <code
class="calibre8">InputChannel</code> needs only to know the common user
interface for all <code class="calibre8">Transport</code> objects.</p>
<p>Forwarding is very common in foundational libraries where generality
and low run-time overhead are necessary and very general interfaces are
common.</p>
<h3 class="h2" id="part0012.html#ch07lev1sec5"><span
id="part0012.html#page_104" class="calibre2 pagebreak"></span>7.5
Template Compilation Model</h3>
<p>Assuming concepts (§<a href="#part0012.html#ch07lev1sec2"
class="calibre6">7.2</a>), the arguments for a template are checked
against its concepts. Errors found here will be reported and the
programmer has to fix the problems. What cannot be checked at this
point, such as arguments for unconstrained template arguments, is
postponed until code is generated for the template and a set of template
arguments: “at template instantiation time.” For pre-concept code, this
is where all type checking happens. When using concepts, we get here
only after concept checking succeeded.</p>
<p>An unfortunate side effect of instantiation-time (late) type checking
is that a type error can be found uncomfortably late and can result in
spectacularly bad error messages because the compiler found the problem
only after combining information from several places in the program.</p>
<p>The instantiation-time type checking provided for templates checks
the use of arguments in the template definition. This provides a
compile-time variant of what is often called <em>duck typing</em> (“If
it walks like a duck and it quacks like a duck, it’s a duck”). Or –
using more technical terminology – we operate on values, and the
presence and meaning of an operation depend solely on its operand
values. This differs from the alternative view that objects have types,
which determine the presence and meaning of operations. Values “live” in
objects. This is the way objects (e.g., variables) work in C++, and only
values that meet an object’s requirements can be put into it. What is
done at compile time using templates mostly does not involve objects,
only values. The exception is local variables in a <code
class="calibre8">constexpr</code> function (§<a
href="#part0006.html#ch01lev1sec6" class="calibre6">1.6</a>) that are
used as objects inside the compiler.</p>
<p>To use an unconstrained template, its definition (not just its
declaration) must be in scope at its point of use. For example, the
standard header <code class="calibre8">&lt;vector&gt;</code> holds the
definition of <code class="calibre8">vector</code>. In practice, this
means that template definitions are typically found in header files,
rather than <code class="calibre8">.cpp</code> files. This changes when
we start to use modules (§<a href="#part0008.html#ch03lev1sec3"
class="calibre6">3.3</a>). Using modules, the source code is organized
in the same way for ordinary functions and template functions. In both
cases, definitions will be protected against the problems of textual
inclusion.</p>
<h3 class="h2" id="part0012.html#ch07lev1sec6">7.6 Advice</h3>
<p>[1] Templates provide a general mechanism for compile-time
programming; §<a href="#part0012.html#ch07lev1sec1"
class="calibre6">7.1</a>.</p>
<p>[2] When designing a template, carefully consider the concepts
(requirements) assumed for its template arguments; §<a
href="#part0012.html#ch07lev2sec6" class="calibre6">7.3.2</a>.</p>
<p>[3] When designing a template, use a concrete version for initial
implementation, debugging, and measurement; §<a
href="#part0012.html#ch07lev2sec6" class="calibre6">7.3.2</a>.</p>
<p>[4] Use concepts as a design tool; §<a
href="#part0012.html#ch07lev2sec1" class="calibre6">7.2.1</a>.</p>
<p>[5] Specify concepts for all template arguments; §<a
href="#part0012.html#ch07lev1sec2" class="calibre6">7.2</a>; [CG:
T.10].</p>
<p>[6] Whenever possible use standard concepts (e.g., the Ranges
concepts); §<a href="#part0012.html#ch07lev2sec4"
class="calibre6">7.2.4</a>; [CG: T.11].</p>
<p>[7] Use a lambda if you need a simple function object in one place
only; §<a href="#part0011.html#ch06lev2sec5"
class="calibre6">6.3.2</a>.</p>
<p>[8] There is no separate compilation of templates: <code
class="calibre8">#include</code> template definitions in every
translation unit that uses them.</p>
<p>[9] Use templates to express containers and ranges; §<a
href="#part0012.html#ch07lev2sec6" class="calibre6">7.3.2</a>; [CG:
T.3].</p>
<p>[10] Avoid “concepts” without meaningful semantics; §<a
href="#part0012.html#ch07lev1sec2" class="calibre6">7.2</a>; [CG:
T.20].</p>
<p>[11] Require a complete set of operations for a concept; §<a
href="#part0012.html#ch07lev1sec2" class="calibre6">7.2</a>; [CG:
T.21].</p>
<p><span id="part0012.html#page_105" class="pagebreak"></span>[12] Use
variadic templates when you need a function that takes a variable number
of arguments of a variety of types; §<a
href="#part0012.html#ch07lev1sec4" class="calibre6">7.4</a>.</p>
<p>[13] Don’t use variadic templates for homogeneous argument lists
(prefer initializer lists for that); §<a
href="#part0012.html#ch07lev1sec4" class="calibre6">7.4</a>.</p>
<p>[14] To use a template, make sure its definition (not just its
declaration) is in scope; §<a href="#part0012.html#ch07lev1sec5"
class="calibre6">7.5</a>.</p>
<p>[15] Templates offer compile-time “duck typing”; §<a
href="#part0012.html#ch07lev1sec5" class="calibre6">7.5</a>.</p>
</section>
<p><span id="part0013.html"></span></p>
<section id="part0013.html#ch08" class="h1 bodymatter">
<h2 class="h1"><span id="part0013.html#page_107"
class="calibre2 pagebreak"></span><span class="big">8</span></h2>
<p>Library Overview</p>
<p><em>Why waste time learning when ignorance is instantaneous?</em></p>
<p><em>– Hobbes</em></p>
<ul>
<li><p><a href="#part0013.html#ch08lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0013.html#ch08lev1sec2"
class="calibre6">Standard-Library Components</a></p></li>
<li><p><a href="#part0013.html#ch08lev1sec3"
class="calibre6">Standard-Library Headers and Namespace</a></p></li>
<li><p><a href="#part0013.html#ch08lev1sec4"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0013.html#ch08lev1sec1">8.1 Introduction</h3>
<p>No significant program is written in just a bare programming
language. First, a set of libraries is developed. These then form the
basis for further work. Most programs are tedious to write in the bare
language, whereas just about any task can be rendered simple by the use
of good libraries.</p>
<p>Continuing from <a href="#part0006.html#ch01"
class="calibre6">Chapters 1</a>–<a href="#part0012.html#ch07"
class="calibre6">7</a>, <a href="#part0014.html#ch09"
class="calibre6">Chapters 9</a>–<a href="#part0020.html#ch15"
class="calibre6">15</a> give a quick tour of key standard-library
facilities. I very briefly present useful standard-library types, such
as <code class="calibre8">string</code>, <code
class="calibre8">ostream</code>, <code class="calibre8">variant</code>,
<code class="calibre8">vector</code>, <code class="calibre8">map</code>,
<code class="calibre8">path</code>, <code
class="calibre8">unique_ptr</code>, <code
class="calibre8">thread</code>, <code class="calibre8">regex</code>, and
<code class="calibre8">complex</code>, as well as the most common ways
of using them.</p>
<p>As in <a href="#part0006.html#ch01" class="calibre6">Chapters
1</a>–<a href="#part0012.html#ch07" class="calibre6">7</a>, you are
strongly encouraged not to be distracted or discouraged by an incomplete
understanding of details. The purpose of this chapter is to convey a
basic understanding of the most useful library facilities.</p>
<p>The specification of the standard library is over two thirds of the
ISO C++ standard. Explore it, and prefer it to home-made alternatives.
Much thought has gone into its design, more still into its
implementations, and much effort will go into its maintenance and
extension.</p>
<p>The standard-library facilities described in this book are part of
every complete C++ implementation. In addition to the standard-library
components, most implementations offer “graphical user interface”
systems (GUIs), Web interfaces, database interfaces, etc. Similarly,
most application-development environments provide “foundation libraries”
for corporate or industrial “standard” development and/or execution
environments. Here, I do not describe such systems and libraries. <span
id="part0013.html#page_108" class="pagebreak"></span>The intent is to
provide a self-contained description of C++ as defined by the standard
and to keep the examples portable. Naturally, a programmer is encouraged
to explore the more extensive facilities available on most systems.</p>
<h3 class="h2" id="part0013.html#ch08lev1sec2">8.2 Standard-Library
Components</h3>
<p>The facilities provided by the standard library can be classified
like this:</p>
<ul>
<li><p>Run-time language support (e.g., for allocation and run-time type
information).</p></li>
<li><p>The C standard library (with very minor modifications to minimize
violations of the type system).</p></li>
<li><p>Strings (with support for international character sets,
localization, and read-only views of substrings); see §<a
href="#part0014.html#ch09lev1sec2" class="calibre6">9.2</a>.</p></li>
<li><p>Support for regular expression matching; see §<a
href="#part0014.html#ch09lev1sec4" class="calibre6">9.4</a>.</p></li>
<li><p>I/O streams is an extensible framework for input and output to
which users can add their own types, streams, buffering strategies,
locales, and character sets (<a href="#part0015.html#ch10"
class="calibre6">Chapter 10</a>). There is also a library for
manipulating file systems in a portable manner (§<a
href="#part0015.html#ch10lev1sec10"
class="calibre6">10.10</a>).</p></li>
<li><p>A framework of containers (such as <code
class="calibre8">vector</code> and <code class="calibre8">map</code>)
and algorithms (such as <code class="calibre8">find()</code>, <code
class="calibre8">sort()</code>, and <code
class="calibre8">merge()</code>); see <a href="#part0016.html#ch11"
class="calibre6">Chapter 11</a> and <a href="#part0017.html#ch12"
class="calibre6">Chapter 12</a>. This framework, conventionally called
the STL [<a href="#part0021.html#ref39"
class="calibre6">Stepanov,1994</a>], is extensible so users can add
their own containers and algorithms.</p></li>
<li><p>Support for numerical computation (such as standard mathematical
functions, complex numbers, vectors with arithmetic operations, and
random number generators); see §<a href="#part0009.html#ch04lev2sec1"
class="calibre6">4.2.1</a> and <a href="#part0019.html#ch14"
class="calibre6">Chapter 14</a>.</p></li>
<li><p>Support for concurrent programming, including <code
class="calibre8">thread</code>s and locks; see <a
href="#part0020.html#ch15" class="calibre6">Chapter 15</a>. The
concurrency support is foundational so that users can add support for
new models of concurrency as libraries.</p></li>
<li><p>Parallel versions of most STL algorithms and some numerical
algorithms (e.g., <code class="calibre8">sort()</code> and <code
class="calibre8">reduce()</code>); see §<a
href="#part0017.html#ch12lev1sec9" class="calibre6">12.9</a> and §<a
href="#part0019.html#ch14lev2sec1" class="calibre6">14.3.1</a>.</p></li>
<li><p>Utilities to support template metaprogramming (e.g., type traits;
§<a href="#part0018.html#ch13lev1sec9" class="calibre6">13.9</a>),
STL-style generic programming (e.g., <code class="calibre8">pair</code>;
§<a href="#part0018.html#ch13lev2sec5" class="calibre6">13.4.3</a>),
general programming (e.g., <code class="calibre8">variant</code> and
<code class="calibre8">optional;</code> §<a
href="#part0018.html#ch13lev2sec6" class="calibre6">13.5.1</a>, §<a
href="#part0018.html#ch13lev2sec7" class="calibre6">13.5.2</a>), and
<code class="calibre8">clock</code> (§<a
href="#part0018.html#ch13lev1sec7" class="calibre6">13.7</a>).</p></li>
<li><p>Support for efficient and safe management of general resources,
plus an interface to optional garbage collectors (§<a
href="#part0010.html#ch05lev1sec3" class="calibre6">5.3</a>).</p></li>
<li><p>“Smart pointers” for resource management (e.g., <code
class="calibre8">unique_ptr</code> and <code
class="calibre8">shared_ptr</code>; §<a
href="#part0018.html#ch13lev2sec1"
class="calibre6">13.2.1</a>).</p></li>
<li><p>Special-purpose containers, such as <code
class="calibre8">array</code> (§<a href="#part0018.html#ch13lev2sec3"
class="calibre6">13.4.1</a>), <code class="calibre8">bitset</code> (§<a
href="#part0018.html#ch13lev2sec4" class="calibre6">13.4.2</a>), and
<code class="calibre8">tuple</code> (§<a
href="#part0018.html#ch13lev2sec5"
class="calibre6">13.4.3</a>).</p></li>
<li><p>Suffixes for popular units, such as <code
class="calibre8">ms</code> for milliseconds and <code
class="calibre8">i</code> for imaginary (§<a
href="#part0010.html#ch05lev2sec9" class="calibre6">5.4.4</a>).</p></li>
</ul>
<p>The main criteria for including a class in the library were that:</p>
<ul>
<li><p>it could be helpful to almost every C++ programmer (both novices
and experts),</p></li>
<li><p>it could be provided in a general form that did not add
significant overhead compared to a simpler version of the same facility,
and</p></li>
<li><p>simple uses should be easy to learn (relative to the inherent
complexity of their task).</p></li>
</ul>
<p>Essentially, the C++ standard library provides the most common
fundamental data structures together with the fundamental algorithms
used on them.</p>
<h3 class="h2" id="part0013.html#ch08lev1sec3"><span
id="part0013.html#page_109" class="calibre2 pagebreak"></span>8.3
Standard-Library Headers and Namespace</h3>
<p>Every standard-library facility is provided through some standard
header. For example:</p>
<div class="sourceCode" id="cb234"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>#<span class="al">include</span><span class="dt">&lt;</span>string<span class="er">&gt;</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>#<span class="al">include</span><span class="dt">&lt;</span>list<span class="er">&gt;</span></span></code></pre></div>
<p>This makes the standard <code class="calibre8">string</code> and
<code class="calibre8">list</code> available.</p>
<p>The standard library is defined in a namespace (§<a
href="#part0008.html#ch03lev1sec4" class="calibre6">3.4</a>) called
<code class="calibre8">std</code>. To use standard-library facilities,
the <code class="calibre8">std::</code> prefix can be used:</p>
<p><a href="#part0032_split_000.html#p0109_01a"
id="part0013.html#p0109_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb235"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>std::string sheep <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Four legs Good</span><span class="ot">;</span><span class="er"> two legs Baaad</span><span class="ot">!&quot;</span><span class="kw">};</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>std::list<span class="dt">&lt;</span>std::string<span class="er">&gt;</span> slogans <span class="kw">{</span><span class="ot">&quot;</span><span class="er">War is Peace</span><span class="ot">&quot;</span><span class="kw">,</span> <span class="ot">&quot;</span><span class="er">Freedom is Slavery</span><span class="ot">&quot;</span><span class="kw">,</span> <span class="ot">&quot;</span><span class="er">Ignorance is Strength</span><span class="ot">&quot;</span><span class="kw">};</span></span></code></pre></div>
<p>For simplicity, I will rarely use the <code
class="calibre8">std::</code> prefix explicitly in examples. Neither
will I always <code class="calibre8">#include</code> the necessary
headers explicitly. To compile and run the program fragments here, you
must <code class="calibre8">#include</code> the appropriate headers and
make the names they declare accessible. For example:</p>
<p><a href="#part0032_split_001.html#p0109_02a"
id="part0013.html#p0109_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb236"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>#<span class="al">include</span><span class="dt">&lt;</span>string<span class="er">&gt;</span>           <span class="fu">//</span> make the standard string facilities accessible</span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>using namespace std<span class="kw">;</span>       <span class="fu">//</span> make std names available without std:: prefix</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>string s <span class="kw">{</span><span class="ot">&quot;</span><span class="er">C</span><span class="ot">++</span><span class="er"> is a general</span><span class="ot">−</span><span class="er">purpose programming language</span><span class="ot">&quot;</span><span class="kw">};</span>   <span class="fu">//</span> <span class="dt">OK</span><span class="fu">:</span> string <span class="dt">is</span> std::string</span></code></pre></div>
<p>It is generally in poor taste to dump every name from a namespace
into the global namespace. However, in this book, I use the standard
library exclusively and it is good to know what it offers.</p>
<p>Here is a selection of standard-library headers, all supplying
declarations in namespace <code class="calibre8">std</code>:</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="3" class="calibre14"><p><strong>Selected Standard Library
Headers</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;algorithm&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">copy()</code>, <code
class="calibre8">find()</code>, <code
class="calibre8">sort()</code></p></td>
<td class="calibre14"><p><a href="#part0017.html#ch12"
class="calibre6">Chapter 12</a></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;array&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">array</code></p></td>
<td class="calibre14"><p>§<a href="#part0018.html#ch13lev2sec3"
class="calibre6">13.4.1</a></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;chrono&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">duration</code>, <code
class="calibre8">time_point</code></p></td>
<td class="calibre14"><p>§<a href="#part0018.html#ch13lev1sec7"
class="calibre6">13.7</a></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;cmath&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">sqrt()</code>, <code
class="calibre8">pow()</code></p></td>
<td class="calibre14"><p>§<a href="#part0019.html#ch14lev1sec2"
class="calibre6">14.2</a></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;complex&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">complex</code>, <code
class="calibre8">sqrt()</code>, <code
class="calibre8">pow()</code></p></td>
<td class="calibre14"><p>§<a href="#part0019.html#ch14lev1sec4"
class="calibre6">14.4</a></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;filesystem&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">path</code></p></td>
<td class="calibre14"><p>§<a href="#part0015.html#ch10lev1sec10"
class="calibre6">10.10</a></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;forward_list&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">forward_list</code></p></td>
<td class="calibre14"><p>§<a href="#part0016.html#ch11lev1sec6"
class="calibre6">11.6</a></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;fstream&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">fstream</code>, <code
class="calibre8">ifstream</code>, <code
class="calibre8">ofstream</code></p></td>
<td class="calibre14"><p>§<a href="#part0015.html#ch10lev1sec7"
class="calibre6">10.7</a></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;future&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">future</code>, <code
class="calibre8">promise</code></p></td>
<td class="calibre14"><p>§<a href="#part0020.html#ch15lev1sec7"
class="calibre6">15.7</a></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;ios&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">hex</code>, <code
class="calibre8">dec</code>, <code class="calibre8">scientific</code>,
<code class="calibre8">fixed</code>, <code
class="calibre8">defaultfloat</code></p></td>
<td class="calibre14"><p>§<a href="#part0015.html#ch10lev1sec6"
class="calibre6">10.6</a></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;iostream&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">istream</code>, <code
class="calibre8">ostream</code>, <code class="calibre8">cin</code>,
<code class="calibre8">cout</code></p></td>
<td class="calibre14"><p><a href="#part0015.html#ch10"
class="calibre6">Chapter 10</a></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;map&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">map</code>, <code
class="calibre8">multimap</code></p></td>
<td class="calibre14"><p>§<a href="#part0016.html#ch11lev1sec5"
class="calibre6">11.5</a></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;memory&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">unique_ptr</code>, <code
class="calibre8">shared_ptr</code>, <code
class="calibre8">allocator</code></p></td>
<td class="calibre14"><p>§<a href="#part0018.html#ch13lev2sec1"
class="calibre6">13.2.1</a></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;random&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">default_random_engine</code>, <code
class="calibre8">normal_distribution</code></p></td>
<td class="calibre14"><p>§<a href="#part0019.html#ch14lev1sec5"
class="calibre6">14.5</a></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;regex&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">regex</code>, <code
class="calibre8">smatch</code></p></td>
<td class="calibre14"><p>§<a href="#part0014.html#ch09lev1sec4"
class="calibre6">9.4</a></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;string&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">string</code>, <code
class="calibre8">basic_string</code></p></td>
<td class="calibre14"><p>§<a href="#part0014.html#ch09lev1sec2"
class="calibre6">9.2</a></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;set&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">set</code>, <code
class="calibre8">multiset</code></p></td>
<td class="calibre14"><p>§<a href="#part0016.html#ch11lev1sec6"
class="calibre6">11.6</a></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;sstream&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">istringstream</code>,
<code class="calibre8">ostringstream</code></p></td>
<td class="calibre14"><p>§<a href="#part0015.html#ch10lev1sec8"
class="calibre6">10.8</a></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><span id="part0013.html#page_110"
class="pagebreak"></span><code
class="calibre8">&lt;stdexcept&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">length_error</code>,
<code class="calibre8">out_of_range</code>, <code
class="calibre8">runtime_error</code></p></td>
<td class="calibre14"><p>§<a href="#part0008.html#ch03lev2sec1"
class="calibre6">3.5.1</a></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;thread&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">thread</code></p></td>
<td class="calibre14"><p>§<a href="#part0020.html#ch15lev1sec2"
class="calibre6">15.2</a></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;unordered_map&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">unordered_map</code>,
<code class="calibre8">unordered_multimap</code></p></td>
<td class="calibre14"><p>§<a href="#part0016.html#ch11lev1sec5"
class="calibre6">11.5</a></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;utility&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">move()</code>, <code
class="calibre8">swap()</code>, <code
class="calibre8">pair</code></p></td>
<td class="calibre14"><p><a href="#part0018.html#ch13"
class="calibre6">Chapter 13</a></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;variant&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">variant</code></p></td>
<td class="calibre14"><p>§<a href="#part0018.html#ch13lev2sec6"
class="calibre6">13.5.1</a></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;vector&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">vector</code></p></td>
<td class="calibre14"><p>§<a href="#part0016.html#ch11lev1sec2"
class="calibre6">11.2</a></p></td>
</tr>
</tbody>
</table>
<p>This listing is far from complete.</p>
<p>Headers from the C standard library, such as <code
class="calibre8">&lt;stdlib.h&gt;</code> are provided. For each such
header there is also a version with its name prefixed by <code
class="calibre8">c</code> and the <code class="calibre8">.h</code>
removed. This version, such as <code
class="calibre8">&lt;cstdlib&gt;</code> places its declarations in the
<code class="calibre8">std</code> namespace.</p>
<h3 class="h2" id="part0013.html#ch08lev1sec4">8.4 Advice</h3>
<p>[1] Don’t reinvent the wheel; use libraries; §<a
href="#part0013.html#ch08lev1sec1" class="calibre6">8.1</a>; [CG:
SL.1.]</p>
<p>[2] When you have a choice, prefer the standard library over other
libraries; §<a href="#part0013.html#ch08lev1sec1"
class="calibre6">8.1</a>; [CG: SL.2].</p>
<p>[3] Do not think that the standard library is ideal for everything;
§<a href="#part0013.html#ch08lev1sec1" class="calibre6">8.1</a>.</p>
<p>[4] Remember to <code class="calibre8">#include</code> the headers
for the facilities you use; §<a href="#part0013.html#ch08lev1sec3"
class="calibre6">8.3</a>.</p>
<p>[5] Remember that standard-library facilities are defined in
namespace <code class="calibre8">std</code>; §<a
href="#part0013.html#ch08lev1sec3" class="calibre6">8.3</a>; [CG:
SL.3].</p>
</section>
<p><span id="part0014.html"></span></p>
<section id="part0014.html#ch09" class="h1 bodymatter">
<h2 class="h1"><span id="part0014.html#page_111"
class="calibre2 pagebreak"></span><span class="big">9</span></h2>
<p>Strings and Regular Expressions</p>
<p><em>Prefer the standard to the offbeat.</em></p>
<p><em>– Strunk &amp; White</em></p>
<ul>
<li><p><a href="#part0014.html#ch09lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0014.html#ch09lev1sec2"
class="calibre6">Strings</a></p>
<p><a href="#part0014.html#ch09lev2sec1" class="calibre6"><code
class="calibre8">string</code> Implementation</a>;</p></li>
<li><p><a href="#part0014.html#ch09lev1sec3" class="calibre6">String
Views</a></p></li>
<li><p><a href="#part0014.html#ch09lev1sec4" class="calibre6">Regular
Expressions</a></p>
<p><a href="#part0014.html#ch09lev2sec2" class="calibre6">Searching</a>;
<a href="#part0014.html#ch09lev2sec3" class="calibre6">Regular
Expression Notation</a>; <a href="#part0014.html#ch09lev2sec4"
class="calibre6">Iterators</a></p></li>
<li><p><a href="#part0014.html#ch09lev1sec5"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0014.html#ch09lev1sec1">9.1 Introduction</h3>
<p>Text manipulation is a major part of most programs. The C++ standard
library offers a <code class="calibre8">string</code> type to save most
users from C-style manipulation of arrays of characters through
pointers. A <code class="calibre8">string_view</code> type allows us to
manipulate sequences of characters however they may be stored (e.g., in
a <code class="calibre8">std::string</code> or a <code
class="calibre8">char[]</code>). In addition, regular expression
matching is offered to help find patterns in text. The regular
expressions are provided in a form similar to what is common in most
modern languages. Both <code class="calibre8">string</code>s and <code
class="calibre8">regex</code> objects can use a variety of character
types (e.g., Unicode).</p>
<h3 class="h2" id="part0014.html#ch09lev1sec2">9.2 Strings</h3>
<p>The standard library provides a <code class="calibre8">string</code>
type to complement the string literals (§<a
href="#part0006.html#ch01lev2sec1" class="calibre6">1.2.1</a>). It
provides a <code class="calibre8">Regular</code> type (§<a
href="#part0012.html#ch07lev1sec2" class="calibre6">7.2</a>, §<a
href="#part0017.html#ch12lev1sec7" class="calibre6">12.7</a>) for owning
and manipulating a sequence of characters of various character types.
The <code class="calibre8">string</code> type provides a variety of
useful string operations, such as concatenation. For example:</p>
<p><a href="#part0033_split_000.html#p0112_01a"
id="part0014.html#p0112_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb237"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>string compose(const string&amp; name<span class="kw">,</span> const string&amp; domain)</span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>     return name <span class="fu">+</span> <span class="st">&#39;@&#39;</span> <span class="fu">+</span> domain<span class="kw">;</span></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a>auto addr <span class="kw">=</span> compose(<span class="ot">&quot;</span><span class="er">dmr</span><span class="ot">&quot;</span><span class="kw">,</span><span class="ot">&quot;</span><span class="er">bell</span><span class="ot">−</span><span class="er">labs</span><span class="ot">.</span><span class="er">com</span><span class="ot">&quot;</span>)<span class="kw">;</span></span></code></pre></div>
<p>Here, <code class="calibre8">addr</code> is initialized to the
character sequence <code class="calibre8">dmr@bell−labs.com</code>.
“Addition” of strings means concatenation. You can concatenate a <code
class="calibre8">string</code>, a string literal, a C-style string, or a
character to a <code class="calibre8">string</code>. The standard <code
class="calibre8">string</code> has a move constructor, so returning even
long <code class="calibre8">string</code>s by value is efficient (§<a
href="#part0010.html#ch05lev2sec5" class="calibre6">5.2.2</a>).</p>
<p>In many applications, the most common form of concatenation is adding
something to the end of a <code class="calibre8">string</code>. This is
directly supported by the <code class="calibre8">+=</code> operation.
For example:</p>
<p><a href="#part0033_split_001.html#p0112_02a"
id="part0014.html#p0112_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb238"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>void m2(string&amp; s1<span class="kw">,</span> string&amp; s2)</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>     s1 <span class="kw">=</span> s1 <span class="fu">+</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span>  <span class="fu">//</span> append newline</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>     s2 += <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span>      <span class="fu">//</span> append newline</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The two ways of adding to the end of a <code
class="calibre8">string</code> are semantically equivalent, but I prefer
the latter because it is more explicit about what it does, more concise,
and possibly more efficient.</p>
<p>A <code class="calibre8">string</code> is mutable. In addition to
<code class="calibre8">=</code> and <code class="calibre8">+=</code>,
subscripting (using <code class="calibre8">[ ]</code>) and substring
operations are supported. For example:</p>
<p><a href="#part0033_split_002.html#p0112_03a"
id="part0014.html#p0112_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb239"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a>string name <span class="kw">=</span> <span class="ot">&quot;</span><span class="er">Niels Stroustrup</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>void m3()</span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>     string s <span class="kw">=</span> name.substr(<span class="dv">6</span><span class="kw">,</span><span class="dv">10</span>)<span class="kw">;</span>      <span class="fu">//</span> s <span class="kw">=</span> <span class="ot">&quot;</span><span class="er">Stroustrup</span><span class="ot">&quot;</span></span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a>     name.replace(<span class="dv">0</span><span class="kw">,</span><span class="dv">5</span><span class="kw">,</span><span class="ot">&quot;</span><span class="er">nicholas</span><span class="ot">&quot;</span>)<span class="kw">;</span>      <span class="fu">//</span> name becomes <span class="ot">&quot;</span><span class="er">nicholas Stroustrup</span><span class="ot">&quot;</span></span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a>     name[<span class="dv">0</span>] <span class="kw">=</span> toupper(name[<span class="dv">0</span>])<span class="kw">;</span>        <span class="fu">//</span> name becomes <span class="ot">&quot;</span><span class="er">Nicholas Stroustrup</span><span class="ot">&quot;</span></span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The <code class="calibre8">substr()</code> operation returns a <code
class="calibre8">string</code> that is a copy of the substring indicated
by its arguments. The first argument is an index into the <code
class="calibre8">string</code> (a position), and the second is the
length of the desired substring. Since indexing starts from <code
class="calibre8">0</code>, <code class="calibre8">s</code> gets the
value <code class="calibre8">Stroustrup</code>.</p>
<p>The <code class="calibre8">replace()</code> operation replaces a
substring with a value. In this case, the substring starting at <code
class="calibre8">0</code> with length <code class="calibre8">5</code> is
<code class="calibre8">Niels</code>; it is replaced by <code
class="calibre8">nicholas</code>. Finally, I replace the initial
character with its uppercase equivalent. Thus, the final value of <code
class="calibre8">name</code> is <code
class="calibre8">Nicholas Stroustrup</code>. Note that the replacement
string need not be the same size as the substring that it is
replacing.</p>
<p>Among the many useful <code class="calibre8">string</code> operations
are assignment (using <code class="calibre8">=</code>), subscripting
(using <code class="calibre8">[ ]</code> or <code
class="calibre8">at()</code> as for <code
class="calibre8">vector</code>; §<a href="#part0016.html#ch11lev2sec2"
class="calibre6">11.2.2</a>), comparison (using <code
class="calibre8">==</code> and <code class="calibre8">!=</code>), and
lexicographical ordering (using <code class="calibre8">&lt;</code>,
<code class="calibre8">&lt;=</code>, <code class="calibre8">&gt;</code>,
and <code class="calibre8">&gt;=</code>), iteration (using iterators as
for <code class="calibre8">vector</code>; §<a
href="#part0017.html#ch12lev1sec2" class="calibre6">12.2</a>), input
(§<a href="#part0015.html#ch10lev1sec3" class="calibre6">10.3</a>), and
streaming (§<a href="#part0015.html#ch10lev1sec8"
class="calibre6">10.8</a>).</p>
<p>Naturally, <code class="calibre8">string</code>s can be compared
against each other, against C-style strings §<a
href="#part0006.html#ch01lev2sec4" class="calibre6">1.7.1</a>), and
against string literals. For example:</p>
<p><a href="#part0033_split_003.html#p0113_01a"
id="part0014.html#p0113_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb240"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>string incantation<span class="kw">;</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a>void respond(const string&amp; answer)</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>     if (answer <span class="fu">==</span> incantation) <span class="kw">{</span></span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> perform magic</span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a>     else if (answer <span class="fu">==</span> <span class="ot">&quot;</span><span class="er">yes</span><span class="ot">&quot;</span>) <span class="kw">{</span></span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> ...</span>
<span id="cb240-10"><a href="#cb240-10" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb240-11"><a href="#cb240-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb240-12"><a href="#cb240-12" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>If you need a C-style string (a zero-terminated array of <code
class="calibre8">char</code>), <code class="calibre8">string</code>
offers read-only access to its contained characters. For example:</p>
<p><a href="#part0033_split_004.html#p0113_02a"
id="part0014.html#p0113_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb241"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a>void print(const string&amp; s)</span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>     printf(<span class="ot">&quot;</span><span class="er">For people who like printf</span><span class="ot">:</span><span class="er"> </span><span class="ot">%</span><span class="er">s</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">,</span>s<span class="al">.</span>c_str())<span class="kw">;</span>     <span class="fu">//</span> s.c_str() returns a pointer to s<span class="st">&#39;</span><span class="er"> characters</span></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a><span class="er">     cout </span><span class="st">&lt;&lt;</span><span class="er"> </span><span class="st">&quot;</span><span class="er">For people who like streams</span><span class="st">:</span><span class="er"> </span><span class="st">&quot;</span><span class="er"> </span><span class="st">&lt;&lt;</span><span class="er"> s </span><span class="st">&lt;&lt;</span><span class="er"> </span><span class="st">&#39;</span><span class="al">\</span>n<span class="st">&#39;</span><span class="er">;</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>A string literal is by definition a <code
class="calibre8">const char*</code>. To get a literal of type <code
class="calibre8">std::string</code> use a <code
class="calibre8">s</code> suffix. For example:</p>
<p><a href="#part0033_split_005.html#p0113_03a"
id="part0014.html#p0113_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb242"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>auto s <span class="kw">=</span> <span class="ot">&quot;</span><span class="er">Cat</span><span class="ot">&quot;</span>s<span class="kw">;</span>   <span class="fu">//</span> a std::string</span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>auto p <span class="kw">=</span> <span class="ot">&quot;</span><span class="er">Dog</span><span class="ot">&quot;</span><span class="kw">;</span>    <span class="fu">//</span> a <span class="dt">C</span><span class="fu">-</span>style string<span class="fu">:</span> a const char<span class="fu">*</span></span></code></pre></div>
<p>To use the <code class="calibre8">s</code> suffix, you need to use
the namespace <code
class="calibre8">std::literals::string_literals</code> (§<a
href="#part0010.html#ch05lev2sec9" class="calibre6">5.4.4</a>).</p>
<h4 class="h3" id="part0014.html#ch09lev2sec1">9.2.1 <code
class="calibre16">string</code> Implementation</h4>
<p>Implementing a string class is a popular and useful exercise.
However, for general-purpose use, our carefully crafted first attempts
rarely match the standard <code class="calibre8">string</code> in
convenience or performance. These days, <code
class="calibre8">string</code> is usually implemented using the
<em>short-string optimization</em>. That is, short string values are
kept in the <code class="calibre8">string</code> object itself and only
longer strings are placed on free store. Consider:</p>
<p><a href="#part0033_split_006.html#p0113_04a"
id="part0014.html#p0113_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb243"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>string s1 <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Annemarie</span><span class="ot">&quot;</span><span class="kw">};</span>               <span class="fu">//</span> short string</span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>string s2 <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Annemarie Stroustrup</span><span class="ot">&quot;</span><span class="kw">};</span>    <span class="fu">//</span> long string</span></code></pre></div>
<p>The memory layout will be something like this:</p>
<figure>
<img src="images/00018.jpeg" class="calibre1" />
</figure>
<p>When a <code class="calibre8">string</code>’s value changes from a
short to a long string (and vice versa) its representation adjusts
appropriately. How many characters can a “short” string have? That’s
implementation defined, but “about 14 characters” isn’t a bad guess.</p>
<p><span id="part0014.html#page_114" class="pagebreak"></span>The actual
performance of <code class="calibre8">string</code>s can depend
critically on the run-time environment. In particular, in multi-threaded
implementations, memory allocation can be relatively costly. Also, when
lots of strings of differing lengths are used, memory fragmentation can
result. These are the main reasons that the short-string optimization
has become ubiquitous.</p>
<p>To handle multiple character sets, <code
class="calibre8">string</code> is really an alias for a general template
<code class="calibre8">basic_string</code> with the character type <code
class="calibre8">char</code>:</p>
<p><a href="#part0033_split_007.html#p0114_01a"
id="part0014.html#p0114_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb244"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Char</span><span class="er">&gt;</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>class basic_string <span class="kw">{</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... string of <span class="dt">Char</span> ...</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>using string <span class="kw">=</span> basic_string<span class="dt">&lt;</span>char<span class="er">&gt;</span></span></code></pre></div>
<p>A user can define strings of arbitrary character types. For example,
assuming we have a Japanese character type <code
class="calibre8">Jchar</code>, we can write:</p>
<p><a href="#part0033_split_008.html#p0114_02a"
id="part0014.html#p0114_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb245"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a>using <span class="dt">Jstring</span> <span class="kw">=</span> basic_string<span class="dt">&lt;Jchar</span><span class="er">&gt;</span><span class="kw">;</span></span></code></pre></div>
<p>Now we can do all the usual string operations on <code
class="calibre8">Jstring</code>, a string of Japanese characters.</p>
<h3 class="h2" id="part0014.html#ch09lev1sec3">9.3 String Views</h3>
<p>The most common use of a sequence of characters is to pass it to some
function to read. This can be achieved by passing a <code
class="calibre8">string</code> by value, a reference to a string, or a
C-style string. In many systems there are further alternatives, such as
string types not offered by the standard. In all of these cases, there
are extra complexities when we want to pass a substring. To address
this, the standard library offers <code
class="calibre8">string_view</code>; a <code
class="calibre8">string_view</code> is basically a (pointer,length) pair
denoting a sequence of characters:</p>
<figure>
<img src="images/00019.jpeg" class="calibre1" />
</figure>
<p>A <code class="calibre8">string_view</code> gives access to a
contiguous sequence of characters. The characters can be stored in many
possible ways, including in a <code class="calibre8">string</code> and
in a C-style string. A <code class="calibre8">string_view</code> is like
a pointer or a reference in that it does not own the characters it
points to. In that, it resembles an STL pair of iterators (§<a
href="#part0017.html#ch12lev1sec3" class="calibre6">12.3</a>).</p>
<p>Consider a simple function concatenating two strings:</p>
<p><a href="#part0033_split_009.html#p0115_01a"
id="part0014.html#p0115_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb246"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>string cat(string_view sv1<span class="kw">,</span> string_view sv2)</span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>     string res(sv1<span class="al">.</span>length()<span class="fu">+</span>sv2<span class="al">.</span>length())<span class="kw">;</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>     char<span class="fu">*</span> p <span class="kw">=</span> &amp;res[<span class="dv">0</span>]<span class="kw">;</span></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>     for (char c <span class="fu">:</span> sv1)                 <span class="fu">//</span> one way to copy</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">*</span>p++ <span class="kw">=</span> c<span class="kw">;</span></span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>     copy(sv2<span class="al">.</span>begin()<span class="kw">,</span>sv2<span class="al">.</span>end()<span class="kw">,</span>p)<span class="kw">;</span>     <span class="fu">//</span> another way</span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>     return res<span class="kw">;</span></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>We can call this <code class="calibre8">cat()</code>:</p>
<p><a href="#part0033_split_010.html#p0115_02a"
id="part0014.html#p0115_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb247"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>string king <span class="kw">=</span> <span class="ot">&quot;</span><span class="er">Harold</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>auto s1 <span class="kw">=</span> cat(king<span class="kw">,</span><span class="ot">&quot;</span><span class="er">William</span><span class="ot">&quot;</span>)<span class="kw">;</span>                <span class="fu">//</span> string and const char<span class="fu">*</span></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>auto s2 <span class="kw">=</span> cat(king<span class="kw">,</span>king)<span class="kw">;</span>                     <span class="fu">//</span> string and string</span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>auto s3 <span class="kw">=</span> cat(<span class="ot">&quot;</span><span class="er">Edward</span><span class="ot">&quot;</span><span class="kw">,</span><span class="ot">&quot;</span><span class="er">Stephen</span><span class="ot">&quot;</span>sv)<span class="kw">;</span>          <span class="fu">//</span> const char <span class="fu">*</span> and string_view</span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>auto s4 <span class="kw">=</span> cat(<span class="ot">&quot;</span><span class="er">Canute</span><span class="ot">&quot;</span>sv<span class="kw">,</span>king)<span class="kw">;</span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>auto s5 <span class="kw">=</span> cat(<span class="kw">{</span>&amp;king[<span class="dv">0</span>]<span class="kw">,</span><span class="dv">2</span><span class="kw">},</span><span class="ot">&quot;</span><span class="er">Henry</span><span class="ot">&quot;</span>sv)<span class="kw">;</span>        <span class="fu">//</span> <span class="dt">HaHenry</span></span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a>auto s6 <span class="kw">=</span> cat(<span class="kw">{</span>&amp;king[<span class="dv">0</span>]<span class="kw">,</span><span class="dv">2</span><span class="kw">},{</span>&amp;king[<span class="dv">2</span>]<span class="kw">,</span><span class="dv">4</span><span class="kw">}</span>)<span class="kw">;</span>     <span class="fu">//</span> <span class="dt">Harold</span></span></code></pre></div>
<p>This <code class="calibre8">cat()</code> has three advantages over
the <code class="calibre8">compose()</code> that takes <code
class="calibre8">const string&amp;</code> arguments (§<a
href="#part0014.html#ch09lev1sec2" class="calibre6">9.2</a>):</p>
<ul>
<li><p>It can be used for character sequences managed in many different
ways.</p></li>
<li><p>No temporary <code class="calibre8">string</code> arguments are
created for C-style string arguments.</p></li>
<li><p>We can easily pass substrings.</p></li>
</ul>
<p>Note the use of the <code class="calibre8">sv</code> (“string view”)
suffix. To use that we need to</p>
<p><a href="#part0033_split_011.html#p0115_03a"
id="part0014.html#p0115_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb248"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>using namespace std::literals::string_view_literals<span class="kw">;</span>   <span class="fu">//</span> <span class="er">§</span><span class="fl">5.4</span><span class="kw">.</span><span class="dv">4</span></span></code></pre></div>
<p>Why bother? The reason is that when we pass <code
class="calibre8">"Edward"</code> we need to construct a <code
class="calibre8">string_view</code> from a <code
class="calibre8">const char*</code> and that requires counting the
characters. For <code class="calibre8">"Stephen"sv</code> the length is
computed at compile time.</p>
<p>When returning a <code class="calibre8">string_view</code>, remember
that it is very much like a pointer; it needs to point to something:</p>
<p><a href="#part0033_split_012.html#p0115_04a"
id="part0014.html#p0115_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb249"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a>string_view bad()</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>     string s <span class="kw">=</span> <span class="ot">&quot;</span><span class="er">Once upon a time</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>     return <span class="kw">{</span>&amp;s[<span class="dv">5</span>]<span class="kw">,</span><span class="dv">4</span><span class="kw">};</span>        <span class="fu">//</span> bad<span class="fu">:</span> returning a pointer to a local</span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>We are returning a pointer to characters of a <code
class="calibre8">string</code> that will be destroyed before we can use
them.</p>
<p>One significant restriction of <code
class="calibre8">string_view</code> is that it is a read-only view of
its characters. For example, you cannot use a <code
class="calibre8">string_view</code> to pass characters to a function
that modifies its argument to lowercase. For that, you might consider
using a <code class="calibre8">gsl::span</code> or <code
class="calibre8">gsl::string_span</code> (§<a
href="#part0018.html#ch13lev1sec3" class="calibre6">13.3</a>).</p>
<p>The behavior of out-of-range access to a <code
class="calibre8">string_view</code> is unspecified. If you want
guaranteed range checking, use <code class="calibre8">at()</code>, which
throws <code class="calibre8">out_of_range</code> for attempted
out-of-range access, use a <code
class="calibre8">gsl::string_span</code> (§<a
href="#part0018.html#ch13lev1sec3" class="calibre6">13.3</a>), or “just
be careful.”</p>
<h3 class="h2" id="part0014.html#ch09lev1sec4"><span
id="part0014.html#page_116" class="calibre2 pagebreak"></span>9.4
Regular Expressions</h3>
<p>Regular expressions are a powerful tool for text processing. They
provide a way to simply and tersely describe patterns in text (e.g., a
U.S. postal code such as <code class="calibre8">TX 77845</code>, or an
ISO-style date, such as <code class="calibre8">2009−06−07</code>) and to
efficiently find such patterns. In <code
class="calibre8">&lt;regex&gt;</code>, the standard library provides
support for regular expressions in the form of the <code
class="calibre8">std::regex</code> class and its supporting functions.
To give a taste of the style of the <code class="calibre8">regex</code>
library, let us define and print a pattern:</p>
<p><a href="#part0033_split_013.html#p0116_01a"
id="part0014.html#p0116_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb250"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>regex pat <span class="kw">{</span><span class="dt">R</span><span class="ot">&quot;(</span><span class="ch">\</span><span class="er">w</span><span class="ot">{2}</span><span class="ch">\</span><span class="er">s</span><span class="ot">*</span><span class="ch">\</span><span class="er">d</span><span class="ot">{5}(−</span><span class="ch">\</span><span class="er">d</span><span class="ot">{4})?)&quot;</span><span class="kw">};</span>  <span class="fu">//</span> <span class="dt">U</span><span class="kw">.</span><span class="dt">S</span><span class="kw">.</span> postal code pattern<span class="fu">:</span> <span class="dt">XXddddd</span><span class="fu">-</span>dddd and variants</span></code></pre></div>
<p>People who have used regular expressions in just about any language
will find <code class="calibre8">\w{2}\s*\d{5}(−\d{4})?</code> familiar.
It specifies a pattern starting with two letters <code
class="calibre8">\w{2}</code> optionally followed by some space <code
class="calibre8">\s*</code> followed by five digits <code
class="calibre8">\d{5}</code> and optionally followed by a dash and four
digits <code class="calibre8">−\d{4}</code>. If you are not familiar
with regular expressions, this may be a good time to learn about them
([<a href="#part0021.html#ref54" class="calibre6">Stroustrup,2009</a>],
[<a href="#part0021.html#ref33" class="calibre6">Maddock,2009</a>], [<a
href="#part0021.html#ref22" class="calibre6">Friedl,1997</a>]).</p>
<p>To express the pattern, I use a <em>raw string literal</em> starting
with <code class="calibre8">R"(</code> and terminated by <code
class="calibre8">)"</code>. This allows backslashes and quotes to be
used directly in the string. Raw strings are particularly suitable for
regular expressions because they tend to contain a lot of backslashes.
Had I used a conventional string, the pattern definition would have
been:</p>
<p><a href="#part0033_split_014.html#p0116_02a"
id="part0014.html#p0116_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb251"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a>regex pat <span class="kw">{</span><span class="ot">&quot;</span><span class="ch">\\</span><span class="er">w</span><span class="ot">{2}</span><span class="ch">\\</span><span class="er">s</span><span class="ot">*</span><span class="ch">\\</span><span class="er">d</span><span class="ot">{5}(−</span><span class="ch">\\</span><span class="er">d</span><span class="ot">{4})?&quot;</span><span class="kw">};</span>  <span class="fu">//</span> <span class="dt">U</span><span class="kw">.</span><span class="dt">S</span><span class="kw">.</span> postal code pattern</span></code></pre></div>
<p>In <code class="calibre8">&lt;regex&gt;</code>, the standard library
provides support for regular expressions:</p>
<ul>
<li><p><code class="calibre8">regex_match()</code>: Match a regular
expression against a string (of known size) (§<a
href="#part0014.html#ch09lev2sec3" class="calibre6">9.4.2</a>).</p></li>
<li><p><code class="calibre8">regex_search()</code>: Search for a string
that matches a regular expression in an (arbitrarily long) stream of
data (§<a href="#part0014.html#ch09lev2sec2"
class="calibre6">9.4.1</a>).</p></li>
<li><p><code class="calibre8">regex_replace()</code>: Search for strings
that match a regular expression in an (arbitrarily long) stream of data
and replace them.</p></li>
<li><p><code class="calibre8">regex_iterator</code>: Iterate over
matches and submatches (§<a href="#part0014.html#ch09lev2sec4"
class="calibre6">9.4.3</a>).</p></li>
<li><p><code class="calibre8">regex_token_iterator</code>: Iterate over
non-matches.</p></li>
</ul>
<h4 class="h3" id="part0014.html#ch09lev2sec2">9.4.1 Searching</h4>
<p>The simplest way of using a pattern is to search for it in a
stream:</p>
<p><a href="#part0033_split_015.html#p0116_03a"
id="part0014.html#p0116_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb252"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>int lineno <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>for (string line<span class="kw">;</span> getline(cin<span class="kw">,</span>line)<span class="kw">;</span> ) <span class="kw">{</span>      <span class="fu">//</span> <span class="fu">read</span> into line buffer</span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>      ++lineno<span class="kw">;</span></span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>      smatch matches<span class="kw">;</span>                         <span class="fu">//</span> matched strings go here</span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>      if (regex_search(line<span class="kw">,</span>matches<span class="kw">,</span>pat))     <span class="fu">//</span> search for pat in line</span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a>            cout <span class="al">&lt;&lt;</span> lineno <span class="al">&lt;&lt;</span> <span class="ot">&quot;:</span><span class="er"> </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> matches[<span class="dv">0</span>] <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The <code class="calibre8">regex_search(line,matches,pat)</code>
searches the <code class="calibre8">line</code> for anything that
matches the regular expression stored in <code
class="calibre8">pat</code> and if it finds any matches, it stores them
in <code class="calibre8">matches</code>. If no match was found, <code
class="calibre8">regex_search(line,matches,pat)</code> returns <code
class="calibre8">false</code>. The <code class="calibre8">matches</code>
variable is of type <code class="calibre8">smatch</code>. The “s” stands
for “sub” or “string,” and an <code class="calibre8">smatch</code> is a
<code class="calibre8">vector</code> of submatches of type <code
class="calibre8">string</code>. The first element, here <code
class="calibre8">matches[0]</code>, is the complete match. The result of
a <code class="calibre8">regex_search()</code> is a collection of
matches, typically represented as an <code
class="calibre8">smatch</code>:</p>
<p><a href="#part0033_split_016.html#p0117_01a"
id="part0014.html#p0117_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb253"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a>void use()</span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>     ifstream in(<span class="ot">&quot;</span><span class="er">file</span><span class="ot">.</span><span class="er">txt</span><span class="ot">&quot;</span>)<span class="kw">;</span>    <span class="fu">//</span> input file</span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>     if (<span class="kw">!</span>in)                    <span class="fu">//</span> check that the file was opened</span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>          cerr <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">no file</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>     regex pat <span class="kw">{</span><span class="dt">R</span><span class="ot">&quot;(</span><span class="ch">\</span><span class="er">w</span><span class="ot">{2}</span><span class="ch">\</span><span class="er">s</span><span class="ot">*</span><span class="ch">\</span><span class="er">d</span><span class="ot">{5}(−</span><span class="ch">\</span><span class="er">d</span><span class="ot">{4})?)&quot;</span><span class="kw">};</span>  <span class="fu">//</span> <span class="dt">U</span>.<span class="dt">S</span>. postal code pattern</span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a>     int lineno <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a>     for (string line<span class="kw">;</span> getline(in<span class="kw">,</span>line)<span class="kw">;</span> ) <span class="kw">{</span></span>
<span id="cb253-11"><a href="#cb253-11" aria-hidden="true" tabindex="-1"></a>           ++lineno<span class="kw">;</span></span>
<span id="cb253-12"><a href="#cb253-12" aria-hidden="true" tabindex="-1"></a>           smatch matches<span class="kw">;</span>   <span class="fu">//</span> matched strings go here</span>
<span id="cb253-13"><a href="#cb253-13" aria-hidden="true" tabindex="-1"></a>           if (regex_search(line<span class="kw">,</span> matches<span class="kw">,</span> pat)) <span class="kw">{</span></span>
<span id="cb253-14"><a href="#cb253-14" aria-hidden="true" tabindex="-1"></a>                 cout <span class="al">&lt;&lt;</span> lineno <span class="al">&lt;&lt;</span> <span class="ot">&quot;:</span><span class="er"> </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> matches[<span class="dv">0</span>] <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span>     <span class="fu">//</span> the complete match</span>
<span id="cb253-15"><a href="#cb253-15" aria-hidden="true" tabindex="-1"></a>                 if (<span class="dv">1</span><span class="dt">&lt;</span>matches<span class="al">.</span>size() &amp;&amp; matches[<span class="dv">1</span>]<span class="al">.</span>matched)       <span class="fu">//</span> if there <span class="dt">is</span> a sub<span class="dt">-</span>pattern</span>
<span id="cb253-16"><a href="#cb253-16" aria-hidden="true" tabindex="-1"></a>                                                                   <span class="dv">//</span> and if it <span class="dt">is</span> matched</span>
<span id="cb253-17"><a href="#cb253-17" aria-hidden="true" tabindex="-1"></a>                       cout <span class="al">&lt;&lt;</span> <span class="er">&quot;</span><span class="al">\</span>t<span class="fu">:</span> <span class="er">&quot;</span> <span class="al">&lt;&lt;</span> matches<span class="er">[</span><span class="dv">1</span><span class="er">]</span> <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span>       <span class="fu">//</span> submatch</span>
<span id="cb253-18"><a href="#cb253-18" aria-hidden="true" tabindex="-1"></a>           <span class="kw">}</span></span>
<span id="cb253-19"><a href="#cb253-19" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb253-20"><a href="#cb253-20" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This function reads a file looking for U.S. postal codes, such as
<code class="calibre8">TX77845</code> and <code
class="calibre8">DC 20500−0001</code>. An <code
class="calibre8">smatch</code> type is a container of regex results.
Here, <code class="calibre8">matches[0]</code> is the whole pattern and
<code class="calibre8">matches[1]</code> is the optional four-digit
subpattern.</p>
<p>The newline character, <code class="calibre8">\n</code>, can be part
of a pattern, so we can search for multiline patterns. Obviously, we
shouldn’t read one line at a time if we want to do that.</p>
<p>The regular expression syntax and semantics are designed so that
regular expressions can be compiled into state machines for efficient
execution [<a href="#part0021.html#ref14"
class="calibre6">Cox,2007</a>]. The <code class="calibre8">regex</code>
type performs this compilation at run time.</p>
<h4 class="h3" id="part0014.html#ch09lev2sec3">9.4.2 Regular Expression
Notation</h4>
<p>The <code class="calibre8">regex</code> library can recognize several
variants of the notation for regular expressions. Here, I use the
default notation, a variant of the ECMA standard used for ECMAScript
(more commonly known as JavaScript).</p>
<p>The syntax of regular expressions is based on characters with special
meaning:</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="4" class="calibre14"><p><strong>Regular Expression Special
Characters</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">.</code></p></td>
<td class="tab"><p>Any single character (a “wildcard”)</p></td>
<td class="calibre14"><p><code class="calibre8">\</code></p></td>
<td class="calibre14"><p>Next character has a special meaning</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">[</code></p></td>
<td class="tab"><p>Begin character class</p></td>
<td class="calibre14"><p><code class="calibre8">*</code></p></td>
<td class="calibre14"><p>Zero or more (suffix operation)</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">]</code></p></td>
<td class="tab"><p>End character class</p></td>
<td class="calibre14"><p><code class="calibre8">+</code></p></td>
<td class="calibre14"><p>One or more (suffix operation)</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">{</code></p></td>
<td class="tab"><p>Begin count</p></td>
<td class="calibre14"><p><code class="calibre8">?</code></p></td>
<td class="calibre14"><p>Optional (zero or one) (suffix
operation)</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">}</code></p></td>
<td class="tab"><p>End count</p></td>
<td class="calibre14"><p><code class="calibre8">|</code></p></td>
<td class="calibre14"><p>Alternative (or)</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">(</code></p></td>
<td class="tab"><p>Begin grouping</p></td>
<td class="calibre14"><p><code class="calibre8">^</code></p></td>
<td class="calibre14"><p>Start of line; negation</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">)</code></p></td>
<td class="tab"><p>End grouping</p></td>
<td class="calibre14"><p><code class="calibre8">$</code></p></td>
<td class="calibre14"><p>End of line</p></td>
</tr>
</tbody>
</table>
<p>For example, we can specify a line starting with zero or more <code
class="calibre8">A</code>s followed by one or more <code
class="calibre8">B</code>s <span id="part0014.html#page_118"
class="pagebreak"></span>followed by an optional <code
class="calibre8">C</code> like this:</p>
<div class="sourceCode" id="cb254"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">^</span><span class="dt">A</span><span class="fu">*</span><span class="dt">B</span><span class="fu">+</span><span class="dt">C</span>?$</span></code></pre></div>
<p>Examples that match:</p>
<p><a href="#part0033_split_017.html#p0118_01a"
id="part0014.html#p0118_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb255"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="dt">AAAAAAAAAAAABBBBBBBBBC</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="dt">BC</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="dt">B</span></span></code></pre></div>
<p>Examples that do not match:</p>
<p><a href="#part0033_split_018.html#p0118_02a"
id="part0014.html#p0118_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb256"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="dt">AAAAA</span>           <span class="fu">//</span> no <span class="dt">B</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">AAAABC</span>        <span class="fu">//</span> initial space</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="dt">AABBCC</span>          <span class="fu">//</span> too many <span class="dt">Cs</span></span></code></pre></div>
<p>A part of a pattern is considered a subpattern (which can be
extracted separately from an <code class="calibre8">smatch</code>) if it
is enclosed in parentheses. For example:</p>
<p><a href="#part0033_split_019.html#p0118_03a"
id="part0014.html#p0118_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb257"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="al">\</span>d<span class="fu">+</span><span class="er">−</span><span class="al">\</span>d<span class="fu">+</span>        <span class="fu">//</span> no subpatterns</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="al">\</span>d<span class="fu">+</span>(<span class="er">−</span><span class="al">\</span>d<span class="fu">+</span>)      <span class="fu">//</span> one subpattern</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>(<span class="al">\</span>d<span class="fu">+</span>)(<span class="er">−</span><span class="al">\</span>d<span class="fu">+</span>)    <span class="fu">//</span> two subpatterns</span></code></pre></div>
<p>A pattern can be optional or repeated (the default is exactly once)
by adding a suffix:</p>
<table class="all1">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2"
class="calibre14"><p><strong>Repetition</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">{n}</code></p></td>
<td class="calibre14"><p>Exactly <code class="calibre8">n</code>
times</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">{n,}</code></p></td>
<td class="calibre14"><p><code class="calibre8">n</code> or more
times</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">{n,m}</code></p></td>
<td class="calibre14"><p>At least <code class="calibre8">n</code> and at
most <code class="calibre8">m</code> times</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">*</code></p></td>
<td class="calibre14"><p>Zero or more, that is, <code
class="calibre8">{0,}</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">+</code></p></td>
<td class="calibre14"><p>One or more, that is, <code
class="calibre8">{1,}</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">?</code></p></td>
<td class="calibre14"><p>Optional (zero or one), that is <code
class="calibre8">{0,1}</code></p></td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="sourceCode" id="cb258"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="dt">A</span><span class="kw">{</span><span class="dv">3</span><span class="kw">}</span><span class="dt">B</span><span class="kw">{</span><span class="dv">2</span><span class="kw">,</span><span class="dv">4</span><span class="kw">}</span><span class="dt">C</span><span class="fu">*</span></span></code></pre></div>
<p>Examples that match:</p>
<div class="sourceCode" id="cb259"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="dt">AAABBC</span></span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="dt">AAABBB</span></span></code></pre></div>
<p>Examples that do not match:</p>
<p><a href="#part0033_split_020.html#p0118_04a"
id="part0014.html#p0118_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb260"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="dt">AABBC</span>          <span class="fu">//</span> too few <span class="dt">As</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="dt">AAABC</span>          <span class="fu">//</span> too few <span class="dt">Bs</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="dt">AAABBBBBCCC</span>    <span class="fu">//</span> too many <span class="dt">Bs</span></span></code></pre></div>
<p>A suffix <code class="calibre8">?</code> after any of the repetition
notations (<code class="calibre8">?</code>, <code
class="calibre8">*</code>, <code class="calibre8">+</code>, and <code
class="calibre8">{ }</code>) makes the pattern matcher “lazy” or
“non-greedy.” That is, when looking for a pattern, it will look for the
shortest match rather than the longest. By default, the pattern matcher
always looks for the longest match; this is known as the <em>Max Munch
rule</em>. Consider:</p>
<div class="sourceCode" id="cb261"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>ababab</span></code></pre></div>
<p><span id="part0014.html#page_119" class="pagebreak"></span>The
pattern <code class="calibre8">(ab)+</code> matches all of <code
class="calibre8">ababab</code>. However, <code
class="calibre8">(ab)+?</code> matches only the first <code
class="calibre8">ab</code>.</p>
<p>The most common character classifications have names:</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>Character
Classes</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">alnum</code></p></td>
<td class="calibre14"><p>Any alphanumeric character</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">alpha</code></p></td>
<td class="calibre14"><p>Any alphabetic character</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">blank</code></p></td>
<td class="calibre14"><p>Any whitespace character that is not a line
separator</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">cntrl</code></p></td>
<td class="calibre14"><p>Any control character</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">d</code></p></td>
<td class="calibre14"><p>Any decimal digit</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">digit</code></p></td>
<td class="calibre14"><p>Any decimal digit</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">graph</code></p></td>
<td class="calibre14"><p>Any graphical character</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">lower</code></p></td>
<td class="calibre14"><p>Any lowercase character</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">print</code></p></td>
<td class="calibre14"><p>Any printable character</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">punct</code></p></td>
<td class="calibre14"><p>Any punctuation character</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">s</code></p></td>
<td class="calibre14"><p>Any whitespace character</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">space</code></p></td>
<td class="calibre14"><p>Any whitespace character</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">upper</code></p></td>
<td class="calibre14"><p>Any uppercase character</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">w</code></p></td>
<td class="calibre14"><p>Any word character (alphanumeric characters
plus the underscore)</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">xdigit</code></p></td>
<td class="calibre14"><p>Any hexadecimal digit character</p></td>
</tr>
</tbody>
</table>
<p>In a regular expression, a character class name must be bracketed by
<code class="calibre8">[: :]</code>. For example, <code
class="calibre8">[:digit:]</code> matches a decimal digit. Furthermore,
they must be used within a <code class="calibre8">[ ]</code> pair
defining a character class.</p>
<p>Several character classes are supported by shorthand notation:</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="3" class="calibre14"><p><strong>Character Class
Abbreviations</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">\d</code></p></td>
<td class="calibre14"><p>A decimal digit</p></td>
<td class="calibre14"><p><code
class="calibre8">[[:digit:]]</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">\s</code></p></td>
<td class="calibre14"><p>A space (space, tab, etc.)</p></td>
<td class="calibre14"><p><code
class="calibre8">[[:space:]]</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="tab1"><p><code class="calibre8">\w</code></p></td>
<td class="tab1"><p>A letter (<code class="calibre8">a</code>-<code
class="calibre8">z</code>) or digit (<code
class="calibre8">0</code>-<code class="calibre8">9</code>) or underscore
(<code class="calibre8">_</code>)</p></td>
<td class="tab1"><p><code class="calibre8">[_[:alnum:]]</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">\D</code></p></td>
<td class="calibre14"><p>Not</p></td>
<td class="calibre14"><p><code
class="calibre8">\d [^[:digit:]]</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">\S</code></p></td>
<td class="calibre14"><p>Not</p></td>
<td class="calibre14"><p><code
class="calibre8">\s [^[:space:]]</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">\W</code></p></td>
<td class="calibre14"><p>Not</p></td>
<td class="calibre14"><p><code
class="calibre8">\w [^_[:alnum:]]</code></p></td>
</tr>
</tbody>
</table>
<p>In addition, languages supporting regular expressions often
provide:</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="3" class="calibre14"><p><strong>Nonstandard (but Common)
Character Class Abbreviations</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">\l</code></p></td>
<td class="calibre14"><p>A lowercase character</p></td>
<td class="calibre14"><p><code
class="calibre8">[[:lower:]]</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">\u</code></p></td>
<td class="calibre14"><p>An uppercase character</p></td>
<td class="calibre14"><p><code
class="calibre8">[[:upper:]]</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">\L</code></p></td>
<td class="calibre14"><p>Not</p></td>
<td class="calibre14"><p><code
class="calibre8">\l [^[:lower:]]</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">\U</code></p></td>
<td class="calibre14"><p>Not</p></td>
<td class="calibre14"><p><code
class="calibre8">\u [^[:upper:]]</code></p></td>
</tr>
</tbody>
</table>
<p>For full portability, use the character class names rather than these
abbreviations.</p>
<p>As an example, consider writing a pattern that describes C++
identifiers: an underscore or a letter followed by a possibly empty
sequence of letters, digits, or underscores. To illustrate the
subtleties involved, I include a few false attempts:</p>
<p><a href="#part0033_split_021.html#p0120_01a"
id="part0014.html#p0120_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb262"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>[<span class="fu">:</span>alpha<span class="fu">:</span>][<span class="fu">:</span>alnum<span class="fu">:</span>]<span class="fu">*</span>              <span class="fu">//</span> wrong<span class="fu">:</span> characters from the set <span class="ot">&quot;:</span><span class="er">alpha</span><span class="ot">&quot;</span> followed by ...</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>[[<span class="fu">:</span>alpha<span class="fu">:</span>]][[<span class="fu">:</span>alnum<span class="fu">:</span>]]<span class="fu">*</span>          <span class="fu">//</span> wrong<span class="fu">:</span> doesn<span class="st">&#39;</span><span class="er">t accept underscore </span><span class="st">(&#39;</span><span class="dt">_</span><span class="st">&#39;</span><span class="er"> is not alpha)</span></span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a><span class="er">([[:alpha:]]|_)[[:alnum:]]*      // wrong: underscore is not part of alnum either</span></span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a><span class="er">([[:alpha:]]|_)([[:alnum:]]|_)*        // OK, but clumsy</span></span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a><span class="er">[[:alpha:]_][[:alnum:]_]*              // OK: include the underscore in the character classes</span></span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a><span class="er">[_[:alpha:]][_[:alnum:]]*              // also OK</span></span>
<span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a><span class="er">[_</span><span class="st">[:</span><span class="er">alpha</span><span class="st">:]]</span><span class="ch">\</span><span class="er">w</span><span class="st">*</span><span class="er">                        </span><span class="st">//</span><span class="er"> </span><span class="ch">\</span><span class="er">w is equivalent to [_[:alnum:]]</span></span></code></pre></div>
<p>Finally, here is a function that uses the simplest version of <code
class="calibre8">regex_match()</code> (§<a
href="#part0014.html#ch09lev2sec2" class="calibre6">9.4.1</a>) to test
whether a string is an identifier:</p>
<p><a href="#part0033_split_022.html#p0120_02a"
id="part0014.html#p0120_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb263"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a>bool is_identifier(const string&amp; s)</span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>     regex pat <span class="kw">{</span><span class="ot">&quot;[</span><span class="er">_</span><span class="ot">[:</span><span class="er">alpha</span><span class="ot">:]]</span><span class="ch">\\</span><span class="er">w</span><span class="ot">*&quot;</span><span class="kw">};</span> <span class="fu">//</span> underscore or letter</span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">//</span> followed by zero or more underscores<span class="kw">,</span> letters<span class="kw">,</span> or digits</span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>     return regex_match(s<span class="kw">,</span>pat)<span class="kw">;</span></span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Note the doubling of the backslash to include a backslash in an
ordinary string literal. Use raw string literals to alleviate problems
with special characters. For example:</p>
<p><a href="#part0033_split_023.html#p0120_03a"
id="part0014.html#p0120_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb264"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>bool is_identifier(const string&amp; s)</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>     regex pat <span class="kw">{</span><span class="dt">R</span><span class="ot">&quot;([</span><span class="er">_</span><span class="ot">[:</span><span class="er">alpha</span><span class="ot">:]]</span><span class="ch">\</span><span class="er">w</span><span class="ot">*)&quot;</span><span class="kw">};</span></span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a>     return regex_match(s<span class="kw">,</span>pat)<span class="kw">;</span></span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Here are some examples of patterns:</p>
<p><a href="#part0033_split_024.html#p0120_04a"
id="part0014.html#p0120_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb265"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Ax</span><span class="fu">*</span>            <span class="fu">//</span> <span class="dt">A</span><span class="kw">,</span> <span class="dt">Ax</span><span class="kw">,</span> <span class="dt">Axxxx</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Ax</span><span class="fu">+</span>            <span class="fu">//</span> <span class="dt">Ax</span><span class="kw">,</span> <span class="dt">Axxx</span>     <span class="dt">Not</span> <span class="dt">A</span></span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a><span class="al">\</span>d<span class="er">−</span>?\d         <span class="fu">//</span> <span class="dv">1-2</span><span class="kw">,</span> <span class="dv">12</span>      <span class="dt">Not</span> <span class="dv">1</span>--<span class="dv">2</span></span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a><span class="al">\</span>w<span class="kw">{</span><span class="dv">2</span><span class="kw">}</span><span class="er">−</span><span class="al">\</span>d<span class="kw">{</span><span class="dv">4</span><span class="kw">,</span><span class="dv">5</span><span class="kw">}</span>  <span class="fu">//</span> <span class="dt">Ab</span><span class="dv">-1234</span><span class="kw">,</span> <span class="dt">XX</span><span class="dv">-54321</span><span class="kw">,</span> <span class="dv">22-5432</span>      <span class="dt">Digits</span> are in <span class="al">\</span>w</span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a>(<span class="al">\</span>d*:)?(<span class="al">\</span>d<span class="fu">+</span>)   <span class="fu">//</span> <span class="dv">12</span><span class="fu">:</span><span class="dv">3</span><span class="kw">,</span> <span class="dv">1</span><span class="fu">:</span><span class="dv">23</span><span class="kw">,</span> <span class="dv">123</span><span class="kw">,</span> <span class="fu">:</span><span class="dv">123</span>  <span class="dt">Not</span> <span class="dv">123</span><span class="fu">:</span></span>
<span id="cb265-6"><a href="#cb265-6" aria-hidden="true" tabindex="-1"></a>(bs|<span class="dt">BS</span>)        <span class="fu">//</span> bs<span class="kw">,</span> <span class="dt">BS</span>       <span class="dt">Not</span> bS</span>
<span id="cb265-7"><a href="#cb265-7" aria-hidden="true" tabindex="-1"></a>[aeiouy]       <span class="fu">//</span> a<span class="kw">,</span> o<span class="kw">,</span> u      <span class="dt">An</span> <span class="dt">English</span> vowel<span class="kw">,</span> not x</span>
<span id="cb265-8"><a href="#cb265-8" aria-hidden="true" tabindex="-1"></a>[<span class="fu">^</span>aeiouy]      <span class="fu">//</span> x<span class="kw">,</span> k         <span class="dt">Not</span> an <span class="dt">English</span> vowel<span class="kw">,</span> not e</span>
<span id="cb265-9"><a href="#cb265-9" aria-hidden="true" tabindex="-1"></a>[a<span class="fu">^</span>eiouy]      <span class="fu">//</span> a<span class="kw">,</span> <span class="fu">^</span><span class="kw">,</span> o<span class="kw">,</span> u   <span class="dt">An</span> <span class="dt">English</span> vowel or <span class="fu">^</span></span></code></pre></div>
<p>A <code class="calibre8">group</code> (a subpattern) potentially to
be represented by a <code class="calibre8">sub_match</code> is delimited
by parentheses. If you need parentheses that should not define a
subpattern, use <code class="calibre8">(?:</code> rather than plain
<code class="calibre8">(</code>. For example:</p>
<p><a href="#part0033_split_025.html#p0120_05a"
id="part0014.html#p0120_05" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb266"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>(<span class="al">\</span>s|<span class="fu">:</span>|<span class="kw">,</span>)<span class="fu">*</span>(<span class="al">\</span>d<span class="fu">*</span>)   <span class="fu">//</span> optional spaces<span class="kw">,</span> colons<span class="kw">,</span> and<span class="fu">/</span>or commas followed by an optional <span class="dt">number</span></span></code></pre></div>
<p>Assuming that we were not interested in the characters before the
number (presumably separators), we could write:</p>
<p><a href="#part0033_split_026.html#p0120_06a"
id="part0014.html#p0120_06" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb267"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>(?:\s|<span class="fu">:</span>|<span class="kw">,</span>)<span class="fu">*</span>(<span class="al">\</span>d<span class="fu">*</span>)  <span class="fu">//</span> optional spaces<span class="kw">,</span> colons<span class="kw">,</span> and<span class="fu">/</span>or commas followed by an optional <span class="dt">number</span></span></code></pre></div>
<p>This would save the regular expression engine from having to store
the first characters: the <code class="calibre8">(?</code> variant has
only one subpattern.</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><span id="part0014.html#page_121"
class="pagebreak"></span><strong>Regular Expression Grouping
Examples</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">\d*\s\w+</code></p></td>
<td class="calibre14"><p>No groups (subpatterns)</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">(\d*)\s(\w+)</code></p></td>
<td class="calibre14"><p>Two groups</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">(\d*)(\s(\w+))+</code></p></td>
<td class="calibre14"><p>Two groups (groups do not nest)</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">(\s*\w*)+</code></p></td>
<td class="calibre14"><p>One group; one or more subpatterns; only the
last subpattern is saved as a <code
class="calibre8">sub_match</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">&lt;(.*?)&gt;(.*?)&lt;/\1&gt;</code></p></td>
<td class="calibre14"><p>Three groups; the <code
class="calibre8">\1</code> means “same as group 1”</p></td>
</tr>
</tbody>
</table>
<p>That last pattern is useful for parsing XML. It finds tag/end-of-tag
markers. Note that I used a non-greedy match (a <em>lazy match</em>),
<code class="calibre8">.*?</code>, for the subpattern between the tag
and the end tag. Had I used plain <code class="calibre8">.*</code>, this
input would have caused a problem:</p>
<p><a href="#part0033_split_027.html#p0121_01a"
id="part0014.html#p0121_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb268"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Always</span> look on the <span class="dt">&lt;</span>b<span class="er">&gt;</span>bright&lt;/b<span class="dt">&gt;</span> side of <span class="er">&lt;</span>b<span class="dt">&gt;</span>life&lt;/b&gt;.</span></code></pre></div>
<p>A <em>greedy match</em> for the first subpattern would match the
first <code class="calibre8">&lt;</code> with the last <code
class="calibre8">&gt;</code>. That would be correct behavior, but
unlikely what the programmer wanted.</p>
<p>For a more exhaustive presentation of regular expressions, see [<a
href="#part0021.html#ref22" class="calibre6">Friedl,1997</a>].</p>
<h4 class="h3" id="part0014.html#ch09lev2sec4">9.4.3 Iterators</h4>
<p>We can define a <code class="calibre8">regex_iterator</code> for
iterating over a sequence of characters finding matches for a pattern.
For example, we can use a <code class="calibre8">sregex_iterator</code>
(a <code class="calibre8">regex_iterator&lt;string&gt;</code>) to output
all whitespace-separated words in a <code
class="calibre8">string</code>:</p>
<p><a href="#part0033_split_028.html#p0121_02a"
id="part0014.html#p0121_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb269"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a>void test()</span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a>     string input <span class="kw">=</span> <span class="ot">&quot;</span><span class="er">aa as</span><span class="ot">;</span><span class="er"> asd </span><span class="ot">++</span><span class="er">e</span><span class="ot">^</span><span class="er">asdf asdfg</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a>     regex pat <span class="kw">{</span><span class="dt">R</span><span class="ot">&quot;(</span><span class="ch">\</span><span class="er">s</span><span class="ot">+(</span><span class="ch">\</span><span class="er">w</span><span class="ot">+))&quot;</span><span class="kw">};</span></span>
<span id="cb269-5"><a href="#cb269-5" aria-hidden="true" tabindex="-1"></a>     for (sregex_iterator p(input<span class="al">.</span>begin()<span class="kw">,</span>input<span class="al">.</span>end()<span class="kw">,</span>pat)<span class="kw">;</span> p<span class="kw">!=</span>sregex_iterator<span class="kw">{};</span> ++p)</span>
<span id="cb269-6"><a href="#cb269-6" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> (<span class="fu">*</span>p)[<span class="dv">1</span>] <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb269-7"><a href="#cb269-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This outputs:</p>
<div class="sourceCode" id="cb270"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>as</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>asd</span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>asdfg</span></code></pre></div>
<p>We missed the first word, <code class="calibre8">aa</code>, because
it has no preceding whitespace. If we simplify the pattern to <code
class="calibre8">R"((\w+))"</code>, we get</p>
<div class="sourceCode" id="cb271"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a>aa</span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>as</span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a>asd</span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a>e</span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a>asdf</span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a>asdfg</span></code></pre></div>
<p>A <code class="calibre8">regex_iterator</code> is a bidirectional
iterator, so we cannot directly iterate over an <code
class="calibre8">istream</code> (which offers only an input iterator).
Also, we cannot write through a <code
class="calibre8">regex_iterator</code>, and the default <code
class="calibre8">regex_iterator</code> (<code
class="calibre8">regex_iterator{}</code>) is the only possible
end-of-sequence.</p>
<h3 class="h2" id="part0014.html#ch09lev1sec5"><span
id="part0014.html#page_122" class="calibre2 pagebreak"></span>9.5
Advice</h3>
<p>[1] Use <code class="calibre8">std::string</code> to own character
sequences; §<a href="#part0014.html#ch09lev1sec2"
class="calibre6">9.2</a>; [CG: SL.str.1].</p>
<p>[2] Prefer <code class="calibre8">string</code> operations to C-style
string functions; §<a href="#part0014.html#ch09lev1sec1"
class="calibre6">9.1</a>.</p>
<p>[3] Use <code class="calibre8">string</code> to declare variables and
members rather than as a base class; §<a
href="#part0014.html#ch09lev1sec2" class="calibre6">9.2</a>.</p>
<p>[4] Return <code class="calibre8">string</code>s by value (rely on
move semantics); §<a href="#part0014.html#ch09lev1sec2"
class="calibre6">9.2</a>, §<a href="#part0014.html#ch09lev2sec1"
class="calibre6">9.2.1</a>.</p>
<p>[5] Directly or indirectly, use <code
class="calibre8">substr()</code> to read substrings and <code
class="calibre8">replace()</code> to write substrings; §<a
href="#part0014.html#ch09lev1sec2" class="calibre6">9.2</a>.</p>
<p>[6] A <code class="calibre8">string</code> can grow and shrink, as
needed; §<a href="#part0014.html#ch09lev1sec2"
class="calibre6">9.2</a>.</p>
<p>[7] Use <code class="calibre8">at()</code> rather than iterators or
<code class="calibre8">[ ]</code> when you want range checking; §<a
href="#part0014.html#ch09lev1sec2" class="calibre6">9.2</a>.</p>
<p>[8] Use iterators and <code class="calibre8">[ ]</code> rather than
<code class="calibre8">at()</code> when you want to optimize speed; §<a
href="#part0014.html#ch09lev1sec2" class="calibre6">9.2</a>.</p>
<p>[9] <code class="calibre8">string</code> input doesn’t overflow; §<a
href="#part0014.html#ch09lev1sec2" class="calibre6">9.2</a>, §<a
href="#part0015.html#ch10lev1sec3" class="calibre6">10.3</a>.</p>
<p>[10] Use <code class="calibre8">c_str()</code> to produce a C-style
string representation of a <code class="calibre8">string</code> (only)
when you have to; §<a href="#part0014.html#ch09lev1sec2"
class="calibre6">9.2</a>.</p>
<p>[11] Use a <code class="calibre8">stringstream</code> or a generic
value extraction function (such as <code
class="calibre8">to&lt;X&gt;</code>) for numeric conversion of strings;
§<a href="#part0015.html#ch10lev1sec8" class="calibre6">10.8</a>.</p>
<p>[12] A <code class="calibre8">basic_string</code> can be used to make
strings of characters on any type; §<a
href="#part0014.html#ch09lev2sec1" class="calibre6">9.2.1</a>.</p>
<p>[13] Use the <code class="calibre8">s</code> suffix for string
literals meant to be standard-library <code
class="calibre8">string</code>s; §<a href="#part0014.html#ch09lev1sec3"
class="calibre6">9.3</a> [CG: SL.str.12].</p>
<p>[14] Use <code class="calibre8">string_view</code> as an argument of
functions that needs to read character sequences stored in various ways;
§<a href="#part0014.html#ch09lev1sec3" class="calibre6">9.3</a> [CG:
SL.str.2].</p>
<p>[15] Use <code class="calibre8">gsl::string_span</code> as an
argument of functions that needs to write character sequences stored in
various ways; §<a href="#part0014.html#ch09lev1sec3"
class="calibre6">9.3</a>. [CG: SL.str.2] [CG: SL.str.11].</p>
<p>[16] Think of a <code class="calibre8">string_view</code> as a kind
of pointer with a size attached; it does not own its characters; §<a
href="#part0014.html#ch09lev1sec3" class="calibre6">9.3</a>.</p>
<p>[17] Use the <code class="calibre8">sv</code> suffix for string
literals meant to be standard-library <code
class="calibre8">string_view</code>s; §<a
href="#part0014.html#ch09lev1sec3" class="calibre6">9.3</a>.</p>
<p>[18] Use <code class="calibre8">regex</code> for most conventional
uses of regular expressions; §<a href="#part0014.html#ch09lev1sec4"
class="calibre6">9.4</a>.</p>
<p>[19] Prefer raw string literals for expressing all but the simplest
patterns; §<a href="#part0014.html#ch09lev1sec4"
class="calibre6">9.4</a>.</p>
<p>[20] Use <code class="calibre8">regex_match()</code> to match a
complete input; §<a href="#part0014.html#ch09lev1sec4"
class="calibre6">9.4</a>, §<a href="#part0014.html#ch09lev2sec3"
class="calibre6">9.4.2</a>.</p>
<p>[21] Use <code class="calibre8">regex_search()</code> to search for a
pattern in an input stream; §<a href="#part0014.html#ch09lev2sec2"
class="calibre6">9.4.1</a>.</p>
<p>[22] The regular expression notation can be adjusted to match various
standards; §<a href="#part0014.html#ch09lev2sec3"
class="calibre6">9.4.2</a>.</p>
<p>[23] The default regular expression notation is that of ECMAScript;
§<a href="#part0014.html#ch09lev2sec3" class="calibre6">9.4.2</a>.</p>
<p>[24] Be restrained; regular expressions can easily become a
write-only language; §<a href="#part0014.html#ch09lev2sec3"
class="calibre6">9.4.2</a>.</p>
<p>[25] Note that <code class="calibre8">\i</code> allows you to express
a subpattern in terms of a previous subpattern; §<a
href="#part0014.html#ch09lev2sec3" class="calibre6">9.4.2</a>.</p>
<p>[26] Use <code class="calibre8">?</code> to make patterns “lazy”; §<a
href="#part0014.html#ch09lev2sec3" class="calibre6">9.4.2</a>.</p>
<p>[27] Use <code class="calibre8">regex_iterator</code>s for iterating
over a stream looking for a pattern; §<a
href="#part0014.html#ch09lev2sec4" class="calibre6">9.4.3</a>.</p>
</section>
<p><span id="part0015.html"></span></p>
<section id="part0015.html#ch10" class="h1 bodymatter">
<h2 class="h1"><span id="part0015.html#page_123"
class="calibre2 pagebreak"></span><span class="big">10</span></h2>
<p>Input and Output</p>
<p><em>What you see is all you get.</em></p>
<p><em>– Brian W. Kernighan</em></p>
<ul>
<li><p><a href="#part0015.html#ch10lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0015.html#ch10lev1sec2"
class="calibre6">Output</a></p></li>
<li><p><a href="#part0015.html#ch10lev1sec3"
class="calibre6">Input</a></p></li>
<li><p><a href="#part0015.html#ch10lev1sec4" class="calibre6">I/O
State</a></p></li>
<li><p><a href="#part0015.html#ch10lev1sec5" class="calibre6">I/O of
User-Defined Types</a></p></li>
<li><p><a href="#part0015.html#ch10lev1sec6"
class="calibre6">Formatting</a></p></li>
<li><p><a href="#part0015.html#ch10lev1sec7" class="calibre6">File
Streams</a></p></li>
<li><p><a href="#part0015.html#ch10lev1sec8" class="calibre6">String
Streams</a></p></li>
<li><p><a href="#part0015.html#ch10lev1sec9" class="calibre6">C-style
I/O</a></p></li>
<li><p><a href="#part0015.html#ch10lev1sec10" class="calibre6">File
System</a></p></li>
<li><p><a href="#part0015.html#ch10lev1sec11"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0015.html#ch10lev1sec1">10.1 Introduction</h3>
<p>The I/O stream library provides formatted and unformatted buffered
I/O of text and numeric values.</p>
<p>An <code class="calibre8">ostream</code> converts typed objects to a
stream of characters (bytes):</p>
<figure>
<img src="images/00020.jpeg" class="calibre1" />
</figure>
<p><span id="part0015.html#page_124" class="pagebreak"></span>An <code
class="calibre8">istream</code> converts a stream of characters (bytes)
to typed objects:</p>
<figure>
<img src="images/00021.jpeg" class="calibre1" />
</figure>
<p>The operations on <code class="calibre8">istream</code>s and <code
class="calibre8">ostream</code>s are described in §<a
href="#part0015.html#ch10lev1sec2" class="calibre6">10.2</a> and §<a
href="#part0015.html#ch10lev1sec3" class="calibre6">10.3</a>. The
operations are type-safe, type-sensitive, and extensible to handle
user-defined types (§<a href="#part0015.html#ch10lev1sec5"
class="calibre6">10.5</a>).</p>
<p>Other forms of user interaction, such as graphical I/O, are handled
through libraries that are not part of the ISO standard and therefore
not described here.</p>
<p>These streams can be used for binary I/O, be used for a variety of
character types, be locale specific, and use advanced buffering
strategies, but these topics are beyond the scope of this book.</p>
<p>The streams can be used for input into and outout from <code
class="calibre8">std::string</code>s (§<a
href="#part0015.html#ch10lev1sec3" class="calibre6">10.3</a>), for
formatting into <code class="calibre8">string</code> buffers (§<a
href="#part0015.html#ch10lev1sec8" class="calibre6">10.8</a>), and for
file I/O (§<a href="#part0015.html#ch10lev1sec10"
class="calibre6">10.10</a>).</p>
<p>The I/O stream classes all have destructors that free all resources
owned (such as buffers and file handles). That is, they are examples of
"Resource Acquisition Is Initialization" (RAII; §<a
href="#part0010.html#ch05lev1sec3" class="calibre6">5.3</a>).</p>
<h3 class="h2" id="part0015.html#ch10lev1sec2">10.2 Output</h3>
<p>In <code class="calibre8">&lt;ostream&gt;</code>, the I/O stream
library defines output for every built-in type. Further, it is easy to
define output of a user-defined type (§<a
href="#part0015.html#ch10lev1sec5" class="calibre6">10.5</a>). The
operator <code class="calibre8">&lt;&lt;</code> (“put to”) is used as an
output operator on objects of type <code
class="calibre8">ostream</code>; <code class="calibre8">cout</code> is
the standard output stream and <code class="calibre8">cerr</code> is the
standard stream for reporting errors. By default, values written to
<code class="calibre8">cout</code> are converted to a sequence of
characters. For example, to output the decimal number <code
class="calibre8">10</code>, we can write:</p>
<div class="sourceCode" id="cb272"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>void f()</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="dv">10</span><span class="kw">;</span></span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This places the character <code class="calibre8">1</code> followed by
the character <code class="calibre8">0</code> on the standard output
stream.</p>
<p>Equivalently, we could write:</p>
<div class="sourceCode" id="cb273"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>void g()</span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>     int x <span class="kw">{</span><span class="dv">10</span><span class="kw">};</span></span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> x<span class="kw">;</span></span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Output of different types can be combined in the obvious way:</p>
<p><a href="#part0034_split_000.html#p0125_01a"
id="part0015.html#p0125_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb274"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>void h(int i)</span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">the value of i is </span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> i<span class="kw">;</span></span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>For <code class="calibre8">h(10)</code>, the output will be:</p>
<div class="sourceCode" id="cb275"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a>the value of i <span class="dt">is</span> <span class="dv">10</span></span></code></pre></div>
<p>People soon tire of repeating the name of the output stream when
outputting several related items. Fortunately, the result of an output
expression can itself be used for further output. For example:</p>
<p><a href="#part0034_split_001.html#p0125_02a"
id="part0015.html#p0125_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb276"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>void h2(int i)</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">the value of i is </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> i <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This <code class="calibre8">h2()</code> produces the same output as
<code class="calibre8">h()</code>.</p>
<p>A character constant is a character enclosed in single quotes. Note
that a character is output as a character rather than as a numerical
value. For example:</p>
<p><a href="#part0034_split_002.html#p0125_03a"
id="part0015.html#p0125_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb277"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a>void k()</span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>     int b <span class="kw">=</span> <span class="st">&#39;</span><span class="er">b</span><span class="st">&#39;</span><span class="kw">;</span>     <span class="fu">//</span> note<span class="fu">:</span> char implicitly converted to int</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a>     char c <span class="kw">=</span> <span class="st">&#39;</span><span class="er">c</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="er">a</span><span class="st">&#39;</span> <span class="al">&lt;&lt;</span> b <span class="al">&lt;&lt;</span> c<span class="kw">;</span></span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The integer value of the character <code class="calibre8">'b'</code>
is <code class="calibre8">98</code> (in the ASCII encoding used on the
C++ implementation that I used), so this will output <code
class="calibre8">a98c</code>.</p>
<h3 class="h2" id="part0015.html#ch10lev1sec3">10.3 Input</h3>
<p>In <code class="calibre8">&lt;istream&gt;</code>, the standard
library offers <code class="calibre8">istream</code>s for input. Like
<code class="calibre8">ostream</code>s, <code
class="calibre8">istream</code>s deal with character string
representations of built-in types and can easily be extended to cope
with user-defined types.</p>
<p>The operator <code class="calibre8">&gt;&gt;</code> (“get from”) is
used as an input operator; <code class="calibre8">cin</code> is the
standard input stream. The type of the right-hand operand of <code
class="calibre8">&gt;&gt;</code> determines what input is accepted and
what is the target of the input operation. For example:</p>
<p><a href="#part0034_split_003.html#p0125_04a"
id="part0015.html#p0125_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb278"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb278-1"><a href="#cb278-1" aria-hidden="true" tabindex="-1"></a>void f()</span>
<span id="cb278-2"><a href="#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb278-3"><a href="#cb278-3" aria-hidden="true" tabindex="-1"></a>     int i<span class="kw">;</span></span>
<span id="cb278-4"><a href="#cb278-4" aria-hidden="true" tabindex="-1"></a>     cin <span class="al">&gt;&gt;</span> i<span class="kw">;</span>    <span class="fu">//</span> <span class="fu">read</span> an <span class="dt">integer</span> into i</span>
<span id="cb278-5"><a href="#cb278-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-6"><a href="#cb278-6" aria-hidden="true" tabindex="-1"></a>     double d<span class="kw">;</span></span>
<span id="cb278-7"><a href="#cb278-7" aria-hidden="true" tabindex="-1"></a>     cin <span class="al">&gt;&gt;</span> d<span class="kw">;</span>    <span class="fu">//</span> <span class="fu">read</span> a double<span class="fu">-</span>precision floating<span class="fu">-</span>point <span class="dt">number</span> into d</span>
<span id="cb278-8"><a href="#cb278-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0015.html#page_126" class="pagebreak"></span>This reads
a number, such as <code class="calibre8">1234</code>, from the standard
input into the integer variable <code class="calibre8">i</code> and a
floating-point number, such as <code class="calibre8">12.34e5</code>,
into the double-precision floating-point variable <code
class="calibre8">d</code>.</p>
<p>Like output operations, input operations can be chained, so I could
equivalently have written:</p>
<p><a href="#part0034_split_004.html#p0126_01a"
id="part0015.html#p0126_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb279"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>void f()</span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a>     int i<span class="kw">;</span></span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>     double d<span class="kw">;</span></span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>     cin <span class="al">&gt;&gt;</span> i <span class="al">&gt;&gt;</span> d<span class="kw">;</span>     <span class="fu">//</span> <span class="fu">read</span> into i and d</span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>In both cases, the read of the integer is terminated by any character
that is not a digit. By default, <code class="calibre8">&gt;&gt;</code>
skips initial whitespace, so a suitable complete input sequence would
be</p>
<div class="sourceCode" id="cb280"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb280-1"><a href="#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1234</span></span>
<span id="cb280-2"><a href="#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="fl">12.34</span>e5</span></code></pre></div>
<p>Often, we want to read a sequence of characters. A convenient way of
doing that is to read into a <code class="calibre8">string</code>. For
example:</p>
<p><a href="#part0034_split_005.html#p0126_02a"
id="part0015.html#p0126_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb281"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a>void hello()</span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">Please enter your name</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>     string str<span class="kw">;</span></span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>     cin <span class="al">&gt;&gt;</span> str<span class="kw">;</span></span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">Hello</span><span class="ot">,</span><span class="er"> </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> str <span class="al">&lt;&lt;</span> <span class="ot">&quot;!</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>If you type in <code class="calibre8">Eric</code> the response
is:</p>
<div class="sourceCode" id="cb282"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Hello</span><span class="kw">,</span> <span class="dt">Eric</span><span class="kw">!</span></span></code></pre></div>
<p>By default, a whitespace character, such as a space or a newline,
terminates the read, so if you enter <code
class="calibre8">Eric Bloodaxe</code> pretending to be the ill-fated
king of York, the response is still:</p>
<div class="sourceCode" id="cb283"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Hello</span><span class="kw">,</span> <span class="dt">Eric</span><span class="kw">!</span></span></code></pre></div>
<p>You can read a whole line using the <code
class="calibre8">getline()</code> function. For example:</p>
<p><a href="#part0034_split_006.html#p0126_03a"
id="part0015.html#p0126_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb284"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a>void hello_line()</span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">Please enter your name</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a>     string str<span class="kw">;</span></span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a>     getline(cin<span class="kw">,</span>str)<span class="kw">;</span></span>
<span id="cb284-6"><a href="#cb284-6" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">Hello</span><span class="ot">,</span><span class="er"> </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> str <span class="al">&lt;&lt;</span> <span class="ot">&quot;!</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb284-7"><a href="#cb284-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>With this program, the input <code
class="calibre8">Eric Bloodaxe</code> yields the desired output:</p>
<div class="sourceCode" id="cb285"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb285-1"><a href="#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Hello</span><span class="kw">,</span> <span class="dt">Eric</span> <span class="dt">Bloodaxe</span><span class="kw">!</span></span></code></pre></div>
<p>The newline that terminated the line is discarded, so <code
class="calibre8">cin</code> is ready for the next input line.</p>
<p>Using the formatted I/O operations is usually less error-prone, more
efficient, and less code than manipulating characters one by one. In
particular, <code class="calibre8">istream</code>s take care of memory
management and range checking. We can do formatting to and from memory
using <code class="calibre8">stringsteam</code>s (§<a
href="#part0015.html#ch10lev1sec8" class="calibre6">10.8</a>).</p>
<p><span id="part0015.html#page_127" class="pagebreak"></span>The
standard strings have the nice property of expanding to hold what you
put in them; you don’t have to pre-calculate a maximum size. So, if you
enter a couple of megabytes of semicolons, the program will echo pages
of semicolons back at you.</p>
<h3 class="h2" id="part0015.html#ch10lev1sec4">10.4 I/O State</h3>
<p>An <code class="calibre8">iostream</code> has a state that we can
examine to determine whether an operation succeeded. The most common use
is to read a sequence of values:</p>
<p><a href="#part0034_split_007.html#p0127_01a"
id="part0015.html#p0127_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb286"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> read_ints(istream&amp; <span class="dt">is</span>)</span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> res<span class="kw">;</span></span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>     for (int i<span class="kw">;</span> <span class="dt">is</span><span class="al">&gt;&gt;</span>i<span class="kw">;</span> )</span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>           res.push_back(i)<span class="kw">;</span></span>
<span id="cb286-6"><a href="#cb286-6" aria-hidden="true" tabindex="-1"></a>     return res<span class="kw">;</span></span>
<span id="cb286-7"><a href="#cb286-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This reads from <code class="calibre8">is</code> until something that
is not an integer is encountered. That something will typically be the
end of input. What is happening here is that the operation <code
class="calibre8">is&gt;&gt;i</code> returns a reference to <code
class="calibre8">is</code>, and testing an <code
class="calibre8">iostream</code> yields <code
class="calibre8">true</code> if the stream is ready for another
operation.</p>
<p>In general, the I/O state holds all the information needed to read or
write, such as formatting information (§<a
href="#part0015.html#ch10lev1sec6" class="calibre6">10.6</a>), error
state (e.g., has end-of-input been reached?), and what kind of buffering
is used. In particular, a user can set the state to reflect that an
error has occurred (§<a href="#part0015.html#ch10lev1sec5"
class="calibre6">10.5</a>) and clear the state if an error wasn’t
serious. For example, we could imagine a version of <code
class="calibre8">read_ints()</code> that accepted a terminating
string:</p>
<p><a href="#part0034_split_008.html#p0127_02a"
id="part0015.html#p0127_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb287"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> read_ints(istream&amp; <span class="dt">is</span><span class="kw">,</span> const string&amp; terminator)</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> res<span class="kw">;</span></span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a>     for (int i<span class="kw">;</span> <span class="dt">is</span> <span class="al">&gt;&gt;</span> i<span class="kw">;</span> )</span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a>           res.push_back(i)<span class="kw">;</span></span>
<span id="cb287-6"><a href="#cb287-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-7"><a href="#cb287-7" aria-hidden="true" tabindex="-1"></a>     if (<span class="dt">is</span><span class="al">.</span>eof())               <span class="fu">//</span> fine<span class="fu">:</span> end of file</span>
<span id="cb287-8"><a href="#cb287-8" aria-hidden="true" tabindex="-1"></a>            return res<span class="kw">;</span></span>
<span id="cb287-9"><a href="#cb287-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-10"><a href="#cb287-10" aria-hidden="true" tabindex="-1"></a>     if (<span class="dt">is</span><span class="al">.</span><span class="kw">fail</span>()) <span class="kw">{</span>            <span class="fu">//</span> we failed to <span class="fu">read</span> an int<span class="kw">;</span> was it the terminator?</span>
<span id="cb287-11"><a href="#cb287-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">is</span>.clear()<span class="kw">;</span>    <span class="fu">//</span> reset the state to good()</span>
<span id="cb287-12"><a href="#cb287-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">is</span>.unget()<span class="kw">;</span>    <span class="fu">//</span> put the non<span class="fu">-</span>digit back into the stream</span>
<span id="cb287-13"><a href="#cb287-13" aria-hidden="true" tabindex="-1"></a>            string s<span class="kw">;</span></span>
<span id="cb287-14"><a href="#cb287-14" aria-hidden="true" tabindex="-1"></a>            if (cin<span class="al">&gt;&gt;</span>s &amp;&amp; s<span class="fu">==</span>terminator)</span>
<span id="cb287-15"><a href="#cb287-15" aria-hidden="true" tabindex="-1"></a>                  return res<span class="kw">;</span></span>
<span id="cb287-16"><a href="#cb287-16" aria-hidden="true" tabindex="-1"></a>            cin.setstate(ios_base::failbit)<span class="kw">;</span>    <span class="fu">//</span> add <span class="kw">fail</span>() to cin<span class="st">&#39;</span><span class="er">s state</span></span>
<span id="cb287-17"><a href="#cb287-17" aria-hidden="true" tabindex="-1"></a><span class="er">     }</span></span>
<span id="cb287-18"><a href="#cb287-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-19"><a href="#cb287-19" aria-hidden="true" tabindex="-1"></a><span class="er">     return res;</span></span>
<span id="cb287-20"><a href="#cb287-20" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb287-21"><a href="#cb287-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-22"><a href="#cb287-22" aria-hidden="true" tabindex="-1"></a><span class="er">auto v = read_ints(cin,&quot;stop&quot;);</span></span></code></pre></div>
<h3 class="h2" id="part0015.html#ch10lev1sec5"><span
id="part0015.html#page_128" class="calibre2 pagebreak"></span>10.5 I/O
of User-Defined Types</h3>
<p>In addition to the I/O of built-in types and standard <code
class="calibre8">string</code>s, the <code
class="calibre8">iostream</code> library allows programmers to define
I/O for their own types. For example, consider a simple type <code
class="calibre8">Entry</code> that we might use to represent entries in
a telephone book:</p>
<p><a href="#part0034_split_009.html#p0128_01a"
id="part0015.html#p0128_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb288"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Entry</span> <span class="kw">{</span></span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>     string name<span class="kw">;</span></span>
<span id="cb288-3"><a href="#cb288-3" aria-hidden="true" tabindex="-1"></a>     int <span class="dt">number</span><span class="kw">;</span></span>
<span id="cb288-4"><a href="#cb288-4" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>We can define a simple output operator to write an <code
class="calibre8">Entry</code> using a <em>{"name",number}</em> format
similar to the one we use for initialization in code:</p>
<p><a href="#part0034_split_010.html#p0128_02a"
id="part0015.html#p0128_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb289"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a>ostream&amp; operator<span class="al">&lt;&lt;</span>(ostream&amp; os<span class="kw">,</span> const <span class="dt">Entry</span>&amp; e)</span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a>     return os <span class="al">&lt;&lt;</span> <span class="ot">&quot;{</span><span class="ch">\&quot;</span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> e.name <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="ch">\&quot;</span><span class="ot">,</span><span class="er"> </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> e.<span class="dt">number</span> <span class="al">&lt;&lt;</span> <span class="ot">&quot;}&quot;</span><span class="kw">;</span></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>A user-defined output operator takes its output stream (by reference)
as its first argument and returns it as its result.</p>
<p>The corresponding input operator is more complicated because it has
to check for correct formatting and deal with errors:</p>
<p><a href="#part0034_split_011.html#p0128_03a"
id="part0015.html#p0128_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb290"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>istream&amp; operator<span class="al">&gt;&gt;</span>(istream&amp; <span class="dt">is</span><span class="kw">,</span> <span class="dt">Entry</span>&amp; e)</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> <span class="fu">read</span> <span class="kw">{</span> <span class="ot">&quot;</span><span class="er">name</span><span class="ot">&quot;</span><span class="kw">,</span> <span class="dt">number</span> <span class="kw">}</span> pair<span class="kw">.</span> <span class="dt">Note</span><span class="fu">:</span> formatted with <span class="kw">{</span> <span class="ot">&quot;</span><span class="er"> </span><span class="ot">&quot;</span><span class="kw">,</span> and <span class="kw">}</span></span>
<span id="cb290-3"><a href="#cb290-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb290-4"><a href="#cb290-4" aria-hidden="true" tabindex="-1"></a>     char c<span class="kw">,</span> c2<span class="kw">;</span></span>
<span id="cb290-5"><a href="#cb290-5" aria-hidden="true" tabindex="-1"></a>     if (<span class="dt">is</span><span class="al">&gt;&gt;</span>c &amp;&amp; c<span class="fu">==</span><span class="er">&#39;{&#39;</span> &amp;&amp; <span class="dt">is</span><span class="al">&gt;&gt;</span>c2 &amp;&amp; c2<span class="fu">==</span><span class="er">&#39;&quot;&#39;</span>) <span class="kw">{</span> <span class="fu">//</span> start with a <span class="kw">{</span> <span class="ot">&quot;</span></span>
<span id="cb290-6"><a href="#cb290-6" aria-hidden="true" tabindex="-1"></a><span class="ch">           </span><span class="er">string name</span><span class="ot">;</span><span class="er">                   </span><span class="ot">//</span><span class="er"> the default value of a string is the empty string</span><span class="ot">:</span><span class="er"> &quot;&quot;</span></span>
<span id="cb290-7"><a href="#cb290-7" aria-hidden="true" tabindex="-1"></a><span class="er">           while </span><span class="ot">(</span><span class="er">is</span><span class="ot">.</span><span class="er">get</span><span class="ot">(</span><span class="er">c</span><span class="ot">)</span><span class="er"> </span><span class="ot">&amp;&amp;</span><span class="er"> c</span><span class="ot">!=&#39;&quot;</span><span class="st">&#39;</span><span class="er">)    // anything before a &quot; is part of the name</span></span>
<span id="cb290-8"><a href="#cb290-8" aria-hidden="true" tabindex="-1"></a><span class="er">                 name+=c;</span></span>
<span id="cb290-9"><a href="#cb290-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb290-10"><a href="#cb290-10" aria-hidden="true" tabindex="-1"></a><span class="er">           if </span><span class="st">(</span><span class="er">is</span><span class="st">&gt;&gt;</span><span class="er">c </span><span class="st">&amp;&amp;</span><span class="er"> c</span><span class="st">==&#39;</span><span class="kw">,</span><span class="st">&#39;</span><span class="er">) {</span></span>
<span id="cb290-11"><a href="#cb290-11" aria-hidden="true" tabindex="-1"></a><span class="er">                 int number = 0;</span></span>
<span id="cb290-12"><a href="#cb290-12" aria-hidden="true" tabindex="-1"></a><span class="er">                 if </span><span class="st">(</span><span class="er">is</span><span class="st">&gt;&gt;</span><span class="er">number</span><span class="st">&gt;&gt;</span><span class="er">c </span><span class="st">&amp;&amp;</span><span class="er"> c</span><span class="st">==&#39;</span><span class="kw">}</span><span class="st">&#39;</span><span class="er">) { // read the number and a }</span></span>
<span id="cb290-13"><a href="#cb290-13" aria-hidden="true" tabindex="-1"></a><span class="er">                        e = {name,number};      // assign to the entry</span></span>
<span id="cb290-14"><a href="#cb290-14" aria-hidden="true" tabindex="-1"></a><span class="er">                        return is;</span></span>
<span id="cb290-15"><a href="#cb290-15" aria-hidden="true" tabindex="-1"></a><span class="er">                 }</span></span>
<span id="cb290-16"><a href="#cb290-16" aria-hidden="true" tabindex="-1"></a><span class="er">           }</span></span>
<span id="cb290-17"><a href="#cb290-17" aria-hidden="true" tabindex="-1"></a><span class="er">     }</span></span>
<span id="cb290-18"><a href="#cb290-18" aria-hidden="true" tabindex="-1"></a><span class="er">     is.setstate(ios_base::failbit);      // register the failure in the stream</span></span>
<span id="cb290-19"><a href="#cb290-19" aria-hidden="true" tabindex="-1"></a><span class="er">     return is;</span></span>
<span id="cb290-20"><a href="#cb290-20" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>An input operation returns a reference to its <code
class="calibre8">istream</code> that can be used to test if the
operation succeeded. For example, when used as a condition, <code
class="calibre8">is&gt;&gt;c</code> means “Did we succeed at reading a
<code class="calibre8">char</code> from <code class="calibre8">is</code>
into <code class="calibre8">c</code>?”</p>
<p>The <code class="calibre8">is&gt;&gt;c</code> skips whitespace by
default, but <code class="calibre8">is.get(c)</code> does not, so this
<code class="calibre8">Entry</code>-input operator ignores (skips)
whitespace outside the name string, but not within it. For example:</p>
<p><a href="#part0034_split_012.html#p0129_01a"
id="part0015.html#p0129_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb291"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span> <span class="ot">&quot;</span><span class="er">John Marwood Cleese</span><span class="ot">&quot;</span><span class="kw">,</span> <span class="dv">123456</span>      <span class="kw">}</span></span>
<span id="cb291-2"><a href="#cb291-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span><span class="ot">&quot;</span><span class="er">Michael Edward Palin</span><span class="ot">&quot;</span><span class="kw">,</span> <span class="dv">987654</span><span class="kw">}</span></span></code></pre></div>
<p>We can read such a pair of values from input into an <code
class="calibre8">Entry</code> like this:</p>
<p><a href="#part0034_split_013.html#p0129_02a"
id="part0015.html#p0129_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb292"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a>for (<span class="dt">Entryee</span><span class="kw">;</span> cin<span class="al">&gt;&gt;</span>ee<span class="kw">;</span> )  <span class="fu">//</span> <span class="fu">read</span> from cin into ee</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>      cout <span class="al">&lt;&lt;</span> ee <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span> <span class="fu">//</span> <span class="fu">write</span> ee to cout</span></code></pre></div>
<p>The output is:</p>
<p><a href="#part0034_split_014.html#p0129_03a"
id="part0015.html#p0129_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb293"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span><span class="ot">&quot;</span><span class="er">John Marwood Cleese</span><span class="ot">&quot;</span><span class="kw">,</span> <span class="dv">123456</span><span class="kw">}</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span><span class="ot">&quot;</span><span class="er">Michael Edward Palin</span><span class="ot">&quot;</span><span class="kw">,</span> <span class="dv">987654</span><span class="kw">}</span></span></code></pre></div>
<p>See §<a href="#part0014.html#ch09lev1sec4" class="calibre6">9.4</a>
for a more systematic technique for recognizing patterns in streams of
characters (regular expression matching).</p>
<h3 class="h2" id="part0015.html#ch10lev1sec6">10.6 Formatting</h3>
<p>The <code class="calibre8">iostream</code> library provides a large
set of operations for controlling the format of input and output. The
simplest formatting controls are called <em>manipulators</em> and are
found in <code class="calibre8">&lt;ios&gt;</code>, <code
class="calibre8">&lt;istream&gt;</code>, <code
class="calibre8">&lt;ostream&gt;</code>, and <code
class="calibre8">&lt;iomanip&gt;</code> (for manipulators that take
arguments). For example, we can output integers as decimal (the
default), octal, or hexadecimal numbers:</p>
<p><a href="#part0034_split_015.html#p0129_04a"
id="part0015.html#p0129_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb294"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>cout <span class="al">&lt;&lt;</span> <span class="dv">1234</span> <span class="al">&lt;&lt;</span> <span class="st">&#39;,&#39;</span> <span class="al">&lt;&lt;</span> hex <span class="al">&lt;&lt;</span> <span class="dv">1234</span> <span class="al">&lt;&lt;</span> <span class="st">&#39;,&#39;</span> <span class="al">&lt;&lt;</span> oct <span class="al">&lt;&lt;</span> <span class="dv">1234</span> <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span>        <span class="fu">//</span> print <span class="dv">1234</span><span class="kw">,</span><span class="er">4d2</span><span class="kw">,</span><span class="dv">2322</span></span></code></pre></div>
<p>We can explicitly set the output format for floating-point
numbers:</p>
<p><a href="#part0034_split_016.html#p0129_05a"
id="part0015.html#p0129_05" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb295"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>constexpr double d <span class="kw">=</span> <span class="fl">123.456</span><span class="kw">;</span></span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-3"><a href="#cb295-3" aria-hidden="true" tabindex="-1"></a>cout <span class="al">&lt;&lt;</span> d <span class="al">&lt;&lt;</span> <span class="ot">&quot;;</span><span class="er"> </span><span class="ot">&quot;</span>                    <span class="fu">//</span> use the default format for d</span>
<span id="cb295-4"><a href="#cb295-4" aria-hidden="true" tabindex="-1"></a>     <span class="al">&lt;&lt;</span> scientific <span class="al">&lt;&lt;</span> d <span class="al">&lt;&lt;</span> <span class="ot">&quot;;</span><span class="er"> </span><span class="ot">&quot;</span>      <span class="fu">//</span> use <span class="fl">1.123</span>e2 style format for d</span>
<span id="cb295-5"><a href="#cb295-5" aria-hidden="true" tabindex="-1"></a>     <span class="al">&lt;&lt;</span> hexfloat <span class="al">&lt;&lt;</span> d <span class="al">&lt;&lt;</span> <span class="ot">&quot;;</span><span class="er"> </span><span class="ot">&quot;</span>        <span class="fu">//</span> use hexadecimal notation for d</span>
<span id="cb295-6"><a href="#cb295-6" aria-hidden="true" tabindex="-1"></a>     <span class="al">&lt;&lt;</span> fixed <span class="al">&lt;&lt;</span> d <span class="al">&lt;&lt;</span> <span class="ot">&quot;;</span><span class="er"> </span><span class="ot">&quot;</span>           <span class="fu">//</span> use <span class="fl">123.456</span> style format for d</span>
<span id="cb295-7"><a href="#cb295-7" aria-hidden="true" tabindex="-1"></a>     <span class="al">&lt;&lt;</span> defaultfloat <span class="al">&lt;&lt;</span> d <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span>   <span class="fu">//</span> use the default format for d</span></code></pre></div>
<p>This produces:</p>
<p><a href="#part0034_split_017.html#p0129_06a"
id="part0015.html#p0129_06" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb296"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="fl">123.456</span><span class="kw">;</span> <span class="fl">1.234560</span>e<span class="fu">+</span><span class="dv">002</span><span class="kw">;</span> <span class="bn">0x1</span><span class="kw">.</span>edd2f2p<span class="fu">+</span><span class="dv">6</span><span class="kw">;</span> <span class="fl">123.456000</span><span class="kw">;</span> <span class="fl">123.456</span></span></code></pre></div>
<p>Precision is an integer that determines the number of digits used to
display a floating-point number:</p>
<ul>
<li><p>The <em>general</em> format (<code
class="calibre8">defaultfloat</code>) lets the implementation choose a
format that presents a value in the style that best preserves the value
in the space available. The precision specifies the maximum number of
digits.</p></li>
<li><p>The <em>scientific</em> format (<code
class="calibre8">scientific</code>) presents a value with one digit
before a decimal point and an exponent. The precision specifies the
maximum number of digits after the decimal point.</p></li>
<li><p>The <em>fixed</em> format (<code class="calibre8">fixed</code>)
presents a value as an integer part followed by a decimal point and a
fractional part. The precision specifies the maximum number of digits
after the decimal point.</p></li>
</ul>
<p>Floating-point values are rounded rather than just truncated, and
<code class="calibre8">precision()</code> doesn’t affect integer output.
For example:</p>
<p><a href="#part0034_split_018.html#p0130_01a"
id="part0015.html#p0130_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb297"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>cout<span class="kw">.</span>precision(<span class="dv">8</span>)<span class="kw">;</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>cout <span class="al">&lt;&lt;</span> <span class="fl">1234.56789</span> <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="er"> </span><span class="st">&#39;</span> <span class="al">&lt;&lt;</span> <span class="fl">1234.56789</span> <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="er"> </span><span class="st">&#39;</span> <span class="al">&lt;&lt;</span> <span class="dv">123456</span> <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a>cout<span class="kw">.</span>precision(<span class="dv">4</span>)<span class="kw">;</span></span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>cout <span class="al">&lt;&lt;</span> <span class="fl">1234.56789</span> <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="er"> </span><span class="st">&#39;</span> <span class="al">&lt;&lt;</span> <span class="fl">1234.56789</span> <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="er"> </span><span class="st">&#39;</span> <span class="al">&lt;&lt;</span> <span class="dv">123456</span> <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a>cout <span class="al">&lt;&lt;</span> <span class="fl">1234.56789</span> <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span></code></pre></div>
<p>This produces:</p>
<p><a href="#part0034_split_019.html#p0130_02a"
id="part0015.html#p0130_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb298"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1234.5679</span> <span class="fl">1234.5679</span> <span class="dv">123456</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1235</span> <span class="dv">1235</span> <span class="dv">123456</span></span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1235</span></span></code></pre></div>
<p>These floating-point manipulators are “sticky”; that is, their
effects persist for subsequent floating-point operations.</p>
<h3 class="h2" id="part0015.html#ch10lev1sec7">10.7 File Streams</h3>
<p>In <code class="calibre8">&lt;fstream&gt;</code>, the standard
library provides streams to and from a file:</p>
<ul>
<li><p><code class="calibre8">ifstream</code>s for reading from a
file</p></li>
<li><p><code class="calibre8">ofstream</code>s for writing to a
file</p></li>
<li><p><code class="calibre8">fstream</code>s for reading from and
writing to a file</p></li>
</ul>
<p>For example:</p>
<p><a href="#part0034_split_020.html#p0130_03a"
id="part0015.html#p0130_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb299"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>ofstream ofs <span class="kw">{</span><span class="ot">&quot;</span><span class="er">target</span><span class="ot">&quot;</span><span class="kw">};</span>               <span class="fu">//</span> <span class="ot">&quot;</span><span class="er">o</span><span class="ot">&quot;</span> for <span class="ot">&quot;</span><span class="er">output</span><span class="ot">&quot;</span></span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>if (<span class="kw">!</span>ofs)</span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>       error(<span class="ot">&quot;</span><span class="er">couldn</span><span class="ot">&#39;</span><span class="er">t open </span><span class="ot">&#39;</span><span class="er">target</span><span class="ot">&#39;</span><span class="er"> for writing</span><span class="ot">&quot;</span>)<span class="kw">;</span></span></code></pre></div>
<p>Testing that a file stream has been properly opened is usually done
by checking its state.</p>
<p><a href="#part0034_split_021.html#p0130_04a"
id="part0015.html#p0130_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb300"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>ifstream ifs <span class="kw">{</span><span class="ot">&quot;</span><span class="er">source</span><span class="ot">&quot;</span><span class="kw">};</span>               <span class="fu">//</span> <span class="ot">&quot;</span><span class="er">i</span><span class="ot">&quot;</span> for <span class="ot">&quot;</span><span class="er">input</span><span class="ot">&quot;</span></span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>if (<span class="kw">!</span>ifs)</span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>       error(<span class="ot">&quot;</span><span class="er">couldn</span><span class="ot">&#39;</span><span class="er">t open </span><span class="ot">&#39;</span><span class="er">source</span><span class="ot">&#39;</span><span class="er"> for reading</span><span class="ot">&quot;</span>)<span class="kw">;</span></span></code></pre></div>
<p>Assuming that the tests succeeded, <code class="calibre8">ofs</code>
can be used as an ordinary <code class="calibre8">ostream</code> (just
like <code class="calibre8">cout</code>) and <code
class="calibre8">ifs</code> can be used as an ordinary <code
class="calibre8">istream</code> (just like <code
class="calibre8">cin</code>).</p>
<p>File positioning and more detailed control of the way a file is
opened is possible, but beyond the scope of this book.</p>
<p>For the composition of file names and file system manipulation, see
§<a href="#part0015.html#ch10lev1sec10" class="calibre6">10.10</a>.</p>
<h3 class="h2" id="part0015.html#ch10lev1sec8">10.8 String Streams</h3>
<p>In <code class="calibre8">&lt;sstream&gt;</code>, the standard
library provides streams to and from a <code
class="calibre8">string</code>:</p>
<ul>
<li><p><code class="calibre8">istringstream</code>s for reading from a
<code class="calibre8">string</code></p></li>
<li><p><code class="calibre8">ostringstream</code>s for writing to a
<code class="calibre8">string</code></p></li>
<li><p><code class="calibre8">stringstream</code>s for reading from and
writing to a <code class="calibre8">string</code>.</p></li>
</ul>
<p>For example:</p>
<p><a href="#part0034_split_022.html#p0131_01a"
id="part0015.html#p0131_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb301"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>void test()</span>
<span id="cb301-2"><a href="#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb301-3"><a href="#cb301-3" aria-hidden="true" tabindex="-1"></a>     ostringstream oss<span class="kw">;</span></span>
<span id="cb301-4"><a href="#cb301-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-5"><a href="#cb301-5" aria-hidden="true" tabindex="-1"></a>     oss <span class="al">&lt;&lt;</span> <span class="ot">&quot;{</span><span class="er">temperature</span><span class="ot">,&quot;</span> <span class="al">&lt;&lt;</span> scientific <span class="al">&lt;&lt;</span> <span class="fl">123.4567890</span> <span class="al">&lt;&lt;</span> <span class="ot">&quot;}&quot;</span><span class="kw">;</span></span>
<span id="cb301-6"><a href="#cb301-6" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> oss.str() <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb301-7"><a href="#cb301-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The result from an <code class="calibre8">istringstream</code> can be
read using <code class="calibre8">str()</code>. One common use of an
<code class="calibre8">ostringstream</code> is to format before giving
the resulting string to a GUI. Similarly, a string received from a GUI
can be read using formatted input operations (§<a
href="#part0015.html#ch10lev1sec3" class="calibre6">10.3</a>) by putting
it into an <code class="calibre8">istringstream</code>.</p>
<p>A <code class="calibre8">stringstream</code> can be used for both
reading and writing. For example, we can define an operation that can
convert any type with a <code class="calibre8">string</code>
representation into another that can also be represented as a <code
class="calibre8">string</code>:</p>
<p><a href="#part0034_split_023.html#p0131_02a"
id="part0015.html#p0131_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb302"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Target</span> <span class="kw">=</span>string<span class="kw">,</span> typename <span class="dt">Source</span> <span class="kw">=</span>string<span class="dt">&gt;</span></span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Target</span> to(<span class="dt">Source</span> arg)      <span class="dv">//</span> convert <span class="dt">Source</span> to <span class="dt">Target</span></span>
<span id="cb302-3"><a href="#cb302-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb302-4"><a href="#cb302-4" aria-hidden="true" tabindex="-1"></a>  stringstream interpreter<span class="kw">;</span></span>
<span id="cb302-5"><a href="#cb302-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Target</span> result<span class="kw">;</span></span>
<span id="cb302-6"><a href="#cb302-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-7"><a href="#cb302-7" aria-hidden="true" tabindex="-1"></a>  if (<span class="kw">!</span>(interpreter <span class="al">&lt;&lt;</span> <span class="fu">arg</span>)                 <span class="fu">//</span> <span class="fu">write</span> <span class="fu">arg</span> into stream</span>
<span id="cb302-8"><a href="#cb302-8" aria-hidden="true" tabindex="-1"></a>      || <span class="kw">!</span>(interpreter <span class="al">&gt;&gt;</span> result)           <span class="fu">//</span> <span class="fu">read</span> result from stream</span>
<span id="cb302-9"><a href="#cb302-9" aria-hidden="true" tabindex="-1"></a>      || <span class="kw">!</span>(interpreter <span class="al">&gt;&gt;</span> std::ws)<span class="al">.</span>eof())   <span class="fu">//</span> stuff left in stream?</span>
<span id="cb302-10"><a href="#cb302-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">throw</span> runtime_error<span class="kw">{</span><span class="ot">&quot;</span><span class="er">to</span><span class="ot">&lt;&gt;()</span><span class="er"> failed</span><span class="ot">&quot;</span><span class="kw">};</span></span>
<span id="cb302-11"><a href="#cb302-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-12"><a href="#cb302-12" aria-hidden="true" tabindex="-1"></a>  return result<span class="kw">;</span></span>
<span id="cb302-13"><a href="#cb302-13" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>A function template argument needs to be explicitly mentioned only if
it cannot be deduced or if there is no default (§<a
href="#part0012.html#ch07lev2sec4" class="calibre6">7.2.4</a>), so we
can write:</p>
<p><a href="#part0034_split_024.html#p0131_03a"
id="part0015.html#p0131_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb303"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb303-1"><a href="#cb303-1" aria-hidden="true" tabindex="-1"></a>auto x1 <span class="kw">=</span> to<span class="dt">&lt;</span>string<span class="kw">,</span>double<span class="dt">&gt;</span>(<span class="fl">1.2</span>)<span class="kw">;</span>   <span class="fu">//</span> very explicit (and verbose)</span>
<span id="cb303-2"><a href="#cb303-2" aria-hidden="true" tabindex="-1"></a>auto x2 <span class="kw">=</span> to<span class="dt">&lt;</span>string<span class="er">&gt;</span>(<span class="fl">1.2</span>)<span class="kw">;</span>          <span class="fu">//</span> <span class="dt">Source</span> <span class="dt">is</span> deduced to double</span>
<span id="cb303-3"><a href="#cb303-3" aria-hidden="true" tabindex="-1"></a>auto x3 <span class="kw">=</span> to&lt;&gt;(<span class="fl">1.2</span>)<span class="kw">;</span>                <span class="fu">//</span> <span class="dt">Target</span> <span class="dt">is</span> defaulted to string<span class="kw">;</span> <span class="dt">Source</span> <span class="dt">is</span> deduced to double</span>
<span id="cb303-4"><a href="#cb303-4" aria-hidden="true" tabindex="-1"></a>auto x4 <span class="kw">=</span> to(<span class="fl">1.2</span>)<span class="kw">;</span>                  <span class="fu">//</span> the &lt;&gt; <span class="dt">is</span> redundant<span class="kw">;</span></span>
<span id="cb303-5"><a href="#cb303-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">//</span> <span class="dt">Target</span> <span class="dt">is</span> defaulted to string<span class="kw">;</span> <span class="dt">Source</span> <span class="dt">is</span> deduced to double</span></code></pre></div>
<p>If all function template arguments are defaulted, the <code
class="calibre8">&lt;&gt;</code> can be left out.</p>
<p>I consider this a good example of the generality and ease of use that
can be achieved by a combination of language features and
standard-library facilities.</p>
<h3 class="h2" id="part0015.html#ch10lev1sec9">10.9 C-style I/O</h3>
<p>The C++ standard library also supports the C standard-library I/O,
including <code class="calibre8">printf()</code> and <code
class="calibre8">scanf()</code>. Many uses of this library are unsafe
from a type and security point-of-view, so I don’t recommend its use. In
particular, it can be difficult to use for safe and convenient input. It
does not support user-defined types. If you <em>don’t</em> use C-style
I/O and care about I/O performance, call</p>
<p><a href="#part0034_split_025.html#p0132_01a"
id="part0015.html#p0132_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb304"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a>ios_base::sync_with_stdio(<span class="kw">false</span>)<span class="kw">;</span>     <span class="fu">//</span> avoid significant overhead</span></code></pre></div>
<p>Without that call, <code class="calibre8">iostream</code>s can be
significantly slowed down to be compatible with the C-style I/O.</p>
<h3 class="h2" id="part0015.html#ch10lev1sec10">10.10 File System</h3>
<p>Most systems have a notion of a <em>file system</em> providing access
to permanent information stored as <em>files</em>. Unfortunately, the
properties of file systems and the ways of manipulating them vary
greatly. To deal with that, the file system library in <code
class="calibre8">&lt;filesystem&gt;</code> offers a uniform interface to
most facilities of most file systems. Using <code
class="calibre8">&lt;filesystem&gt;</code>, we can portably</p>
<ul>
<li><p>express file system paths and navigate through a file
system</p></li>
<li><p>examine file types and the permissions associated with
them</p></li>
</ul>
<p>The filesystem library can handle unicode, but explaining how is
beyond the scope of this book. I recommend the cppreference [<a
href="#part0021.html#ref13" class="calibre6">Cppreference</a>] and the
Boost filesystem documentation [<a href="#part0021.html#ref1"
class="calibre6">Boost</a>] for detailed information.</p>
<p>Consider an example:</p>
<p><a href="#part0034_split_026.html#p0132_02a"
id="part0015.html#p0132_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb305"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a>path f <span class="kw">=</span> <span class="ot">&quot;</span><span class="er">dir</span><span class="ot">/</span><span class="er">hypothetical</span><span class="ot">.</span><span class="er">cpp</span><span class="ot">&quot;</span><span class="kw">;</span>    <span class="fu">//</span> naming a file</span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a>assert(exists(f))<span class="kw">;</span>        <span class="fu">//</span> f must exist</span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a>if (is_regular_file(f))   <span class="fu">//</span> <span class="dt">is</span> f an ordinary file?</span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> f <span class="al">&lt;&lt;</span> <span class="er">&quot;</span> <span class="dt">is</span> a file<span class="kw">;</span> its size <span class="dt">is</span> <span class="er">&quot;</span> <span class="al">&lt;&lt;</span> file_size(f) <span class="al">&lt;&lt;</span> <span class="er">&#39;</span><span class="al">\</span>n<span class="er">&#39;</span><span class="kw">;</span></span></code></pre></div>
<p>Note that a program manipulating a file system is usually running on
a computer together with other programs. Thus, the contents of a file
system can change between two commands. For example, even though we
first of all carefully asserted the <code class="calibre8">f</code>
existed, that may no longer be true when on the next line, we ask if
<code class="calibre8">f</code> is a regular file.</p>
<p>A <code class="calibre8">path</code> is quite a complicated class,
capable of handling the native character sets and conventions of many
operating systems. In particular, it can handle file names from command
lines as presented by <code class="calibre8">main()</code>; for
example:</p>
<p><a href="#part0034_split_027.html#p0132_03a"
id="part0015.html#p0132_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb306"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>int main(int argc<span class="kw">,</span> char<span class="fu">*</span> argv[])</span>
<span id="cb306-2"><a href="#cb306-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb306-3"><a href="#cb306-3" aria-hidden="true" tabindex="-1"></a>     if (argc <span class="dt">&lt;</span> <span class="dv">2</span>) <span class="kw">{</span></span>
<span id="cb306-4"><a href="#cb306-4" aria-hidden="true" tabindex="-1"></a>           cerr <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">arguments expected</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb306-5"><a href="#cb306-5" aria-hidden="true" tabindex="-1"></a>           return <span class="dv">1</span><span class="kw">;</span></span>
<span id="cb306-6"><a href="#cb306-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb306-7"><a href="#cb306-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-8"><a href="#cb306-8" aria-hidden="true" tabindex="-1"></a>     path p <span class="kw">{</span>argv[<span class="dv">1</span>]<span class="kw">};</span>   <span class="fu">//</span> create a path from the command line</span>
<span id="cb306-9"><a href="#cb306-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-10"><a href="#cb306-10" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> p <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er"> </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> exists(p) <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span>    <span class="fu">//</span> note<span class="fu">:</span> a path can be printed like a string</span>
<span id="cb306-11"><a href="#cb306-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb306-12"><a href="#cb306-12" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>A <code class="calibre8">path</code> is not checked for validity
until it is used. Even then, its validity depends on the conventions of
the system on which the program runs.</p>
<p><span id="part0015.html#page_133" class="pagebreak"></span>Naturally,
a <code class="calibre8">path</code> can be used to open a file</p>
<p><a href="#part0034_split_028.html#p0133_01a"
id="part0015.html#p0133_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb307"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>void use(path p)</span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a>     ofstream f <span class="kw">{</span>p<span class="kw">};</span></span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a>     if (<span class="kw">!</span>f) error(<span class="ot">&quot;</span><span class="er">bad file name</span><span class="ot">:</span><span class="er"> </span><span class="ot">&quot;</span><span class="kw">,</span> p)<span class="kw">;</span></span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a>     f <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">Hello</span><span class="ot">,</span><span class="er"> file</span><span class="ot">!&quot;</span><span class="kw">;</span></span>
<span id="cb307-6"><a href="#cb307-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>In addition to <code class="calibre8">path</code>, <code
class="calibre8">&lt;filesystem&gt;</code> offers types for traversing
directories and inquiring about the properties of the files found:</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>File System Types
(partial)</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">path</code></p></td>
<td class="calibre14"><p>A directory path</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">filesystem_error</code></p></td>
<td class="calibre14"><p>A file system exception</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">directory_entry</code></p></td>
<td class="calibre14"><p>A directory entry</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">directory_iterator</code></p></td>
<td class="calibre14"><p>For iterating over a directory</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">recursive_directory_iterator</code></p></td>
<td class="calibre14"><p>For iterating over a directory and its
subdirectories</p></td>
</tr>
</tbody>
</table>
<p>Consider a simple, but not completely unrealistic, example:</p>
<p><a href="#part0034_split_029.html#p0133_02a"
id="part0015.html#p0133_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb308"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>void print_directory(path p)</span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a>try</span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb308-4"><a href="#cb308-4" aria-hidden="true" tabindex="-1"></a>     if (is_directory(p)) <span class="kw">{</span></span>
<span id="cb308-5"><a href="#cb308-5" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> p <span class="al">&lt;&lt;</span> <span class="ot">&quot;:</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb308-6"><a href="#cb308-6" aria-hidden="true" tabindex="-1"></a>           for (const directory_entry&amp; x <span class="fu">:</span> directory_iterator<span class="kw">{</span>p<span class="kw">}</span>)</span>
<span id="cb308-7"><a href="#cb308-7" aria-hidden="true" tabindex="-1"></a>                 cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">  </span><span class="ot">&quot;</span> <span class="al">&lt;&lt;</span> x.path() <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb308-8"><a href="#cb308-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb308-9"><a href="#cb308-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb308-10"><a href="#cb308-10" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> (const filesystem_error&amp; ex) <span class="kw">{</span></span>
<span id="cb308-11"><a href="#cb308-11" aria-hidden="true" tabindex="-1"></a>     cerr <span class="al">&lt;&lt;</span> ex.what() <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb308-12"><a href="#cb308-12" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>A string can be implicitly converted to a <code
class="calibre8">path</code> so we can exercise <code
class="calibre8">print_directory</code> like this:</p>
<p><a href="#part0034_split_030.html#p0133_03a"
id="part0015.html#p0133_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb309"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a>void use()</span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>     print_directory(<span class="ot">&quot;.&quot;</span>)<span class="kw">;</span>     <span class="fu">//</span> current directory</span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a>     print_directory(<span class="ot">&quot;..&quot;</span>)<span class="kw">;</span>    <span class="fu">//</span> parent directory</span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a>     print_directory(<span class="ot">&quot;/&quot;</span>)<span class="kw">;</span>     <span class="fu">//</span> <span class="dt">Unix</span> root directory</span>
<span id="cb309-6"><a href="#cb309-6" aria-hidden="true" tabindex="-1"></a>     print_directory(<span class="ot">&quot;</span><span class="er">c</span><span class="ot">:&quot;</span>)<span class="kw">;</span>    <span class="fu">//</span> <span class="dt">Windows</span> volume <span class="dt">C</span></span>
<span id="cb309-7"><a href="#cb309-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-8"><a href="#cb309-8" aria-hidden="true" tabindex="-1"></a>     for (string s<span class="kw">;</span> cin<span class="al">&gt;&gt;</span>s<span class="kw">;</span> )</span>
<span id="cb309-9"><a href="#cb309-9" aria-hidden="true" tabindex="-1"></a>           print_directory(s)<span class="kw">;</span></span>
<span id="cb309-10"><a href="#cb309-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Had I wanted to list subdirectories also, I would have said <code
class="calibre8">recursive_directory_iterator{p}</code>. Had I wanted to
print entries in lexicographical order, I would have copied the <code
class="calibre8">path</code>s into a <code
class="calibre8">vector</code> and sorted that before printing.</p>
<p><span id="part0015.html#page_134" class="pagebreak"></span>Class
<code class="calibre8">path</code> offers many common and useful
operations:</p>
<table class="all">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>Path Operations
(partial)</strong><br />
<code class="calibre8">p</code> and <code class="calibre8">p2</code> are
<code class="calibre8">path</code>s</p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">value_type</code></p></td>
<td class="calibre14"><p>Character type used by the native encoding of
the filesystem: <code class="calibre8">char</code> on POSIX, <code
class="calibre8">wchar_t</code> on Windows</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">string_type</code></p></td>
<td class="calibre14"><p><code
class="calibre8">std::basic_string&lt;value_type&gt;</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">const_iterator</code></p></td>
<td class="calibre14"><p>A <code class="calibre8">const</code>
BidirectionalIterator with a <code class="calibre8">value_type</code> of
<code class="calibre8">path</code></p></td>
</tr>
<tr class="even calibre13">
<td class="tab1"><p><code class="calibre8">iterator</code></p></td>
<td class="tab1"><p>Alias for <code
class="calibre8">const_iterator</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">p=p2</code></p></td>
<td class="calibre14"><p>Assign <code class="calibre8">p2</code> to
<code class="calibre8">p</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">p/=p2</code></p></td>
<td class="calibre14"><p><code class="calibre8">p</code> and <code
class="calibre8">p2</code> concatenated using the file-name separator
(by default <code class="calibre8">/</code>)</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">p+=p2</code></p></td>
<td class="calibre14"><p><code class="calibre8">p</code> and <code
class="calibre8">p2</code> concatenated (no separator)</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">p.native()</code></p></td>
<td class="calibre14"><p>The native format of <code
class="calibre8">p</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p.string()</code></p></td>
<td class="calibre14"><p><code class="calibre8">p</code> in the native
format of <code class="calibre8">p</code> as a <code
class="calibre8">string</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">p.generic_string()</code></p></td>
<td class="calibre14"><p><code class="calibre8">p</code> in the generic
format as a <code class="calibre8">string</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p.filename()</code></p></td>
<td class="calibre14"><p>The filename part of <code
class="calibre8">p</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">p.stem()</code></p></td>
<td class="calibre14"><p>The stem part of <code
class="calibre8">p</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p.extension()</code></p></td>
<td class="calibre14"><p>The file extension part of <code
class="calibre8">p</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">p.begin()</code></p></td>
<td class="calibre14"><p>The beginning of <code
class="calibre8">p</code>’s element sequence</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">p.end()</code></p></td>
<td class="calibre14"><p>The end of <code class="calibre8">p</code>’s
element sequence</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">p==p2</code>, <code
class="calibre8">p!=p2</code></p></td>
<td class="calibre14"><p>Equality and inequality for <code
class="calibre8">p</code> and <code class="calibre8">p2</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">p&lt;p2</code>, <code
class="calibre8">p&lt;=p2</code>, <code class="calibre8">p&gt;p2</code>,
<code class="calibre8">p&gt;=p2</code></p></td>
<td class="calibre14"><p>Lexicographical comparisons</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">is&gt;&gt;p</code>,
<code class="calibre8">os&lt;&lt;p</code></p></td>
<td class="calibre14"><p>Stream I/O to/from <code
class="calibre8">p</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">u8path(s)</code></p></td>
<td class="calibre14"><p>A path from a UTF-8 encoded source <code
class="calibre8">s</code></p></td>
</tr>
</tbody>
</table>
<p>For example:</p>
<p><a href="#part0034_split_031.html#p0134_01a"
id="part0015.html#p0134_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb310"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a>void test(path p)</span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>     if (is_directory(p)) <span class="kw">{</span></span>
<span id="cb310-4"><a href="#cb310-4" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> p <span class="al">&lt;&lt;</span> <span class="ot">&quot;:</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb310-5"><a href="#cb310-5" aria-hidden="true" tabindex="-1"></a>           for (const directory_entry&amp; x <span class="fu">:</span> directory_iterator(p)) <span class="kw">{</span></span>
<span id="cb310-6"><a href="#cb310-6" aria-hidden="true" tabindex="-1"></a>                const path&amp; f <span class="kw">=</span> x<span class="kw">;</span>  <span class="fu">//</span> refer to the path part of a directory entry</span>
<span id="cb310-7"><a href="#cb310-7" aria-hidden="true" tabindex="-1"></a>                if (f<span class="al">.</span>extension() <span class="fu">==</span> <span class="ot">&quot;.</span><span class="er">exe</span><span class="ot">&quot;</span>)</span>
<span id="cb310-8"><a href="#cb310-8" aria-hidden="true" tabindex="-1"></a>                     cout <span class="al">&lt;&lt;</span> f.stem() <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er"> is a Windows executable</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb310-9"><a href="#cb310-9" aria-hidden="true" tabindex="-1"></a>                else <span class="kw">{</span></span>
<span id="cb310-10"><a href="#cb310-10" aria-hidden="true" tabindex="-1"></a>                     string n <span class="kw">=</span> f.extension().string()<span class="kw">;</span></span>
<span id="cb310-11"><a href="#cb310-11" aria-hidden="true" tabindex="-1"></a>                     if (n <span class="fu">==</span> <span class="ot">&quot;.</span><span class="er">cpp</span><span class="ot">&quot;</span> || n <span class="fu">==</span> <span class="ot">&quot;.</span><span class="er">C</span><span class="ot">&quot;</span> || n <span class="fu">==</span> <span class="ot">&quot;.</span><span class="er">cxx</span><span class="ot">&quot;</span>)</span>
<span id="cb310-12"><a href="#cb310-12" aria-hidden="true" tabindex="-1"></a>                          cout <span class="al">&lt;&lt;</span> f.stem() <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er"> is a C</span><span class="ot">++</span><span class="er"> source file</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb310-13"><a href="#cb310-13" aria-hidden="true" tabindex="-1"></a>                <span class="kw">}</span></span>
<span id="cb310-14"><a href="#cb310-14" aria-hidden="true" tabindex="-1"></a>          <span class="kw">}</span></span>
<span id="cb310-15"><a href="#cb310-15" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb310-16"><a href="#cb310-16" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>We use a <code class="calibre8">path</code> as a string (e.g., <code
class="calibre8">f.extension</code>) and we can extract strings of
various types from a <code class="calibre8">path</code> (e.g., <code
class="calibre8">f.extension().string()</code>).</p>
<p><span id="part0015.html#page_135" class="pagebreak"></span>Note that
naming conventions, natural languages, and string encodings are rich in
complexity. The filesystem-library abstractions offer portability and
great simplification.</p>
<table class="all">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>File System Operations
(partial)</strong><br />
<code class="calibre8">p</code>, <code class="calibre8">p1</code>, and
<code class="calibre8">p2</code> are <code
class="calibre8">path</code>s; <code class="calibre8">e</code> is an
<code class="calibre8">error_code</code>; <code
class="calibre8">b</code> is a bool indicating success or
failure</p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">exists(p)</code></p></td>
<td class="calibre14"><p>Does <code class="calibre8">p</code> refer to
an existing file system object?</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">copy(p1,p2)</code></p></td>
<td class="calibre14"><p>Copy files or directories from <code
class="calibre8">p1</code> to <code class="calibre8">p2</code>; report
errors as exceptions</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">copy(p1,p2,e)</code></p></td>
<td class="calibre14"><p>Copy files or directories; report errors as
error codes</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">b=copy_file(p1,p2)</code></p></td>
<td class="calibre14"><p>Copy file contents from <code
class="calibre8">p1</code> to <code class="calibre8">p2</code>; report
errors as exceptions</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">b=create_directory(p)</code></p></td>
<td class="calibre14"><p>Create new directory named <code
class="calibre8">p</code>; all intermediate directories on <code
class="calibre8">p</code> must exist</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">b=create_directories(p)</code></p></td>
<td class="calibre14"><p>Create new directory named <code
class="calibre8">p</code>; create all intermediate directories on <code
class="calibre8">p</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p=current_path()</code></p></td>
<td class="calibre14"><p><code class="calibre8">p</code> is the current
working directory</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">current_path(p)</code></p></td>
<td class="calibre14"><p>Make <code class="calibre8">p</code> the
current working directory</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">s=file_size(p)</code></p></td>
<td class="calibre14"><p><code class="calibre8">s</code> is the number
of bytes in <code class="calibre8">p</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">b=remove(p)</code></p></td>
<td class="calibre14"><p>Remove <code class="calibre8">p</code> if it is
a file or an empty directory</p></td>
</tr>
</tbody>
</table>
<p>Many operations have overloads that take extra arguments, such as
operating systems permissions. The handling of such is far beyond the
scope of this book, so look them up if you need them.</p>
<p>Like <code class="calibre8">copy()</code>, all operations come in two
versions:</p>
<ul>
<li><p>The basic version as listed in the table, e.g., <code
class="calibre8">exists(p)</code>. The function will throw <code
class="calibre8">filesystem_error</code> if the operation
failed.</p></li>
<li><p>A version with an extra <code class="calibre8">error_code</code>
argument, e.g., <code class="calibre8">exists(p,e)</code>. Check <code
class="calibre8">e</code> to see if the operations succeeded.</p></li>
</ul>
<p>We use the error codes when operations are expected to fail
frequently in normal use and the throwing operations when an error is
considered exceptional.</p>
<p>Often, using an inquiry function is the simplest and most
straightforward approach to examining the properties of a file. The
<code class="calibre8">&lt;filesystem&gt;</code> library knows about a
few common kinds of files and classifies the rest as “other”:</p>
<table class="all">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>File types</strong><br />
<code class="calibre8">f</code> Is a <code class="calibre8">path</code>
or a <code class="calibre8">file_status</code></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">is_block_file(f)</code></p></td>
<td class="calibre14"><p>Is <code class="calibre8">f</code> a block
device?</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">is_character_file(f)</code></p></td>
<td class="calibre14"><p>Is <code class="calibre8">f</code> a character
device?</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">is_directory(f)</code></p></td>
<td class="calibre14"><p>Is <code class="calibre8">f</code> a
directory?</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">is_empty(f)</code></p></td>
<td class="calibre14"><p>Is <code class="calibre8">f</code> an empty
file or directory?</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">is_fifo(f)</code></p></td>
<td class="calibre14"><p>Is <code class="calibre8">f</code> a named
pipe?</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">is_other(f)</code></p></td>
<td class="calibre14"><p>Is <code class="calibre8">f</code> some other
kind of file?</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">is_regular_file(f)</code></p></td>
<td class="calibre14"><p>Is <code class="calibre8">f</code> a regular
(ordinary) file?</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">is_socket(f)</code></p></td>
<td class="calibre14"><p>Is <code class="calibre8">f</code> a named IPC
socket?</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">is_symlink(f)</code></p></td>
<td class="calibre14"><p>Is <code class="calibre8">f</code> a symbolic
link?</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">status_known(f)</code></p></td>
<td class="calibre14"><p>Is <code class="calibre8">f</code>’s file
status known?</p></td>
</tr>
</tbody>
</table>
<h3 class="h2" id="part0015.html#ch10lev1sec11"><span
id="part0015.html#page_136" class="calibre2 pagebreak"></span>10.11
Advice</h3>
<p>[1] <code class="calibre8">iostream</code>s are type-safe,
type-sensitive, and extensible; §<a href="#part0015.html#ch10lev1sec1"
class="calibre6">10.1</a>.</p>
<p>[2] Use character-level input only when you have to; §<a
href="#part0015.html#ch10lev1sec3" class="calibre6">10.3</a>; [CG:
SL.io.1].</p>
<p>[3] When reading, always consider ill-formed input; §<a
href="#part0015.html#ch10lev1sec3" class="calibre6">10.3</a>; [CG:
SL.io.2].</p>
<p>[4] Avoid <code class="calibre8">endl</code> (if you don’t know what
<code class="calibre8">endl</code> is, you haven’t missed anything);
[CG: SL.io.50].</p>
<p>[5] Define <code class="calibre8">&lt;&lt;</code> and <code
class="calibre8">&gt;&gt;</code> for user-defined types with values that
have meaningful textual representations; §<a
href="#part0015.html#ch10lev1sec1" class="calibre6">10.1</a>, §<a
href="#part0015.html#ch10lev1sec2" class="calibre6">10.2</a>, §<a
href="#part0015.html#ch10lev1sec3" class="calibre6">10.3</a>.</p>
<p>[6] Use <code class="calibre8">cout</code> for normal output and
<code class="calibre8">cerr</code> for errors; §<a
href="#part0015.html#ch10lev1sec1" class="calibre6">10.1</a>.</p>
<p>[7] There are <code class="calibre8">iostream</code>s for ordinary
characters and wide characters, and you can define an <code
class="calibre8">iostream</code> for any kind of character; §<a
href="#part0015.html#ch10lev1sec1" class="calibre6">10.1</a>.</p>
<p>[8] Binary I/O is supported; §<a href="#part0015.html#ch10lev1sec1"
class="calibre6">10.1</a>.</p>
<p>[9] There are standard <code class="calibre8">iostream</code>s for
standard I/O streams, files, and <code class="calibre8">string</code>s;
§<a href="#part0015.html#ch10lev1sec2" class="calibre6">10.2</a>, §<a
href="#part0015.html#ch10lev1sec3" class="calibre6">10.3</a>, §<a
href="#part0015.html#ch10lev1sec7" class="calibre6">10.7</a>, §<a
href="#part0015.html#ch10lev1sec8" class="calibre6">10.8</a>.</p>
<p>[10] Chain <code class="calibre8">&lt;&lt;</code> operations for a
terser notation; §<a href="#part0015.html#ch10lev1sec2"
class="calibre6">10.2</a>.</p>
<p>[11] Chain <code class="calibre8">&gt;&gt;</code> operations for a
terser notation; §<a href="#part0015.html#ch10lev1sec3"
class="calibre6">10.3</a>.</p>
<p>[12] Input into <code class="calibre8">string</code>s does not
overflow; §<a href="#part0015.html#ch10lev1sec3"
class="calibre6">10.3</a>.</p>
<p>[13] By default <code class="calibre8">&gt;&gt;</code> skips initial
whitespace; §<a href="#part0015.html#ch10lev1sec3"
class="calibre6">10.3</a>.</p>
<p>[14] Use the stream state <code class="calibre8">fail</code> to
handle potentially recoverable I/O errors; §<a
href="#part0015.html#ch10lev1sec4" class="calibre6">10.4</a>.</p>
<p>[15] You can define <code class="calibre8">&lt;&lt;</code> and <code
class="calibre8">&gt;&gt;</code> operators for your own types; §<a
href="#part0015.html#ch10lev1sec5" class="calibre6">10.5</a>.</p>
<p>[16] You don’t need to modify <code class="calibre8">istream</code>
or <code class="calibre8">ostream</code> to add new <code
class="calibre8">&lt;&lt;</code> and <code
class="calibre8">&gt;&gt;</code> operators; §<a
href="#part0015.html#ch10lev1sec5" class="calibre6">10.5</a>.</p>
<p>[17] Use manipulators to control formatting; §<a
href="#part0015.html#ch10lev1sec6" class="calibre6">10.6</a>.</p>
<p>[18] <code class="calibre8">precision()</code> specifications apply
to all following floating-point output operations; §<a
href="#part0015.html#ch10lev1sec6" class="calibre6">10.6</a>.</p>
<p>[19] Floating-point format specifications (e.g., <code
class="calibre8">scientific</code>) apply to all following
floating-point output operations; §<a href="#part0015.html#ch10lev1sec6"
class="calibre6">10.6</a>.</p>
<p>[20] <code class="calibre8">#include &lt;ios&gt;</code> when using
standard manipulators; §<a href="#part0015.html#ch10lev1sec6"
class="calibre6">10.6</a>.</p>
<p>[21] <code class="calibre8">#include &lt;iomanip&gt;</code> when
using standard manipulators taking arguments; §<a
href="#part0015.html#ch10lev1sec6" class="calibre6">10.6</a>.</p>
<p>[22] Don’t try to copy a file stream.</p>
<p>[23] Remember to check that a file stream is attached to a file
before using it; §<a href="#part0015.html#ch10lev1sec7"
class="calibre6">10.7</a>.</p>
<p>[24] Use <code class="calibre8">stringstream</code>s for in-memory
formatting; §<a href="#part0015.html#ch10lev1sec8"
class="calibre6">10.8</a>.</p>
<p>[25] You can define conversions between any two types that both have
string representation; §<a href="#part0015.html#ch10lev1sec8"
class="calibre6">10.8</a>.</p>
<p>[26] C-style I/O is not type-safe; §<a
href="#part0015.html#ch10lev1sec9" class="calibre6">10.9</a>.</p>
<p>[27] Unless you use printf-family functions call <code
class="calibre8">ios_base::sync_with_stdio(false)</code>; §<a
href="#part0015.html#ch10lev1sec9" class="calibre6">10.9</a>; [CG:
SL.io.10].</p>
<p>[28] Prefer <code class="calibre8">&lt;filesystem&gt;</code> to
direct use of a specific operating system interfaces; §<a
href="#part0015.html#ch10lev1sec10" class="calibre6">10.10</a>.</p>
</section>
<p><span id="part0016.html"></span></p>
<section id="part0016.html#ch11" class="h1 bodymatter">
<h2 class="h1"><span id="part0016.html#page_137"
class="calibre2 pagebreak"></span><span class="big">11</span></h2>
<p>Containers</p>
<p><em>It was new.</em><br />
<em>It was singular.</em><br />
<em>It was simple.</em><br />
<em>It must succeed!</em></p>
<p><em>– H. Nelson</em></p>
<ul>
<li><p><a href="#part0016.html#ch11lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0016.html#ch11lev1sec2" class="calibre6"><code
class="calibre8">vector</code></a></p>
<p><a href="#part0016.html#ch11lev2sec1" class="calibre6">Elements</a>;
<a href="#part0016.html#ch11lev2sec2" class="calibre6">Range
Checking</a></p></li>
<li><p><a href="#part0016.html#ch11lev1sec3" class="calibre6"><code
class="calibre8">list</code></a></p></li>
<li><p><a href="#part0016.html#ch11lev1sec4" class="calibre6"><code
class="calibre8">map</code></a></p></li>
<li><p><a href="#part0016.html#ch11lev1sec5" class="calibre6"><code
class="calibre8">unordered_map</code></a></p></li>
<li><p><a href="#part0016.html#ch11lev1sec6" class="calibre6">Container
Overview</a></p></li>
<li><p><a href="#part0016.html#ch11lev1sec7"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0016.html#ch11lev1sec1">11.1 Introduction</h3>
<p>Most computing involves creating collections of values and then
manipulating such collections. Reading characters into a <code
class="calibre8">string</code> and printing out the <code
class="calibre8">string</code> is a simple example. A class with the
main purpose of holding objects is commonly called a <em>container</em>.
Providing suitable containers for a given task and supporting them with
useful fundamental operations are important steps in the construction of
any program.</p>
<p>To illustrate the standard-library containers, consider a simple
program for keeping names and telephone numbers. This is the kind of
program for which different approaches appear “simple and obvious” to
people of different backgrounds. The <code class="calibre8">Entry</code>
class from §<a href="#part0015.html#ch10lev1sec5"
class="calibre6">10.5</a> can be used to hold a simple phone book entry.
Here, we deliberately ignore many real-world complexities, such as the
fact that many phone numbers do not have a simple representation as a
32-bit <code class="calibre8">int</code>.</p>
<h3 class="h2" id="part0016.html#ch11lev1sec2"><span
id="part0016.html#page_138" class="calibre2 pagebreak"></span>11.2 <code
class="calibre17">vector</code></h3>
<p>The most useful standard-library container is <code
class="calibre8">vector</code>. A <code class="calibre8">vector</code>
is a sequence of elements of a given type. The elements are stored
contiguously in memory. A typical implementation of <code
class="calibre8">vector</code> (§<a href="#part0009.html#ch04lev2sec2"
class="calibre6">4.2.2</a>, §<a href="#part0010.html#ch05lev1sec2"
class="calibre6">5.2</a>) will consist of a handle holding pointers to
the first element, one-past-the-last element, and one-past-the-last
allocated space (§<a href="#part0017.html#ch12lev1sec1"
class="calibre6">12.1</a>) (or the equivalent information represented as
a pointer plus offsets):</p>
<figure>
<img src="images/00022.jpeg" class="calibre1" />
</figure>
<p>In addition, it holds an allocator (here, <code
class="calibre8">alloc</code>), from which the <code
class="calibre8">vector</code> can acquire memory for its elements. The
default allocator uses <code class="calibre8">new</code> and <code
class="calibre8">delete</code> to acquire and release memory (§<a
href="#part0018.html#ch13lev1sec6" class="calibre6">13.6</a>).</p>
<p>We can initialize a <code class="calibre8">vector</code> with a set
of values of its element type:</p>
<p><a href="#part0035_split_000.html#p0138_01a"
id="part0016.html#p0138_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb311"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;Entry</span><span class="er">&gt;</span> phone_book <span class="kw">=</span> <span class="kw">{</span></span>
<span id="cb311-2"><a href="#cb311-2" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span><span class="ot">&quot;</span><span class="er">David Hume</span><span class="ot">&quot;</span><span class="kw">,</span><span class="dv">123456</span><span class="kw">},</span></span>
<span id="cb311-3"><a href="#cb311-3" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Karl Popper</span><span class="ot">&quot;</span><span class="kw">,</span><span class="dv">234567</span><span class="kw">},</span></span>
<span id="cb311-4"><a href="#cb311-4" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Bertrand Arthur William Russell</span><span class="ot">&quot;</span><span class="kw">,</span><span class="dv">345678</span><span class="kw">}</span></span>
<span id="cb311-5"><a href="#cb311-5" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>Elements can be accessed through subscripting. So, assuming that we
have defined <code class="calibre8">&lt;&lt;</code> for <code
class="calibre8">Entry</code>, we can write:</p>
<p><a href="#part0035_split_001.html#p0138_02a"
id="part0016.html#p0138_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb312"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>void print_book(const vector<span class="dt">&lt;Entry</span>&gt;&amp; book)</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a>     for (int i <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>book<span class="al">.</span>size()<span class="kw">;</span> ++i)</span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> book[i] <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>As usual, indexing starts at <code class="calibre8">0</code> so that
<code class="calibre8">book[0]</code> holds the entry for <code
class="calibre8">David Hume</code>. The <code
class="calibre8">vector</code> member function <code
class="calibre8">size()</code> gives the number of elements.</p>
<p>The elements of a <code class="calibre8">vector</code> constitute a
range, so we can use a range-<code class="calibre8">for</code> loop (§<a
href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>):</p>
<p><a href="#part0035_split_002.html#p0138_03a"
id="part0016.html#p0138_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb313"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a>void print_book(const vector<span class="dt">&lt;Entry</span>&gt;&amp; book)</span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a>     for (const auto&amp; x <span class="fu">:</span> book)     <span class="fu">//</span> for <span class="ot">&quot;</span><span class="er">auto</span><span class="ot">&quot;</span> see <span class="er">§</span><span class="fl">1.4</span></span>
<span id="cb313-4"><a href="#cb313-4" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> x <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb313-5"><a href="#cb313-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>When we define a <code class="calibre8">vector</code>, we give it an
initial size (initial number of elements):</p>
<p><a href="#part0035_split_003.html#p0138_04a"
id="part0016.html#p0138_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb314"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> v1 <span class="kw">=</span> <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span> <span class="dv">2</span><span class="kw">,</span> <span class="dv">3</span><span class="kw">,</span> <span class="dv">4</span><span class="kw">};</span>     <span class="fu">//</span> sizeis4</span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>string<span class="er">&gt;</span> v2<span class="kw">;</span>                 <span class="fu">//</span> sizeis0</span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;Shape</span>*&gt; v3(<span class="dv">23</span>)<span class="kw">;</span>             <span class="fu">//</span> size <span class="dt">is</span> <span class="dv">23</span><span class="kw">;</span> initial element value<span class="fu">:</span> nullptr</span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>double<span class="er">&gt;</span> v4(<span class="dv">32</span><span class="kw">,</span><span class="fl">9.9</span>)<span class="kw">;</span>         <span class="fu">//</span> size <span class="dt">is</span> <span class="dv">32</span><span class="kw">;</span> initial element value<span class="fu">:</span> <span class="fl">9.9</span></span></code></pre></div>
<p><span id="part0016.html#page_139" class="pagebreak"></span>An
explicit size is enclosed in ordinary parentheses, for example, <code
class="calibre8">(23)</code>, and by default, the elements are
initialized to the element type’s default value (e.g., <code
class="calibre8">nullptr</code> for pointers and <code
class="calibre8">0</code> for numbers). If you don’t want the default
value, you can specify one as a second argument (e.g., <code
class="calibre8">9.9</code> for the <code class="calibre8">32</code>
elements of <code class="calibre8">v4</code>).</p>
<p>The initial size can be changed. One of the most useful operations on
a <code class="calibre8">vector</code> is <code
class="calibre8">push_back()</code>, which adds a new element at the end
of a <code class="calibre8">vector</code>, increasing its size by one.
For example, assuming that we have defined <code
class="calibre8">&gt;&gt;</code> for <code
class="calibre8">Entry</code>, we can write:</p>
<p><a href="#part0035_split_004.html#p0139_01a"
id="part0016.html#p0139_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb315"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a>void input()</span>
<span id="cb315-2"><a href="#cb315-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb315-3"><a href="#cb315-3" aria-hidden="true" tabindex="-1"></a>     for (<span class="dt">Entry</span> e<span class="kw">;</span> cin<span class="al">&gt;&gt;</span>e<span class="kw">;</span>)</span>
<span id="cb315-4"><a href="#cb315-4" aria-hidden="true" tabindex="-1"></a>           phone_book.push_back(e)<span class="kw">;</span></span>
<span id="cb315-5"><a href="#cb315-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This reads <code class="calibre8">Entry</code>s from the standard
input into <code class="calibre8">phone_book</code> until either the
end-of-input (e.g., the end of a file) is reached or the input operation
encounters a format error.</p>
<p>The standard-library <code class="calibre8">vector</code> is
implemented so that growing a <code class="calibre8">vector</code> by
repeated <code class="calibre8">push_back()</code>s is efficient. To
show how, consider an elaboration of the simple <code
class="calibre8">Vector</code> from (<a href="#part0009.html#ch04"
class="calibre6">Chapter 4</a> and <a href="#part0011.html#ch06"
class="calibre6">Chapter 6</a>) using the representation indicated in
the diagram above:</p>
<p><a href="#part0035_split_005.html#p0139_02a"
id="part0016.html#p0139_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb316"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vector</span> <span class="kw">{</span></span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">T</span><span class="fu">*</span> elem<span class="kw">;</span>     <span class="fu">//</span> pointer to first element</span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">T</span><span class="fu">*</span> space<span class="kw">;</span>    <span class="fu">//</span> pointer to first unused (and uninitialized) slot</span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">T</span><span class="fu">*</span> last<span class="kw">;</span>     <span class="fu">//</span> pointer to last slot</span>
<span id="cb316-6"><a href="#cb316-6" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb316-7"><a href="#cb316-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb316-8"><a href="#cb316-8" aria-hidden="true" tabindex="-1"></a>     int size()<span class="kw">;</span>                     <span class="fu">//</span> <span class="dt">number</span> of elements (space<span class="fu">-</span>elem)</span>
<span id="cb316-9"><a href="#cb316-9" aria-hidden="true" tabindex="-1"></a>     int capacity()<span class="kw">;</span>                 <span class="fu">//</span> <span class="dt">number</span> of slots available for elements (last<span class="fu">-</span>elem)</span>
<span id="cb316-10"><a href="#cb316-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb316-11"><a href="#cb316-11" aria-hidden="true" tabindex="-1"></a>     void reserve(int newsz)<span class="kw">;</span>        <span class="fu">//</span> increase capacity() to newsz</span>
<span id="cb316-12"><a href="#cb316-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb316-13"><a href="#cb316-13" aria-hidden="true" tabindex="-1"></a>     void push_back(const <span class="dt">T</span>&amp; t)<span class="kw">;</span>     <span class="fu">//</span> copy t into <span class="dt">Vector</span></span>
<span id="cb316-14"><a href="#cb316-14" aria-hidden="true" tabindex="-1"></a>     void push_back(<span class="dt">T</span>&amp;&amp; t)<span class="kw">;</span>          <span class="fu">//</span> move t into <span class="dt">Vector</span></span>
<span id="cb316-15"><a href="#cb316-15" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>The standard-library <code class="calibre8">vector</code> has members
<code class="calibre8">capacity()</code>, <code
class="calibre8">reserve()</code>, and <code
class="calibre8">push_back()</code>. The <code
class="calibre8">reserve()</code> is used by users of <code
class="calibre8">vector</code> and other <code
class="calibre8">vector</code> members to make room for more elements.
It may have to allocate new memory and when it does, it moves the
elements to the new allocation.</p>
<p>Given <code class="calibre8">capacity()</code> and <code
class="calibre8">reserve()</code>, implementing <code
class="calibre8">push_back()</code> is trivial:</p>
<p><a href="#part0035_split_006.html#p0139_03a"
id="part0016.html#p0139_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb317"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a>void <span class="dt">Vector&lt;T</span>&gt;::push_back(const <span class="dt">T</span>&amp; t)</span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a>     if (capacity()<span class="er">&lt;</span>size()<span class="dt">+</span><span class="dv">1</span><span class="er">)</span>             <span class="fu">//</span> make sure we have space for t</span>
<span id="cb317-5"><a href="#cb317-5" aria-hidden="true" tabindex="-1"></a>           reserve(size()<span class="fu">==</span><span class="dv">0</span>?<span class="dv">8</span><span class="fu">:</span><span class="dv">2</span><span class="fu">*</span>size())<span class="kw">;</span> <span class="fu">//</span> double the capacity</span>
<span id="cb317-6"><a href="#cb317-6" aria-hidden="true" tabindex="-1"></a>     new(space) <span class="dt">T</span><span class="kw">{</span>t<span class="kw">};</span>                     <span class="fu">//</span> initialize <span class="fu">*</span>space to t</span>
<span id="cb317-7"><a href="#cb317-7" aria-hidden="true" tabindex="-1"></a>     ++space<span class="kw">;</span></span>
<span id="cb317-8"><a href="#cb317-8" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p><span id="part0016.html#page_140" class="pagebreak"></span>Now
allocation and relocation of elements happens only infrequently. I used
to use <code class="calibre8">reserve()</code> to try to improve
performance, but that turned out to be a waste of effort: the heuristic
used by <code class="calibre8">vector</code> is on average better than
my guesses, so now I only explicitly use <code
class="calibre8">reserve()</code> to avoid reallocation of elements when
I want to use pointers to elements.</p>
<p>A <code class="calibre8">vector</code> can be copied in assignments
and initializations. For example:</p>
<p><a href="#part0035_split_007.html#p0140_01a"
id="part0016.html#p0140_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb318"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;Entry</span><span class="er">&gt;</span> book2 <span class="kw">=</span> phone_book<span class="kw">;</span></span></code></pre></div>
<p>Copying and moving of <code class="calibre8">vector</code>s are
implemented by constructors and assignment operators as described in §<a
href="#part0010.html#ch05lev1sec2" class="calibre6">5.2</a>. Assigning a
<code class="calibre8">vector</code> involves copying its elements.
Thus, after the initialization of <code class="calibre8">book2</code>,
<code class="calibre8">book2</code> and <code
class="calibre8">phone_book</code> hold separate copies of every <code
class="calibre8">Entry</code> in the phone book. When a <code
class="calibre8">vector</code> holds many elements, such
innocent-looking assignments and initializations can be expensive. Where
copying is undesirable, references or pointers (§<a
href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>) or move
operations (§<a href="#part0010.html#ch05lev2sec5"
class="calibre6">5.2.2</a>) should be used.</p>
<p>The standard-library <code class="calibre8">vector</code> is very
flexible and efficient. Use it as your default container; that is, use
it unless you have a solid reason to use some other container. If you
avoid <code class="calibre8">vector</code> because of concerns about
“efficiency,” measure. Our intuition is most fallible in matters of the
performance of container uses.</p>
<h4 class="h3" id="part0016.html#ch11lev2sec1">11.2.1 Elements</h4>
<p>Like all standard-library containers, <code
class="calibre8">vector</code> is a container of elements of some type
<code class="calibre8">T</code>, that is, a <code
class="calibre8">vector&lt;T&gt;</code>. Just about any type qualifies
as an element type: built-in numeric types (such as <code
class="calibre8">char</code>, <code class="calibre8">int</code>, and
<code class="calibre8">double</code>), user-defined types (such as <code
class="calibre8">string</code>, <code class="calibre8">Entry</code>,
<code class="calibre8">list&lt;int&gt;</code>, and <code
class="calibre8">Matrix&lt;double,2&gt;</code>), and pointers (such as
<code class="calibre8">const char*</code>, <code
class="calibre8">Shape*</code>, and <code
class="calibre8">double*</code>). When you insert a new element, its
value is copied into the container. For example, when you put an integer
with the value <code class="calibre8">7</code> into a container, the
resulting element really has the value <code class="calibre8">7</code>.
The element is not a reference or a pointer to some object containing
<code class="calibre8">7</code>. This makes for nice, compact containers
with fast access. For people who care about memory sizes and run-time
performance this is critical.</p>
<p>If you have a class hierarchy (§<a href="#part0009.html#ch04lev1sec5"
class="calibre6">4.5</a>) that relies on <code
class="calibre8">virtual</code> functions to get polymorphic behavior,
do not store objects directly in a container. Instead store a pointer
(or a smart pointer; §<a href="#part0018.html#ch13lev2sec1"
class="calibre6">13.2.1</a>). For example:</p>
<p><a href="#part0035_split_008.html#p0140_02a"
id="part0016.html#p0140_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb319"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;Shape</span><span class="er">&gt;</span> vs<span class="kw">;</span>                  <span class="fu">//</span> <span class="dt">No</span><span class="kw">,</span> don<span class="st">&#39;</span><span class="er">t - there is no room for a Circle or a Smiley</span></span>
<span id="cb319-2"><a href="#cb319-2" aria-hidden="true" tabindex="-1"></a><span class="er">vector&lt;Shape*&gt; vps;                // better, but see §4.5.3</span></span>
<span id="cb319-3"><a href="#cb319-3" aria-hidden="true" tabindex="-1"></a><span class="er">vector&lt;unique_ptr&lt;Shape&gt;&gt; vups;    // OK</span></span></code></pre></div>
<h4 class="h3" id="part0016.html#ch11lev2sec2">11.2.2 Range
Checking</h4>
<p>The standard-library <code class="calibre8">vector</code> does not
guarantee range checking. For example:</p>
<p><a href="#part0035_split_009.html#p0140_03a"
id="part0016.html#p0140_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb320"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a>void silly(vector<span class="dt">&lt;Entry</span>&gt;&amp; book)</span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a>     int i <span class="kw">=</span> book[book.size()].<span class="dt">number</span><span class="kw">;</span>     <span class="fu">//</span> book.size() <span class="dt">is</span> out of range</span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a>     <span class="dv">//</span> ...</span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0016.html#page_141" class="pagebreak"></span>That
initialization is likely to place some random value in <code
class="calibre8">i</code> rather than giving an error. This is
undesirable, and out-of-range errors are a common problem. Consequently,
I often use a simple range-checking adaptation of <code
class="calibre8">vector</code>:</p>
<p><a href="#part0035_split_010.html#p0141_01a"
id="part0016.html#p0141_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb321"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Vec</span> <span class="fu">:</span> public std::vector<span class="dt">&lt;T</span><span class="er">&gt;</span> <span class="kw">{</span></span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a>     using vector<span class="dt">&lt;T</span>&gt;::vector<span class="kw">;</span>                <span class="fu">//</span> use the constructors from vector (under the name <span class="dt">Vec</span>)</span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-6"><a href="#cb321-6" aria-hidden="true" tabindex="-1"></a>     <span class="dt">T</span>&amp; operator[](int i)                    <span class="fu">//</span> range check</span>
<span id="cb321-7"><a href="#cb321-7" aria-hidden="true" tabindex="-1"></a>          <span class="kw">{</span> return vector<span class="dt">&lt;T</span>&gt;::at(i)<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb321-8"><a href="#cb321-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-9"><a href="#cb321-9" aria-hidden="true" tabindex="-1"></a>     const <span class="dt">T</span>&amp; operator[](int i) const        <span class="fu">//</span> range check const objects<span class="kw">;</span> <span class="er">§</span><span class="fl">4.2</span>.<span class="dv">1</span></span>
<span id="cb321-10"><a href="#cb321-10" aria-hidden="true" tabindex="-1"></a>          <span class="kw">{</span> return vector<span class="dt">&lt;T</span>&gt;::at(i)<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb321-11"><a href="#cb321-11" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p><code class="calibre8">Vec</code> inherits everything from <code
class="calibre8">vector</code> except for the subscript operations that
it redefines to do range checking. The <code
class="calibre8">at()</code> operation is a <code
class="calibre8">vector</code> subscript operation that throws an
exception of type <code class="calibre8">out_of_range</code> if its
argument is out of the <code class="calibre8">vector</code>’s range (§<a
href="#part0008.html#ch03lev2sec1" class="calibre6">3.5.1</a>).</p>
<p>For <code class="calibre8">Vec</code>, an out-of-range access will
throw an exception that the user can catch. For example:</p>
<p><a href="#part0035_split_011.html#p0141_02a"
id="part0016.html#p0141_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb322"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb322-1"><a href="#cb322-1" aria-hidden="true" tabindex="-1"></a>void checked(<span class="dt">Vec&lt;Entry</span>&gt;&amp; book)</span>
<span id="cb322-2"><a href="#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb322-3"><a href="#cb322-3" aria-hidden="true" tabindex="-1"></a>     try<span class="kw">{</span></span>
<span id="cb322-4"><a href="#cb322-4" aria-hidden="true" tabindex="-1"></a>          book[book.size()] <span class="kw">=</span> <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Joe</span><span class="ot">&quot;</span><span class="kw">,</span><span class="dv">999999</span><span class="kw">};</span>     <span class="fu">//</span> will <span class="kw">throw</span> an exception</span>
<span id="cb322-5"><a href="#cb322-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> ...</span>
<span id="cb322-6"><a href="#cb322-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb322-7"><a href="#cb322-7" aria-hidden="true" tabindex="-1"></a>     <span class="kw">catch</span> (out_of_range&amp;) <span class="kw">{</span></span>
<span id="cb322-8"><a href="#cb322-8" aria-hidden="true" tabindex="-1"></a>          cerr <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">range error</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb322-9"><a href="#cb322-9" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb322-10"><a href="#cb322-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The exception will be thrown, and then caught (§<a
href="#part0008.html#ch03lev2sec1" class="calibre6">3.5.1</a>). If the
user doesn’t catch an exception, the program will terminate in a
well-defined manner rather than proceeding or failing in an undefined
manner. One way to minimize surprises from uncaught exceptions is to use
a <code class="calibre8">main()</code> with a <code
class="calibre8">try</code>-block as its body. For example:</p>
<p><a href="#part0035_split_012.html#p0141_03a"
id="part0016.html#p0141_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb323"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>int main()</span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a>try<span class="kw">{</span></span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> your code</span>
<span id="cb323-4"><a href="#cb323-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb323-5"><a href="#cb323-5" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> (out_of_range&amp;) <span class="kw">{</span></span>
<span id="cb323-6"><a href="#cb323-6" aria-hidden="true" tabindex="-1"></a>     cerr <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">range error</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb323-7"><a href="#cb323-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb323-8"><a href="#cb323-8" aria-hidden="true" tabindex="-1"></a><span class="kw">catch</span> (...) <span class="kw">{</span></span>
<span id="cb323-9"><a href="#cb323-9" aria-hidden="true" tabindex="-1"></a>     cerr <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">unknown exception thrown</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb323-10"><a href="#cb323-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This provides default exception handlers so that if we fail to catch
some exception, an error message is printed on the standard
error-diagnostic output stream <code class="calibre8">cerr</code> (§<a
href="#part0015.html#ch10lev1sec2" class="calibre6">10.2</a>).</p>
<p><span id="part0016.html#page_142" class="pagebreak"></span>Why
doesn’t the standard guarantee range checking? Many performance-critical
applications use <code class="calibre8">vector</code>s and checking all
subscripting implies a cost on the order of 10%. Obviously, that cost
can vary dramatically depending on hardware, optimizers, and an
application’s use of subscripting. However, experience shows that such
overhead can lead people to prefer the far more unsafe built-in arrays.
Even the mere fear of such overhead can lead to disuse. At least <code
class="calibre8">vector</code> is easily range checked at debug time and
we can build checked versions on top of the unchecked default. Some
implementations save you the bother of defining <code
class="calibre8">Vec</code> (or equivalent) by providing a range-checked
version of <code class="calibre8">vector</code> (e.g., as a compiler
option).</p>
<p>A range-<code class="calibre8">for</code> avoids range errors at no
cost by accessing elements through iterators in the range [<code
class="calibre8">begin()</code>:<code class="calibre8">end()</code>). As
long as their iterator arguments are valid, the standard-library
algorithms do the same to ensure the absence of range errors.</p>
<p>If you can use <code class="calibre8">vector::at()</code> directly in
your code, you don’t need my <code class="calibre8">Vec</code>
workaround. Furthermore, some standard libraries have range-checked
<code class="calibre8">vector</code> implementations that offer more
complete checking than <code class="calibre8">Vec</code>.</p>
<h3 class="h2" id="part0016.html#ch11lev1sec3">11.3 <code
class="calibre17">list</code></h3>
<p>The standard library offers a doubly-linked list called <code
class="calibre8">list</code>:</p>
<figure>
<img src="images/00023.jpeg" class="calibre1" />
</figure>
<p>We use a <code class="calibre8">list</code> for sequences where we
want to insert and delete elements without moving other elements.
Insertion and deletion of phone book entries could be common, so a <code
class="calibre8">list</code> could be appropriate for representing a
simple phone book. For example:</p>
<p><a href="#part0035_split_013.html#p0142_01a"
id="part0016.html#p0142_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb324"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a>list<span class="dt">&lt;Entry</span><span class="er">&gt;</span> phone_book <span class="kw">=</span> <span class="kw">{</span></span>
<span id="cb324-2"><a href="#cb324-2" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span><span class="ot">&quot;</span><span class="er">David Hume</span><span class="ot">&quot;</span><span class="kw">,</span><span class="dv">123456</span><span class="kw">},</span></span>
<span id="cb324-3"><a href="#cb324-3" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Karl Popper</span><span class="ot">&quot;</span><span class="kw">,</span><span class="dv">234567</span><span class="kw">},</span></span>
<span id="cb324-4"><a href="#cb324-4" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Bertrand Arthur William Russell</span><span class="ot">&quot;</span><span class="kw">,</span><span class="dv">345678</span><span class="kw">}</span></span>
<span id="cb324-5"><a href="#cb324-5" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>When we use a linked list, we tend not to access elements using
subscripting the way we commonly do for vectors. Instead, we might
search the list looking for an element with a given value. To do this,
we take advantage of the fact that a <code class="calibre8">list</code>
is a sequence as described in <a href="#part0017.html#ch12"
class="calibre6">Chapter 12</a>:</p>
<p><a href="#part0035_split_014.html#p0142_02a"
id="part0016.html#p0142_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb325"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a>int get_number(const string&amp; s)</span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a>     for (const auto&amp; x <span class="fu">:</span> phone_book)</span>
<span id="cb325-4"><a href="#cb325-4" aria-hidden="true" tabindex="-1"></a>          if (x<span class="al">.</span>name<span class="fu">==</span>s)</span>
<span id="cb325-5"><a href="#cb325-5" aria-hidden="true" tabindex="-1"></a>                return x.<span class="dt">number</span><span class="kw">;</span></span>
<span id="cb325-6"><a href="#cb325-6" aria-hidden="true" tabindex="-1"></a>     return <span class="dv">0</span><span class="kw">;</span> <span class="fu">//</span> use <span class="dv">0</span> to represent <span class="ot">&quot;</span><span class="er">number not found</span><span class="ot">&quot;</span></span>
<span id="cb325-7"><a href="#cb325-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0016.html#page_143" class="pagebreak"></span>The search
for <code class="calibre8">s</code> starts at the beginning of the list
and proceeds until <code class="calibre8">s</code> is found or the end
of <code class="calibre8">phone_book</code> is reached.</p>
<p>Sometimes, we need to identify an element in a <code
class="calibre8">list</code>. For example, we may want to delete an
element or insert a new element before it. To do that we use an
<em>iterator</em>: a <code class="calibre8">list</code> iterator
identifies an element of a <code class="calibre8">list</code> and can be
used to iterate through a <code class="calibre8">list</code> (hence its
name). Every standard-library container provides the functions <code
class="calibre8">begin()</code> and <code class="calibre8">end()</code>,
which return an iterator to the first and to one-past-the-last element,
respectively (<a href="#part0017.html#ch12" class="calibre6">Chapter
12</a>). Using iterators explicitly, we can – less elegantly – write the
<code class="calibre8">get_number()</code> function like this:</p>
<p><a href="#part0035_split_015.html#p0143_01a"
id="part0016.html#p0143_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb326"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>int get_number(const string&amp; s)</span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a>     for (auto p <span class="kw">=</span> phone_book<span class="al">.</span>begin()<span class="kw">;</span> p<span class="kw">!=</span>phone_book<span class="al">.</span>end()<span class="kw">;</span> ++p)</span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a>          if (p<span class="er">−</span><span class="dt">&gt;</span>name<span class="fu">==</span>s)</span>
<span id="cb326-5"><a href="#cb326-5" aria-hidden="true" tabindex="-1"></a>                return p<span class="er">−</span><span class="dt">&gt;</span>number<span class="kw">;</span></span>
<span id="cb326-6"><a href="#cb326-6" aria-hidden="true" tabindex="-1"></a>     return <span class="dv">0</span><span class="kw">;</span> <span class="fu">//</span> use <span class="dv">0</span> to represent <span class="ot">&quot;</span><span class="er">number not found</span><span class="ot">&quot;</span></span>
<span id="cb326-7"><a href="#cb326-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>In fact, this is roughly the way the terser and less error-prone
range-<code class="calibre8">for</code> loop is implemented by the
compiler. Given an iterator <code class="calibre8">p</code>, <code
class="calibre8">*p</code> is the element to which it refers, <code
class="calibre8">++p</code> advances <code class="calibre8">p</code> to
refer to the next element, and when <code class="calibre8">p</code>
refers to a class with a member <code class="calibre8">m</code>, then
<code class="calibre8">p−&gt;m</code> is equivalent to <code
class="calibre8">(*p).m</code>.</p>
<p>Adding elements to a <code class="calibre8">list</code> and removing
elements from a <code class="calibre8">list</code> is easy:</p>
<p><a href="#part0035_split_016.html#p0143_02a"
id="part0016.html#p0143_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb327"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a>void f(const <span class="dt">Entry</span>&amp; ee<span class="kw">,</span> list<span class="dt">&lt;Entry</span>&gt;::iterator p<span class="kw">,</span> list<span class="dt">&lt;Entry</span>&gt;::iterator q)</span>
<span id="cb327-2"><a href="#cb327-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb327-3"><a href="#cb327-3" aria-hidden="true" tabindex="-1"></a>     phone_book.insert(p<span class="kw">,</span>ee)<span class="kw">;</span>     <span class="fu">//</span> add ee before the element referred to by p</span>
<span id="cb327-4"><a href="#cb327-4" aria-hidden="true" tabindex="-1"></a>     phone_book.erase(q)<span class="kw">;</span>         <span class="fu">//</span> remove the element referred to by q</span>
<span id="cb327-5"><a href="#cb327-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>For a <code class="calibre8">list</code>, <code
class="calibre8">insert(p,elem)</code> inserts an element with a copy of
the value <code class="calibre8">elem</code> before the element pointed
to by <code class="calibre8">p</code>. Here, <code
class="calibre8">p</code> may be an iterator pointing one-beyond-the-end
of the <code class="calibre8">list</code>. Conversely, <code
class="calibre8">erase(p)</code> removes the element pointed to by <code
class="calibre8">p</code> and destroys it.</p>
<p>These <code class="calibre8">list</code> examples could be written
identically using <code class="calibre8">vector</code> and
(surprisingly, unless you understand machine architecture) perform
better with a small <code class="calibre8">vector</code> than with a
small <code class="calibre8">list</code>. When all we want is a sequence
of elements, we have a choice between using a <code
class="calibre8">vector</code> and a <code class="calibre8">list</code>.
Unless you have a reason not to, use a <code
class="calibre8">vector</code>. A <code class="calibre8">vector</code>
performs better for traversal (e.g., <code
class="calibre8">find()</code> and <code
class="calibre8">count()</code>) and for sorting and searching (e.g.,
<code class="calibre8">sort()</code> and <code
class="calibre8">equal_range()</code>; §<a
href="#part0017.html#ch12lev1sec6" class="calibre6">12.6</a>, §<a
href="#part0018.html#ch13lev2sec5" class="calibre6">13.4.3</a>).</p>
<p>The standard library also offers a singly-linked list called <code
class="calibre8">forward_list</code>:</p>
<figure>
<img src="images/00024.jpeg" class="calibre1" />
</figure>
<p>A <code class="calibre8">forward_list</code> differs from <code
class="calibre8">list</code> by only allowing forward iteration. The
real point of that is to save space. There is no need keep predecessor
pointers in each link and the size of an empty <code
class="calibre8">forward_list</code> is just one pointer. A <code
class="calibre8">forward_list</code> doesn’t even keep its number of
elements. If you need the element count, you can count. If you can’t
afford to count, you probably shouldn’t use a <code
class="calibre8">forward_list</code>.</p>
<h3 class="h2" id="part0016.html#ch11lev1sec4"><span
id="part0016.html#page_144" class="calibre2 pagebreak"></span>11.4 <code
class="calibre17">map</code></h3>
<p>Writing code to look up a name in a list of <em>(name,number)</em>
pairs is quite tedious. In addition, a linear search is inefficient for
all but the shortest lists. The standard library offers a balanced
binary search tree (usually, a red-black tree) called <code
class="calibre8">map</code>:</p>
<figure>
<img src="images/00025.jpeg" class="calibre1" />
</figure>
<p>In other contexts, a <code class="calibre8">map</code> is known as an
associative array or a dictionary. It is implemented as a balanced
binary tree.</p>
<p>The standard-library <code class="calibre8">map</code> is a container
of pairs of values optimized for lookup. We can use the same initializer
as for <code class="calibre8">vector</code> and <code
class="calibre8">list</code> (§<a href="#part0016.html#ch11lev1sec2"
class="calibre6">11.2</a>, §<a href="#part0016.html#ch11lev1sec3"
class="calibre6">11.3</a>):</p>
<p><a href="#part0035_split_017.html#p0144_01a"
id="part0016.html#p0144_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb328"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a>map<span class="dt">&lt;</span>string<span class="kw">,</span>int<span class="dt">&gt;</span> phone_book <span class="er">{</span></span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a>     <span class="er">{&quot;</span><span class="dt">David</span> <span class="dt">Hume</span><span class="er">&quot;</span><span class="kw">,</span><span class="dv">123456</span><span class="er">}</span><span class="kw">,</span></span>
<span id="cb328-3"><a href="#cb328-3" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Karl Popper</span><span class="ot">&quot;</span><span class="kw">,</span><span class="dv">234567</span><span class="kw">},</span></span>
<span id="cb328-4"><a href="#cb328-4" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Bertrand Arthur William Russell</span><span class="ot">&quot;</span><span class="kw">,</span><span class="dv">345678</span><span class="kw">}</span></span>
<span id="cb328-5"><a href="#cb328-5" aria-hidden="true" tabindex="-1"></a><span class="er">}</span><span class="kw">;</span></span></code></pre></div>
<p>When indexed by a value of its first type (called the <em>key</em>),
a <code class="calibre8">map</code> returns the corresponding value of
the second type (called the <em>value</em> or the <em>mapped type</em>).
For example:</p>
<p><a href="#part0035_split_018.html#p0144_02a"
id="part0016.html#p0144_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb329"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb329-1"><a href="#cb329-1" aria-hidden="true" tabindex="-1"></a>int get_number(const string&amp; s)</span>
<span id="cb329-2"><a href="#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb329-3"><a href="#cb329-3" aria-hidden="true" tabindex="-1"></a>     return phone_book[s]<span class="kw">;</span></span>
<span id="cb329-4"><a href="#cb329-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>In other words, subscripting a <code class="calibre8">map</code> is
essentially the lookup we called <code
class="calibre8">get_number()</code>. If a <code
class="calibre8">key</code> isn’t found, it is entered into the <code
class="calibre8">map</code> with a default value for its <code
class="calibre8">value</code>. The default value for an integer type is
<code class="calibre8">0</code>; the value I just happened to choose
represents an invalid telephone number.</p>
<p>If we wanted to avoid entering invalid numbers into our phone book,
we could use <code class="calibre8">find()</code> and <code
class="calibre8">insert()</code> instead of <code
class="calibre8">[ ]</code>.</p>
<h3 class="h2" id="part0016.html#ch11lev1sec5">11.5 <code
class="calibre17">unordered_map</code></h3>
<p>The cost of a <code class="calibre8">map</code> lookup is <code
class="calibre8">O(log(n))</code> where <code class="calibre8">n</code>
is the number of elements in the <code class="calibre8">map</code>.
That’s pretty good. For example, for a <code class="calibre8">map</code>
with 1,000,000 elements, we perform only about 20 comparisons and
indirections to find an element. However, in many cases, we can do
better by using a hashed <span id="part0016.html#page_145"
class="pagebreak"></span>lookup rather than a comparison using an
ordering function, such as <code class="calibre8">&lt;</code>. The
standard-library hashed containers are referred to as “unordered”
because they don’t require an ordering function:</p>
<figure>
<img src="images/00026.jpeg" class="calibre1" />
</figure>
<p>For example, we can use an <code
class="calibre8">unordered_map</code> from <code
class="calibre8">&lt;unordered_map&gt;</code> for our phone book:</p>
<p><a href="#part0035_split_019.html#p0145_01a"
id="part0016.html#p0145_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb330"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a>unordered_map<span class="dt">&lt;</span>string<span class="kw">,</span>int<span class="dt">&gt;</span> phone_book <span class="er">{</span></span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a>    <span class="er">{&quot;</span><span class="dt">David</span> <span class="dt">Hume</span><span class="er">&quot;</span><span class="kw">,</span><span class="dv">123456</span><span class="er">}</span><span class="kw">,</span></span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Karl Popper</span><span class="ot">&quot;</span><span class="kw">,</span><span class="dv">234567</span><span class="kw">},</span></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Bertrand Arthur William Russell</span><span class="ot">&quot;</span><span class="kw">,</span><span class="dv">345678</span><span class="kw">}</span></span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true" tabindex="-1"></a><span class="er">}</span><span class="kw">;</span></span></code></pre></div>
<p>Like for a <code class="calibre8">map</code>, we can subscript an
<code class="calibre8">unordered_map</code>:</p>
<p><a href="#part0035_split_020.html#p0145_02a"
id="part0016.html#p0145_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb331"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb331-1"><a href="#cb331-1" aria-hidden="true" tabindex="-1"></a>int get_number(const string&amp; s)</span>
<span id="cb331-2"><a href="#cb331-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb331-3"><a href="#cb331-3" aria-hidden="true" tabindex="-1"></a>     return phone_book[s]<span class="kw">;</span></span>
<span id="cb331-4"><a href="#cb331-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The standard library provides a default hash function for <code
class="calibre8">string</code>s as well as for other built-in and
standard-library types. If necessary, you can provide your own (§<a
href="#part0010.html#ch05lev2sec11" class="calibre6">5.4.6</a>).
Possibly, the most common need for a “custom” hash function comes when
we want an unordered container of one of our own types. A hash function
is often provided as a function object (§<a
href="#part0011.html#ch06lev2sec5" class="calibre6">6.3.2</a>). For
example:</p>
<p><a href="#part0035_split_021.html#p0145_03a"
id="part0016.html#p0145_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb332"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Record</span> <span class="kw">{</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a>     string name<span class="kw">;</span></span>
<span id="cb332-3"><a href="#cb332-3" aria-hidden="true" tabindex="-1"></a>     int product_code<span class="kw">;</span></span>
<span id="cb332-4"><a href="#cb332-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb332-5"><a href="#cb332-5" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb332-6"><a href="#cb332-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-7"><a href="#cb332-7" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Rhash</span> <span class="kw">{</span>     <span class="fu">//</span> a hash function for <span class="dt">Record</span></span>
<span id="cb332-8"><a href="#cb332-8" aria-hidden="true" tabindex="-1"></a>     size_t operator()(const <span class="dt">Record</span>&amp; r) const</span>
<span id="cb332-9"><a href="#cb332-9" aria-hidden="true" tabindex="-1"></a>     <span class="kw">{</span></span>
<span id="cb332-10"><a href="#cb332-10" aria-hidden="true" tabindex="-1"></a>          return hash<span class="dt">&lt;</span>string<span class="er">&gt;</span>()(r<span class="al">.</span>name) <span class="fu">^</span> hash<span class="dt">&lt;</span>int<span class="er">&gt;</span>()(r<span class="al">.</span>product_code)<span class="kw">;</span></span>
<span id="cb332-11"><a href="#cb332-11" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb332-12"><a href="#cb332-12" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb332-13"><a href="#cb332-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb332-14"><a href="#cb332-14" aria-hidden="true" tabindex="-1"></a>unordered_set<span class="dt">&lt;Record</span><span class="kw">,</span><span class="dt">Rhash&gt;</span> my_set<span class="kw">;</span> <span class="fu">//</span> set of <span class="dt">Records</span> using <span class="dt">Rhash</span> for lookup</span></code></pre></div>
<p>Designing good hash functions is an art and sometimes requires
knowledge of the data to which it will be applied. Creating a new hash
function by combining existing hash functions using exclusive-or (<code
class="calibre8">^</code>) is simple and often very effective.</p>
<p>We can avoid explicitly passing the <code
class="calibre8">hash</code> operation by defining it as a
specialization of the standard-library <code
class="calibre8">hash</code>:</p>
<p><a href="#part0035_split_022.html#p0146_01a"
id="part0016.html#p0146_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb333"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb333-1"><a href="#cb333-1" aria-hidden="true" tabindex="-1"></a>namespace std <span class="kw">{</span> <span class="fu">//</span> make a hash function for <span class="dt">Record</span></span>
<span id="cb333-2"><a href="#cb333-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-3"><a href="#cb333-3" aria-hidden="true" tabindex="-1"></a>    template&lt;&gt; struct hash<span class="dt">&lt;Record</span><span class="er">&gt;</span> <span class="kw">{</span></span>
<span id="cb333-4"><a href="#cb333-4" aria-hidden="true" tabindex="-1"></a>        using argument_type <span class="kw">=</span> <span class="dt">Record</span><span class="kw">;</span></span>
<span id="cb333-5"><a href="#cb333-5" aria-hidden="true" tabindex="-1"></a>        using result_type <span class="kw">=</span> std::size_t<span class="kw">;</span></span>
<span id="cb333-6"><a href="#cb333-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb333-7"><a href="#cb333-7" aria-hidden="true" tabindex="-1"></a>        size_t operator()(const <span class="dt">Record</span>&amp; r) const</span>
<span id="cb333-8"><a href="#cb333-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">{</span></span>
<span id="cb333-9"><a href="#cb333-9" aria-hidden="true" tabindex="-1"></a>             return hash<span class="dt">&lt;</span>string<span class="er">&gt;</span>()(r<span class="al">.</span>name) <span class="fu">^</span> hash<span class="dt">&lt;</span>int<span class="er">&gt;</span>()(r<span class="al">.</span>product_code)<span class="kw">;</span></span>
<span id="cb333-10"><a href="#cb333-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb333-11"><a href="#cb333-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">};</span></span>
<span id="cb333-12"><a href="#cb333-12" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Note the differences between a <code class="calibre8">map</code> and
an <code class="calibre8">unordered_map</code>:</p>
<ul>
<li><p>A <code class="calibre8">map</code> requires an ordering function
(the default is <code class="calibre8">&lt;</code>) and yields an
ordered sequence.</p></li>
<li><p>A <code class="calibre8">unordered_map</code> requires a hash
function and does not maintain an order among its elements.</p></li>
</ul>
<p>Given a good hash function, an <code
class="calibre8">unordered_map</code> is much faster than a <code
class="calibre8">map</code> for large containers. However, the
worst-case behavior of an <code class="calibre8">unordered_map</code>
with a poor hash function is far worse than that of a <code
class="calibre8">map</code>.</p>
<h3 class="h2" id="part0016.html#ch11lev1sec6">11.6 Container
Overview</h3>
<p>The standard library provides some of the most general and useful
container types to allow the programmer to select a container that best
serves the needs of an application:</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>Standard Container
Summary</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">vector&lt;T&gt;</code></p></td>
<td class="calibre14"><p>A variable-size vector (§<a
href="#part0016.html#ch11lev1sec2" class="calibre6">11.2</a>)</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">list&lt;T&gt;</code></p></td>
<td class="calibre14"><p>A doubly-linked list (§<a
href="#part0016.html#ch11lev1sec3" class="calibre6">11.3</a>)</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">forward_list&lt;T&gt;</code></p></td>
<td class="calibre14"><p>A singly-linked list</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">deque&lt;T&gt;</code></p></td>
<td class="calibre14"><p>A double-ended queue</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">set&lt;T&gt;</code></p></td>
<td class="calibre14"><p>A set (a <code class="calibre8">map</code> with
just a key and no value)</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">multiset&lt;T&gt;</code></p></td>
<td class="calibre14"><p>A set in which a value can occur many
times</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">map&lt;K,V&gt;</code></p></td>
<td class="calibre14"><p>An associative array (§<a
href="#part0016.html#ch11lev1sec4" class="calibre6">11.4</a>)</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">multimap&lt;K,V&gt;</code></p></td>
<td class="calibre14"><p>A map in which a key can occur many
times</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">unordered_map&lt;K,V&gt;</code></p></td>
<td class="calibre14"><p>A map using a hashed lookup (§<a
href="#part0016.html#ch11lev1sec5" class="calibre6">11.5</a>)</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">unordered_multimap&lt;K,V&gt;</code></p></td>
<td class="calibre14"><p>A multimap using a hashed lookup</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">unordered_set&lt;T&gt;</code></p></td>
<td class="calibre14"><p>A set using a hashed lookup</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">unordered_multiset&lt;T&gt;</code></p></td>
<td class="calibre14"><p>A multiset using a hashed lookup</p></td>
</tr>
</tbody>
</table>
<p>The unordered containers are optimized for lookup with a key (often a
string); in other words, they are implemented using hash tables.</p>
<p>The containers are defined in namespace <code
class="calibre8">std</code> and presented in headers <code
class="calibre8">&lt;vector&gt;</code>, <code
class="calibre8">&lt;list&gt;</code>, <code
class="calibre8">&lt;map&gt;</code>, etc. (§<a
href="#part0013.html#ch08lev1sec3" class="calibre6">8.3</a>). In
addition, the standard library provides container adaptors <code
class="calibre8">queue&lt;T&gt;</code>, <code
class="calibre8">stack&lt;T&gt;</code>, and <code
class="calibre8">priority_queue&lt;T&gt;</code>. Look them up if you
need them. The standard library also provides more <span
id="part0016.html#page_147" class="pagebreak"></span>specialized
container-like types, such as a fixed-size array <code
class="calibre8">array&lt;T,N&gt;</code> (§<a
href="#part0018.html#ch13lev2sec3" class="calibre6">13.4.1</a>) and
<code class="calibre8">bitset&lt;N&gt;</code> (§<a
href="#part0018.html#ch13lev2sec4" class="calibre6">13.4.2</a>).</p>
<p>The standard containers and their basic operations are designed to be
similar from a notational point of view. Furthermore, the meanings of
the operations are equivalent for the various containers. Basic
operations apply to every kind of container for which they make sense
and can be efficiently implemented:</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>Standard Container
Operations (partial)</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="tab1"><p><code class="calibre8">value_type</code></p></td>
<td class="tab1"><p>The type of an element</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">p=c.begin()</code></p></td>
<td class="calibre14"><p><code class="calibre8">p</code> points to first
element of <code class="calibre8">c</code>; also <code
class="calibre8">cbegin()</code> for an iterator to <code
class="calibre8">const</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p=c.end()</code></p></td>
<td class="calibre14"><p><code class="calibre8">p</code> points to
one-past-the-last element of <code class="calibre8">c</code>; also <code
class="calibre8">cend()</code> for an iterator to <code
class="calibre8">const</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">k=c.size()</code></p></td>
<td class="calibre14"><p><code class="calibre8">k</code> is the number
of elements in <code class="calibre8">c</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">c.empty()</code></p></td>
<td class="calibre14"><p>Is <code class="calibre8">c</code>
empty?</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">k=c.capacity()</code></p></td>
<td class="calibre14"><p><code class="calibre8">k</code> is the number
of elements that <code class="calibre8">c</code> can hold without a new
allocation</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">c.reserve(k)</code></p></td>
<td class="calibre14"><p>Make the capacity <code
class="calibre8">k</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">c.resize(k)</code></p></td>
<td class="calibre14"><p>Make the number of elements <code
class="calibre8">k</code>; added elements has the value <code
class="calibre8">value_type{}</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">c[k]</code></p></td>
<td class="calibre14"><p>The <code class="calibre8">k</code>th element
of <code class="calibre8">c</code>; no range checking</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">c.at(k)</code></p></td>
<td class="calibre14"><p>The <code class="calibre8">k</code>th element
of <code class="calibre8">c</code>; if out of range, throw <code
class="calibre8">out_of_range</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">c.push_back(x)</code></p></td>
<td class="calibre14"><p>Add <code class="calibre8">x</code> at the end
of <code class="calibre8">c</code>; increase the size of <code
class="calibre8">c</code> by one</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">c.emplace_back(a)</code></p></td>
<td class="calibre14"><p>Add <code class="calibre8">value_type{a}</code>
at the end of <code class="calibre8">c</code>; increase the size of
<code class="calibre8">c</code> by one</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">q=c.insert(p,x)</code></p></td>
<td class="calibre14"><p>Add <code class="calibre8">x</code> before
<code class="calibre8">p</code> in <code
class="calibre8">c</code></p></td>
</tr>
<tr class="even calibre13">
<td class="tab1"><p><code class="calibre8">q=c.erase(p)</code></p></td>
<td class="tab1"><p>Remove element at <code class="calibre8">p</code>
from <code class="calibre8">c</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">=</code></p></td>
<td class="calibre14"><p>Assignment</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">==</code>, <code
class="calibre8">!=</code></p></td>
<td class="calibre14"><p>Equality of all elements of <code
class="calibre8">c</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">&lt;</code>, <code
class="calibre8">&lt;=</code>, <code class="calibre8">&gt;</code>, <code
class="calibre8">&gt;=</code></p></td>
<td class="calibre14"><p>Lexicographical order</p></td>
</tr>
</tbody>
</table>
<p>This notational and semantic uniformity enables programmers to
provide new container types that can be used in a very similar manner to
the standard ones. The range-checked vector, <code
class="calibre8">Vector</code> (§<a href="#part0008.html#ch03lev2sec2"
class="calibre6">3.5.2</a>, <a href="#part0009.html#ch04"
class="calibre6">Chapter 4</a>), is an example of that. The uniformity
of container interfaces allows us to specify algorithms independently of
individual container types. However, each has strengths and weaknesses.
For example, subscripting and traversing a <code
class="calibre8">vector</code> is cheap and easy. On the other hand,
<code class="calibre8">vector</code> elements are moved when we insert
or remove elements; <code class="calibre8">list</code> has exactly the
opposite properties. Please note that a <code
class="calibre8">vector</code> is usually more efficient than a <code
class="calibre8">list</code> for short sequences of small elements (even
for <code class="calibre8">insert()</code> and <code
class="calibre8">erase()</code>). I recommend the standard-library <code
class="calibre8">vector</code> as the default type for sequences of
elements: you need a reason to choose another.</p>
<p>Consider the singly-linked list, <code
class="calibre8">forward_list</code>, a container optimized for the
empty sequence (§<a href="#part0016.html#ch11lev1sec3"
class="calibre6">11.3</a>). An empty <code
class="calibre8">forward_list</code> occupies just one word, whereas an
empty <code class="calibre8">vector</code> occupy three. Empty
sequences, and sequences with only an element or two, are surprisingly
common and useful.</p>
<p>An emplace operation, such as <code
class="calibre8">emplace_back()</code> takes arguments for an element’s
constructor and builds the object in a newly allocated space in the
container, rather than copying an object into the container. For
example, for a <code
class="calibre8">vector&lt;pair&lt;int,string&gt;&gt;</code> we could
write:</p>
<p><a href="#part0035_split_023.html#p0147_01a"
id="part0016.html#p0147_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb334"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a>v<span class="kw">.</span>push_back(pair<span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="ot">&quot;</span><span class="er">copy or move</span><span class="ot">&quot;</span><span class="er">))</span><span class="kw">;</span>   <span class="fu">//</span> make a pair and move it into v</span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a>v.emplace_back(<span class="dv">1</span><span class="kw">,</span><span class="ot">&quot;</span><span class="er">build in place</span><span class="ot">&quot;</span>)<span class="kw">;</span>    <span class="fu">//</span> buid a pair in v</span></code></pre></div>
<h3 class="h2" id="part0016.html#ch11lev1sec7"><span
id="part0016.html#page_148" class="calibre2 pagebreak"></span>11.7
Advice</h3>
<p>[1] An STL container defines a sequence; §<a
href="#part0016.html#ch11lev1sec2" class="calibre6">11.2</a>.</p>
<p>[2] STL containers are resource handles; §<a
href="#part0016.html#ch11lev1sec2" class="calibre6">11.2</a>, §<a
href="#part0016.html#ch11lev1sec3" class="calibre6">11.3</a>, §<a
href="#part0016.html#ch11lev1sec4" class="calibre6">11.4</a>, §<a
href="#part0016.html#ch11lev1sec5" class="calibre6">11.5</a>.</p>
<p>[3] Use <code class="calibre8">vector</code> as your default
container; §<a href="#part0016.html#ch11lev1sec2"
class="calibre6">11.2</a>, §<a href="#part0016.html#ch11lev1sec6"
class="calibre6">11.6</a>; [CG: SL.con.2].</p>
<p>[4] For simple traversals of a container, use a range-<code
class="calibre8">for</code> loop or a begin/end pair of iterators; §<a
href="#part0016.html#ch11lev1sec2" class="calibre6">11.2</a>, §<a
href="#part0016.html#ch11lev1sec3" class="calibre6">11.3</a>.</p>
<p>[5] Use <code class="calibre8">reserve()</code> to avoid invalidating
pointers and iterators to elements; §<a
href="#part0016.html#ch11lev1sec2" class="calibre6">11.2</a>.</p>
<p>[6] Don’t assume performance benefits from <code
class="calibre8">reserve()</code> without measurement; §<a
href="#part0016.html#ch11lev1sec2" class="calibre6">11.2</a>.</p>
<p>[7] Use <code class="calibre8">push_back()</code> or <code
class="calibre8">resize()</code> on a container rather than <code
class="calibre8">realloc()</code> on an array; §<a
href="#part0016.html#ch11lev1sec2" class="calibre6">11.2</a>.</p>
<p>[8] Don’t use iterators into a resized <code
class="calibre8">vector</code>; §<a href="#part0016.html#ch11lev1sec2"
class="calibre6">11.2</a>.</p>
<p>[9] Do not assume that <code class="calibre8">[ ]</code> range
checks; §<a href="#part0016.html#ch11lev1sec2"
class="calibre6">11.2</a>.</p>
<p>[10] Use <code class="calibre8">at()</code> when you need guaranteed
range checks; §<a href="#part0016.html#ch11lev1sec2"
class="calibre6">11.2</a>; [CG: SL.con.3].</p>
<p>[11] Use range-<code class="calibre8">for</code> and standard-library
algorithms for cost-free avoidance of range errors; §<a
href="#part0016.html#ch11lev2sec2" class="calibre6">11.2.2</a>.</p>
<p>[12] Elements are copied into a container; §<a
href="#part0016.html#ch11lev2sec1" class="calibre6">11.2.1</a>.</p>
<p>[13] To preserve polymorphic behavior of elements, store pointers;
§<a href="#part0016.html#ch11lev2sec1" class="calibre6">11.2.1</a>.</p>
<p>[14] Insertion operators, such as <code
class="calibre8">insert()</code> and <code
class="calibre8">push_back()</code>, are often surprisingly efficient on
a <code class="calibre8">vector</code>; §<a
href="#part0016.html#ch11lev1sec3" class="calibre6">11.3</a>.</p>
<p>[15] Use <code class="calibre8">forward_list</code> for sequences
that are usually empty; §<a href="#part0016.html#ch11lev1sec6"
class="calibre6">11.6</a>.</p>
<p>[16] When it comes to performance, don’t trust your intuition:
measure; §<a href="#part0016.html#ch11lev1sec2"
class="calibre6">11.2</a>.</p>
<p>[17] A <code class="calibre8">map</code> is usually implemented as a
red-black tree; §<a href="#part0016.html#ch11lev1sec4"
class="calibre6">11.4</a>.</p>
<p>[18] An <code class="calibre8">unordered_map</code> is a hash table;
§<a href="#part0016.html#ch11lev1sec5" class="calibre6">11.5</a>.</p>
<p>[19] Pass a container by reference and return a container by value;
§<a href="#part0016.html#ch11lev1sec2" class="calibre6">11.2</a>.</p>
<p>[20] For a container, use the <code
class="calibre8">()</code>-initializer syntax for sizes and the <code
class="calibre8">{}</code>-initializer syntax for lists of elements; §<a
href="#part0009.html#ch04lev2sec3" class="calibre6">4.2.3</a>, §<a
href="#part0016.html#ch11lev1sec2" class="calibre6">11.2</a>.</p>
<p>[21] Prefer compact and contiguous data structures; §<a
href="#part0016.html#ch11lev1sec3" class="calibre6">11.3</a>.</p>
<p>[22] A <code class="calibre8">list</code> is relatively expensive to
traverse; §<a href="#part0016.html#ch11lev1sec3"
class="calibre6">11.3</a>.</p>
<p>[23] Use unordered containers if you need fast lookup for large
amounts of data; §<a href="#part0016.html#ch11lev1sec5"
class="calibre6">11.5</a>.</p>
<p>[24] Use ordered associative containers (e.g., <code
class="calibre8">map</code> and <code class="calibre8">set</code>) if
you need to iterate over their elements in order; §<a
href="#part0016.html#ch11lev1sec4" class="calibre6">11.4</a>.</p>
<p>[25] Use unordered containers for element types with no natural order
(e.g., no reasonable <code class="calibre8">&lt;</code>); §<a
href="#part0016.html#ch11lev1sec4" class="calibre6">11.4</a>.</p>
<p>[26] Experiment to check that you have an acceptable hash function;
§<a href="#part0016.html#ch11lev1sec5" class="calibre6">11.5</a>.</p>
<p>[27] A hash function obtained by combining standard hash functions
for elements using the exclusive-or operator (<code
class="calibre8">^</code>) is often good; §<a
href="#part0016.html#ch11lev1sec5" class="calibre6">11.5</a>.</p>
<p>[28] Know your standard-library containers and prefer them to
handcrafted data structures; §<a href="#part0016.html#ch11lev1sec6"
class="calibre6">11.6</a>.</p>
</section>
<p><span id="part0017.html"></span></p>
<section id="part0017.html#ch12" class="h1 bodymatter">
<h2 class="h1"><span id="part0017.html#page_149"
class="calibre2 pagebreak"></span><span class="big">12</span></h2>
<p>Algorithms</p>
<p><em>Do not multiply entities beyond necessity.</em></p>
<p><em>– William Occam</em></p>
<ul>
<li><p><a href="#part0017.html#ch12lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0017.html#ch12lev1sec2" class="calibre6">Use of
Iterators</a></p></li>
<li><p><a href="#part0017.html#ch12lev1sec3" class="calibre6">Iterator
Types</a></p></li>
<li><p><a href="#part0017.html#ch12lev1sec4" class="calibre6">Stream
Iterators</a></p></li>
<li><p><a href="#part0017.html#ch12lev1sec5"
class="calibre6">Predicates</a></p></li>
<li><p><a href="#part0017.html#ch12lev1sec6" class="calibre6">Algorithm
Overview</a></p></li>
<li><p><a href="#part0017.html#ch12lev1sec7"
class="calibre6">Concepts</a></p></li>
<li><p><a href="#part0017.html#ch12lev1sec8" class="calibre6">Container
Algorithms</a></p></li>
<li><p><a href="#part0017.html#ch12lev1sec9" class="calibre6">Parallel
Algorithms</a></p></li>
<li><p><a href="#part0017.html#ch12lev1sec10"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0017.html#ch12lev1sec1">12.1 Introduction</h3>
<p>A data structure, such as a list or a vector, is not very useful on
its own. To use one, we need operations for basic access such as adding
and removing elements (as is provided for <code
class="calibre8">list</code> and <code class="calibre8">vector</code>).
Furthermore, we rarely just store objects in a container. We sort them,
print them, extract subsets, remove elements, search for objects, etc.
Consequently, the standard library provides the most common algorithms
for containers in addition to providing the most common container types.
For example, we can simply and efficiently sort a <code
class="calibre8">vector</code> of <code class="calibre8">Entry</code>s
and place a copy of each unique <code class="calibre8">vector</code>
element on a <code class="calibre8">list</code>:</p>
<p><a href="#part0036_split_000.html#p0149_01a"
id="part0017.html#p0149_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb335"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a>void f(vector<span class="dt">&lt;Entry</span>&gt;&amp; vec<span class="kw">,</span> list<span class="dt">&lt;Entry</span>&gt;&amp; lst)</span>
<span id="cb335-2"><a href="#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb335-3"><a href="#cb335-3" aria-hidden="true" tabindex="-1"></a>     sort(vec<span class="al">.</span>begin()<span class="kw">,</span>vec<span class="al">.</span>end())<span class="kw">;</span>                      <span class="fu">//</span> use <span class="dt">&lt;</span> for order</span>
<span id="cb335-4"><a href="#cb335-4" aria-hidden="true" tabindex="-1"></a>     unique_copy(vec.begin()<span class="er">,</span>vec.end()<span class="er">,</span>lst.begin())<span class="kw">;</span>   <span class="fu">//</span> don<span class="st">&#39;</span><span class="er">t copy adjacent equal elements</span></span>
<span id="cb335-5"><a href="#cb335-5" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p><span id="part0017.html#page_150" class="pagebreak"></span>For this
to work, less than (<code class="calibre8">&lt;</code>) and equal (<code
class="calibre8">==</code>) must be defined for <code
class="calibre8">Entry</code>s. For example:</p>
<p><a href="#part0036_split_001.html#p0150_01a"
id="part0017.html#p0150_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb336"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a>bool operator<span class="dt">&lt;</span>(const <span class="dt">Entry</span>&amp; x<span class="er">,</span> const <span class="dt">Entry</span>&amp; y)   <span class="dv">//</span> less than</span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a>     return x<span class="kw">.</span>name<span class="dt">&lt;</span>y<span class="kw">.</span>name<span class="kw">;</span>       <span class="fu">//</span> order <span class="dt">Entries</span> by their names</span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>A standard algorithm is expressed in terms of (half-open) sequences
of elements. A <em>sequence</em> is represented by a pair of iterators
specifying the first element and the one-beyond-the-last element:</p>
<figure>
<img src="images/00027.jpeg" class="calibre1" />
</figure>
<p>In the example, <code class="calibre8">sort()</code> sorts the
sequence defined by the pair of iterators <code
class="calibre8">vec.begin()</code> and <code
class="calibre8">vec.end()</code>, which just happens to be all the
elements of a <code class="calibre8">vector</code>. For writing
(output), you need only to specify the first element to be written. If
more than one element is written, the elements following that initial
element will be overwritten. Thus, to avoid errors, <code
class="calibre8">lst</code> must have at least as many elements as there
are unique values in <code class="calibre8">vec</code>.</p>
<p>If we wanted to place the unique elements in a new container, we
could have written:</p>
<p><a href="#part0036_split_002.html#p0150_02a"
id="part0017.html#p0150_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb337"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a>list<span class="dt">&lt;Entry</span><span class="er">&gt;</span> f(vector<span class="dt">&lt;Entry</span>&gt;&amp; vec)</span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb337-3"><a href="#cb337-3" aria-hidden="true" tabindex="-1"></a>     list<span class="dt">&lt;Entry</span><span class="er">&gt;</span> res<span class="kw">;</span></span>
<span id="cb337-4"><a href="#cb337-4" aria-hidden="true" tabindex="-1"></a>     sort(vec<span class="al">.</span>begin()<span class="kw">,</span>vec<span class="al">.</span>end())<span class="kw">;</span></span>
<span id="cb337-5"><a href="#cb337-5" aria-hidden="true" tabindex="-1"></a>     unique_copy(vec<span class="al">.</span>begin()<span class="kw">,</span>vec<span class="al">.</span>end()<span class="kw">,</span>back_inserter(res))<span class="kw">;</span>     <span class="fu">//</span> append to res</span>
<span id="cb337-6"><a href="#cb337-6" aria-hidden="true" tabindex="-1"></a>     return res<span class="kw">;</span></span>
<span id="cb337-7"><a href="#cb337-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The call <code class="calibre8">back_inserter(res)</code> constructs
an iterator for <code class="calibre8">res</code> that adds elements at
the end of a container, extending the container to make room for them.
This saves us from first having to allocate a fixed amount of space and
then filling it. Thus, the standard containers plus <code
class="calibre8">back_inserter()</code>s eliminate the need to use
error-prone, explicit C-style memory management using <code
class="calibre8">realloc()</code>. The standard-library <code
class="calibre8">list</code> has a move constructor (§<a
href="#part0010.html#ch05lev2sec5" class="calibre6">5.2.2</a>) that
makes returning <code class="calibre8">res</code> by value efficient
(even for <code class="calibre8">list</code>s of thousands of
elements).</p>
<p>If you find the pair-of-iterators style of code, such as <code
class="calibre8">sort(vec.begin(),vec.end())</code>, tedious, you can
define container versions of the algorithms and write <code
class="calibre8">sort(vec)</code> (§<a
href="#part0017.html#ch12lev1sec8" class="calibre6">12.8</a>).</p>
<h3 class="h2" id="part0017.html#ch12lev1sec2">12.2 Use of
Iterators</h3>
<p>For a container, a few iterators referring to useful elements can be
obtained; <code class="calibre8">begin()</code> and <code
class="calibre8">end()</code> are the best examples of this. In
addition, many algorithms return iterators. For example, the standard
algorithm <code class="calibre8">find</code> looks for a value in a
sequence and returns an iterator to the element found:</p>
<p><a href="#part0036_split_003.html#p0151_01a"
id="part0017.html#p0151_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb338"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a>bool has_c(const string&amp; s<span class="kw">,</span> char c)    <span class="fu">//</span> does s contain the character c?</span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a>     auto p <span class="kw">=</span> find(s<span class="al">.</span>begin()<span class="kw">,</span>s<span class="al">.</span>end()<span class="kw">,</span>c)<span class="kw">;</span></span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a>     if (p<span class="kw">!=</span>s<span class="al">.</span>end())</span>
<span id="cb338-5"><a href="#cb338-5" aria-hidden="true" tabindex="-1"></a>           return <span class="kw">true;</span></span>
<span id="cb338-6"><a href="#cb338-6" aria-hidden="true" tabindex="-1"></a>     else</span>
<span id="cb338-7"><a href="#cb338-7" aria-hidden="true" tabindex="-1"></a>           return <span class="kw">false;</span></span>
<span id="cb338-8"><a href="#cb338-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Like many standard-library search algorithms, <code
class="calibre8">find</code> returns <code class="calibre8">end()</code>
to indicate “not found.” An equivalent, shorter, definition of <code
class="calibre8">has_c()</code> is:</p>
<p><a href="#part0036_split_004.html#p0151_02a"
id="part0017.html#p0151_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb339"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a>bool has_c(const string&amp; s<span class="kw">,</span> char c)     <span class="fu">//</span> does s contain the character c?</span>
<span id="cb339-2"><a href="#cb339-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb339-3"><a href="#cb339-3" aria-hidden="true" tabindex="-1"></a>     return find(s<span class="al">.</span>begin()<span class="kw">,</span>s<span class="al">.</span>end()<span class="kw">,</span>c)<span class="kw">!=</span>s.end()<span class="kw">;</span></span>
<span id="cb339-4"><a href="#cb339-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>A more interesting exercise would be to find the location of all
occurrences of a character in a string. We can return the set of
occurrences as a <code class="calibre8">vector</code> of <code
class="calibre8">string</code> iterators. Returning a <code
class="calibre8">vector</code> is efficient because <code
class="calibre8">vector</code> provides move semantics (§<a
href="#part0010.html#ch05lev2sec4" class="calibre6">5.2.1</a>). Assuming
that we would like to modify the locations found, we pass a non-<code
class="calibre8">const</code> string:</p>
<p><a href="#part0036_split_005.html#p0151_03a"
id="part0017.html#p0151_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb340"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>string::iterator<span class="er">&gt;</span> find_all(string&amp; s<span class="kw">,</span> char c)     <span class="fu">//</span> find all occurrences of c in s</span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb340-3"><a href="#cb340-3" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>string::iterator<span class="er">&gt;</span> res<span class="kw">;</span></span>
<span id="cb340-4"><a href="#cb340-4" aria-hidden="true" tabindex="-1"></a>     for (auto p <span class="kw">=</span> s<span class="al">.</span>begin()<span class="kw">;</span> p<span class="kw">!=</span>s<span class="al">.</span>end()<span class="kw">;</span> ++p)</span>
<span id="cb340-5"><a href="#cb340-5" aria-hidden="true" tabindex="-1"></a>           if (<span class="fu">*</span>p<span class="fu">==</span>c)</span>
<span id="cb340-6"><a href="#cb340-6" aria-hidden="true" tabindex="-1"></a>                 res.push_back(p)<span class="kw">;</span></span>
<span id="cb340-7"><a href="#cb340-7" aria-hidden="true" tabindex="-1"></a>     return res<span class="kw">;</span></span>
<span id="cb340-8"><a href="#cb340-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>We iterate through the string using a conventional loop, moving the
iterator <code class="calibre8">p</code> forward one element at a time
using <code class="calibre8">++</code> and looking at the elements using
the dereference operator <code class="calibre8">*</code>. We could test
<code class="calibre8">find_all()</code> like this:</p>
<p><a href="#part0036_split_006.html#p0151_04a"
id="part0017.html#p0151_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb341"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a>void test()</span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb341-3"><a href="#cb341-3" aria-hidden="true" tabindex="-1"></a>     string m <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Mary had a little lamb</span><span class="ot">&quot;</span><span class="kw">};</span></span>
<span id="cb341-4"><a href="#cb341-4" aria-hidden="true" tabindex="-1"></a>     for (auto p <span class="fu">:</span> find_all(m<span class="kw">,</span><span class="st">&#39;</span><span class="er">a</span><span class="st">&#39;</span>))</span>
<span id="cb341-5"><a href="#cb341-5" aria-hidden="true" tabindex="-1"></a>           if (<span class="fu">*</span>p<span class="kw">!=</span><span class="st">&#39;</span><span class="er">a</span><span class="st">&#39;</span>)</span>
<span id="cb341-6"><a href="#cb341-6" aria-hidden="true" tabindex="-1"></a>                 cerr <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">a bug</span><span class="ot">!</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb341-7"><a href="#cb341-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>That call of <code class="calibre8">find_all()</code> could be
graphically represented like this:</p>
<figure>
<img src="images/00028.jpeg" class="calibre1" />
</figure>
<p><span id="part0017.html#page_152" class="pagebreak"></span>Iterators
and standard algorithms work equivalently on every standard container
for which their use makes sense. Consequently, we could generalize <code
class="calibre8">find_all()</code>:</p>
<p><a href="#part0036_split_007.html#p0152_01a"
id="part0017.html#p0152_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb342"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">C</span><span class="kw">,</span> typename <span class="dt">V&gt;</span></span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>vector<span class="er">&lt;</span>typename <span class="dt">C</span>::iterator<span class="dt">&gt;</span> find_all(<span class="dt">C</span>&amp; c<span class="er">,</span> <span class="dt">V</span> v)      <span class="dv">//</span> find all occurrences of v in c</span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a>     vector<span class="er">&lt;</span>typename <span class="dt">C</span>::iterator<span class="dt">&gt;</span> res<span class="kw">;</span></span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true" tabindex="-1"></a>     for (auto p <span class="kw">=</span> c<span class="al">.</span>begin()<span class="kw">;</span> p<span class="kw">!=</span>c<span class="al">.</span>end()<span class="kw">;</span> ++p)</span>
<span id="cb342-6"><a href="#cb342-6" aria-hidden="true" tabindex="-1"></a>           if (<span class="fu">*</span>p<span class="fu">==</span>v)</span>
<span id="cb342-7"><a href="#cb342-7" aria-hidden="true" tabindex="-1"></a>                 res<span class="kw">.</span>push_back(p)<span class="kw">;</span></span>
<span id="cb342-8"><a href="#cb342-8" aria-hidden="true" tabindex="-1"></a>     return res<span class="kw">;</span></span>
<span id="cb342-9"><a href="#cb342-9" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>The <code class="calibre8">typename</code> is needed to inform the
compiler that <code class="calibre8">C</code>’s <code
class="calibre8">iterator</code> is supposed to be a type and not a
value of some type, say, the integer <code class="calibre8">7</code>. We
can hide this implementation detail by introducing a type alias (§<a
href="#part0011.html#ch06lev2sec8" class="calibre6">6.4.2</a>) for <code
class="calibre8">Iterator</code>:</p>
<p><a href="#part0036_split_008.html#p0152_02a"
id="part0017.html#p0152_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb343"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb343-1"><a href="#cb343-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb343-2"><a href="#cb343-2" aria-hidden="true" tabindex="-1"></a>using <span class="dt">Iterator</span> <span class="kw">=</span> typename <span class="dt">T</span>::iterator<span class="kw">;</span>         <span class="fu">//</span> <span class="dt">T</span><span class="st">&#39;</span><span class="er">s iterator</span></span>
<span id="cb343-3"><a href="#cb343-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-4"><a href="#cb343-4" aria-hidden="true" tabindex="-1"></a><span class="er">template&lt;typename C, typename V&gt;</span></span>
<span id="cb343-5"><a href="#cb343-5" aria-hidden="true" tabindex="-1"></a><span class="er">vector&lt;Iterator&lt;C&gt;&gt; find_all(C&amp; c, V v)        // find all occurrences of v in c</span></span>
<span id="cb343-6"><a href="#cb343-6" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb343-7"><a href="#cb343-7" aria-hidden="true" tabindex="-1"></a><span class="ch">     </span><span class="er">vector&lt;Iterator&lt;C&gt;&gt; res;</span></span>
<span id="cb343-8"><a href="#cb343-8" aria-hidden="true" tabindex="-1"></a><span class="er">     for (auto p = c.begin(); p!=c.end(); ++p)</span></span>
<span id="cb343-9"><a href="#cb343-9" aria-hidden="true" tabindex="-1"></a><span class="er">           if (*p==v)</span></span>
<span id="cb343-10"><a href="#cb343-10" aria-hidden="true" tabindex="-1"></a><span class="er">                 res.push_back(p);</span></span>
<span id="cb343-11"><a href="#cb343-11" aria-hidden="true" tabindex="-1"></a><span class="er">     return res;</span></span>
<span id="cb343-12"><a href="#cb343-12" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>We can now write:</p>
<p><a href="#part0036_split_009.html#p0152_03a"
id="part0017.html#p0152_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb344"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a>void test()</span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>     string m <span class="kw">{</span><span class="ot">&quot;</span><span class="er">Mary had a little lamb</span><span class="ot">&quot;</span><span class="kw">};</span></span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a>     for (auto p <span class="fu">:</span> find_all(m<span class="kw">,</span><span class="st">&#39;</span><span class="er">a</span><span class="st">&#39;</span>))           <span class="fu">//</span> p <span class="dt">is</span> a string::iterator</span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a>           if (<span class="dt">*</span>p!<span class="fu">=</span><span class="er">&#39;</span>a<span class="er">&#39;</span>)</span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true" tabindex="-1"></a>                 cerr <span class="al">&lt;&lt;</span> <span class="er">&quot;</span>string bug<span class="kw">!</span><span class="al">\</span>n<span class="ot">&quot;</span><span class="er">;</span></span>
<span id="cb344-8"><a href="#cb344-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-9"><a href="#cb344-9" aria-hidden="true" tabindex="-1"></a><span class="er">     list&lt;double&gt; ld {1.1, 2.2, 3.3, 1.1};</span></span>
<span id="cb344-10"><a href="#cb344-10" aria-hidden="true" tabindex="-1"></a><span class="er">     for (auto p : find_all(ld,1.1))          // p is a list&lt;double&gt;::iterator</span></span>
<span id="cb344-11"><a href="#cb344-11" aria-hidden="true" tabindex="-1"></a><span class="er">           if (*p!=1.1)</span></span>
<span id="cb344-12"><a href="#cb344-12" aria-hidden="true" tabindex="-1"></a><span class="er">                 cerr </span><span class="ot">&lt;&lt;</span><span class="er"> </span><span class="ot">&quot;</span>list bug<span class="kw">!</span><span class="al">\</span>n<span class="ot">&quot;</span><span class="er">;</span></span>
<span id="cb344-13"><a href="#cb344-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-14"><a href="#cb344-14" aria-hidden="true" tabindex="-1"></a><span class="er">     vector</span><span class="ot">&lt;</span><span class="er">string</span><span class="ot">&gt;</span><span class="er"> vs </span><span class="ot">{</span><span class="er"> </span><span class="ot">&quot;</span>red<span class="ot">&quot;,</span><span class="er"> </span><span class="ot">&quot;</span>blue<span class="ot">&quot;,</span><span class="er"> </span><span class="ot">&quot;</span>green<span class="ot">&quot;,</span><span class="er"> </span><span class="ot">&quot;</span>green<span class="ot">&quot;,</span><span class="er"> </span><span class="ot">&quot;</span>orange<span class="ot">&quot;,</span><span class="er"> </span><span class="ot">&quot;</span>green<span class="ot">&quot;</span><span class="er"> };</span></span>
<span id="cb344-15"><a href="#cb344-15" aria-hidden="true" tabindex="-1"></a><span class="er">     for </span><span class="ot">(</span><span class="er">auto p </span><span class="ot">:</span><span class="er"> find_all</span><span class="ot">(</span><span class="er">vs</span><span class="ot">,&quot;</span>red<span class="ot">&quot;</span><span class="er">))        // p is a vector&lt;string&gt;::iterator</span></span>
<span id="cb344-16"><a href="#cb344-16" aria-hidden="true" tabindex="-1"></a><span class="er">           if </span><span class="ot">(*</span><span class="er">p</span><span class="ot">!=&quot;</span>red<span class="ot">&quot;</span><span class="er">)</span></span>
<span id="cb344-17"><a href="#cb344-17" aria-hidden="true" tabindex="-1"></a><span class="er">                 cerr </span><span class="ot">&lt;&lt;</span><span class="er"> </span><span class="ot">&quot;</span>vector bug<span class="kw">!</span><span class="al">\</span>n<span class="ot">&quot;</span><span class="er">;</span></span>
<span id="cb344-18"><a href="#cb344-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-19"><a href="#cb344-19" aria-hidden="true" tabindex="-1"></a><span class="er">     for </span><span class="ot">(</span><span class="er">auto p </span><span class="ot">:</span><span class="er"> find_all</span><span class="ot">(</span><span class="er">vs</span><span class="ot">,&quot;</span>green<span class="ot">&quot;</span><span class="er">))</span></span>
<span id="cb344-20"><a href="#cb344-20" aria-hidden="true" tabindex="-1"></a><span class="er">           </span><span class="ot">*</span><span class="er">p </span><span class="ot">=</span><span class="er"> </span><span class="ot">&quot;</span>vert<span class="ot">&quot;</span><span class="er">;</span></span>
<span id="cb344-21"><a href="#cb344-21" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p><span id="part0017.html#page_153" class="pagebreak"></span>Iterators
are used to separate algorithms and containers. An algorithm operates on
its data through iterators and knows nothing about the container in
which the elements are stored. Conversely, a container knows nothing
about the algorithms operating on its elements; all it does is to supply
iterators upon request (e.g., <code class="calibre8">begin()</code> and
<code class="calibre8">end()</code>). This model of separation between
data storage and algorithm delivers very general and flexible
software.</p>
<h3 class="h2" id="part0017.html#ch12lev1sec3">12.3 Iterator Types</h3>
<p>What are iterators really? Any particular iterator is an object of
some type. There are, however, many different iterator types, because an
iterator needs to hold the information necessary for doing its job for a
particular container type. These iterator types can be as different as
the containers and the specialized needs they serve. For example, a
<code class="calibre8">vector</code>’s iterator could be an ordinary
pointer, because a pointer is quite a reasonable way of referring to an
element of a <code class="calibre8">vector</code>:</p>
<figure>
<img src="images/00029.jpeg" class="calibre1" />
</figure>
<p>Alternatively, a <code class="calibre8">vector</code> iterator could
be implemented as a pointer to the <code class="calibre8">vector</code>
plus an index:</p>
<figure>
<img src="images/00030.jpeg" class="calibre1" />
</figure>
<p>Using such an iterator would allow range checking.</p>
<p>A <code class="calibre8">list</code> iterator must be something more
complicated than a simple pointer to an element because an element of a
<code class="calibre8">list</code> in general does not know where the
next element of that <code class="calibre8">list</code> is. Thus, a
<code class="calibre8">list</code> iterator might be a pointer to a
link:</p>
<figure>
<img src="images/00031.jpeg" class="calibre1" />
</figure>
<p>What is common for all iterators is their semantics and the naming of
their operations. For example, applying <code class="calibre8">++</code>
to any iterator yields an iterator that refers to the next element.
Similarly, <code class="calibre8">*</code> yields <span
id="part0017.html#page_154" class="pagebreak"></span>the element to
which the iterator refers. In fact, any object that obeys a few simple
rules like these is an iterator – <em>Iterator</em> is a concept (§<a
href="#part0012.html#ch07lev1sec2" class="calibre6">7.2</a>, §<a
href="#part0017.html#ch12lev1sec7" class="calibre6">12.7</a>).
Furthermore, users rarely need to know the type of a specific iterator;
each container “knows” its iterator types and makes them available under
the conventional names <code class="calibre8">iterator</code> and <code
class="calibre8">const_iterator</code>. For example, <code
class="calibre8">list&lt;Entry&gt;::iterator</code> is the general
iterator type for <code class="calibre8">list&lt;Entry&gt;</code>. We
rarely have to worry about the details of how that type is defined.</p>
<h3 class="h2" id="part0017.html#ch12lev1sec4">12.4 Stream
Iterators</h3>
<p>Iterators are a general and useful concept for dealing with sequences
of elements in containers. However, containers are not the only place
where we find sequences of elements. For example, an input stream
produces a sequence of values, and we write a sequence of values to an
output stream. Consequently, the notion of iterators can be usefully
applied to input and output.</p>
<p>To make an <code class="calibre8">ostream_iterator</code>, we need to
specify which stream will be used and the type of objects written to it.
For example:</p>
<p><a href="#part0036_split_010.html#p0154_01a"
id="part0017.html#p0154_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb345"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb345-1"><a href="#cb345-1" aria-hidden="true" tabindex="-1"></a>ostream_iterator<span class="dt">&lt;</span>string<span class="er">&gt;</span> oo <span class="kw">{</span>cout<span class="kw">};</span>    <span class="fu">//</span> <span class="fu">write</span> strings to cout</span></code></pre></div>
<p>The effect of assigning to <code class="calibre8">*oo</code> is to
write the assigned value to <code class="calibre8">cout.</code> For
example:</p>
<p><a href="#part0036_split_011.html#p0154_02a"
id="part0017.html#p0154_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb346"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a>int main()</span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">*</span>oo <span class="kw">=</span> <span class="ot">&quot;</span><span class="er">Hello</span><span class="ot">,</span><span class="er"> </span><span class="ot">&quot;</span><span class="kw">;</span>    <span class="fu">//</span> meaning cout<span class="al">&lt;&lt;</span><span class="ot">&quot;</span><span class="er">Hello</span><span class="ot">,</span><span class="er"> </span><span class="ot">&quot;</span></span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a>     ++oo<span class="kw">;</span></span>
<span id="cb346-5"><a href="#cb346-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">*</span>oo <span class="kw">=</span> <span class="ot">&quot;</span><span class="er">world</span><span class="ot">!</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span>   <span class="fu">//</span> meaning cout<span class="al">&lt;&lt;</span><span class="ot">&quot;</span><span class="er">world</span><span class="ot">!</span><span class="ch">\n</span><span class="ot">&quot;</span></span>
<span id="cb346-6"><a href="#cb346-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This is yet another way of writing the canonical message to standard
output. The <code class="calibre8">++oo</code> is done to mimic writing
into an array through a pointer.</p>
<p>Similarly, an <code class="calibre8">istream_iterator</code> is
something that allows us to treat an input stream as a read-only
container. Again, we must specify the stream to be used and the type of
values expected:</p>
<div class="sourceCode" id="cb347"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb347-1"><a href="#cb347-1" aria-hidden="true" tabindex="-1"></a>istream_iterator<span class="dt">&lt;</span>string<span class="er">&gt;</span> ii <span class="kw">{</span>cin<span class="kw">};</span></span></code></pre></div>
<p>Input iterators are used in pairs representing a sequence, so we must
provide an <code class="calibre8">istream_iterator</code> to indicate
the end of input. This is the default <code
class="calibre8">istream_iterator</code>:</p>
<div class="sourceCode" id="cb348"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a>istream_iterator<span class="dt">&lt;</span>string<span class="er">&gt;</span> eos <span class="kw">{};</span></span></code></pre></div>
<p>Typically, <code class="calibre8">istream_iterator</code>s and <code
class="calibre8">ostream_iterator</code>s are not used directly.
Instead, they are provided as arguments to algorithms. For example, we
can write a simple program to read a file, sort the words read,
eliminate duplicates, and write the result to another file:</p>
<p><a href="#part0036_split_012.html#p0154_03a"
id="part0017.html#p0154_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb349"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb349-1"><a href="#cb349-1" aria-hidden="true" tabindex="-1"></a>int main()</span>
<span id="cb349-2"><a href="#cb349-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb349-3"><a href="#cb349-3" aria-hidden="true" tabindex="-1"></a>     string from<span class="kw">,</span> to<span class="kw">;</span></span>
<span id="cb349-4"><a href="#cb349-4" aria-hidden="true" tabindex="-1"></a>     cin <span class="al">&gt;&gt;</span> from <span class="al">&gt;&gt;</span> to<span class="kw">;</span>                      <span class="fu">//</span> get source and target file names</span>
<span id="cb349-5"><a href="#cb349-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-6"><a href="#cb349-6" aria-hidden="true" tabindex="-1"></a>     ifstream <span class="dt">is</span> <span class="er">{</span>from<span class="kw">};</span>                     <span class="fu">//</span> input stream for file <span class="ot">&quot;</span><span class="er">from</span><span class="ot">&quot;</span></span>
<span id="cb349-7"><a href="#cb349-7" aria-hidden="true" tabindex="-1"></a>     istream_iterator<span class="dt">&lt;</span>string<span class="er">&gt;</span> ii <span class="kw">{</span><span class="dt">is</span><span class="kw">};</span>       <span class="fu">//</span> input iterator for stream</span>
<span id="cb349-8"><a href="#cb349-8" aria-hidden="true" tabindex="-1"></a>     istream_iterator<span class="dt">&lt;</span>string<span class="er">&gt;</span> eos <span class="kw">{};</span>        <span class="fu">//</span> input sentinel</span>
<span id="cb349-9"><a href="#cb349-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-10"><a href="#cb349-10" aria-hidden="true" tabindex="-1"></a>     ofstream os <span class="kw">{</span>to<span class="kw">};</span>                       <span class="fu">//</span> output stream for file <span class="ot">&quot;</span><span class="er">to</span><span class="ot">&quot;</span></span>
<span id="cb349-11"><a href="#cb349-11" aria-hidden="true" tabindex="-1"></a>     ostream_iterator<span class="dt">&lt;</span>string<span class="er">&gt;</span> oo <span class="kw">{</span>os<span class="kw">,</span><span class="ot">&quot;</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">};</span>  <span class="fu">//</span> output iterator for stream</span>
<span id="cb349-12"><a href="#cb349-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-13"><a href="#cb349-13" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>string<span class="er">&gt;</span> b <span class="kw">{</span>ii<span class="kw">,</span>eos<span class="kw">};</span>              <span class="fu">//</span> b <span class="dt">is</span> a vector initialized from input</span>
<span id="cb349-14"><a href="#cb349-14" aria-hidden="true" tabindex="-1"></a>     sort(b.begin()<span class="er">,</span>b.end())<span class="kw">;</span>                <span class="fu">//</span> sort the buffer</span>
<span id="cb349-15"><a href="#cb349-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-16"><a href="#cb349-16" aria-hidden="true" tabindex="-1"></a>     unique_copy(b<span class="al">.</span>begin()<span class="kw">,</span>b<span class="al">.</span>end()<span class="kw">,</span>oo)<span class="kw">;</span>      <span class="fu">//</span> copy buffer to output<span class="kw">,</span> discard replicated values</span>
<span id="cb349-17"><a href="#cb349-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-18"><a href="#cb349-18" aria-hidden="true" tabindex="-1"></a>     return <span class="kw">!</span><span class="dt">is</span><span class="kw">.</span>eof() || <span class="kw">!</span>os<span class="kw">;</span>                <span class="fu">//</span> return error state (<span class="er">§</span><span class="fl">1.2</span><span class="al">.</span><span class="dv">1</span><span class="kw">,</span> <span class="er">§</span><span class="fl">10.4</span>)</span>
<span id="cb349-19"><a href="#cb349-19" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p><span id="part0017.html#page_155" class="pagebreak"></span>An <code
class="calibre8">ifstream</code> is an <code
class="calibre8">istream</code> that can be attached to a file, and an
<code class="calibre8">ofstream</code> is an <code
class="calibre8">ostream</code> that can be attached to a file (§<a
href="#part0015.html#ch10lev1sec7" class="calibre6">10.7</a>). The <code
class="calibre8">ostream_iterator</code>’s second argument is used to
delimit output values.</p>
<p>Actually, this program is longer than it needs to be. We read the
strings into a <code class="calibre8">vector</code>, then we <code
class="calibre8">sort()</code> them, and then we write them out,
eliminating duplicates. A more elegant solution is not to store
duplicates at all. This can be done by keeping the <code
class="calibre8">string</code>s in a <code class="calibre8">set</code>,
which does not keep duplicates and keeps its elements in order (§<a
href="#part0016.html#ch11lev1sec4" class="calibre6">11.4</a>). That way,
we could replace the two lines using a <code
class="calibre8">vector</code> with one using a <code
class="calibre8">set</code> and replace <code
class="calibre8">unique_copy()</code> with the simpler <code
class="calibre8">copy()</code>:</p>
<p><a href="#part0036_split_013.html#p0155_01a"
id="part0017.html#p0155_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb350"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a>set<span class="dt">&lt;</span>string<span class="er">&gt;</span> b <span class="kw">{</span>ii<span class="kw">,</span>eos<span class="kw">};</span>           <span class="fu">//</span> collect strings from input</span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>copy(b<span class="al">.</span>begin()<span class="kw">,</span>b<span class="al">.</span>end()<span class="kw">,</span>oo)<span class="kw">;</span>       <span class="fu">//</span> copy buffer to output</span></code></pre></div>
<p>We used the names <code class="calibre8">ii</code>, <code
class="calibre8">eos</code>, and <code class="calibre8">oo</code> only
once, so we could further reduce the size of the program:</p>
<p><a href="#part0036_split_014.html#p0155_02a"
id="part0017.html#p0155_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb351"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb351-1"><a href="#cb351-1" aria-hidden="true" tabindex="-1"></a>int main()</span>
<span id="cb351-2"><a href="#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb351-3"><a href="#cb351-3" aria-hidden="true" tabindex="-1"></a>     string from<span class="kw">,</span> to<span class="kw">;</span></span>
<span id="cb351-4"><a href="#cb351-4" aria-hidden="true" tabindex="-1"></a>     cin <span class="al">&gt;&gt;</span> from <span class="al">&gt;&gt;</span> to<span class="kw">;</span>             <span class="fu">//</span> get source and target file names</span>
<span id="cb351-5"><a href="#cb351-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-6"><a href="#cb351-6" aria-hidden="true" tabindex="-1"></a>     ifstream <span class="dt">is</span> <span class="er">{</span>from<span class="kw">};</span>            <span class="fu">//</span> input stream for file <span class="ot">&quot;</span><span class="er">from</span><span class="ot">&quot;</span></span>
<span id="cb351-7"><a href="#cb351-7" aria-hidden="true" tabindex="-1"></a>     ofstream os <span class="kw">{</span>to<span class="kw">};</span>              <span class="fu">//</span> output stream for file <span class="ot">&quot;</span><span class="er">to</span><span class="ot">&quot;</span></span>
<span id="cb351-8"><a href="#cb351-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-9"><a href="#cb351-9" aria-hidden="true" tabindex="-1"></a>     set<span class="dt">&lt;</span>string<span class="er">&gt;</span> b <span class="kw">{</span>istream_iterator<span class="dt">&lt;</span>string<span class="er">&gt;</span><span class="kw">{</span><span class="dt">is</span><span class="kw">},</span>istream_iterator<span class="dt">&lt;</span>string<span class="er">&gt;</span><span class="kw">{}};</span>     <span class="fu">//</span> <span class="fu">read</span> input</span>
<span id="cb351-10"><a href="#cb351-10" aria-hidden="true" tabindex="-1"></a>     copy(b<span class="al">.</span>begin()<span class="kw">,</span>b<span class="al">.</span>end()<span class="kw">,</span>ostream_iterator<span class="dt">&lt;</span>string<span class="er">&gt;</span><span class="kw">{</span>os<span class="kw">,</span><span class="ot">&quot;</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">}</span>)<span class="kw">;</span>                   <span class="fu">//</span> copy to output</span>
<span id="cb351-11"><a href="#cb351-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-12"><a href="#cb351-12" aria-hidden="true" tabindex="-1"></a>     return <span class="kw">!</span><span class="dt">is</span><span class="kw">.</span>eof() || <span class="kw">!</span>os<span class="kw">;</span>           <span class="fu">//</span> return error state (<span class="er">§</span><span class="fl">1.2</span><span class="al">.</span><span class="dv">1</span><span class="kw">,</span> <span class="er">§</span><span class="fl">10.4</span>)</span>
<span id="cb351-13"><a href="#cb351-13" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>It is a matter of taste and experience whether or not this last
simplification improves readability.</p>
<h3 class="h2" id="part0017.html#ch12lev1sec5">12.5 Predicates</h3>
<p>In the examples so far, the algorithms have simply “built in” the
action to be done for each element of a sequence. However, we often want
to make that action a parameter to the algorithm. For example, the <code
class="calibre8">find</code> algorithm (§<a
href="#part0017.html#ch12lev1sec2" class="calibre6">12.2</a>, §<a
href="#part0017.html#ch12lev1sec6" class="calibre6">12.6</a>) provides a
convenient way of looking for a specific value. A more general variant
looks for an element that fulfills a specified requirement, a
<em>predicate</em>. For example, we might want to search a <code
class="calibre8">map</code> for the first value larger than <code
class="calibre8">42</code>. A <code class="calibre8">map</code> allows
us to access its elements as a sequence of <em>(key,value)</em> pairs,
so we can search a <code class="calibre8">map&lt;string,int&gt;</code>’s
sequence for a <code
class="calibre8">pair&lt;const string,int&gt;</code> where the <code
class="calibre8">int</code> is greater than <code
class="calibre8">42</code>:</p>
<p><a href="#part0036_split_015.html#p0156_01a"
id="part0017.html#p0156_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb352"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb352-1"><a href="#cb352-1" aria-hidden="true" tabindex="-1"></a>void f(map<span class="dt">&lt;</span>string<span class="kw">,</span>int&gt;&amp; m)</span>
<span id="cb352-2"><a href="#cb352-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb352-3"><a href="#cb352-3" aria-hidden="true" tabindex="-1"></a>     auto p <span class="kw">=</span> find_if(m<span class="al">.</span>begin()<span class="kw">,</span>m<span class="al">.</span>end()<span class="kw">,</span><span class="dt">Greater_than</span><span class="kw">{</span><span class="dv">42</span><span class="kw">}</span>)<span class="kw">;</span></span>
<span id="cb352-4"><a href="#cb352-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb352-5"><a href="#cb352-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Here, <code class="calibre8">Greater_than</code> is a function object
(§<a href="#part0011.html#ch06lev2sec5" class="calibre6">6.3.2</a>)
holding the value (<code class="calibre8">42</code>) to be compared
against:</p>
<p><a href="#part0036_split_016.html#p0156_02a"
id="part0017.html#p0156_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb353"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Greater_than</span> <span class="kw">{</span></span>
<span id="cb353-2"><a href="#cb353-2" aria-hidden="true" tabindex="-1"></a>     int val<span class="kw">;</span></span>
<span id="cb353-3"><a href="#cb353-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Greater_than</span>(int v) <span class="fu">:</span> val<span class="kw">{</span>v<span class="kw">}</span> <span class="kw">{</span> <span class="kw">}</span></span>
<span id="cb353-4"><a href="#cb353-4" aria-hidden="true" tabindex="-1"></a>     bool operator()(const pair<span class="dt">&lt;</span>string<span class="kw">,</span>int&gt;&amp; r) const <span class="kw">{</span> return r.second<span class="dt">&gt;</span>val<span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb353-5"><a href="#cb353-5" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>Alternatively, we could use a lambda expression (§<a
href="#part0011.html#ch06lev2sec5" class="calibre6">6.3.2</a>):</p>
<p><a href="#part0036_split_017.html#p0156_03a"
id="part0017.html#p0156_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb354"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb354-1"><a href="#cb354-1" aria-hidden="true" tabindex="-1"></a>auto p <span class="kw">=</span> find_if(m<span class="al">.</span>begin()<span class="kw">,</span> m<span class="al">.</span>end()<span class="kw">,</span> [](const pair<span class="dt">&lt;</span>string<span class="kw">,</span>int&gt;&amp; r) <span class="kw">{</span> return r.second<span class="dt">&gt;</span><span class="dv">42</span><span class="kw">;</span> <span class="kw">}</span>)<span class="kw">;</span></span></code></pre></div>
<p>A predicate should not modify the elements to which it is
applied.</p>
<h3 class="h2" id="part0017.html#ch12lev1sec6">12.6 Algorithm
Overview</h3>
<p>A general definition of an algorithm is “a finite set of rules which
gives a sequence of operations for solving a specific set of problems
[and] has five important features: Finiteness ... Definiteness ... Input
... Output ... Effectiveness” [<a href="#part0021.html#ref31"
class="calibre6">Knuth,1968</a>,§<a href="#part0006.html#ch01lev1sec1"
class="calibre6">1.1</a>]. In the context of the C++ standard library,
an algorithm is a function template operating on sequences of
elements.</p>
<p>The standard library provides dozens of algorithms. The algorithms
are defined in namespace <code class="calibre8">std</code> and presented
in the <code class="calibre8">&lt;algorithm&gt;</code> header. These
standard-library algorithms all take sequences as inputs. A half-open
sequence from <code class="calibre8">b</code> to <code
class="calibre8">e</code> is referred to as [<code
class="calibre8">b</code>:<code class="calibre8">e</code>). Here are a
few examples:</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>Selected Standard
Algorithms</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">f=for_each(b,e,f)</code></p></td>
<td class="calibre14"><p>For each element <code
class="calibre8">x</code> in [<code class="calibre8">b</code>:<code
class="calibre8">e</code>)do <code class="calibre8">f(x)</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">p=find(b,e,x)</code></p></td>
<td class="calibre14"><p><code class="calibre8">p</code> is the first
<code class="calibre8">p</code> in [<code
class="calibre8">b</code>:<code class="calibre8">e</code>) so that <code
class="calibre8">*p==x</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p=find_if(b,e,f)</code></p></td>
<td class="calibre14"><p><code class="calibre8">p</code> is the first
<code class="calibre8">p</code> in [<code
class="calibre8">b</code>:<code class="calibre8">e</code>) so that <code
class="calibre8">f(*p)</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">n=count(b,e,x)</code></p></td>
<td class="calibre14"><p><code class="calibre8">n</code> is the number
of elements <code class="calibre8">*q</code> in [<code
class="calibre8">b</code>:<code class="calibre8">e</code>) so that <code
class="calibre8">*q==x</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">n=count_if(b,e,f)</code></p></td>
<td class="calibre14"><p><code class="calibre8">n</code> is the number
of elements <code class="calibre8">*q</code> in [<code
class="calibre8">b</code>:<code class="calibre8">e</code>) so that <code
class="calibre8">f(*q)</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">replace(b,e,v,v2)</code></p></td>
<td class="calibre14"><p>Replace elements <code
class="calibre8">*q</code> in [<code class="calibre8">b</code>:<code
class="calibre8">e</code>) so that <code class="calibre8">*q==v</code>
with <code class="calibre8">v2</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">replace_if(b,e,f,v2)</code></p></td>
<td class="calibre14"><p>Replace elements <code
class="calibre8">*q</code> in [<code class="calibre8">b</code>:<code
class="calibre8">e</code>) so that <code class="calibre8">f(*q)</code>
with <code class="calibre8">v2</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">p=copy(b,e,out)</code></p></td>
<td class="calibre14"><p>Copy [<code class="calibre8">b</code>:<code
class="calibre8">e</code>)to[<code class="calibre8">out</code>:<code
class="calibre8">p</code>)</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p=copy_if(b,e,out,f)</code></p></td>
<td class="calibre14"><p>Copy elements <code class="calibre8">*q</code>
from [<code class="calibre8">b</code>:<code class="calibre8">e</code>)
so that <code class="calibre8">f(*q)</code> to [<code
class="calibre8">out</code>:<code class="calibre8">p</code>)</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">p=move(b,e,out)</code></p></td>
<td class="calibre14"><p>Move [<code class="calibre8">b</code>:<code
class="calibre8">e</code>)to[<code class="calibre8">out</code>:<code
class="calibre8">p</code>)</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p=unique_copy(b,e,out)</code></p></td>
<td class="calibre14"><p>Copy [<code class="calibre8">b</code>:<code
class="calibre8">e</code>)to[<code class="calibre8">out</code>:<code
class="calibre8">p</code>); don’t copy adjacent duplicates</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">sort(b,e)</code></p></td>
<td class="calibre14"><p>Sort elements of [<code
class="calibre8">b</code>:<code class="calibre8">e</code>) using <code
class="calibre8">&lt;</code> as the sorting criterion</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">sort(b,e,f)</code></p></td>
<td class="calibre14"><p>Sort elements of [<code
class="calibre8">b</code>:<code class="calibre8">e</code>) using <code
class="calibre8">f</code> as the sorting criterion</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">(p1,p2)=equal_range(b,e,v)</code></p></td>
<td class="calibre14"><p>[<code class="calibre8">p1</code>:<code
class="calibre8">p2</code>) is the subsequence of the sorted sequence
[<code class="calibre8">b</code>:<code class="calibre8">e</code>) with
the value <code class="calibre8">v</code>; basically a binary search for
<code class="calibre8">v</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p=merge(b,e,b2,e2,out)</code></p></td>
<td class="calibre14"><p>Merge two sorted sequences [<code
class="calibre8">b</code>:<code class="calibre8">e</code>) and [<code
class="calibre8">b2</code>:<code class="calibre8">e2</code>) into [<code
class="calibre8">out</code>:<code class="calibre8">p</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">p=merge(b,e,b2,e2,out,f)</code></p></td>
<td class="calibre14"><p>Merge two sorted sequences [<code
class="calibre8">b</code>:<code class="calibre8">e</code>) and [<code
class="calibre8">b2</code>:<code class="calibre8">e2</code>) into [<code
class="calibre8">out</code>:<code class="calibre8">p</code> using <code
class="calibre8">f</code> as the comparison)</p></td>
</tr>
</tbody>
</table>
<p><span id="part0017.html#page_157" class="pagebreak"></span>These
algorithms, and many more (e.g., §<a href="#part0019.html#ch14lev1sec3"
class="calibre6">14.3</a>), can be applied to elements of containers,
<code class="calibre8">string</code>s, and built-in arrays.</p>
<p>Some algorithms, such as <code class="calibre8">replace()</code> and
<code class="calibre8">sort(),</code> modify element values, but no
algorithm adds or subtracts elements of a container. The reason is that
a sequence does not identify the container that holds the elements of
the sequence. To add or delete elements, you need something that knows
about the container (e.g., a <code
class="calibre8">back_inserter</code>; §<a
href="#part0017.html#ch12lev1sec1" class="calibre6">12.1</a>) or
directly refers to the container itself (e.g., <code
class="calibre8">push_back()</code> or <code
class="calibre8">erase()</code>; §<a href="#part0016.html#ch11lev1sec2"
class="calibre6">11.2</a>).</p>
<p>Lambdas are very common as operations passed as arguments. For
example:</p>
<p><a href="#part0036_split_018.html#p0157_01a"
id="part0017.html#p0157_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb355"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb355-1"><a href="#cb355-1" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> v <span class="kw">=</span> <span class="kw">{</span><span class="dv">0</span><span class="kw">,</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">,</span><span class="dv">4</span><span class="kw">,</span><span class="dv">5</span><span class="kw">};</span></span>
<span id="cb355-2"><a href="#cb355-2" aria-hidden="true" tabindex="-1"></a>for_each(v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end()<span class="kw">,</span>[](int&amp; x)<span class="kw">{</span> x<span class="kw">=</span>x<span class="fu">*</span>x<span class="kw">;</span> <span class="kw">}</span>)<span class="kw">;</span>     <span class="fu">//</span> v<span class="fu">==</span><span class="kw">{</span><span class="dv">0</span><span class="kw">,</span><span class="dv">1</span><span class="kw">,</span><span class="dv">4</span><span class="kw">,</span><span class="dv">9</span><span class="kw">,</span><span class="dv">16</span><span class="kw">,</span><span class="dv">25</span><span class="kw">}</span></span></code></pre></div>
<p>The standard-library algorithms tend to be more carefully designed,
specified, and implemented than the average hand-crafted loop, so know
them and use them in preference to code written in the bare
language.</p>
<h3 class="h2" id="part0017.html#ch12lev1sec7">12.7 Concepts
(C++20)</h3>
<p>Eventually, the standard-library algorithms will be specified using
concepts (<a href="#part0012.html#ch07" class="calibre6">Chapter 7</a>).
The preliminary work on this can be found in the Ranges Technical
Specification [<a href="#part0021.html#ref37"
class="calibre6">RangesTS</a>]. Implementations can be found on the Web.
The concepts are defined in <code
class="calibre8">&lt;experimental/ranges&gt;</code>, but hopefully
something very similar will be added to namespace <code
class="calibre8">std</code> for C++20.</p>
<p><code class="calibre8">Range</code>s are a generalization of the
C++98 sequences defined by <code class="calibre8">begin()</code>/<code
class="calibre8">end()</code> pairs. A <code
class="calibre8">Range</code> is a concept specifying what it takes to
be a sequence of elements. It can be defined by</p>
<ul>
<li><p>A <code class="calibre8">{begin,end}</code> pair of
iterators</p></li>
<li><p>A <code class="calibre8">{begin,n}</code> pair, where <code
class="calibre8">begin</code> is an iterator and <code
class="calibre8">n</code> is the number of elements</p></li>
<li><p>A <code class="calibre8">{begin,pred}</code> pair, where <code
class="calibre8">begin</code> is an iterator and <code
class="calibre8">pred</code> is a predicate; if <code
class="calibre8">pred(p)</code> is <code class="calibre8">true</code>
for the iterator <code class="calibre8">p</code>, we have reached the
end of the sequence. This allows us to have infinite sequences and
sequences that are generated “on the fly.”</p></li>
</ul>
<p>This <code class="calibre8">Range</code> concept is what allows us to
say <code class="calibre8">sort(v)</code> rather than <code
class="calibre8">sort(v.begin(),v.end())</code> as we had to using the
STL since 1994. For example:</p>
<p><a href="#part0036_split_019.html#p0157_02a"
id="part0017.html#p0157_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb356"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;BoundedRangeR</span><span class="er">&gt;</span></span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a>    requires <span class="dt">Sortable&lt;R</span><span class="er">&gt;</span></span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a>void sort(<span class="dt">R</span>&amp; r)</span>
<span id="cb356-4"><a href="#cb356-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb356-5"><a href="#cb356-5" aria-hidden="true" tabindex="-1"></a>    return sort(begin(r)<span class="kw">,</span>end(r))<span class="kw">;</span></span>
<span id="cb356-6"><a href="#cb356-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The relation for <code class="calibre8">Sortable</code> is defaulted
to <code class="calibre8">less</code>.</p>
<p><span id="part0017.html#page_158" class="pagebreak"></span>In
addition to <code class="calibre8">Range</code>, the Ranges TS offers
many useful concepts. These concepts are found in <code
class="calibre8">&lt;experimental/ranges/concepts&gt;</code>. For
precise definitions, see [<a href="#part0021.html#ref37"
class="calibre6">RangesTS</a>].</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>Core language
concepts</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Same&lt;T,U&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">T</code> is the same
type as <code class="calibre8">U</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">DerivedFrom&lt;T,U&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">T</code> is derived from
<code class="calibre8">U</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">ConvertibleTo&lt;T,U&gt;</code></p></td>
<td class="calibre14"><p>A <code class="calibre8">T</code> can be
converted to a <code class="calibre8">U</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">CommonReference&lt;T,U&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">T</code> and <code
class="calibre8">U</code> share a common reference type</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Common&lt;T,U&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">T</code> and <code
class="calibre8">U</code> share a common type</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">Integral&lt;T&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">T</code> is an integral
type</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">SignedIntegral&lt;T&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">T</code> is a signed
integral type</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">UnsignedIntegral&lt;T&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">T</code> is an unsigned
integral type</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Assignable&lt;T,U&gt;</code></p></td>
<td class="calibre14"><p>A <code class="calibre8">U</code> can be
assigned to a <code class="calibre8">T</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">SwappableWith&lt;T,U&gt;</code></p></td>
<td class="calibre14"><p>A <code class="calibre8">T</code> can be
swapped with a <code class="calibre8">U</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Swappable&lt;T&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">SwappableWith&lt;T,T&gt;</code></p></td>
</tr>
</tbody>
</table>
<p><code class="calibre8">Common</code> is important for specifying
algorithms that should work with a variety of related types while still
being mathematically sound. <code
class="calibre8">Common&lt;T,U&gt;</code> is a type <code
class="calibre8">C</code> that we can use for comparing a <code
class="calibre8">T</code> with a <code class="calibre8">U</code> by
first converting both to <code class="calibre8">C</code>s. For example,
we would like to compare a <code class="calibre8">std::string</code>
with a C-style string (a <code class="calibre8">char*</code>) and an
<code class="calibre8">int</code> with a <code
class="calibre8">double</code>, but not a <code
class="calibre8">std::string</code> with an <code
class="calibre8">int</code>. To ensure that we specialize <code
class="calibre8">common_type_t</code>, used in the definition of <code
class="calibre8">Common</code>, suitably:</p>
<p><a href="#part0036_split_020.html#p0158_01a"
id="part0017.html#p0158_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb357"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a>using common_type_t<span class="dt">&lt;</span>std::string<span class="kw">,</span>char*&gt; <span class="kw">=</span> std::string<span class="kw">;</span></span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a>using common_type_t<span class="dt">&lt;</span>double<span class="kw">,</span>int<span class="dt">&gt;</span> <span class="kw">=</span> double<span class="kw">;</span></span></code></pre></div>
<p>The definition of <code class="calibre8">Common</code> is a bit
tricky but solves a hard fundamental problem. Fortunately, we don’t need
to define a <code class="calibre8">common_type_t</code> specialization
unless we want to use operations on mixes of types for which a library
doesn’t (yet) have suitable definitions. <code
class="calibre8">Common</code> or <code
class="calibre8">CommonReference</code> is used in the definitions of
most concepts and algorithms that can compare values of different
types.</p>
<p>The concepts related to comparison are strongly influenced by [<a
href="#part0021.html#ref40" class="calibre6">Stepanov,2009</a>].</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>Comparison
concepts</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Boolean&lt;T&gt;</code></p></td>
<td class="calibre14"><p>A <code class="calibre8">T</code> can be used
as a Boolean</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">WeaklyEqualityComparableWith&lt;T,U&gt;</code></p></td>
<td class="calibre14"><p>A <code class="calibre8">T</code> and a <code
class="calibre8">U</code> can be compared for equality using <code
class="calibre8">==</code> and <code class="calibre8">!=</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">WeaklyEqualityComparable&lt;T&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">WeaklyEqualityComparableWith&lt;T,T&gt;</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">EqualityComparableWith&lt;T,U&gt;</code></p></td>
<td class="calibre14"><p>A <code class="calibre8">T</code> and a <code
class="calibre8">U</code> can be compared for equivalence using <code
class="calibre8">==</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">EqualityComparable&lt;T&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">EqualityComparableWith&lt;T,T&gt;</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">StrictTotallyOrderedWith&lt;T,U&gt;</code></p></td>
<td class="calibre14"><p>A <code class="calibre8">T</code> and a <code
class="calibre8">U</code> can be compared using <code
class="calibre8">&lt;</code>, <code class="calibre8">&lt;=</code>, <code
class="calibre8">&gt;</code>, and <code class="calibre8">&gt;=</code>
yielding a total order</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">StrictTotallyOrdered&lt;T&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">StrictTotallyOrderedWith&lt;T,T&gt;</code></p></td>
</tr>
</tbody>
</table>
<p>The use of both <code
class="calibre8">WeaklyEqualityComparableWith</code> and <code
class="calibre8">WeaklyEqualityComparable</code> shows a (so far) missed
opportunity to overload.</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><span id="part0017.html#page_159"
class="pagebreak"></span><strong>Object concepts</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Destructible&lt;T&gt;</code></p></td>
<td class="calibre14"><p>A <code class="calibre8">T</code> can be
destroyed and have its address taken with unary <code
class="calibre8">&amp;</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">Constructible&lt;T,Args&gt;</code></p></td>
<td class="calibre14"><p>A <code class="calibre8">T</code> can be
constructed from an argument list of type <code
class="calibre8">Args</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">DefaultConstructible&lt;T&gt;</code></p></td>
<td class="calibre14"><p>A <code class="calibre8">T</code> can be
default constructed</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">MoveConstructible&lt;T&gt;</code></p></td>
<td class="calibre14"><p>A <code class="calibre8">T</code> can be move
constructed</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">CopyConstructible&lt;T&gt;</code></p></td>
<td class="calibre14"><p>A <code class="calibre8">T</code> can be copy
constructed and move constructed</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">Movable&lt;T&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">MoveConstructable&lt;T&gt;</code>, <code
class="calibre8">Assignable&lt;T&amp;,T&gt;</code>, and <code
class="calibre8">Swapable&lt;T&gt;</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Copyable&lt;T&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">CopyConstructable&lt;T&gt;</code>, <code
class="calibre8">Moveable&lt;T&gt;</code>, and <code
class="calibre8">Assignable&lt;T, const T&amp;&gt;</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">Semiregular&lt;T&gt;</code></p></td>
<td class="calibre14"><p><code class="calibre8">Copyable&lt;T&gt;</code>
and <code class="calibre8">DefaultConstructable&lt;T&gt;</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Regular&lt;T&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">SemiRegular&lt;T&gt;</code> and <code
class="calibre8">EqualityComparable&lt;T&gt;</code></p></td>
</tr>
</tbody>
</table>
<p><code class="calibre8">Regular</code> is the ideal for types. A <code
class="calibre8">Regular</code> type works roughly like an <code
class="calibre8">int</code> and simplifies much of our thinking about
how to use a type (§<a href="#part0012.html#ch07lev1sec2"
class="calibre6">7.2</a>). The lack of default <code
class="calibre8">==</code> for classes means that most classes start out
as <code class="calibre8">SemiRegular</code> even though most could and
should be <code class="calibre8">Regular</code>.</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>Callable
concepts</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Invocable&lt;F,Args&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">F</code> can be
invoked with an argument list of type <code
class="calibre8">Args</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">InvocableRegular&lt;F,Args&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">Invocable&lt;F,Args&gt;</code> and is equality
preserving</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Predicate&lt;F,Args&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">F</code> can be
invoked with an argument list of type <code class="calibre8">Args</code>
returning a <code class="calibre8">bool</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">Relation&lt;F,T,U&gt;</code></p></td>
<td class="calibre14"><p><code
class="calibre8">Predicate&lt;F,T,U&gt;</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">StrictWeakOrder&lt;F,T,U&gt;</code></p></td>
<td class="calibre14"><p>A <code
class="calibre8">Relation&lt;F,T,U&gt;</code> that provides strict weak
ordering</p></td>
</tr>
</tbody>
</table>
<p>A function <code class="calibre8">f()</code> is <em>equality
preserving</em> if <code class="calibre8">x==y</code> implies that <code
class="calibre8">f(x)==f(y)</code>.</p>
<p>Strict weak ordering is what the standard library usually assumes for
comparisons, such as <code class="calibre8">&lt;</code>; look it up if
you feel the need to know.</p>
<p><code class="calibre8">Relation</code> and <code
class="calibre8">StrictWeakOrder</code> differ only in semantics. We
can’t (currently) represent that in code so the names simply express our
intent.</p>
<table class="all">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>Iterator
concepts</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Iterator&lt;I&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">I</code> can be
incremented (<code class="calibre8">++</code>) and dereferenced (<code
class="calibre8">*</code>)</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">Sentinel&lt;S,I&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">S</code> is a
sentinel for an <code class="calibre8">Iterator</code> type;</p>
<p>that is, <code class="calibre8">S</code> is a predicate on <code
class="calibre8">I</code>’s value type</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">SizedSentinel&lt;S,I&gt;</code></p></td>
<td class="calibre14"><p>A sentinel <code class="calibre8">S</code>
where the <code class="calibre8">−</code> operator can be applied to
<code class="calibre8">I</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">InputIterator&lt;I&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">I</code> is an input
iterator; <code class="calibre8">*</code> can be used for reading
only</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">OutputIterator&lt;I&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">I</code> is an output
iterator; <code class="calibre8">*</code> can be used for writing
only</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">ForwardIterator&lt;I&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">I</code> is a forward
iterator, supporting multi-pass</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">BidirectionalIterator&lt;I&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">I</code> is a <code
class="calibre8">ForwardIterator</code> supporting <code
class="calibre8">−−</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">RandomAccessIterator&lt;I&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">I</code> is a <code
class="calibre8">BidirectionalIterator</code> supporting <code
class="calibre8">+</code>, <code class="calibre8">−</code>, <code
class="calibre8">+=</code>, <code class="calibre8">−=</code>, and <code
class="calibre8">[]</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Permutable&lt;I&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">I</code> is a <code
class="calibre8">ForwardIterator&lt;I&gt;</code> where <code
class="calibre8">I</code> allows us to move and swap elements</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">Mergeable&lt;I1,I2,R,O&gt;</code></p></td>
<td class="calibre14"><p>Can merge sorted sequences defined by <code
class="calibre8">I1</code> and <code class="calibre8">I2</code> into
<code class="calibre8">O</code> using <code
class="calibre8">Relation&lt;R&gt;</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Sortable&lt;I&gt;</code></p></td>
<td class="calibre14"><p>Can sort sequences defined by <code
class="calibre8">I</code> using <code
class="calibre8">less</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">Sortable&lt;I,R&gt;</code></p></td>
<td class="calibre14"><p>Can sort sequences defined by <code
class="calibre8">I</code> using <code
class="calibre8">Relation&lt;R&gt;</code></p></td>
</tr>
</tbody>
</table>
<p><span id="part0017.html#page_160" class="pagebreak"></span>The
different kinds (categories) of iterators are used to select the best
algorithm for a given algorithm; see §<a
href="#part0012.html#ch07lev2sec2" class="calibre6">7.2.2</a> and §<a
href="#part0018.html#ch13lev2sec12" class="calibre6">13.9.1</a>. For an
example of an <code class="calibre8">InputIterator</code>, see §<a
href="#part0017.html#ch12lev1sec4" class="calibre6">12.4</a>.</p>
<p>The basic idea of a sentinel is that we can iterate over a range
starting at an iterator until the predicate becomes true for an element.
T hat way, an iterator <code class="calibre8">p</code> and a sentinel
<code class="calibre8">s</code> define a range [<code
class="calibre8">p</code>:<code class="calibre8">s(*p)</code>). For
example, we could define a predicate for a sentinel for traversing a
C-style string using a pointer as the iterator:</p>
<div class="sourceCode" id="cb358"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a>[](const char<span class="fu">*</span> p) <span class="kw">{</span>return <span class="fu">*</span>p<span class="fu">==</span><span class="dv">0</span><span class="kw">;</span> <span class="kw">}</span></span></code></pre></div>
<p>The summary of <code class="calibre8">Mergeable</code> and <code
class="calibre8">Sortable</code> are simplified relative to [<a
href="#part0021.html#ref37" class="calibre6">RangesTS</a>].</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>Range
concepts</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">Range&lt;R&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">R</code> is a range
with a begin iterator and a sentinel</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">SizedRange&lt;R&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">R</code> is a range
that knows its size in constant time</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">View&lt;R&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">R</code> is a range
with constant time copy, move, and assignment</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">BoundedRange&lt;R&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">R</code> is a range
with identical iterator and sentinel types</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">InputRange&lt;R&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">R</code> is a range
whose iterator type satisfies InputIterator</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">OutputRange&lt;R&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">R</code> is a range
whose iterator type satisfies OutputIterator</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">ForwardRange&lt;R&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">R</code> is a range
whose iterator type satisfies ForwardIterator</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">BidirectionalRange&lt;R&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">R</code> is a range
whose iterator type satisfies BidirectionalIterator</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">RandomAccessRange&lt;R&gt;</code></p></td>
<td class="calibre14"><p>An <code class="calibre8">R</code> is a range
whose iterator type satisfies RandomAccessIterator</p></td>
</tr>
</tbody>
</table>
<p>There are a few more concepts in [<a href="#part0021.html#ref37"
class="calibre6">RangesTS</a>], but this set is a good start.</p>
<h3 class="h2" id="part0017.html#ch12lev1sec8">12.8 Container
Algorithms</h3>
<p>When we can’t wait for Ranges, we can define our own simple range
algorithms. For example, we can easily provide the shorthand to say just
<code class="calibre8">sort(v)</code> instead of <code
class="calibre8">sort(v.begin(),v.end())</code>:</p>
<p><a href="#part0036_split_021.html#p0160_01a"
id="part0017.html#p0160_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb359"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a>namespace <span class="dt">Estd</span> <span class="kw">{</span></span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>    using namespace std<span class="kw">;</span></span>
<span id="cb359-3"><a href="#cb359-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-4"><a href="#cb359-4" aria-hidden="true" tabindex="-1"></a>    template<span class="dt">&lt;</span>typename <span class="dt">C</span><span class="er">&gt;</span></span>
<span id="cb359-5"><a href="#cb359-5" aria-hidden="true" tabindex="-1"></a>    void sort(<span class="dt">C</span>&amp; c)</span>
<span id="cb359-6"><a href="#cb359-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">{</span></span>
<span id="cb359-7"><a href="#cb359-7" aria-hidden="true" tabindex="-1"></a>         sort(c<span class="al">.</span>begin()<span class="kw">,</span>c<span class="al">.</span>end())<span class="kw">;</span></span>
<span id="cb359-8"><a href="#cb359-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb359-9"><a href="#cb359-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-10"><a href="#cb359-10" aria-hidden="true" tabindex="-1"></a>    template<span class="dt">&lt;</span>typename <span class="dt">C</span><span class="kw">,</span> typename <span class="dt">Pred&gt;</span></span>
<span id="cb359-11"><a href="#cb359-11" aria-hidden="true" tabindex="-1"></a>    void sort(<span class="dt">C</span>&amp; c<span class="er">,</span> <span class="dt">Pred</span> p)</span>
<span id="cb359-12"><a href="#cb359-12" aria-hidden="true" tabindex="-1"></a>    <span class="er">{</span></span>
<span id="cb359-13"><a href="#cb359-13" aria-hidden="true" tabindex="-1"></a>         sort(c.begin()<span class="er">,</span>c.end()<span class="er">,</span>p)<span class="kw">;</span></span>
<span id="cb359-14"><a href="#cb359-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">}</span></span>
<span id="cb359-15"><a href="#cb359-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-16"><a href="#cb359-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">//</span> ...</span>
<span id="cb359-17"><a href="#cb359-17" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>I put the container versions of <code class="calibre8">sort()</code>
(and other algorithms) into their own namespace <code
class="calibre8">Estd</code> <span id="part0017.html#page_161"
class="pagebreak"></span>(“extended <code class="calibre8">std</code>”)
to avoid interfering with other programmers’ uses of namespace <code
class="calibre8">std</code> and also to make it easier to replace this
stopgap with <code class="calibre8">Range</code>s.</p>
<h3 class="h2" id="part0017.html#ch12lev1sec9">12.9 Parallel
Algorithms</h3>
<p>When the same task is to be done to many data items, we can execute
it in parallel on each data item provided the computations on different
data items are independent:</p>
<ul>
<li><p><em>parallel execution</em>: tasks are done on multiple threads
(often running on several processor cores)</p></li>
<li><p><em>vectorized execution</em>: tasks are done on a single thread
using vectorization, also known as <em>SIMD</em> (“Single Instruction,
Multiple Data”).</p></li>
</ul>
<p>The standard library offers support for both and we can be specific
about wanting sequential execution; in <code
class="calibre8">&lt;execution&gt;</code>, we find:</p>
<ul>
<li><p><code class="calibre8">seq</code>: sequential execution</p></li>
<li><p><code class="calibre8">par</code>: parallel execution (if
feasible)</p></li>
<li><p><code class="calibre8">par_unseq</code>: parallel and/or
unsequenced (vectorized) execution (if feasible).</p></li>
</ul>
<p>Consider <code class="calibre8">std::sort()</code>:</p>
<p><a href="#part0036_split_022.html#p0161_01a"
id="part0017.html#p0161_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb360"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a>sort(v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end())<span class="kw">;</span>            <span class="fu">//</span> sequential</span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a>sort(seq<span class="kw">,</span>v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end())<span class="kw">;</span>        <span class="fu">//</span> sequential (same as the default)</span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a>sort(par<span class="kw">,</span>v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end())<span class="kw">;</span>        <span class="fu">//</span> parallel</span>
<span id="cb360-4"><a href="#cb360-4" aria-hidden="true" tabindex="-1"></a>sort(par_unseq<span class="kw">,</span>v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end())<span class="kw">;</span>  <span class="fu">//</span> parallel and<span class="fu">/</span>or vectorized</span></code></pre></div>
<p>Whether it is worthwhile to parallelize and/or vectorize depends on
the algorithm, the number of elements in the sequence, the hardware, and
the utilization of that hardware by programs running on it.
Consequently, the <em>execution policy indicators</em> are just hints. A
compiler and/or run-time scheduler will decide how much concurrency to
use. This is all nontrivial and the rule against making statements about
efficiency without measurement is very important here.</p>
<p>Most standard-library algorithms, including all in the table in §<a
href="#part0017.html#ch12lev1sec6" class="calibre6">12.6</a> except
<code class="calibre8">equal_range</code>, can be requested to be
parallelized and vectorized using <code class="calibre8">par</code> and
<code class="calibre8">par_unseq</code> as for <code
class="calibre8">sort()</code>. Why not <code
class="calibre8">equal_range()</code>? Because so far nobody has come up
with a worthwhile parallel algorithm for that.</p>
<p>Many parallel algorithms are used primarily for numeric data; see §<a
href="#part0019.html#ch14lev2sec1" class="calibre6">14.3.1</a>.</p>
<p>When requesting parallel execution, be sure to avoid data races (§<a
href="#part0020.html#ch15lev1sec2" class="calibre6">15.2</a>) and
deadlock (§<a href="#part0020.html#ch15lev1sec5"
class="calibre6">15.5</a>).</p>
<h3 class="h2" id="part0017.html#ch12lev1sec10">12.10 Advice</h3>
<p>[1] An STL algorithm operates on one or more sequences; §<a
href="#part0017.html#ch12lev1sec1" class="calibre6">12.1</a>.</p>
<p>[2] An input sequence is half-open and defined by a pair of
iterators; §<a href="#part0017.html#ch12lev1sec1"
class="calibre6">12.1</a>.</p>
<p>[3] When searching, an algorithm usually returns the end of the input
sequence to indicate “not found”; §<a href="#part0017.html#ch12lev1sec2"
class="calibre6">12.2</a>.</p>
<p>[4] Algorithms do not directly add or subtract elements from their
argument sequences; §<a href="#part0017.html#ch12lev1sec2"
class="calibre6">12.2</a>, §<a href="#part0017.html#ch12lev1sec6"
class="calibre6">12.6</a>.</p>
<p>[5] When writing a loop, consider whether it could be expressed as a
general algorithm; §<a href="#part0017.html#ch12lev1sec2"
class="calibre6">12.2</a>.</p>
<p><span id="part0017.html#page_162" class="pagebreak"></span>[6] Use
predicates and other function objects to give standard algorithms a
wider range of meanings; §<a href="#part0017.html#ch12lev1sec5"
class="calibre6">12.5</a>, §<a href="#part0017.html#ch12lev1sec6"
class="calibre6">12.6</a>.</p>
<p>[7] A predicate must not modify its argument; §<a
href="#part0017.html#ch12lev1sec5" class="calibre6">12.5</a>.</p>
<p>[8] Know your standard-library algorithms and prefer them to
hand-crafted loops; §<a href="#part0017.html#ch12lev1sec6"
class="calibre6">12.6</a>.</p>
<p>[9] When the pair-of-iterators style becomes tedious, introduce a
container/range algorithm; §<a href="#part0017.html#ch12lev1sec8"
class="calibre6">12.8</a>.</p>
</section>
<p><span id="part0018.html"></span></p>
<section id="part0018.html#ch13" class="h1 bodymatter">
<h2 class="h1"><span id="part0018.html#page_163"
class="calibre2 pagebreak"></span><span class="big">13</span></h2>
<p>Utilities</p>
<p><em>The time you enjoy wasting is not wasted time.</em></p>
<p><em>– Bertrand Russell</em></p>
<ul>
<li><p><a href="#part0018.html#ch13lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0018.html#ch13lev1sec2" class="calibre6">Resource
Management</a></p>
<p><a href="#part0018.html#ch13lev2sec1" class="calibre6"><code
class="calibre8">unique_ptr</code> and <code
class="calibre8">shared_ptr</code></a>; <a
href="#part0018.html#ch13lev2sec2" class="calibre6"><code
class="calibre8">move()</code> and <code
class="calibre8">forward()</code></a></p></li>
<li><p><a href="#part0018.html#ch13lev1sec3" class="calibre6">Range
Checking: <code class="calibre8">span</code></a></p></li>
<li><p><a href="#part0018.html#ch13lev1sec4"
class="calibre6">Specialized Containers</a></p>
<p><a href="#part0018.html#ch13lev2sec3" class="calibre6"><code
class="calibre8">array</code></a>; <a href="#part0018.html#ch13lev2sec4"
class="calibre6"><code class="calibre8">bitset</code></a>; <a
href="#part0018.html#ch13lev2sec5" class="calibre6"><code
class="calibre8">pair</code> and <code
class="calibre8">tuple</code></a></p></li>
<li><p><a href="#part0018.html#ch13lev1sec5"
class="calibre6">Alternatives</a></p>
<p><a href="#part0018.html#ch13lev2sec6" class="calibre6"><code
class="calibre8">variant</code></a>; <a
href="#part0018.html#ch13lev2sec7" class="calibre6"><code
class="calibre8">optional</code></a>; <a
href="#part0018.html#ch13lev2sec8" class="calibre6"><code
class="calibre8">any</code></a></p></li>
<li><p><a href="#part0018.html#ch13lev1sec7"
class="calibre6">Time</a></p></li>
<li><p><a href="#part0018.html#ch13lev1sec8" class="calibre6">Function
Adaption</a></p>
<p><a href="#part0018.html#ch13lev2sec9" class="calibre6">Lambdas as
Adaptors</a>; <a href="#part0018.html#ch13lev2sec10"
class="calibre6"><code class="calibre8">mem_fn()</code></a>; <a
href="#part0018.html#ch13lev2sec11" class="calibre6"><code
class="calibre8">function</code></a></p></li>
<li><p><a href="#part0018.html#ch13lev1sec6"
class="calibre6">Allocators</a></p></li>
<li><p><a href="#part0018.html#ch13lev1sec9" class="calibre6">Type
Functions</a></p>
<p><a href="#part0018.html#ch13lev2sec12" class="calibre6"><code
class="calibre8">iterator_traits</code></a>; <a
href="#part0018.html#ch13lev2sec13" class="calibre6">Type
Predicates</a>; <a href="#part0018.html#ch13lev2sec14"
class="calibre6"><code class="calibre8">enable_if</code></a></p></li>
<li><p><a href="#part0018.html#ch13lev1sec10"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0018.html#ch13lev1sec1">13.1 Introduction</h3>
<p>Not all standard-library components come as part of obviously labeled
facilities, such as “containers” or “I/O.” This section gives a few
examples of small, widely useful components. Such components (classes
and templates) are often called <em>vocabulary types</em> because they
are part of the common vocabulary we use to describe our designs and
programs. Such library components often act as building blocks for more
powerful library facilities, including other components of the standard
library. A function or a type need not be complicated or closely tied to
a mass of other functions and types to be useful.</p>
<h3 class="h2" id="part0018.html#ch13lev1sec2"><span
id="part0018.html#page_164" class="calibre2 pagebreak"></span>13.2
Resource Management</h3>
<p>One of the key tasks of any nontrivial program is to manage
resources. A resource is something that must be acquired and later
(explicitly or implicitly) released. Examples are memory, locks,
sockets, thread handles, and file handles. For a long-running program,
failing to release a resource in a timely manner (“a leak”) can cause
serious performance degradation and possibly even a miserable crash.
Even for short programs, a leak can become an embarrassment, say by a
resource shortage increasing the run time by orders of magnitude.</p>
<p>The standard library components are designed not to leak resources.
To do this, they rely on the basic language support for resource
management using constructor/destructor pairs to ensure that a resource
doesn’t outlive an object responsible for it. The use of a
constructor/destructor pair in <code class="calibre8">Vector</code> to
manage the lifetime of its elements is an example (§<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>) and all
standard-library containers are implemented in similar ways.
Importantly, this approach interacts correctly with error handling using
exceptions. For example, this technique is used for the standard-library
lock classes:</p>
<p><a href="#part0037_split_000.html#p0164_01a"
id="part0018.html#p0164_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb361"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb361-1"><a href="#cb361-1" aria-hidden="true" tabindex="-1"></a>mutex m<span class="kw">;</span> <span class="fu">//</span> used to protect access to shared data</span>
<span id="cb361-2"><a href="#cb361-2" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> ...</span>
<span id="cb361-3"><a href="#cb361-3" aria-hidden="true" tabindex="-1"></a>void f()</span>
<span id="cb361-4"><a href="#cb361-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb361-5"><a href="#cb361-5" aria-hidden="true" tabindex="-1"></a>     scoped_lock<span class="dt">&lt;</span>mutex<span class="er">&gt;</span> lck <span class="kw">{</span>m<span class="kw">};</span> <span class="fu">//</span> acquire the mutex m</span>
<span id="cb361-6"><a href="#cb361-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... manipulate shared data ...</span>
<span id="cb361-7"><a href="#cb361-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>A <code class="calibre8">thread</code> will not proceed until <code
class="calibre8">lck</code>’s constructor has acquired the <code
class="calibre8">mutex</code> (§<a href="#part0020.html#ch15lev1sec5"
class="calibre6">15.5</a>). The corresponding destructor releases the
resources. So, in this example, <code
class="calibre8">scoped_lock</code>’s destructor releases the <code
class="calibre8">mutex</code> when the thread of control leaves <code
class="calibre8">f()</code> (through a <code
class="calibre8">return</code>, by “falling off the end of the
function,” or through an exception throw).</p>
<p>This is an application of RAII (the “Resource Acquisition Is
Initialization” technique; §<a href="#part0009.html#ch04lev2sec2"
class="calibre6">4.2.2</a>). RAII is fundamental to the idiomatic
handling of resources in C++. Containers (such as <code
class="calibre8">vector</code> and <code class="calibre8">map</code>,
<code class="calibre8">string</code>, and <code
class="calibre8">iostream</code>) manage their resources (such as file
handles and buffers) similarly.</p>
<h4 class="h3" id="part0018.html#ch13lev2sec1">13.2.1 <code
class="calibre16">unique_ptr</code> and <code
class="calibre16">shared_ptr</code></h4>
<p>The examples so far take care of objects defined in a scope,
releasing the resources they acquire at the exit from the scope, but
what about objects allocated on the free store? In <code
class="calibre8">&lt;memory&gt;</code>, the standard library provides
two “smart pointers” to help manage objects on the free store:</p>
<p>[1] <code class="calibre8">unique_ptr</code> to represent unique
ownership</p>
<p>[2] <code class="calibre8">shared_ptr</code> to represent shared
ownership</p>
<p>The most basic use of these “smart pointers” is to prevent memory
leaks caused by careless programming. For example:</p>
<p><a href="#part0037_split_001.html#p0164_02a"
id="part0018.html#p0164_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb362"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a>void f(int i<span class="kw">,</span> int j)    <span class="fu">//</span> <span class="dt">X</span><span class="fu">*</span> vs<span class="kw">.</span> unique_ptr<span class="dt">&lt;X</span><span class="er">&gt;</span></span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">X</span><span class="fu">*</span> p <span class="kw">=</span> new <span class="dt">X</span><span class="kw">;</span>                <span class="fu">//</span> allocate a new <span class="dt">X</span></span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a>     unique_ptr<span class="dt">&lt;X</span><span class="er">&gt;</span> sp <span class="kw">{</span>new <span class="dt">X</span><span class="kw">};</span>    <span class="fu">//</span> allocate a new <span class="dt">X</span> and give its pointer to unique_ptr</span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb362-6"><a href="#cb362-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb362-7"><a href="#cb362-7" aria-hidden="true" tabindex="-1"></a>     if (i<span class="dt">&lt;</span><span class="dv">99</span>) <span class="kw">throw</span> <span class="dt">Z</span><span class="kw">{};</span>         <span class="fu">//</span> may <span class="kw">throw</span> an exception</span>
<span id="cb362-8"><a href="#cb362-8" aria-hidden="true" tabindex="-1"></a>     if (j<span class="dt">&lt;</span><span class="dv">77</span>) return<span class="kw">;</span>            <span class="fu">//</span> may return <span class="ot">&quot;</span><span class="er">early</span><span class="ot">&quot;</span></span>
<span id="cb362-9"><a href="#cb362-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... use p and sp ..</span>
<span id="cb362-10"><a href="#cb362-10" aria-hidden="true" tabindex="-1"></a>     delete p<span class="kw">;</span>                    <span class="fu">//</span> destroy <span class="fu">*</span>p</span>
<span id="cb362-11"><a href="#cb362-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0018.html#page_165" class="pagebreak"></span>Here, we
“forgot” to delete <code class="calibre8">p</code> if <code
class="calibre8">i&lt;99</code> or if <code
class="calibre8">j&lt;77</code>. On the other hand, <code
class="calibre8">unique_ptr</code> ensures that its object is properly
destroyed whichever way we exit <code class="calibre8">f()</code> (by
throwing an exception, by executing <code
class="calibre8">return</code>, or by “falling off the end”).
Ironically, we could have solved the problem simply by <em>not</em>
using a pointer and <em>not</em> using <code
class="calibre8">new</code>:</p>
<p><a href="#part0037_split_002.html#p0165_01a"
id="part0018.html#p0165_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb363"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb363-1"><a href="#cb363-1" aria-hidden="true" tabindex="-1"></a>void f(int i<span class="kw">,</span> int j)    <span class="fu">//</span> use a local variable</span>
<span id="cb363-2"><a href="#cb363-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb363-3"><a href="#cb363-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Xx</span><span class="kw">;</span></span>
<span id="cb363-4"><a href="#cb363-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb363-5"><a href="#cb363-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Unfortunately, overuse of <code class="calibre8">new</code> (and of
pointers and references) seems to be an increasing problem.</p>
<p>However, when you really need the semantics of pointers, <code
class="calibre8">unique_ptr</code> is a very lightweight mechanism with
no space or time overhead compared to correct use of a built-in pointer.
Its further uses include passing free-store allocated objects in and out
of functions:</p>
<p><a href="#part0037_split_003.html#p0165_02a"
id="part0018.html#p0165_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb364"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb364-1"><a href="#cb364-1" aria-hidden="true" tabindex="-1"></a>unique_ptr<span class="dt">&lt;X</span><span class="er">&gt;</span> make_X(int i)</span>
<span id="cb364-2"><a href="#cb364-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> make an <span class="dt">X</span> and immediately give it to a unique_ptr</span>
<span id="cb364-3"><a href="#cb364-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb364-4"><a href="#cb364-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... check i<span class="kw">,</span> etc. ...</span>
<span id="cb364-5"><a href="#cb364-5" aria-hidden="true" tabindex="-1"></a>     return unique_ptr<span class="dt">&lt;X</span><span class="er">&gt;</span><span class="kw">{</span>new <span class="dt">X</span><span class="kw">{</span>i<span class="kw">}};</span></span>
<span id="cb364-6"><a href="#cb364-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>A <code class="calibre8">unique_ptr</code> is a handle to an
individual object (or an array) in much the same way that a <code
class="calibre8">vector</code> is a handle to a sequence of objects.
Both control the lifetime of other objects (using RAII) and both rely on
move semantics to make <code class="calibre8">return</code> simple and
efficient.</p>
<p>The <code class="calibre8">shared_ptr</code> is similar to <code
class="calibre8">unique_ptr</code> except that <code
class="calibre8">shared_ptr</code>s are copied rather than moved. The
<code class="calibre8">shared_ptr</code>s for an object share ownership
of an object; that object is destroyed when the last of its <code
class="calibre8">shared_ptr</code>s is destroyed. For example:</p>
<p><a href="#part0037_split_004.html#p0165_03a"
id="part0018.html#p0165_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb365"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb365-1"><a href="#cb365-1" aria-hidden="true" tabindex="-1"></a>void f(shared_ptr<span class="dt">&lt;</span>fstream<span class="er">&gt;</span>)<span class="kw">;</span></span>
<span id="cb365-2"><a href="#cb365-2" aria-hidden="true" tabindex="-1"></a>void g(shared_ptr<span class="dt">&lt;</span>fstream<span class="er">&gt;</span>)<span class="kw">;</span></span>
<span id="cb365-3"><a href="#cb365-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-4"><a href="#cb365-4" aria-hidden="true" tabindex="-1"></a>void user(const string&amp; name<span class="kw">,</span> ios_base::openmode mode)</span>
<span id="cb365-5"><a href="#cb365-5" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb365-6"><a href="#cb365-6" aria-hidden="true" tabindex="-1"></a>     shared_ptr<span class="dt">&lt;</span>fstream<span class="er">&gt;</span> fp <span class="kw">{</span>new fstream(name<span class="kw">,</span>mode)<span class="kw">};</span></span>
<span id="cb365-7"><a href="#cb365-7" aria-hidden="true" tabindex="-1"></a>     if (<span class="kw">!</span><span class="fu">*</span>fp)               <span class="fu">//</span> make sure the file was properly opened</span>
<span id="cb365-8"><a href="#cb365-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">throw</span> <span class="dt">No_file</span><span class="kw">{};</span></span>
<span id="cb365-9"><a href="#cb365-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-10"><a href="#cb365-10" aria-hidden="true" tabindex="-1"></a>     f(fp)<span class="kw">;</span></span>
<span id="cb365-11"><a href="#cb365-11" aria-hidden="true" tabindex="-1"></a>     g(fp)<span class="kw">;</span></span>
<span id="cb365-12"><a href="#cb365-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb365-13"><a href="#cb365-13" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0018.html#page_166" class="pagebreak"></span>Now, the
file opened by <code class="calibre8">fp</code>’s constructor will be
closed by the last function to (explicitly or implicitly) destroy a copy
of <code class="calibre8">fp</code>. Note that <code
class="calibre8">f()</code> or <code class="calibre8">g()</code> may
spawn a task holding a copy of <code class="calibre8">fp</code> or in
some other way store a copy that outlives <code
class="calibre8">user()</code>. Thus, <code
class="calibre8">shared_ptr</code> provides a form of garbage collection
that respects the destructor-based resource management of the
memory-managed objects. This is neither cost free nor exorbitantly
expensive, but it does make the lifetime of the shared object hard to
predict. Use <code class="calibre8">shared_ptr</code> only if you
actually need shared ownership.</p>
<p>Creating an object on the free store and then passing the pointer to
it to a smart pointer is a bit verbose. It also allows for mistakes,
such as forgetting to pass a pointer to a <code
class="calibre8">unique_ptr</code> or giving a pointer to something that
is not on the free store to a <code class="calibre8">shared_ptr</code>.
To avoid such problems, the standard library (in <code
class="calibre8">&lt;memory&gt;</code>) provides functions for
constructing an object and returning an appropriate smart pointer, <code
class="calibre8">make_shared()</code> and <code
class="calibre8">make_unique()</code>. For example:</p>
<p><a href="#part0037_split_005.html#p0166_01a"
id="part0018.html#p0166_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb366"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb366-1"><a href="#cb366-1" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">S</span> <span class="kw">{</span></span>
<span id="cb366-2"><a href="#cb366-2" aria-hidden="true" tabindex="-1"></a>     int i<span class="kw">;</span></span>
<span id="cb366-3"><a href="#cb366-3" aria-hidden="true" tabindex="-1"></a>     string s<span class="kw">;</span></span>
<span id="cb366-4"><a href="#cb366-4" aria-hidden="true" tabindex="-1"></a>     double d<span class="kw">;</span></span>
<span id="cb366-5"><a href="#cb366-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb366-6"><a href="#cb366-6" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb366-7"><a href="#cb366-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb366-8"><a href="#cb366-8" aria-hidden="true" tabindex="-1"></a>auto p1 <span class="kw">=</span> make_shared<span class="dt">&lt;S</span><span class="er">&gt;</span>(<span class="dv">1</span><span class="kw">,</span><span class="ot">&quot;</span><span class="er">Ankh Morpork</span><span class="ot">&quot;</span><span class="kw">,</span><span class="fl">4.65</span>)<span class="kw">;</span>    <span class="fu">//</span> p1 <span class="dt">is</span> a shared_ptr<span class="er">&lt;</span><span class="dt">S&gt;</span></span>
<span id="cb366-9"><a href="#cb366-9" aria-hidden="true" tabindex="-1"></a>auto p2 <span class="kw">=</span> make_unique<span class="dt">&lt;S</span><span class="er">&gt;</span>(<span class="dv">2</span><span class="kw">,</span><span class="ot">&quot;</span><span class="er">Oz</span><span class="ot">&quot;</span><span class="kw">,</span><span class="fl">7.62</span>)<span class="kw">;</span>              <span class="fu">//</span> p2 <span class="dt">is</span> a unique_ptr<span class="er">&lt;</span><span class="dt">S&gt;</span></span></code></pre></div>
<p>Now, <code class="calibre8">p2</code> is a <code
class="calibre8">unique_ptr&lt;S&gt;</code> pointing to a
free-store-allocated object of type <code class="calibre8">S</code> with
the value <code class="calibre8">{2,"Oz"s,7.62}</code>.</p>
<p>Using <code class="calibre8">make_shared()</code> is not just more
convenient than separately making an object using <code
class="calibre8">new</code> and then passing it to a <code
class="calibre8">shared_ptr</code>, it is also notably more efficient
because it does not need a separate allocation for the use count that is
essential in the implementation of a <code
class="calibre8">shared_ptr</code>.</p>
<p>Given <code class="calibre8">unique_ptr</code> and <code
class="calibre8">shared_ptr</code>, we can implement a complete “no
naked <code class="calibre8">new</code>” policy (§<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>) for many
programs. However, these “smart pointers” are still conceptually
pointers and therefore only my second choice for resource management –
after containers and other types that manage their resources at a higher
conceptual level. In particular, <code
class="calibre8">shared_ptr</code>s do not in themselves provide any
rules for which of their owners can read and/or write the shared object.
Data races (§<a href="#part0020.html#ch15lev1sec7"
class="calibre6">15.7</a>) and other forms of confusion are not
addressed simply by eliminating the resource management issues.</p>
<p>Where do we use “smart pointers” (such as <code
class="calibre8">unique_ptr</code>) rather than resource handles with
operations designed specifically for the resource (such as <code
class="calibre8">vector</code> or <code class="calibre8">thread</code>)?
Unsurprisingly, the answer is “when we need pointer semantics.”</p>
<ul>
<li><p>When we share an object, we need pointers (or references) to
refer to the shared object, so a <code
class="calibre8">shared_ptr</code> becomes the obvious choice (unless
there is an obvious single owner).</p></li>
<li><p>When we refer to a polymorphic object in classical
object-oriented code (§<a href="#part0009.html#ch04lev1sec5"
class="calibre6">4.5</a>), we need a pointer (or a reference) because we
don’t know the exact type of the object referred to (or even its size),
so a <code class="calibre8">unique_ptr</code> becomes the obvious
choice.</p></li>
<li><p>A shared polymorphic object typically requires <code
class="calibre8">shared_ptr</code>s.</p></li>
</ul>
<p>We do <em>not</em> need to use a pointer to return a collection of
objects from a function; a container that is a resource handle will do
that simply and efficiently (§<a href="#part0010.html#ch05lev2sec5"
class="calibre6">5.2.2</a>).</p>
<h4 class="h3" id="part0018.html#ch13lev2sec2"><span
id="part0018.html#page_167" class="calibre2 pagebreak"></span>13.2.2
<code class="calibre16">move()</code> and <code
class="calibre16">forward()</code></h4>
<p>The choice between moving and copying is mostly implicit (§<a
href="#part0008.html#ch03lev1sec6" class="calibre6">3.6</a>). A compiler
will prefer to move when an object is about to be destroyed (as in a
<code class="calibre8">return</code>) because that’s assumed to be the
simpler and more efficient operation. However, sometimes we must be
explicit. For example, a <code class="calibre8">unique_ptr</code> is the
sole owner of an object. Consequently, it cannot be copied:</p>
<p><a href="#part0037_split_006.html#p0167_01a"
id="part0018.html#p0167_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb367"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb367-1"><a href="#cb367-1" aria-hidden="true" tabindex="-1"></a>void f1()</span>
<span id="cb367-2"><a href="#cb367-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb367-3"><a href="#cb367-3" aria-hidden="true" tabindex="-1"></a>     auto p <span class="kw">=</span> make_unique<span class="dt">&lt;</span>int<span class="er">&gt;</span>(<span class="dv">2</span>)<span class="kw">;</span></span>
<span id="cb367-4"><a href="#cb367-4" aria-hidden="true" tabindex="-1"></a>     auto q <span class="kw">=</span> p<span class="kw">;</span>       <span class="fu">//</span> error<span class="fu">:</span> we can<span class="st">&#39;</span><span class="er">t copy a unique_ptr</span></span>
<span id="cb367-5"><a href="#cb367-5" aria-hidden="true" tabindex="-1"></a><span class="er">     // ...</span></span>
<span id="cb367-6"><a href="#cb367-6" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>If you want a <code class="calibre8">unique_ptr</code> elsewhere, you
must move it. For example:</p>
<p><a href="#part0037_split_007.html#p0167_02a"
id="part0018.html#p0167_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb368"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb368-1"><a href="#cb368-1" aria-hidden="true" tabindex="-1"></a>void f1()</span>
<span id="cb368-2"><a href="#cb368-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb368-3"><a href="#cb368-3" aria-hidden="true" tabindex="-1"></a>     auto p <span class="kw">=</span> make_unique<span class="dt">&lt;</span>int<span class="er">&gt;</span>(<span class="dv">2</span>)<span class="kw">;</span></span>
<span id="cb368-4"><a href="#cb368-4" aria-hidden="true" tabindex="-1"></a>     auto q <span class="kw">=</span> move(p)<span class="kw">;</span>       <span class="fu">//</span> p now holds nullptr</span>
<span id="cb368-5"><a href="#cb368-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb368-6"><a href="#cb368-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Confusingly, <code class="calibre8">std::move()</code> doesn’t move
anything. Instead, it casts its argument to an rvalue reference, thereby
saying that its argument will not be used again and therefore may be
moved (§<a href="#part0010.html#ch05lev2sec5"
class="calibre6">5.2.2</a>). It should have been called something like
<code class="calibre8">rvalue_cast</code>. Like other casts, it’s
error-prone and best avoided. It exists to serve a few essential cases.
Consider a simple swap:</p>
<p><a href="#part0037_split_008.html#p0167_03a"
id="part0018.html#p0167_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb369"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a>template <span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a>void swap(<span class="dt">T</span>&amp; a<span class="kw">,</span> <span class="dt">T</span>&amp; b)</span>
<span id="cb369-3"><a href="#cb369-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb369-4"><a href="#cb369-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">T</span> tmp <span class="kw">{</span>move(a)<span class="kw">};</span>       <span class="fu">//</span> the <span class="dt">T</span> constructor sees an rvalue and moves</span>
<span id="cb369-5"><a href="#cb369-5" aria-hidden="true" tabindex="-1"></a>     a <span class="kw">=</span> move(b)<span class="kw">;</span>           <span class="fu">//</span> the <span class="dt">T</span> assignment sees an rvalue and moves</span>
<span id="cb369-6"><a href="#cb369-6" aria-hidden="true" tabindex="-1"></a>     b <span class="kw">=</span> move(tmp)<span class="kw">;</span>         <span class="fu">//</span> the <span class="dt">T</span> assignment sees an rvalue and moves</span>
<span id="cb369-7"><a href="#cb369-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>We don’t want to repeatedly copy potentially large objects, so we
request moves using <code class="calibre8">std::move()</code>.</p>
<p>Like for other casts, there are tempting, but dangerous, uses of
<code class="calibre8">std::move()</code>. Consider:</p>
<p><a href="#part0037_split_009.html#p0167_04a"
id="part0018.html#p0167_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb370"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a>string s1 <span class="kw">=</span> <span class="ot">&quot;</span><span class="er">Hello</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a>string s2 <span class="kw">=</span> <span class="ot">&quot;</span><span class="er">World</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb370-3"><a href="#cb370-3" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>string<span class="er">&gt;</span> v<span class="kw">;</span></span>
<span id="cb370-4"><a href="#cb370-4" aria-hidden="true" tabindex="-1"></a>v<span class="kw">.</span>push_back(s1)<span class="kw">;</span>          <span class="fu">//</span> use a <span class="ot">&quot;</span><span class="er">const string</span><span class="ot">&amp;&quot;</span> argument<span class="kw">;</span> push_back() will copy</span>
<span id="cb370-5"><a href="#cb370-5" aria-hidden="true" tabindex="-1"></a>v<span class="kw">.</span>push_back(move(s2))<span class="kw">;</span>    <span class="fu">//</span> use a move constructor</span></code></pre></div>
<p>Here <code class="calibre8">s1</code> is copied (by <code
class="calibre8">push_back()</code>) whereas <code
class="calibre8">s2</code> is moved. This sometimes (only sometimes)
makes the <code class="calibre8">push_back()</code> of <code
class="calibre8">s2</code> cheaper. The problem is that a moved-from
object is left behind. If we use <code class="calibre8">s2</code> again,
we have a problem:</p>
<p><a href="#part0037_split_010.html#p0167_05a"
id="part0018.html#p0167_05" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb371"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a>cout <span class="al">&lt;&lt;</span> s1[<span class="dv">2</span>]<span class="kw">;</span>     <span class="fu">//</span> <span class="fu">write</span> <span class="st">&#39;</span><span class="er">l</span><span class="st">&#39;</span></span>
<span id="cb371-2"><a href="#cb371-2" aria-hidden="true" tabindex="-1"></a>cout <span class="al">&lt;&lt;</span> s2[<span class="dv">2</span>]<span class="kw">;</span>     <span class="fu">//</span> crash?</span></code></pre></div>
<p>I consider this use of <code class="calibre8">std::move()</code> to
be too error-prone for widespread use. Don’t use it unless you <span
id="part0018.html#page_168" class="pagebreak"></span>can demonstrate
significant and necessary performance improvement. Later maintenance may
accidentally lead to unanticipated use of the moved-from object.</p>
<p>The state of a moved-from object is in general unspecified, but all
standard-library types leave a moved-from object in a state where it can
be destroyed and assigned to. It would be unwise not to follow that
lead. For a container (e.g., <code class="calibre8">vector</code> or
<code class="calibre8">string</code>), the moved-from state will
“empty.” For many types, the default value is a good empty state:
meaningful and cheap to establish.</p>
<p>Forwarding arguments is an important use case that requires moves
(§<a href="#part0012.html#ch07lev2sec8" class="calibre6">7.4.2</a>). We
sometimes want to transmit a set of arguments on to another function
without changing anything (to achieve “perfect forwarding”):</p>
<p><a href="#part0037_split_011.html#p0168_01a"
id="part0018.html#p0168_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb372"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="kw">,</span> typename ... <span class="dt">Args&gt;</span></span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a>unique_ptr<span class="er">&lt;</span><span class="dt">T&gt;</span> make_unique(<span class="dt">Args</span>&amp;&amp;... args)</span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb372-4"><a href="#cb372-4" aria-hidden="true" tabindex="-1"></a>    return unique_ptr<span class="er">&lt;</span><span class="dt">T&gt;</span><span class="er">{</span>new <span class="dt">T</span><span class="er">{</span>std::forward<span class="er">&lt;</span><span class="dt">Args&gt;</span>(args)...<span class="er">}}</span><span class="kw">;</span>  <span class="fu">//</span> forward each argument</span>
<span id="cb372-5"><a href="#cb372-5" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>The standard-library <code class="calibre8">forward()</code> differs
from the simpler <code class="calibre8">std::move()</code> by correctly
handling subtleties to do with lvalue and rvalue (§<a
href="#part0010.html#ch05lev2sec5" class="calibre6">5.2.2</a>). Use
<code class="calibre8">std::forward()</code> exclusively for forwarding
and don’t <code class="calibre8">forward()</code> something twice; once
you have forwarded an object, it’s not yours to use anymore.</p>
<h3 class="h2" id="part0018.html#ch13lev1sec3">13.3 Range Checking:
<code class="calibre17">gsl::span</code></h3>
<p>Traditionally, range errors have been a major source of serious
errors in C and C++ programs. The use of containers (<a
href="#part0016.html#ch11" class="calibre6">Chapter 11</a>), algorithms
(<a href="#part0017.html#ch12" class="calibre6">Chapter 12</a>), and
range-<code class="calibre8">for</code> has significantly reduced this
problem, but more can be done. A key source of range errors is that
people pass pointers (raw or smart) and then rely on convention to know
the number of elements pointed to. The best advice for code outside
resource handles is to assume that at most one object is pointed to [CG:
F.22], but without support that advice is unmanageable. The
standard-library <code class="calibre8">string_view</code> (§<a
href="#part0014.html#ch09lev1sec3" class="calibre6">9.3</a>) can help,
but that is read-only and for characters only. Most programmers need
more.</p>
<p>The Core Guidelines [<a href="#part0021.html#ref60"
class="calibre6">Stroustrup,2015</a>] offer guidelines and a small
Guidelines Support Library [<a href="#part0021.html#ref23"
class="calibre6">GSL</a>], including a <code
class="calibre8">span</code> type for referring to a range of elements.
This <code class="calibre8">span</code> is being proposed for the
standard, but for now it is just something you can download if
needed.</p>
<p>A <code class="calibre8">string_view</code> is basically a
(pointer,length) pair denoting a sequence of elements:</p>
<figure>
<img src="images/00032.jpeg" class="calibre1" />
</figure>
<p>A <code class="calibre8">span</code> gives access to a contiguous
sequence of elements. The elements can be stored in many ways, including
in <code class="calibre8">vector</code>s and built-in arrays. Like a
pointer, a <code class="calibre8">span</code> does not own the
characters it points to. In that, it resembles a <code
class="calibre8">string_view</code> (§<a
href="#part0014.html#ch09lev1sec3" class="calibre6">9.3</a>) and an STL
pair of iterators (§<a href="#part0017.html#ch12lev1sec3"
class="calibre6">12.3</a>).</p>
<p><span id="part0018.html#page_169" class="pagebreak"></span>Consider a
common interface style:</p>
<p><a href="#part0037_split_012.html#p0169_01a"
id="part0018.html#p0169_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb373"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb373-1"><a href="#cb373-1" aria-hidden="true" tabindex="-1"></a>void fpn(int<span class="fu">*</span> p<span class="kw">,</span> int n)</span>
<span id="cb373-2"><a href="#cb373-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb373-3"><a href="#cb373-3" aria-hidden="true" tabindex="-1"></a>     for (int i <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span> i<span class="dt">&lt;</span>n<span class="kw">;</span> ++i)</span>
<span id="cb373-4"><a href="#cb373-4" aria-hidden="true" tabindex="-1"></a>           p[i] <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb373-5"><a href="#cb373-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>We assume that <code class="calibre8">p</code> points to <code
class="calibre8">n</code> integers. Unfortunately, this assumption is
simply a convention, so we can’t use it to write a range-<code
class="calibre8">for</code> loop and the compiler cannot implement cheap
and effective range checking. Also, our assumption can be wrong:</p>
<p><a href="#part0037_split_013.html#p0169_02a"
id="part0018.html#p0169_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb374"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a>void use(int x)</span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a>     int a[<span class="dv">100</span>]<span class="kw">;</span></span>
<span id="cb374-4"><a href="#cb374-4" aria-hidden="true" tabindex="-1"></a>     fpn(a<span class="kw">,</span><span class="dv">100</span>)<span class="kw">;</span>        <span class="fu">//</span> <span class="dt">OK</span></span>
<span id="cb374-5"><a href="#cb374-5" aria-hidden="true" tabindex="-1"></a>     fpn(a<span class="kw">,</span><span class="dv">1000</span>)<span class="kw">;</span>       <span class="fu">//</span> oops<span class="kw">,</span> my finger slipped<span class="kw">!</span> (range error in fpn)</span>
<span id="cb374-6"><a href="#cb374-6" aria-hidden="true" tabindex="-1"></a>     fpn(a<span class="fu">+</span><span class="dv">10</span><span class="kw">,</span><span class="dv">100</span>)<span class="kw">;</span>     <span class="fu">//</span> range error in fpn</span>
<span id="cb374-7"><a href="#cb374-7" aria-hidden="true" tabindex="-1"></a>     fpn(a<span class="kw">,</span>x)<span class="kw">;</span>          <span class="fu">//</span> suspect<span class="kw">,</span> but looks innocent</span>
<span id="cb374-8"><a href="#cb374-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>We can do better using a <code class="calibre8">span</code>:</p>
<p><a href="#part0037_split_014.html#p0169_03a"
id="part0018.html#p0169_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb375"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb375-1"><a href="#cb375-1" aria-hidden="true" tabindex="-1"></a>void fs(span<span class="dt">&lt;</span>int<span class="er">&gt;</span> p)</span>
<span id="cb375-2"><a href="#cb375-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb375-3"><a href="#cb375-3" aria-hidden="true" tabindex="-1"></a>     for (int x <span class="fu">:</span> p)</span>
<span id="cb375-4"><a href="#cb375-4" aria-hidden="true" tabindex="-1"></a>           x <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb375-5"><a href="#cb375-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>We can use <code class="calibre8">fs</code> like this:</p>
<p><a href="#part0037_split_015.html#p0169_04a"
id="part0018.html#p0169_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb376"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb376-1"><a href="#cb376-1" aria-hidden="true" tabindex="-1"></a>void use(int x)</span>
<span id="cb376-2"><a href="#cb376-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb376-3"><a href="#cb376-3" aria-hidden="true" tabindex="-1"></a>     int a[<span class="dv">100</span>]<span class="kw">;</span></span>
<span id="cb376-4"><a href="#cb376-4" aria-hidden="true" tabindex="-1"></a>     fs(a)<span class="kw">;</span>                  <span class="fu">//</span> implicitly creates a span<span class="dt">&lt;</span>int<span class="er">&gt;</span><span class="kw">{</span>a<span class="kw">,</span><span class="dv">100</span><span class="kw">}</span></span>
<span id="cb376-5"><a href="#cb376-5" aria-hidden="true" tabindex="-1"></a>     fs(a<span class="kw">,</span><span class="dv">1000</span>)<span class="kw">;</span>             <span class="fu">//</span> error<span class="fu">:</span> span expected</span>
<span id="cb376-6"><a href="#cb376-6" aria-hidden="true" tabindex="-1"></a>     fs(<span class="kw">{</span>a<span class="fu">+</span><span class="dv">10</span><span class="kw">,</span><span class="dv">100</span><span class="kw">}</span>)<span class="kw">;</span>         <span class="fu">//</span> a range error in fs</span>
<span id="cb376-7"><a href="#cb376-7" aria-hidden="true" tabindex="-1"></a>     fs(<span class="kw">{</span>a<span class="kw">,</span>x<span class="kw">}</span>)<span class="kw">;</span>              <span class="fu">//</span> obviously suspect</span>
<span id="cb376-8"><a href="#cb376-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>That is, the common case, creating a <code
class="calibre8">span</code> directly from an array, is now safe (the
compiler computes the element count) and notationally simple. For other
cases, the probability of mistakes is lowered because the programmer has
to explicitly compose a span.</p>
<p>The common case where a <code class="calibre8">span</code> is passed
along from function to function is simpler than for (pointer,count)
interfaces and obviously doesn’t require extra checking:</p>
<p><a href="#part0037_split_016.html#p0169_05a"
id="part0018.html#p0169_05" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb377"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a>void f1(span<span class="dt">&lt;</span>int<span class="er">&gt;</span> p)<span class="kw">;</span></span>
<span id="cb377-2"><a href="#cb377-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-3"><a href="#cb377-3" aria-hidden="true" tabindex="-1"></a>void f2(span<span class="dt">&lt;</span>int<span class="er">&gt;</span> p)</span>
<span id="cb377-4"><a href="#cb377-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb377-5"><a href="#cb377-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb377-6"><a href="#cb377-6" aria-hidden="true" tabindex="-1"></a>     f1(p)<span class="kw">;</span></span>
<span id="cb377-7"><a href="#cb377-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0018.html#page_170" class="pagebreak"></span>When used
for subscripting (e.g., <code class="calibre8">r[i]</code>), range
checking is done and a <code class="calibre8">gsl::fail_fast</code> is
thrown in case of a range error. Range checks can be suppressed for
performance critical code. When <code class="calibre8">span</code> makes
it into the standard, I expect that <code
class="calibre8">std::span</code> will use contracts [Garcia,2017] to
control responses to range violation.</p>
<p>Note that just a single range check is needed for the loop. Thus, for
the common case where the body of a function using a <code
class="calibre8">span</code> is a loop over the <code
class="calibre8">span</code>, range checking is almost free.</p>
<p>A <code class="calibre8">span</code> of characters is supported
directly and called <code class="calibre8">gsl::string_span</code>.</p>
<h3 class="h2" id="part0018.html#ch13lev1sec4">13.4 Specialized
Containers</h3>
<p>The standard library provides several containers that don’t fit
perfectly into the STL framework (<a href="#part0016.html#ch11"
class="calibre6">Chapter 11</a>, <a href="#part0017.html#ch12"
class="calibre6">Chapter 12</a>). Examples are built-in arrays, <code
class="calibre8">array</code>, and <code class="calibre8">string</code>.
I sometimes refer to those as “almost containers,” but that is not quite
fair: they hold elements, so they are containers, but each has
restrictions or added facilities that make them awkward in the context
of the STL. Describing them separately also simplifies the description
of the STL.</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>“Almost
Containers”</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">T[N]</code></p></td>
<td class="calibre14"><p>Built-in array: a fixed-size continuously
allocated sequence of <code class="calibre8">N</code> elements of type
<code class="calibre8">T</code>; implicitly converts to a <code
class="calibre8">T*</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">array&lt;T,N&gt;</code></p></td>
<td class="calibre14"><p>A fixed-size continuously allocated sequence of
<code class="calibre8">N</code> elements of type <code
class="calibre8">T</code>; like the built-in array, but with most
problems solved</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">bitset&lt;N&gt;</code></p></td>
<td class="calibre14"><p>A fixed-size sequence of <code
class="calibre8">N</code> bits</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">vector&lt;bool&gt;</code></p></td>
<td class="calibre14"><p>A sequence of bits compactly stored in a
specialization of <code class="calibre8">vector</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">pair&lt;T,U&gt;</code></p></td>
<td class="calibre14"><p>Two elements of types <code
class="calibre8">T</code> and <code class="calibre8">U</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">tuple&lt;T...&gt;</code></p></td>
<td class="calibre14"><p>A sequence of an arbitrary number of elements
of arbitrary types</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">basic_string&lt;C&gt;</code></p></td>
<td class="calibre14"><p>A sequence of characters of type <code
class="calibre8">C</code>; provides string operations</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">valarray&lt;T&gt;</code></p></td>
<td class="calibre14"><p>An array of numeric values of type <code
class="calibre8">T</code>; provides numeric operations</p></td>
</tr>
</tbody>
</table>
<p>Why does the standard library provide so many containers? They serve
common but different (often overlapping) needs. If the standard library
didn’t provide them, many people would have to design and implement
their own. For example:</p>
<ul>
<li><p><code class="calibre8">pair</code> and <code
class="calibre8">tuple</code> are heterogeneous; all other containers
are homogeneous (all elements are of the same type).</p></li>
<li><p><code class="calibre8">array</code>, <code
class="calibre8">vector</code>, and <code class="calibre8">tuple</code>
elements are contiguously allocated; <code
class="calibre8">forward_list</code> and <code
class="calibre8">map</code> are linked structures.</p></li>
<li><p><code class="calibre8">bitset</code> and <code
class="calibre8">vector&lt;bool&gt;</code> hold bits and access them
through proxy objects; all other standard-library containers can hold a
variety of types and access elements directly.</p></li>
<li><p><code class="calibre8">basic_string</code> requires its elements
to be some form of character and to provide string manipulation, such as
concatenation and locale-sensitive operations.</p></li>
<li><p><code class="calibre8">valarray</code> requires its elements to
be numbers and to provide numerical operations.</p></li>
</ul>
<p>All of these containers can be seen as providing specialized services
needed by large communities of programmers. No single container could
serve all of these needs because some needs are contradictory, for
example, “ability to grow” vs. “guaranteed to be allocated in a fixed
location,” and “elements do not move when elements are added” vs.
“contiguously allocated.”</p>
<h4 class="h3" id="part0018.html#ch13lev2sec3"><span
id="part0018.html#page_171" class="calibre2 pagebreak"></span>13.4.1
<code class="calibre16">array</code></h4>
<p>An <code class="calibre8">array</code>, defined in <code
class="calibre8">&lt;array&gt;</code>, is a fixed-size sequence of
elements of a given type where the number of elements is specified at
compile time. Thus, an <code class="calibre8">array</code> can be
allocated with its elements on the stack, in an object, or in static
storage. The elements are allocated in the scope where the <code
class="calibre8">array</code> is defined. An <code
class="calibre8">array</code> is best understood as a built-in array
with its size firmly attached, without implicit, potentially surprising
conversions to pointer types, and with a few convenience functions
provided. There is no overhead (time or space) involved in using an
<code class="calibre8">array</code> compared to using a built-in array.
An <code class="calibre8">array</code> does <em>not</em> follow the
“handle to elements” model of STL containers. Instead, an <code
class="calibre8">array</code> directly contains its elements.</p>
<p>An <code class="calibre8">array</code> can be initialized by an
initializer list:</p>
<p><a href="#part0037_split_017.html#p0171_01a"
id="part0018.html#p0171_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb378"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb378-1"><a href="#cb378-1" aria-hidden="true" tabindex="-1"></a>array<span class="dt">&lt;</span>int<span class="kw">,</span><span class="dv">3</span><span class="dt">&gt;</span> a1 <span class="kw">=</span> <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">};</span></span></code></pre></div>
<p>The number of elements in the initializer must be equal to or less
than the number of elements specified for the <code
class="calibre8">array</code>.</p>
<p>The element count is not optional:</p>
<p><a href="#part0037_split_018.html#p0171_02a"
id="part0018.html#p0171_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb379"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb379-1"><a href="#cb379-1" aria-hidden="true" tabindex="-1"></a>array<span class="dt">&lt;</span>int<span class="er">&gt;</span> ax <span class="kw">=</span> <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">};</span>     <span class="fu">//</span> error size not specified</span></code></pre></div>
<p>The element count must be a constant expression:</p>
<p><a href="#part0037_split_019.html#p0171_03a"
id="part0018.html#p0171_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb380"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb380-1"><a href="#cb380-1" aria-hidden="true" tabindex="-1"></a>void f(int n)</span>
<span id="cb380-2"><a href="#cb380-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb380-3"><a href="#cb380-3" aria-hidden="true" tabindex="-1"></a>     array<span class="dt">&lt;</span>string<span class="kw">,</span>n<span class="dt">&gt;</span> aa <span class="kw">=</span> <span class="kw">{</span><span class="ot">&quot;</span><span class="er">John</span><span class="ot">&#39;</span><span class="er">s</span><span class="ot">&quot;</span><span class="kw">,</span> <span class="ot">&quot;</span><span class="er">Queens</span><span class="ot">&#39;</span><span class="er"> </span><span class="ot">&quot;</span><span class="kw">};</span>     <span class="fu">//</span> error<span class="fu">:</span> size not a constant expression</span>
<span id="cb380-4"><a href="#cb380-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span></span>
<span id="cb380-5"><a href="#cb380-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>If you need the element count to be a variable, use <code
class="calibre8">vector</code>.</p>
<p>When necessary, an <code class="calibre8">array</code> can be
explicitly passed to a C-style function that expects a pointer. For
example:</p>
<p><a href="#part0037_split_020.html#p0171_04a"
id="part0018.html#p0171_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb381"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a>void f(int<span class="fu">*</span> p<span class="kw">,</span> int sz)<span class="kw">;</span>    <span class="fu">//</span> <span class="dt">C</span><span class="fu">-</span>style interface</span>
<span id="cb381-2"><a href="#cb381-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-3"><a href="#cb381-3" aria-hidden="true" tabindex="-1"></a>void g()</span>
<span id="cb381-4"><a href="#cb381-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb381-5"><a href="#cb381-5" aria-hidden="true" tabindex="-1"></a>     array<span class="dt">&lt;</span>int<span class="kw">,</span><span class="dv">10</span><span class="dt">&gt;</span> a<span class="kw">;</span></span>
<span id="cb381-6"><a href="#cb381-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-7"><a href="#cb381-7" aria-hidden="true" tabindex="-1"></a>     f(a<span class="kw">,</span>a<span class="al">.</span>size())<span class="kw">;</span>             <span class="fu">//</span> error<span class="fu">:</span> no conversion</span>
<span id="cb381-8"><a href="#cb381-8" aria-hidden="true" tabindex="-1"></a>     f(&amp;a[<span class="dv">0</span>]<span class="kw">,</span>a<span class="al">.</span>size())<span class="kw">;</span>         <span class="fu">//</span> <span class="dt">C</span><span class="fu">-</span>style use</span>
<span id="cb381-9"><a href="#cb381-9" aria-hidden="true" tabindex="-1"></a>     f(a<span class="al">.</span>data()<span class="kw">,</span>a<span class="al">.</span>size())<span class="kw">;</span>      <span class="fu">//</span> <span class="dt">C</span><span class="fu">-</span>style use</span>
<span id="cb381-10"><a href="#cb381-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb381-11"><a href="#cb381-11" aria-hidden="true" tabindex="-1"></a>     auto p <span class="kw">=</span> find(a<span class="al">.</span>begin()<span class="kw">,</span>a<span class="al">.</span>end()<span class="kw">,</span><span class="dv">777</span>)<span class="kw">;</span>    <span class="fu">//</span> <span class="dt">C</span>++/<span class="dt">STL</span><span class="fu">-</span>style use</span>
<span id="cb381-12"><a href="#cb381-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb381-13"><a href="#cb381-13" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Why would we use an <code class="calibre8">array</code> when <code
class="calibre8">vector</code> is so much more flexible? An <code
class="calibre8">array</code> is less flexible so it is simpler.
Occasionally, there is a significant performance advantage to be had by
directly accessing elements allocated on the stack rather than
allocating elements on the free store, accessing them indirectly through
the <code class="calibre8">vector</code> (a handle), and then
deallocating them. On the other hand, the stack is a limited resource
(especially on some embedded systems), and stack overflow is nasty.</p>
<p><span id="part0018.html#page_172" class="pagebreak"></span>Why would
we use an <code class="calibre8">array</code> when we could use a
built-in array? An <code class="calibre8">array</code> knows its size,
so it is easy to use with standard-library algorithms, and it can be
copied using <code class="calibre8">=</code>. However, my main reason to
prefer <code class="calibre8">array</code> is that it saves me from
surprising and nasty conversions to pointers. Consider:</p>
<p><a href="#part0037_split_021.html#p0172_01a"
id="part0018.html#p0172_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb382"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb382-1"><a href="#cb382-1" aria-hidden="true" tabindex="-1"></a>void h()</span>
<span id="cb382-2"><a href="#cb382-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb382-3"><a href="#cb382-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Circle</span> a1[<span class="dv">10</span>]<span class="kw">;</span></span>
<span id="cb382-4"><a href="#cb382-4" aria-hidden="true" tabindex="-1"></a>     array<span class="dt">&lt;Circle</span><span class="kw">,</span><span class="dv">10</span><span class="dt">&gt;</span> a2<span class="kw">;</span></span>
<span id="cb382-5"><a href="#cb382-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb382-6"><a href="#cb382-6" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Shape</span><span class="fu">*</span> p1 <span class="kw">=</span> a1<span class="kw">;</span>    <span class="fu">//</span> <span class="dt">OK</span><span class="fu">:</span> disaster waiting to happen</span>
<span id="cb382-7"><a href="#cb382-7" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Shape</span><span class="fu">*</span> p2 <span class="kw">=</span> a2<span class="kw">;</span>    <span class="fu">//</span> error<span class="fu">:</span> no conversion of array<span class="dt">&lt;Circle</span><span class="kw">,</span><span class="dv">10</span><span class="dt">&gt;</span> to <span class="dt">Shape*</span></span>
<span id="cb382-8"><a href="#cb382-8" aria-hidden="true" tabindex="-1"></a>     p1<span class="er">[</span><span class="dv">3</span><span class="er">]</span>.draw()<span class="kw">;</span>      <span class="fu">//</span> disaster</span>
<span id="cb382-9"><a href="#cb382-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The “disaster” comment assumes that <code
class="calibre8">sizeof(Shape)&lt;sizeof(Circle)</code>, so subscripting
a <code class="calibre8">Circle[]</code> through a <code
class="calibre8">Shape*</code> gives a wrong offset. All standard
containers provide this advantage over built-in arrays.</p>
<h4 class="h3" id="part0018.html#ch13lev2sec4">13.4.2 <code
class="calibre16">bitset</code></h4>
<p>Aspects of a system, such as the state of an input stream, are often
represented as a set of flags indicating binary conditions such as
good/bad, true/false, and on/off. C++ supports the notion of small sets
of flags efficiently through bitwise operations on integers (§<a
href="#part0006.html#ch01lev1sec4" class="calibre6">1.4</a>). Class
<code class="calibre8">bitset&lt;N&gt;</code> generalizes this notion by
providing operations on a sequence of <code class="calibre8">N</code>
bits [<code class="calibre8">0</code>:<code class="calibre8">N</code>),
where <code class="calibre8">N</code> is known at compile time. For sets
of bits that don’t fit into a <code
class="calibre8">long long int</code>, using a <code
class="calibre8">bitset</code> is much more convenient than using
integers directly. For smaller sets, <code
class="calibre8">bitset</code> is usually optimized. If you want to name
the bits, rather than numbering them, you can use a <code
class="calibre8">set</code> (§<a href="#part0016.html#ch11lev1sec4"
class="calibre6">11.4</a>) or an enumeration (§<a
href="#part0007.html#ch02lev1sec5" class="calibre6">2.5</a>).</p>
<p>A <code class="calibre8">bitset</code> can be initialized with an
integer or a string:</p>
<p><a href="#part0037_split_022.html#p0172_02a"
id="part0018.html#p0172_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb383"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb383-1"><a href="#cb383-1" aria-hidden="true" tabindex="-1"></a>bitset<span class="dt">&lt;</span><span class="dv">9</span><span class="er">&gt;</span> bs1 <span class="kw">{</span><span class="ot">&quot;110001111&quot;</span><span class="kw">};</span></span>
<span id="cb383-2"><a href="#cb383-2" aria-hidden="true" tabindex="-1"></a>bitset<span class="dt">&lt;</span><span class="dv">9</span><span class="er">&gt;</span> bs2 <span class="kw">{</span><span class="bn">0b1</span><span class="st">&#39;1000&#39;</span><span class="dv">1111</span><span class="kw">};</span>     <span class="fu">//</span> binary literal using digit separators (<span class="er">§</span><span class="fl">1.4</span>)</span></code></pre></div>
<p>The usual bitwise operators (§<a href="#part0006.html#ch01lev1sec4"
class="calibre6">1.4</a>) and the left- and right-shift operators (<code
class="calibre8">&lt;&lt;</code> and <code
class="calibre8">&gt;&gt;</code>) can be applied:</p>
<p><a href="#part0037_split_023.html#p0172_03a"
id="part0018.html#p0172_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb384"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a>bitset<span class="dt">&lt;</span><span class="dv">9</span><span class="er">&gt;</span> bs3 <span class="kw">=</span> ~bs1<span class="kw">;</span>       <span class="fu">//</span> complement<span class="fu">:</span> bs3<span class="fu">==</span><span class="ot">&quot;001110000&quot;</span></span>
<span id="cb384-2"><a href="#cb384-2" aria-hidden="true" tabindex="-1"></a>bitset<span class="dt">&lt;</span><span class="dv">9</span><span class="er">&gt;</span> bs4 <span class="kw">=</span> bs1&amp;bs3<span class="kw">;</span>    <span class="fu">//</span> all zeros</span>
<span id="cb384-3"><a href="#cb384-3" aria-hidden="true" tabindex="-1"></a>bitset<span class="dt">&lt;</span><span class="dv">9</span><span class="er">&gt;</span> bs5 <span class="kw">=</span> bs1<span class="al">&lt;&lt;</span><span class="dv">2</span><span class="kw">;</span>     <span class="fu">//</span> shift left<span class="fu">:</span> bs5 <span class="kw">=</span> <span class="ot">&quot;000111100&quot;</span></span></code></pre></div>
<p>The shift operators (here, <code class="calibre8">&lt;&lt;</code>)
“shift in” zeros.</p>
<p>The operations <code class="calibre8">to_ullong()</code> and <code
class="calibre8">to_string()</code> provide the inverse operations to
the constructors. For example, we could write out the binary
representation of an <code class="calibre8">int</code>:</p>
<p><a href="#part0037_split_024.html#p0172_04a"
id="part0018.html#p0172_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb385"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb385-1"><a href="#cb385-1" aria-hidden="true" tabindex="-1"></a>void binary(int i)</span>
<span id="cb385-2"><a href="#cb385-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb385-3"><a href="#cb385-3" aria-hidden="true" tabindex="-1"></a>     bitset<span class="dt">&lt;</span><span class="dv">8</span><span class="dt">*</span>sizeof(int)<span class="er">&gt;</span>b <span class="kw">=</span> i<span class="kw">;</span>        <span class="fu">//</span> assume <span class="dv">8</span><span class="fu">-</span>bit byte (see also <span class="er">§</span><span class="fl">14.7</span>)</span>
<span id="cb385-4"><a href="#cb385-4" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> b.to_string() <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span>     <span class="fu">//</span> <span class="fu">write</span> out the bits of i</span>
<span id="cb385-5"><a href="#cb385-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This prints the bits represented as <code class="calibre8">1</code>s
and <code class="calibre8">0</code>s from left to right, with the most
significant bit leftmost, so that argument <code
class="calibre8">123</code> would give the output</p>
<div class="sourceCode" id="cb386"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="dv">00000000000000000000000001111011</span></span></code></pre></div>
<p><span id="part0018.html#page_173" class="pagebreak"></span>For this
example, it is simpler to directly use the <code
class="calibre8">bitset</code> output operator:</p>
<p><a href="#part0037_split_025.html#p0173_01a"
id="part0018.html#p0173_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb387"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a>void binary2(int i)</span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a>     bitset<span class="dt">&lt;</span><span class="dv">8</span><span class="dt">*</span>sizeof(int)<span class="er">&gt;</span>b <span class="kw">=</span> i<span class="kw">;</span>    <span class="fu">//</span> assume <span class="dv">8</span><span class="fu">-</span>bit byte (see also <span class="er">§</span><span class="fl">14.7</span>)</span>
<span id="cb387-4"><a href="#cb387-4" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> b <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span>             <span class="fu">//</span> <span class="fu">write</span> out the bits of i</span>
<span id="cb387-5"><a href="#cb387-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h4 class="h3" id="part0018.html#ch13lev2sec5">13.4.3 <code
class="calibre16">pair</code> and <code
class="calibre16">tuple</code></h4>
<p>Often, we need some data that is just data; that is, a collection of
values, rather than an object of a class with well-defined semantics and
an invariant for its value (§<a href="#part0008.html#ch03lev2sec2"
class="calibre6">3.5.2</a>). In such cases, a simple <code
class="calibre8">struct</code> with an appropriate set of appropriately
named members is often ideal. Alternatively, we could let the standard
library write the definition for us. For example, the standard-library
algorithm <code class="calibre8">equal_range</code> returns a <code
class="calibre8">pair</code> of iterators specifying a subsequence
meeting a predicate:</p>
<p><a href="#part0037_split_026.html#p0173_02a"
id="part0018.html#p0173_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb388"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb388-1"><a href="#cb388-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Forward_iterator</span><span class="kw">,</span> typename <span class="dt">T</span><span class="kw">,</span> typename <span class="dt">Compare&gt;</span></span>
<span id="cb388-2"><a href="#cb388-2" aria-hidden="true" tabindex="-1"></a>    pair<span class="er">&lt;</span><span class="dt">Forward_iterator</span><span class="kw">,</span><span class="dt">Forward_iterator&gt;</span></span>
<span id="cb388-3"><a href="#cb388-3" aria-hidden="true" tabindex="-1"></a>    equal_range(<span class="dt">Forward_iterator</span> first<span class="er">,</span> <span class="dt">Forward_iterator</span> last<span class="er">,</span> const <span class="dt">T</span>&amp; val<span class="er">,</span> <span class="dt">Compare</span> cmp)<span class="kw">;</span></span></code></pre></div>
<p>Given a sorted sequence [<code class="calibre8">first</code>:<code
class="calibre8">last</code>), <code
class="calibre8">equal_range()</code> will return the <code
class="calibre8">pair</code> representing the subsequence that matches
the predicate <code class="calibre8">cmp</code>. We can use that to
search in a sorted sequence of <code
class="calibre8">Record</code>s:</p>
<p><a href="#part0037_split_027.html#p0173_03a"
id="part0018.html#p0173_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb389"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb389-1"><a href="#cb389-1" aria-hidden="true" tabindex="-1"></a>auto less <span class="kw">=</span> [](const <span class="dt">Record</span>&amp; r1<span class="kw">,</span> const <span class="dt">Record</span>&amp; r2) <span class="kw">{</span> return r1.name<span class="dt">&lt;</span>r2.name<span class="kw">;};</span>     <span class="fu">//</span> <span class="fu">compare</span> names</span>
<span id="cb389-2"><a href="#cb389-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-3"><a href="#cb389-3" aria-hidden="true" tabindex="-1"></a>void f(const vector<span class="dt">&lt;Record</span>&gt;&amp; v)        <span class="fu">//</span> assume that v <span class="dt">is</span> sorted on its <span class="er">&quot;</span>name<span class="er">&quot;</span> field</span>
<span id="cb389-4"><a href="#cb389-4" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb389-5"><a href="#cb389-5" aria-hidden="true" tabindex="-1"></a>     auto er <span class="kw">=</span> equal_range(v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end()<span class="kw">,</span><span class="dt">Record</span><span class="kw">{</span><span class="ot">&quot;</span><span class="er">Reg</span><span class="ot">&quot;</span><span class="kw">},</span>less)<span class="kw">;</span></span>
<span id="cb389-6"><a href="#cb389-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb389-7"><a href="#cb389-7" aria-hidden="true" tabindex="-1"></a>     for (auto p <span class="kw">=</span> er<span class="al">.</span>first<span class="kw">;</span> p<span class="kw">!=</span>er<span class="al">.</span>second<span class="kw">;</span> ++p)    <span class="fu">//</span> print all equal records</span>
<span id="cb389-8"><a href="#cb389-8" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> <span class="fu">*</span>p<span class="kw">;</span>                             <span class="fu">//</span> assume that <span class="al">&lt;&lt;</span> <span class="dt">is</span> defined for <span class="dt">Record</span></span>
<span id="cb389-9"><a href="#cb389-9" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>The first member of a <code class="calibre8">pair</code> is called
<code class="calibre8">first</code> and the second member is called
<code class="calibre8">second</code>. This naming is not particularly
creative and may look a bit odd at first, but such consistent naming is
a boon when we want to write generic code. Where the names <code
class="calibre8">first</code> and <code class="calibre8">last</code> are
too generic, we can use structured binding (§<a
href="#part0008.html#ch03lev2sec8" class="calibre6">3.6.3</a>):</p>
<p><a href="#part0037_split_028.html#p0173_04a"
id="part0018.html#p0173_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb390"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb390-1"><a href="#cb390-1" aria-hidden="true" tabindex="-1"></a>void f2(const vector<span class="dt">&lt;Record</span>&gt;&amp; v)     <span class="fu">//</span> assume that v <span class="dt">is</span> sorted on its <span class="er">&quot;</span>name<span class="er">&quot;</span> field</span>
<span id="cb390-2"><a href="#cb390-2" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb390-3"><a href="#cb390-3" aria-hidden="true" tabindex="-1"></a>     auto <span class="er">[</span>first<span class="kw">,</span>last<span class="er">]</span> <span class="kw">=</span> equal_range(v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end()<span class="kw">,</span><span class="dt">Record</span><span class="kw">{</span><span class="ot">&quot;</span><span class="er">Reg</span><span class="ot">&quot;</span><span class="kw">},</span>less)<span class="kw">;</span></span>
<span id="cb390-4"><a href="#cb390-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb390-5"><a href="#cb390-5" aria-hidden="true" tabindex="-1"></a>     for (auto p <span class="kw">=</span> first<span class="kw">;</span> p<span class="kw">!=</span>last<span class="kw">;</span> ++p)     <span class="fu">//</span> print all equal records</span>
<span id="cb390-6"><a href="#cb390-6" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> <span class="fu">*</span>p<span class="kw">;</span>                      <span class="fu">//</span> assume that <span class="al">&lt;&lt;</span> <span class="dt">is</span> defined for <span class="dt">Record</span></span>
<span id="cb390-7"><a href="#cb390-7" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>The standard-library <code class="calibre8">pair</code> (from <code
class="calibre8">&lt;utility&gt;</code>) is quite frequently used in the
standard library and elsewhere. A <code class="calibre8">pair</code>
provides operators, such as <code class="calibre8">=</code>, <code
class="calibre8">==</code>, and <code class="calibre8">&lt;</code>, if
its elements do. Type deduction makes it easy to create a <code
class="calibre8">pair</code> without explicitly mentioning its type. For
example:</p>
<p><a href="#part0037_split_029.html#p0174_01a"
id="part0018.html#p0174_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb391"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb391-1"><a href="#cb391-1" aria-hidden="true" tabindex="-1"></a>void f(vector<span class="dt">&lt;</span>string&gt;&amp; v)</span>
<span id="cb391-2"><a href="#cb391-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb391-3"><a href="#cb391-3" aria-hidden="true" tabindex="-1"></a>     pair p1 <span class="kw">{</span>v.begin()<span class="kw">,</span><span class="dv">2</span><span class="kw">};</span>             <span class="fu">//</span> one way</span>
<span id="cb391-4"><a href="#cb391-4" aria-hidden="true" tabindex="-1"></a>     auto p2 <span class="kw">=</span> make_pair(v<span class="al">.</span>begin()<span class="kw">,</span><span class="dv">2</span>)<span class="kw">;</span>  <span class="fu">//</span> another way</span>
<span id="cb391-5"><a href="#cb391-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb391-6"><a href="#cb391-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Both <code class="calibre8">p1</code> and <code
class="calibre8">p2</code> are of type <code
class="calibre8">pair&lt;vector&lt;string&gt;::iterator,int&gt;</code>.</p>
<p>If you need more than two elements (or less), you can use <code
class="calibre8">tuple</code> (from <code
class="calibre8">&lt;utility&gt;</code>). A <code
class="calibre8">tuple</code> is a heterogeneous sequence of elements;
for example:</p>
<p><a href="#part0037_split_030.html#p0174_02a"
id="part0018.html#p0174_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb392"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb392-1"><a href="#cb392-1" aria-hidden="true" tabindex="-1"></a>tuple<span class="dt">&lt;</span>string<span class="kw">,</span>int<span class="kw">,</span>double<span class="dt">&gt;</span> t1 <span class="er">{&quot;</span><span class="dt">Shark</span><span class="er">&quot;</span><span class="kw">,</span><span class="dv">123</span><span class="kw">,</span><span class="fl">3.14</span><span class="er">}</span><span class="kw">;</span>    <span class="fu">//</span> the type <span class="dt">is</span> explicitly specified</span>
<span id="cb392-2"><a href="#cb392-2" aria-hidden="true" tabindex="-1"></a>auto t2 <span class="kw">=</span> make_tuple(string<span class="kw">{</span><span class="ot">&quot;</span><span class="er">Herring</span><span class="ot">&quot;</span><span class="kw">},</span><span class="dv">10</span><span class="kw">,</span><span class="fl">1.23</span>)<span class="kw">;</span>   <span class="fu">//</span> the type <span class="dt">is</span> deduced to tuple<span class="er">&lt;</span>string<span class="kw">,</span>int<span class="kw">,</span>double<span class="dt">&gt;</span></span>
<span id="cb392-3"><a href="#cb392-3" aria-hidden="true" tabindex="-1"></a>tuple t3 <span class="er">{&quot;</span><span class="dt">Cod</span><span class="er">&quot;</span>s<span class="kw">,</span><span class="dv">20</span><span class="kw">,</span><span class="fl">9.99</span><span class="er">}</span><span class="kw">;</span>                         <span class="fu">//</span> the type <span class="dt">is</span> deduced to tuple<span class="er">&lt;</span>string<span class="kw">,</span>int<span class="kw">,</span>double<span class="dt">&gt;</span></span></code></pre></div>
<p>Older code tends to use <code class="calibre8">make_tuple()</code>
because template argument type deduction from constructor arguments is
C++17.</p>
<p>Access to <code class="calibre8">tuple</code> members is through a
<code class="calibre8">get</code> function template:</p>
<p><a href="#part0037_split_031.html#p0174_03a"
id="part0018.html#p0174_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb393"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb393-1"><a href="#cb393-1" aria-hidden="true" tabindex="-1"></a>string s <span class="kw">=</span> get<span class="dt">&lt;</span><span class="dv">0</span><span class="er">&gt;</span>(t1)<span class="kw">;</span>      <span class="fu">//</span> get the first element<span class="fu">:</span> <span class="ot">&quot;</span><span class="er">Shark</span><span class="ot">&quot;</span></span>
<span id="cb393-2"><a href="#cb393-2" aria-hidden="true" tabindex="-1"></a>int x <span class="kw">=</span> get<span class="dt">&lt;</span><span class="dv">1</span><span class="er">&gt;</span>(t1)<span class="kw">;</span>         <span class="fu">//</span> get the second element<span class="fu">:</span> <span class="dv">123</span></span>
<span id="cb393-3"><a href="#cb393-3" aria-hidden="true" tabindex="-1"></a>double d <span class="kw">=</span> get<span class="dt">&lt;</span><span class="dv">2</span><span class="er">&gt;</span>(t1)<span class="kw">;</span>      <span class="fu">//</span> get the third element<span class="fu">:</span> <span class="fl">3.14</span></span></code></pre></div>
<p>The elements of a <code class="calibre8">tuple</code> are numbered
(starting with zero) and the indices must be constants.</p>
<p>Accessing members of a <code class="calibre8">tuple</code> by their
index is general, ugly, and somewhat error-prone. Fortunately, an
element of a <code class="calibre8">tuple</code> with a unique type in
that <code class="calibre8">tuple</code> can be “named” by its type:</p>
<p><a href="#part0037_split_032.html#p0174_04a"
id="part0018.html#p0174_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb394"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a>auto s <span class="kw">=</span> get<span class="dt">&lt;</span>string<span class="er">&gt;</span>(t1)<span class="kw">;</span>     <span class="fu">//</span> get the string<span class="fu">:</span> <span class="ot">&quot;</span><span class="er">Shark</span><span class="ot">&quot;</span></span>
<span id="cb394-2"><a href="#cb394-2" aria-hidden="true" tabindex="-1"></a>auto x <span class="kw">=</span> get<span class="dt">&lt;</span>int<span class="er">&gt;</span>(t1)<span class="kw">;</span>        <span class="fu">//</span> get the int<span class="fu">:</span> <span class="dv">123</span></span>
<span id="cb394-3"><a href="#cb394-3" aria-hidden="true" tabindex="-1"></a>auto d <span class="kw">=</span> get<span class="dt">&lt;</span>double<span class="er">&gt;</span>(t1)<span class="kw">;</span>     <span class="fu">//</span> get the double<span class="fu">:</span> <span class="fl">3.14</span></span></code></pre></div>
<p>We can use <code class="calibre8">get&lt;&gt;</code> for writing
also:</p>
<p><a href="#part0037_split_033.html#p0174_05a"
id="part0018.html#p0174_05" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb395"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a>get<span class="dt">&lt;</span>string<span class="er">&gt;</span>(t1) <span class="kw">=</span> <span class="ot">&quot;</span><span class="er">Tuna</span><span class="ot">&quot;</span><span class="kw">;</span>    <span class="fu">//</span> <span class="fu">write</span> to the string</span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a>get<span class="dt">&lt;</span>int<span class="er">&gt;</span>(t1) <span class="kw">=</span> <span class="dv">7</span><span class="kw">;</span>            <span class="fu">//</span> <span class="fu">write</span> to the int</span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a>get<span class="dt">&lt;</span>double<span class="er">&gt;</span>(t1) <span class="kw">=</span> <span class="dv">312</span><span class="kw">;</span>       <span class="fu">//</span> <span class="fu">write</span> to the double</span></code></pre></div>
<p>Like <code class="calibre8">pair</code>s, <code
class="calibre8">tuple</code>s can be assigned and compared if their
elements can be. Like <code class="calibre8">tuple</code> elements,
<code class="calibre8">pair</code> elements can be accessed using <code
class="calibre8">get&lt;&gt;()</code>.</p>
<p>Like for <code class="calibre8">pair</code>, structured binding (§<a
href="#part0008.html#ch03lev2sec8" class="calibre6">3.6.3</a>) can be
used for <code class="calibre8">tuple</code>. However, when code doesn’t
need to be generic, a simple struct with named members often leads to
more maintainable code.</p>
<h3 class="h2" id="part0018.html#ch13lev1sec5">13.5 Alternatives</h3>
<p>The standard library offers three types to express alternatives:</p>
<ul>
<li><p><code class="calibre8">variant</code> to represent one of a
specified set of alternatives (in <code
class="calibre8">&lt;variant&gt;</code>)</p></li>
<li><p><code class="calibre8">optional</code> to represent a value of a
specified type or no value (in <code
class="calibre8">&lt;optional&gt;</code>)</p></li>
<li><p><code class="calibre8">any</code> to represent one of an
unbounded set of alternative types (in <code
class="calibre8">&lt;any&gt;</code>)</p></li>
</ul>
<p>These three types offer related functionality to the user.
Unfortunately, they don’t offer a unified interface.</p>
<h4 class="h3" id="part0018.html#ch13lev2sec6"><span
id="part0018.html#page_175" class="calibre2 pagebreak"></span>13.5.1
<code class="calibre16">variant</code></h4>
<p>A <code class="calibre8">variant&lt;A,B,C&gt;</code> is often a safer
and more convenient alternative to explicitly using a <code
class="calibre8">union</code> (§<a href="#part0007.html#ch02lev1sec4"
class="calibre6">2.4</a>). Possibly the simplest example is to return
either a value or an error code:</p>
<p><a href="#part0037_split_034.html#p0175_01a"
id="part0018.html#p0175_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb396"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a>variant<span class="dt">&lt;</span>string<span class="kw">,</span>int<span class="dt">&gt;</span> compose_message(istream&amp; s)</span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a>     string mess<span class="kw">;</span></span>
<span id="cb396-4"><a href="#cb396-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... <span class="fu">read</span> from s and compose message ...</span>
<span id="cb396-5"><a href="#cb396-5" aria-hidden="true" tabindex="-1"></a>     if (no_problems)</span>
<span id="cb396-6"><a href="#cb396-6" aria-hidden="true" tabindex="-1"></a>           return mess<span class="kw">;</span>            <span class="fu">//</span> return a string</span>
<span id="cb396-7"><a href="#cb396-7" aria-hidden="true" tabindex="-1"></a>     else</span>
<span id="cb396-8"><a href="#cb396-8" aria-hidden="true" tabindex="-1"></a>           return error_number<span class="kw">;</span>    <span class="fu">//</span> return an int</span>
<span id="cb396-9"><a href="#cb396-9" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>When you assign or initialize a <code class="calibre8">variant</code>
with a value, it remembers the type of that value. Later, we can inquire
what type the <code class="calibre8">variant</code> holds and extract
the value. For example:</p>
<p><a href="#part0037_split_035.html#p0175_02a"
id="part0018.html#p0175_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb397"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a>auto m <span class="kw">=</span> compose_message(cin)<span class="er">)</span><span class="kw">;</span></span>
<span id="cb397-2"><a href="#cb397-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb397-3"><a href="#cb397-3" aria-hidden="true" tabindex="-1"></a>if (holds_alternative<span class="dt">&lt;</span>string<span class="er">&gt;</span>(m)) <span class="kw">{</span></span>
<span id="cb397-4"><a href="#cb397-4" aria-hidden="true" tabindex="-1"></a>      cout <span class="al">&lt;&lt;</span> m.get<span class="dt">&lt;</span>string<span class="er">&gt;</span>()<span class="kw">;</span></span>
<span id="cb397-5"><a href="#cb397-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb397-6"><a href="#cb397-6" aria-hidden="true" tabindex="-1"></a>else <span class="kw">{</span></span>
<span id="cb397-7"><a href="#cb397-7" aria-hidden="true" tabindex="-1"></a>      int err <span class="kw">=</span> m.get<span class="dt">&lt;</span>int<span class="er">&gt;</span>()<span class="kw">;</span></span>
<span id="cb397-8"><a href="#cb397-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">//</span> ... handle error ...</span>
<span id="cb397-9"><a href="#cb397-9" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This style appeals to some people who dislike exceptions (see §<a
href="#part0008.html#ch03lev2sec3" class="calibre6">3.5.3</a>), but
there are more interesting uses. For example, a simple compiler may need
to distinguish between different kind of nodes with different
representations:</p>
<p><a href="#part0037_split_036.html#p0175_03a"
id="part0018.html#p0175_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb398"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a>using <span class="dt">Node</span> <span class="kw">=</span> variant<span class="dt">&lt;Expression</span><span class="kw">,</span><span class="dt">Statement</span><span class="kw">,</span><span class="dt">Declaration</span><span class="kw">,</span><span class="dt">Type&gt;</span><span class="kw">;</span></span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb398-3"><a href="#cb398-3" aria-hidden="true" tabindex="-1"></a>void check(<span class="dt">Node</span><span class="fu">*</span> p)</span>
<span id="cb398-4"><a href="#cb398-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb398-5"><a href="#cb398-5" aria-hidden="true" tabindex="-1"></a>     if (holds_alternative<span class="dt">&lt;Expression</span><span class="er">&gt;</span>(<span class="fu">*</span>p)) <span class="kw">{</span></span>
<span id="cb398-6"><a href="#cb398-6" aria-hidden="true" tabindex="-1"></a>           <span class="dt">Expression</span>&amp; e <span class="kw">=</span> get<span class="dt">&lt;Expression</span><span class="er">&gt;</span>(<span class="fu">*</span>p)<span class="kw">;</span></span>
<span id="cb398-7"><a href="#cb398-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">//</span> ...</span>
<span id="cb398-8"><a href="#cb398-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb398-9"><a href="#cb398-9" aria-hidden="true" tabindex="-1"></a>     else if (holds_alternative<span class="dt">&lt;Statement</span><span class="er">&gt;</span>(<span class="fu">*</span>p)) <span class="kw">{</span></span>
<span id="cb398-10"><a href="#cb398-10" aria-hidden="true" tabindex="-1"></a>           <span class="dt">Statement</span>&amp; s <span class="kw">=</span> get<span class="dt">&lt;Statement</span><span class="er">&gt;</span>(<span class="fu">*</span>p)<span class="kw">;</span></span>
<span id="cb398-11"><a href="#cb398-11" aria-hidden="true" tabindex="-1"></a>           <span class="fu">//</span> ...</span>
<span id="cb398-12"><a href="#cb398-12" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb398-13"><a href="#cb398-13" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... <span class="dt">Declaration</span> and <span class="dt">Type</span> ...</span>
<span id="cb398-14"><a href="#cb398-14" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This pattern of checking alternatives to decide on the appropriate
action is so common and relatively inefficient that it deserves direct
support:</p>
<p><a href="#part0037_split_037.html#p0176_01a"
id="part0018.html#p0176_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb399"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a>void check(<span class="dt">Node</span><span class="fu">*</span> p)</span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true" tabindex="-1"></a>     visit(overloaded <span class="kw">{</span></span>
<span id="cb399-4"><a href="#cb399-4" aria-hidden="true" tabindex="-1"></a>           [](<span class="dt">Expression</span>&amp; e) <span class="kw">{</span> <span class="co">/* ... */</span> <span class="kw">},</span></span>
<span id="cb399-5"><a href="#cb399-5" aria-hidden="true" tabindex="-1"></a>           [](<span class="dt">Statement</span>&amp; s) <span class="kw">{</span> <span class="co">/* ... */</span> <span class="kw">},</span></span>
<span id="cb399-6"><a href="#cb399-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">//</span> ... <span class="dt">Declaration</span> and <span class="dt">Type</span> ...</span>
<span id="cb399-7"><a href="#cb399-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">},</span> <span class="fu">*</span>p)<span class="kw">;</span></span>
<span id="cb399-8"><a href="#cb399-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This is basically equivalent to a virtual function call, but
potentially faster. As with all claims of performance, this “potentially
faster” should be verified by measurements when performance is critical.
For most uses, the difference in performance is insignificant.</p>
<p>Unfortunately, the <code class="calibre8">overloaded</code> is
necessary and not standard. It’s a “piece of magic” that builds an
overload set from a set of arguments (usually lambdas):</p>
<p><a href="#part0037_split_038.html#p0176_02a"
id="part0018.html#p0176_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb400"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>class... <span class="dt">Ts</span><span class="er">&gt;</span></span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a>struct overloaded <span class="fu">:</span> <span class="dt">Ts</span>... <span class="kw">{</span></span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a>     using <span class="dt">Ts</span>::operator()...<span class="kw">;</span></span>
<span id="cb400-4"><a href="#cb400-4" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb400-5"><a href="#cb400-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb400-6"><a href="#cb400-6" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>class... <span class="dt">Ts</span><span class="er">&gt;</span></span>
<span id="cb400-7"><a href="#cb400-7" aria-hidden="true" tabindex="-1"></a>     overloaded(<span class="dt">Ts</span>...) <span class="er">−</span><span class="dt">&gt;</span> overloaded<span class="er">&lt;</span><span class="dt">Ts</span>...&gt;<span class="kw">;</span>     <span class="fu">//</span> deduction guide</span></code></pre></div>
<p>The “visitor” <code class="calibre8">visit</code> then applies <code
class="calibre8">()</code> to the <code
class="calibre8">overload</code>, which selects the most appropriate
lambda to call according to the overload rules.</p>
<p>A <em>deduction guide</em> is a mechanism for resolving subtle
ambiguities, primarily for constructors of class templates in foundation
libraries.</p>
<p>If we try to access a <code class="calibre8">variant</code> holding a
different type than the expected one, <code
class="calibre8">bad_variant_access</code> is thrown.</p>
<h4 class="h3" id="part0018.html#ch13lev2sec7">13.5.2 <code
class="calibre16">optional</code></h4>
<p>An <code class="calibre8">optional&lt;A&gt;</code> can be seen as a
special kind of <code class="calibre8">variant</code> (like a <code
class="calibre8">variant&lt;A,nothing&gt;</code>) or as a generalization
of the idea of an <code class="calibre8">A*</code> either pointing to an
object or being <code class="calibre8">nullptr</code>.</p>
<p>An <code class="calibre8">optional</code> can be useful for functions
that may or may not return an object:</p>
<p><a href="#part0037_split_039.html#p0176_03a"
id="part0018.html#p0176_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb401"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb401-1"><a href="#cb401-1" aria-hidden="true" tabindex="-1"></a>optional<span class="dt">&lt;</span>string<span class="er">&gt;</span> compose_message(istream&amp; s)</span>
<span id="cb401-2"><a href="#cb401-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb401-3"><a href="#cb401-3" aria-hidden="true" tabindex="-1"></a>     string mess<span class="kw">;</span></span>
<span id="cb401-4"><a href="#cb401-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-5"><a href="#cb401-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... <span class="fu">read</span> from s and compose message ...</span>
<span id="cb401-6"><a href="#cb401-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-7"><a href="#cb401-7" aria-hidden="true" tabindex="-1"></a>     if (no_problems)</span>
<span id="cb401-8"><a href="#cb401-8" aria-hidden="true" tabindex="-1"></a>           return mess<span class="kw">;</span></span>
<span id="cb401-9"><a href="#cb401-9" aria-hidden="true" tabindex="-1"></a>     return <span class="kw">{};</span>     <span class="fu">//</span> the empty optional</span>
<span id="cb401-10"><a href="#cb401-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Given that, we can write</p>
<p><a href="#part0037_split_040.html#p0177_01a"
id="part0018.html#p0177_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb402"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb402-1"><a href="#cb402-1" aria-hidden="true" tabindex="-1"></a>if (auto m <span class="kw">=</span> compose_message(cin))</span>
<span id="cb402-2"><a href="#cb402-2" aria-hidden="true" tabindex="-1"></a>      cout <span class="al">&lt;&lt;</span> <span class="fu">*</span>m<span class="kw">;</span>     <span class="fu">//</span> note the dereference (<span class="fu">*</span>)</span>
<span id="cb402-3"><a href="#cb402-3" aria-hidden="true" tabindex="-1"></a>else <span class="kw">{</span></span>
<span id="cb402-4"><a href="#cb402-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... handle error ...</span>
<span id="cb402-5"><a href="#cb402-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This appeals to some people who dislike exceptions (see §<a
href="#part0008.html#ch03lev2sec3" class="calibre6">3.5.3</a>). Note the
curious use of <code class="calibre8">*</code>. An <code
class="calibre8">optional</code> is treated as a pointer to its object
rather than the object itself.</p>
<p>The <code class="calibre8">optional</code> equivalent to <code
class="calibre8">nullptr</code> is the empty object, <code
class="calibre8">{}</code>. For example:</p>
<p><a href="#part0037_split_041.html#p0177_02a"
id="part0018.html#p0177_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb403"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb403-1"><a href="#cb403-1" aria-hidden="true" tabindex="-1"></a>int cat(optional<span class="dt">&lt;</span>int<span class="er">&gt;</span> a<span class="kw">,</span> optional<span class="dt">&lt;</span>int<span class="er">&gt;</span> b)</span>
<span id="cb403-2"><a href="#cb403-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb403-3"><a href="#cb403-3" aria-hidden="true" tabindex="-1"></a>     int res <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span></span>
<span id="cb403-4"><a href="#cb403-4" aria-hidden="true" tabindex="-1"></a>     if (a) res+=*a<span class="kw">;</span></span>
<span id="cb403-5"><a href="#cb403-5" aria-hidden="true" tabindex="-1"></a>     if (b) res+=*b<span class="kw">;</span></span>
<span id="cb403-6"><a href="#cb403-6" aria-hidden="true" tabindex="-1"></a>     return res<span class="kw">;</span></span>
<span id="cb403-7"><a href="#cb403-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb403-8"><a href="#cb403-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb403-9"><a href="#cb403-9" aria-hidden="true" tabindex="-1"></a>int x <span class="kw">=</span> cat(<span class="dv">17</span><span class="kw">,</span><span class="dv">19</span>)<span class="kw">;</span></span>
<span id="cb403-10"><a href="#cb403-10" aria-hidden="true" tabindex="-1"></a>int y <span class="kw">=</span> cat(<span class="dv">17</span><span class="kw">,{}</span>)<span class="kw">;</span></span>
<span id="cb403-11"><a href="#cb403-11" aria-hidden="true" tabindex="-1"></a>int z <span class="kw">=</span> cat(<span class="kw">{},{}</span>)<span class="kw">;</span></span></code></pre></div>
<p>If we try to access an <code class="calibre8">optional</code> that
does not hold a value, the result is undefined; an exception is
<em>not</em> thrown. Thus, <code class="calibre8">optional</code> is not
guaranteed type safe.</p>
<h4 class="h3" id="part0018.html#ch13lev2sec8">13.5.3 <code
class="calibre16">any</code></h4>
<p>An <code class="calibre8">any</code> can hold an arbitrary type and
know which type (if any) it holds. It is basically an unconstrained
version of <code class="calibre8">variant</code>:</p>
<p><a href="#part0037_split_042.html#p0177_03a"
id="part0018.html#p0177_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb404"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb404-1"><a href="#cb404-1" aria-hidden="true" tabindex="-1"></a>any compose_message(istream&amp; s)</span>
<span id="cb404-2"><a href="#cb404-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb404-3"><a href="#cb404-3" aria-hidden="true" tabindex="-1"></a>    string mess<span class="kw">;</span></span>
<span id="cb404-4"><a href="#cb404-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-5"><a href="#cb404-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">//</span> ... <span class="fu">read</span> from s and compose message ...</span>
<span id="cb404-6"><a href="#cb404-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-7"><a href="#cb404-7" aria-hidden="true" tabindex="-1"></a>    if (no_problems)</span>
<span id="cb404-8"><a href="#cb404-8" aria-hidden="true" tabindex="-1"></a>          return mess<span class="kw">;</span>           <span class="fu">//</span> return a string</span>
<span id="cb404-9"><a href="#cb404-9" aria-hidden="true" tabindex="-1"></a>    else</span>
<span id="cb404-10"><a href="#cb404-10" aria-hidden="true" tabindex="-1"></a>          return error_number<span class="kw">;</span>   <span class="fu">//</span> return an int</span>
<span id="cb404-11"><a href="#cb404-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>When you assign or initialize an <code class="calibre8">any</code>
with a value, it remembers the type of that value. Later, we can inquire
what type the <code class="calibre8">any</code> holds and extract the
value. For example:</p>
<p><a href="#part0037_split_043.html#p0177_04a"
id="part0018.html#p0177_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb405"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb405-1"><a href="#cb405-1" aria-hidden="true" tabindex="-1"></a>auto m <span class="kw">=</span> compose_message(cin)<span class="er">)</span><span class="kw">;</span></span>
<span id="cb405-2"><a href="#cb405-2" aria-hidden="true" tabindex="-1"></a>string&amp; s <span class="kw">=</span> any_cast<span class="dt">&lt;</span>string<span class="er">&gt;</span>(m)<span class="kw">;</span></span>
<span id="cb405-3"><a href="#cb405-3" aria-hidden="true" tabindex="-1"></a>cout <span class="al">&lt;&lt;</span> s<span class="kw">;</span></span></code></pre></div>
<p>If we try to access an <code class="calibre8">any</code> holding a
different type than the expected one, <code
class="calibre8">bad_any_access</code> is thrown. There are also ways of
accessing an <code class="calibre8">any</code> that do not rely on
exceptions.</p>
<h3 class="h2" id="part0018.html#ch13lev1sec6"><span
id="part0018.html#page_178" class="calibre2 pagebreak"></span>13.6
Allocators</h3>
<p>By default, standard-library containers allocate space using <code
class="calibre8">new</code>. Operators <code class="calibre8">new</code>
and <code class="calibre8">delete</code> provide a general free store
(also called dynamic memory or heap) that can hold objects of arbitrary
size and user-controlled lifetime. This implies time and space overheads
that can be eliminated in many special cases. Therefore, the
standard-library containers offer the opportunity to install allocators
with specific semantics where needed. This has been used to address a
wide variety of concerns related to performance (e.g., pool allocators),
security (allocators that clean-up memory as part of deletion),
per-thread allocation, and non-uniform memory architectures (allocating
in specific memories with pointer types to match). This is not the place
to discuss these important, but very specialized and often advanced
techniques. However, I will give one example motivated by a real-world
problem for which a pool allocator was the solution [Zubkov,2017].</p>
<p>An important, long-running system used an event queue (see §<a
href="#part0020.html#ch15lev1sec6" class="calibre6">15.6</a>) using
<code class="calibre8">vector</code>s as events that were passed as
<code class="calibre8">shared_ptr</code>s. That way, the last user of an
event implicitly deleted it:</p>
<p><a href="#part0037_split_044.html#p0178_01a"
id="part0018.html#p0178_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb406"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb406-1"><a href="#cb406-1" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Event</span> <span class="kw">{</span></span>
<span id="cb406-2"><a href="#cb406-2" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> data <span class="kw">=</span> vector<span class="dt">&lt;</span>int<span class="er">&gt;</span>(<span class="dv">512</span>)<span class="kw">;</span></span>
<span id="cb406-3"><a href="#cb406-3" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb406-4"><a href="#cb406-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-5"><a href="#cb406-5" aria-hidden="true" tabindex="-1"></a>list<span class="dt">&lt;</span>shared_ptr<span class="er">&lt;</span><span class="dt">Event</span><span class="al">&gt;&gt;</span> q<span class="kw">;</span></span>
<span id="cb406-6"><a href="#cb406-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-7"><a href="#cb406-7" aria-hidden="true" tabindex="-1"></a>void producer()</span>
<span id="cb406-8"><a href="#cb406-8" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb406-9"><a href="#cb406-9" aria-hidden="true" tabindex="-1"></a>     for (int n <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span> n<span class="kw">!=</span><span class="dt">LOTS</span><span class="kw">;</span> ++n) <span class="kw">{</span></span>
<span id="cb406-10"><a href="#cb406-10" aria-hidden="true" tabindex="-1"></a>           lock_guard lk <span class="kw">{</span>m<span class="kw">};</span>      <span class="fu">//</span> m <span class="dt">is</span> a mutex (<span class="er">§</span><span class="fl">15.5</span>)</span>
<span id="cb406-11"><a href="#cb406-11" aria-hidden="true" tabindex="-1"></a>           q.push_back(make_shared<span class="dt">&lt;Event</span><span class="er">&gt;</span>())<span class="kw">;</span></span>
<span id="cb406-12"><a href="#cb406-12" aria-hidden="true" tabindex="-1"></a>           cv.notify_one()<span class="kw">;</span></span>
<span id="cb406-13"><a href="#cb406-13" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb406-14"><a href="#cb406-14" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>From a logical point of view this worked nicely. It is logically
simple, so the code is robust and maintainable. Unfortunately, this led
to massive fragmentation. After 100,000 events had been passed among 16
producers and 4 consumers, more than 6GB memory had been consumed.</p>
<p>The traditional solution to fragmentation problems is to rewrite the
code to use a pool allocator. A pool allocator is an allocator that
manages objects of a single fixed size and allocates space for many
objects at a time, rather than using individual allocations.
Fortunately, C++17 offers direct support for that. The pool allocator is
defined in the <code class="calibre8">pmr</code> (“polymorphic memory
resource”) sub-namespace of <code class="calibre8">std</code>:</p>
<p><a href="#part0037_split_045.html#p0178_02a"
id="part0018.html#p0178_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb407"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb407-1"><a href="#cb407-1" aria-hidden="true" tabindex="-1"></a>pmr::synchronized_pool_resource pool<span class="kw">;</span>             <span class="fu">//</span> make a pool</span>
<span id="cb407-2"><a href="#cb407-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-3"><a href="#cb407-3" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Event</span> <span class="kw">{</span></span>
<span id="cb407-4"><a href="#cb407-4" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> data <span class="kw">=</span> vector<span class="dt">&lt;</span>int<span class="er">&gt;</span><span class="kw">{</span><span class="dv">512</span><span class="kw">,</span>&amp;pool<span class="kw">};</span>   <span class="fu">//</span> let <span class="dt">Events</span> use the pool</span>
<span id="cb407-5"><a href="#cb407-5" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb407-6"><a href="#cb407-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-7"><a href="#cb407-7" aria-hidden="true" tabindex="-1"></a>list<span class="dt">&lt;</span>shared_ptr<span class="er">&lt;</span><span class="dt">Event</span><span class="al">&gt;&gt;</span> q <span class="kw">{</span>&amp;pool<span class="kw">};</span>                <span class="fu">//</span> let q use the pool</span>
<span id="cb407-8"><a href="#cb407-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb407-9"><a href="#cb407-9" aria-hidden="true" tabindex="-1"></a>void producer()</span>
<span id="cb407-10"><a href="#cb407-10" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb407-11"><a href="#cb407-11" aria-hidden="true" tabindex="-1"></a>     for (int n <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span> n<span class="kw">!=</span><span class="dt">LOTS</span><span class="kw">;</span> ++n) <span class="kw">{</span></span>
<span id="cb407-12"><a href="#cb407-12" aria-hidden="true" tabindex="-1"></a>           scoped_lock lk <span class="kw">{</span>m<span class="kw">};</span>      <span class="fu">//</span> m <span class="dt">is</span> a mutex (<span class="er">§</span><span class="fl">15.5</span>)</span>
<span id="cb407-13"><a href="#cb407-13" aria-hidden="true" tabindex="-1"></a>           q.push_back(allocate_shared<span class="dt">&lt;Event</span><span class="kw">,</span>pmr::polymorphic_allocator<span class="dt">&lt;Event</span><span class="al">&gt;&gt;</span><span class="er">{</span>&amp;pool<span class="er">}</span>)<span class="kw">;</span></span>
<span id="cb407-14"><a href="#cb407-14" aria-hidden="true" tabindex="-1"></a>           cv.notify_one()<span class="kw">;</span></span>
<span id="cb407-15"><a href="#cb407-15" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb407-16"><a href="#cb407-16" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p><span id="part0018.html#page_179" class="pagebreak"></span>Now, after
100,000 events had been passed among 16 producers and 4 consumers, less
than 3MB memory had been consumed. That’s about a 2000-fold improvement!
Naturally, the amount of memory actually in use (as opposed to memory
wasted to fragmentation) is unchanged. After eliminating fragmentation,
memory use was stable over time so the system could run for months.</p>
<p>Techniques like this have been applied with good effects from the
earliest days of C++, but generally they required code to be rewritten
to use specialized containers. Now, the standard containers optionally
take allocator arguments. The default is for the containers to use <code
class="calibre8">new</code> and <code
class="calibre8">delete</code>.</p>
<h3 class="h2" id="part0018.html#ch13lev1sec7">13.7 Time</h3>
<p>In <code class="calibre8">&lt;chrono&gt;</code>, the standard library
provides facilities for dealing with time. For example, here is the
basic way of timing something:</p>
<p><a href="#part0037_split_046.html#p0179_01a"
id="part0018.html#p0179_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb408"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb408-1"><a href="#cb408-1" aria-hidden="true" tabindex="-1"></a>using namespace std::chrono<span class="kw">;</span>     <span class="fu">//</span> in sub<span class="fu">-</span>namespace std::chrono<span class="kw">;</span> see <span class="er">§</span><span class="fl">3.4</span></span>
<span id="cb408-2"><a href="#cb408-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb408-3"><a href="#cb408-3" aria-hidden="true" tabindex="-1"></a>auto t0 <span class="kw">=</span> high_resolution_clock::now()<span class="kw">;</span></span>
<span id="cb408-4"><a href="#cb408-4" aria-hidden="true" tabindex="-1"></a>do_work()<span class="kw">;</span></span>
<span id="cb408-5"><a href="#cb408-5" aria-hidden="true" tabindex="-1"></a>auto t1 <span class="kw">=</span> high_resolution_clock::now()<span class="kw">;</span></span>
<span id="cb408-6"><a href="#cb408-6" aria-hidden="true" tabindex="-1"></a>cout <span class="al">&lt;&lt;</span> duration_cast<span class="dt">&lt;</span>milliseconds<span class="er">&gt;</span>(t1<span class="er">−</span>t0)<span class="kw">.</span>count() <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">msec</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span></code></pre></div>
<p>The clock returns a <code class="calibre8">time_point</code> (a point
in time). Subtracting two <code class="calibre8">time_point</code>s
gives a <code class="calibre8">duration</code> (a period of time).
Various clocks give their results in various units of time (the clock I
used measures <code class="calibre8">nanoseconds</code>), so it is
usually a good idea to convert a <code class="calibre8">duration</code>
into a known unit. That’s what <code
class="calibre8">duration_cast</code> does.</p>
<p>Don’t make statements about “efficiency” of code without first doing
time measurements. Guesses about performance are most unreliable.</p>
<p>To simplify notation and minimize errors, <code
class="calibre8">&lt;chrono&gt;</code> offers time-unit suffixes (§<a
href="#part0010.html#ch05lev2sec9" class="calibre6">5.4.4</a>). For
example:</p>
<p><a href="#part0037_split_047.html#p0179_02a"
id="part0018.html#p0179_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb409"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb409-1"><a href="#cb409-1" aria-hidden="true" tabindex="-1"></a>this_thread::sleep(<span class="er">10ms</span><span class="fu">+</span><span class="er">33us</span>)<span class="kw">;</span>   <span class="fu">//</span> wait for <span class="dv">10</span> milliseconds and <span class="dv">33</span> microseconds</span></code></pre></div>
<p>The chrono suffixes are defined in namespace <code
class="calibre8">std::chrono_literals</code>.</p>
<p>An elegant and efficient extension to <code
class="calibre8">&lt;chrono&gt;</code>, supporting longer time intervals
(e.g., years and months), calendars, and time zones, is being added to
the standard for C++20. It is currently available and in wide production
use [<a href="#part0021.html#ref25" class="calibre6">Hinnant,2018</a>]
[<a href="#part0021.html#ref26" class="calibre6">Hinnant,2018b</a>]. You
can say things like</p>
<p><a href="#part0037_split_048.html#p0179_03a"
id="part0018.html#p0179_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb410"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb410-1"><a href="#cb410-1" aria-hidden="true" tabindex="-1"></a>auto spring_day <span class="kw">=</span> apr<span class="fu">/</span><span class="dv">7</span><span class="fu">/</span><span class="dv">2018</span><span class="kw">;</span></span>
<span id="cb410-2"><a href="#cb410-2" aria-hidden="true" tabindex="-1"></a>cout <span class="al">&lt;&lt;</span> weekday(spring_day) <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span>       <span class="fu">//</span> <span class="dt">Saturday</span></span></code></pre></div>
<p>It even handles leap seconds.</p>
<h3 class="h2" id="part0018.html#ch13lev1sec8"><span
id="part0018.html#page_180" class="calibre2 pagebreak"></span>13.8
Function Adaption</h3>
<p>When passing a function as a function argument, the type of the
argument must exactly match the expectations expressed in the called
function’s declaration. If the intended argument “almost matches
expectations,” we have three good alternatives:</p>
<ul>
<li><p>Use a lambda (§<a href="#part0018.html#ch13lev2sec9"
class="calibre6">13.8.1</a>).</p></li>
<li><p>Use <code class="calibre8">std::mem_fn()</code> to make a
function object from a member function (§<a
href="#part0018.html#ch13lev2sec10"
class="calibre6">13.8.2</a>).</p></li>
<li><p>Define the function to accept a <code
class="calibre8">std::function</code> (§<a
href="#part0018.html#ch13lev2sec11"
class="calibre6">13.8.3</a>).</p></li>
</ul>
<p>There are many other ways, but usually one of these three ways works
best.</p>
<h4 class="h3" id="part0018.html#ch13lev2sec9">13.8.1 Lambdas as
Adaptors</h4>
<p>Consider the classical “draw all shapes” example:</p>
<p><a href="#part0037_split_049.html#p0180_01a"
id="part0018.html#p0180_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb411"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb411-1"><a href="#cb411-1" aria-hidden="true" tabindex="-1"></a>void draw_all(vector<span class="dt">&lt;Shape</span>*&gt;&amp; v)</span>
<span id="cb411-2"><a href="#cb411-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb411-3"><a href="#cb411-3" aria-hidden="true" tabindex="-1"></a>     for_each(v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end()<span class="kw">,</span>[](<span class="dt">Shape</span><span class="fu">*</span> p) <span class="kw">{</span> p<span class="er">−</span><span class="dt">&gt;</span>draw()<span class="kw">;</span> <span class="kw">}</span>)<span class="kw">;</span></span>
<span id="cb411-4"><a href="#cb411-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Like all standard-library algorithms, <code
class="calibre8">for_each()</code> calls its argument using the
traditional function call syntax <code class="calibre8">f(x)</code>, but
<code class="calibre8">Shape's draw()</code> uses the conventional OO
notation <code class="calibre8">x−&gt;f()</code>. A lambda easily
mediates between the two notations.</p>
<h4 class="h3" id="part0018.html#ch13lev2sec10">13.8.2 <code
class="calibre16">mem_fn()</code></h4>
<p>Given a member function, the function adaptor <code
class="calibre8">mem_fn(mf)</code> produces a function object that can
be called as a nonmember function. For example:</p>
<p><a href="#part0037_split_050.html#p0180_02a"
id="part0018.html#p0180_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb412"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb412-1"><a href="#cb412-1" aria-hidden="true" tabindex="-1"></a>void draw_all(vector<span class="dt">&lt;Shape</span>*&gt;&amp; v)</span>
<span id="cb412-2"><a href="#cb412-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb412-3"><a href="#cb412-3" aria-hidden="true" tabindex="-1"></a>     for_each(v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end()<span class="kw">,</span>mem_fn(&amp;<span class="dt">Shape</span>::draw))<span class="kw">;</span></span>
<span id="cb412-4"><a href="#cb412-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Before the introduction of lambdas in C++11, <code
class="calibre8">mem_fn()</code> and equivalents were the main way to
map from the object-oriented calling style to the functional one.</p>
<h4 class="h3" id="part0018.html#ch13lev2sec11">13.8.3 <code
class="calibre16">function</code></h4>
<p>The standard-library <code class="calibre8">function</code> is a type
that can hold any object you can invoke using the call operator <code
class="calibre8">()</code>. That is, an object of type <code
class="calibre8">function</code> is a function object (§<a
href="#part0011.html#ch06lev2sec5" class="calibre6">6.3.2</a>). For
example:</p>
<p><a href="#part0037_split_051.html#p0180_03a"
id="part0018.html#p0180_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb413"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb413-1"><a href="#cb413-1" aria-hidden="true" tabindex="-1"></a>int f1(double)<span class="kw">;</span></span>
<span id="cb413-2"><a href="#cb413-2" aria-hidden="true" tabindex="-1"></a>function<span class="dt">&lt;</span>int(double)<span class="er">&gt;</span> fct1 <span class="kw">{</span>f1<span class="kw">};</span>                <span class="fu">//</span> initialize to f1</span>
<span id="cb413-3"><a href="#cb413-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb413-4"><a href="#cb413-4" aria-hidden="true" tabindex="-1"></a>int f2(string)<span class="kw">;</span></span>
<span id="cb413-5"><a href="#cb413-5" aria-hidden="true" tabindex="-1"></a>function fct2 <span class="kw">{</span>f2<span class="kw">};</span>                             <span class="fu">//</span> fct2<span class="st">&#39;</span><span class="er">s type is function&lt;int(string)&gt;</span></span>
<span id="cb413-6"><a href="#cb413-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb413-7"><a href="#cb413-7" aria-hidden="true" tabindex="-1"></a><span class="er">function fct3 </span><span class="st">=</span><span class="er"> </span><span class="st">[](</span><span class="er">Shape</span><span class="st">*</span><span class="er"> p</span><span class="st">)</span><span class="er"> </span><span class="st">{</span><span class="er"> p</span><span class="st">−&gt;</span><span class="er">draw</span><span class="st">();</span><span class="er"> </span><span class="st">};</span><span class="er">    </span><span class="st">//</span><span class="er"> fct3</span><span class="st">&#39;</span>s type <span class="dt">is</span> function<span class="er">&lt;</span>void(<span class="dt">Shape</span><span class="fu">*</span>)<span class="dt">&gt;</span></span></code></pre></div>
<p>For <code class="calibre8">fct2</code>, I let the type of the <code
class="calibre8">function</code> be deduced from the initializer: <code
class="calibre8">int(string)</code>.</p>
<p><span id="part0018.html#page_181" class="pagebreak"></span>Obviously,
<code class="calibre8">function</code>s are useful for callbacks, for
passing operations as arguments, for passing function objects, etc.
However, it may introduce some run-time overhead compared to direct
calls, and a <code class="calibre8">function</code>, being an object,
does not participate in overloading. If you need to overload function
objects (including lambdas), consider <code
class="calibre8">overloaded</code> (§<a
href="#part0018.html#ch13lev2sec6" class="calibre6">13.5.1</a>).</p>
<h3 class="h2" id="part0018.html#ch13lev1sec9">13.9 Type Functions</h3>
<p>A <em>type function</em> is a function that is evaluated at compile
time given a type as its argument or returning a type. The standard
library provides a variety of type functions to help library
implementers (and programmers in general) to write code that takes
advantage of aspects of the language, the standard library, and code in
general.</p>
<p>For numerical types, <code class="calibre8">numeric_limits</code>
from <code class="calibre8">&lt;limits&gt;</code> presents a variety of
useful information (§<a href="#part0019.html#ch14lev1sec7"
class="calibre6">14.7</a>). For example:</p>
<p><a href="#part0037_split_052.html#p0181_01a"
id="part0018.html#p0181_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb414"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb414-1"><a href="#cb414-1" aria-hidden="true" tabindex="-1"></a>constexpr <span class="dt">float</span> min <span class="kw">=</span> numeric_limits<span class="dt">&lt;</span><span class="fl">float</span>&gt;::<span class="dt">min</span>()<span class="kw">;</span>     <span class="fu">//</span> smallest positive <span class="dt">float</span></span></code></pre></div>
<p>Similarly, object sizes can be found by the built-in <code
class="calibre8">sizeof</code> operator (§<a
href="#part0006.html#ch01lev1sec4" class="calibre6">1.4</a>). For
example:</p>
<p><a href="#part0037_split_053.html#p0181_02a"
id="part0018.html#p0181_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb415"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb415-1"><a href="#cb415-1" aria-hidden="true" tabindex="-1"></a>constexprint szi <span class="kw">=</span> sizeof(int)<span class="kw">;</span>     <span class="fu">//</span> the <span class="dt">number</span> of bytes in an int</span></code></pre></div>
<p>Such type functions are part of C++’s mechanisms for compile-time
computation that allow tighter type checking and better performance than
would otherwise have been possible. Use of such features is often called
<em>metaprogramming</em> or (when templates are involved) <em>template
metaprogramming</em>. Here, I just present the use of two facilities
provided by the standard library: <code
class="calibre8">iterator_traits</code> (§<a
href="#part0018.html#ch13lev2sec12" class="calibre6">13.9.1</a>) and
type predicates (§<a href="#part0018.html#ch13lev2sec13"
class="calibre6">13.9.2</a>). Concepts (§<a
href="#part0012.html#ch07lev1sec2" class="calibre6">7.2</a>) make some
of these techniques redundant and simplify many of the rest, but
concepts are still not standard or universally available, so the
techniques presented here are in wide use.</p>
<h4 class="h3" id="part0018.html#ch13lev2sec12">13.9.1 <code
class="calibre16">iterator_traits</code></h4>
<p>The standard-library <code class="calibre8">sort()</code> takes a
pair of iterators supposed to define a sequence (<a
href="#part0017.html#ch12" class="calibre6">Chapter 12</a>).
Furthermore, those iterators must offer random access to that sequence,
that is, they must be <em>random-access iterators</em>. Some containers,
such as <code class="calibre8">forward_list</code>, do not offer that.
In particular, a <code class="calibre8">forward_list</code> is a
singly-linked list so subscripting would be expensive and there is no
reasonable way to refer back to a previous element. However, like most
containers, <code class="calibre8">forward_list</code> offers
<em>forward iterators</em> that can be used to traverse the sequence by
algorithms and <code class="calibre8">for</code>-statements (§<a
href="#part0011.html#ch06lev1sec2" class="calibre6">6.2</a>).</p>
<p>The standard library provides a mechanism, <code
class="calibre8">iterator_traits</code>, that allows us to check which
kind of iterator is provided. Given that, we can improve the range <code
class="calibre8">sort()</code> from §<a
href="#part0017.html#ch12lev1sec8" class="calibre6">12.8</a> to accept
either a <code class="calibre8">vector</code> or a <code
class="calibre8">forward_list</code>. For example:</p>
<p><a href="#part0037_split_054.html#p0181_03a"
id="part0018.html#p0181_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb416"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb416-1"><a href="#cb416-1" aria-hidden="true" tabindex="-1"></a>void test(vector<span class="dt">&lt;</span>string&gt;&amp; v<span class="kw">,</span> forward_list<span class="dt">&lt;</span>int&gt;&amp; lst)</span>
<span id="cb416-2"><a href="#cb416-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb416-3"><a href="#cb416-3" aria-hidden="true" tabindex="-1"></a>     sort(v)<span class="kw">;</span>   <span class="fu">//</span> sort the vector</span>
<span id="cb416-4"><a href="#cb416-4" aria-hidden="true" tabindex="-1"></a>     sort(lst)<span class="kw">;</span> <span class="fu">//</span> sort the singly<span class="fu">-</span>linked list</span>
<span id="cb416-5"><a href="#cb416-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The techniques needed to make that work are generally useful.</p>
<p><span id="part0018.html#page_182" class="pagebreak"></span>First, I
write two helper functions that take an extra argument indicating
whether they are to be used for random-access iterators or forward
iterators. The version taking random-access iterator arguments is
trivial:</p>
<p><a href="#part0037_split_055.html#p0182_01a"
id="part0018.html#p0182_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb417"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb417-1"><a href="#cb417-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Ran</span><span class="er">&gt;</span>                                             <span class="fu">//</span> for random<span class="fu">-</span>access iterators</span>
<span id="cb417-2"><a href="#cb417-2" aria-hidden="true" tabindex="-1"></a>void sort_helper(<span class="dt">Ran</span> beg<span class="kw">,</span> <span class="dt">Ran</span> end<span class="kw">,</span> random_access_iterator_tag)     <span class="fu">//</span> we can subscript into [beg<span class="fu">:</span>end<span class="er">)</span></span>
<span id="cb417-3"><a href="#cb417-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb417-4"><a href="#cb417-4" aria-hidden="true" tabindex="-1"></a>     sort(beg<span class="kw">,</span>end)<span class="kw">;</span>     <span class="fu">//</span> just sort it</span>
<span id="cb417-5"><a href="#cb417-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The version for forward iterators simply copies the list into a <code
class="calibre8">vector</code>, sorts, and copies back:</p>
<p><a href="#part0037_split_056.html#p0182_02a"
id="part0018.html#p0182_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb418"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb418-1"><a href="#cb418-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">For</span><span class="er">&gt;</span>                                       <span class="fu">//</span> for forward iterators</span>
<span id="cb418-2"><a href="#cb418-2" aria-hidden="true" tabindex="-1"></a>void sort_helper(<span class="dt">For</span> beg<span class="kw">,</span> <span class="dt">For</span> end<span class="kw">,</span> forward_iterator_tag)     <span class="fu">//</span> we can traverse [beg<span class="fu">:</span>end<span class="er">)</span></span>
<span id="cb418-3"><a href="#cb418-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb418-4"><a href="#cb418-4" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;Value_type</span><span class="er">&lt;</span><span class="dt">For</span><span class="al">&gt;&gt;</span> v <span class="kw">{</span>beg<span class="kw">,</span>end<span class="kw">};</span>  <span class="fu">//</span> initialize a vector from [beg<span class="fu">:</span>end<span class="er">)</span></span>
<span id="cb418-5"><a href="#cb418-5" aria-hidden="true" tabindex="-1"></a>     sort(v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end())<span class="kw">;</span>              <span class="fu">//</span> use the random access sort</span>
<span id="cb418-6"><a href="#cb418-6" aria-hidden="true" tabindex="-1"></a>     copy(v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end()<span class="kw">,</span>beg)<span class="kw">;</span>          <span class="fu">//</span> copy the elements back</span>
<span id="cb418-7"><a href="#cb418-7" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p><code class="calibre8">Value_type&lt;For&gt;</code> is the type of
<code class="calibre8">For</code>’s elements, called it’s <em>value
type</em>. Every standard-library iterator has a member <code
class="calibre8">value_type</code>. I get the <code
class="calibre8">Value_type&lt;For&gt;</code> notation by defining a
type alias (§<a href="#part0011.html#ch06lev2sec8"
class="calibre6">6.4.2</a>):</p>
<p><a href="#part0037_split_057.html#p0182_03a"
id="part0018.html#p0182_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb419"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb419-1"><a href="#cb419-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">C</span><span class="er">&gt;</span></span>
<span id="cb419-2"><a href="#cb419-2" aria-hidden="true" tabindex="-1"></a>     using <span class="dt">Value_type</span> <span class="kw">=</span> typename <span class="dt">C</span>::value_type<span class="kw">;</span> <span class="fu">//</span> <span class="dt">C</span><span class="st">&#39;</span><span class="er">s value type</span></span></code></pre></div>
<p>Thus, for a <code class="calibre8">vector&lt;X&gt;</code>, <code
class="calibre8">Value_type&lt;X&gt;</code> is <code
class="calibre8">X</code>.</p>
<p>The real “type magic” is in the selection of helper functions:</p>
<p><a href="#part0037_split_058.html#p0182_04a"
id="part0018.html#p0182_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb420"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb420-1"><a href="#cb420-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">C</span><span class="er">&gt;</span></span>
<span id="cb420-2"><a href="#cb420-2" aria-hidden="true" tabindex="-1"></a>void sort(<span class="dt">C</span>&amp; c)</span>
<span id="cb420-3"><a href="#cb420-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb420-4"><a href="#cb420-4" aria-hidden="true" tabindex="-1"></a>     using <span class="dt">Iter</span> <span class="kw">=</span> <span class="dt">Iterator_type&lt;C</span><span class="er">&gt;</span><span class="kw">;</span></span>
<span id="cb420-5"><a href="#cb420-5" aria-hidden="true" tabindex="-1"></a>     sort_helper(c<span class="al">.</span>begin()<span class="kw">,</span>c<span class="al">.</span>end()<span class="kw">,</span><span class="dt">Iterator_category&lt;Iter</span><span class="er">&gt;</span><span class="kw">{}</span>)<span class="kw">;</span></span>
<span id="cb420-6"><a href="#cb420-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Here, I use two type functions: <code
class="calibre8">Iterator_type&lt;C&gt;</code> returns the iterator type
of <code class="calibre8">C</code> (that is, <code
class="calibre8">C::iterator</code>) and then <code
class="calibre8">Iterator_category&lt;Iter&gt;{}</code> constructs a
“tag” value indicating the kind of iterator provided:</p>
<ul>
<li><p><code class="calibre8">std::random_access_iterator_tag</code> if
<code class="calibre8">C</code>’s iterator supports random
access</p></li>
<li><p><code class="calibre8">std::forward_iterator_tag</code> if <code
class="calibre8">C</code>’s iterator supports forward iteration</p></li>
</ul>
<p>Given that, we can select between the two sorting algorithms at
compile time. This technique, called <em>tag dispatch</em>, is one of
several used in the standard library and elsewhere to improve
flexibility and performance.</p>
<p>We could define <code class="calibre8">Iterator_type</code> like
this:</p>
<p><a href="#part0037_split_059.html#p0182_05a"
id="part0018.html#p0182_05" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb421"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb421-1"><a href="#cb421-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">C</span><span class="er">&gt;</span></span>
<span id="cb421-2"><a href="#cb421-2" aria-hidden="true" tabindex="-1"></a>    using <span class="dt">Iterator_type</span> <span class="kw">=</span> typename <span class="dt">C</span>::iterator<span class="kw">;</span>   <span class="fu">//</span> <span class="dt">C</span><span class="st">&#39;</span><span class="er">s iterator type</span></span></code></pre></div>
<p>However, to extend this idea to types without member types, such as
pointers, the standard-library support for tag dispatch comes in the
form of a class template <code class="calibre8">iterator_traits</code>
from <code class="calibre8">&lt;iterator&gt;</code>. The specialization
for pointers looks like this:</p>
<p><a href="#part0037_split_060.html#p0183_01a"
id="part0018.html#p0183_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb422"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb422-1"><a href="#cb422-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>class <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb422-2"><a href="#cb422-2" aria-hidden="true" tabindex="-1"></a>struct iterator_traits<span class="dt">&lt;T</span>*&gt;<span class="er">{</span></span>
<span id="cb422-3"><a href="#cb422-3" aria-hidden="true" tabindex="-1"></a>     using difference_type <span class="kw">=</span> ptrdiff_t<span class="kw">;</span></span>
<span id="cb422-4"><a href="#cb422-4" aria-hidden="true" tabindex="-1"></a>     using value_type <span class="kw">=</span> <span class="dt">T</span><span class="kw">;</span></span>
<span id="cb422-5"><a href="#cb422-5" aria-hidden="true" tabindex="-1"></a>     using pointer <span class="kw">=</span> <span class="dt">T</span><span class="fu">*</span><span class="kw">;</span></span>
<span id="cb422-6"><a href="#cb422-6" aria-hidden="true" tabindex="-1"></a>     using reference <span class="kw">=</span> <span class="dt">T</span>&amp;<span class="kw">;</span></span>
<span id="cb422-7"><a href="#cb422-7" aria-hidden="true" tabindex="-1"></a>     using iterator_category <span class="kw">=</span> random_access_iterator_tag<span class="kw">;</span></span>
<span id="cb422-8"><a href="#cb422-8" aria-hidden="true" tabindex="-1"></a><span class="er">}</span><span class="kw">;</span></span></code></pre></div>
<p>We can now write:</p>
<p><a href="#part0037_split_061.html#p0183_02a"
id="part0018.html#p0183_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb423"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb423-1"><a href="#cb423-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Iter</span><span class="er">&gt;</span></span>
<span id="cb423-2"><a href="#cb423-2" aria-hidden="true" tabindex="-1"></a>    using <span class="dt">Iterator_category</span> <span class="kw">=</span> typename std::iterator_traits<span class="dt">&lt;Iter</span>&gt;::iterator_category<span class="kw">;</span> <span class="fu">//</span> <span class="dt">Iter</span><span class="st">&#39;</span><span class="er">s category</span></span></code></pre></div>
<p>Now an <code class="calibre8">int*</code> can be used as a
random-access iterator despite not having a member type; <code
class="calibre8">Iterator_category&lt;int*&gt;</code> is <code
class="calibre8">random_access_iterator_tag</code>.</p>
<p>Many traits and traits-based techniques will be made redundant by
concepts (§<a href="#part0012.html#ch07lev1sec2"
class="calibre6">7.2</a>). Consider the concepts version of the <code
class="calibre8">sort()</code> example:</p>
<p><a href="#part0037_split_062.html#p0183_03a"
id="part0018.html#p0183_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb424"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb424-1"><a href="#cb424-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;RandomAccessIterator</span> <span class="dt">Iter</span><span class="er">&gt;</span></span>
<span id="cb424-2"><a href="#cb424-2" aria-hidden="true" tabindex="-1"></a>void sort(<span class="dt">Iter</span> p<span class="kw">,</span> <span class="dt">Iter</span> q)<span class="kw">;</span>   <span class="fu">//</span> use for std::vector and other types supporting random access</span>
<span id="cb424-3"><a href="#cb424-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-4"><a href="#cb424-4" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;ForwardIterator</span> <span class="dt">Iter</span><span class="er">&gt;</span></span>
<span id="cb424-5"><a href="#cb424-5" aria-hidden="true" tabindex="-1"></a>void sort(<span class="dt">Iter</span> p<span class="kw">,</span> <span class="dt">Iter</span> q)</span>
<span id="cb424-6"><a href="#cb424-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> use for std::list and other types supporting just forward traversal</span>
<span id="cb424-7"><a href="#cb424-7" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb424-8"><a href="#cb424-8" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;Value_type</span><span class="er">&lt;</span><span class="dt">Iter</span><span class="al">&gt;&gt;</span> v <span class="kw">{</span>p<span class="kw">,</span>q<span class="kw">};</span></span>
<span id="cb424-9"><a href="#cb424-9" aria-hidden="true" tabindex="-1"></a>     sort(v)<span class="kw">;</span>                      <span class="fu">//</span> use the random<span class="fu">-</span>access sort</span>
<span id="cb424-10"><a href="#cb424-10" aria-hidden="true" tabindex="-1"></a>     copy(v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end()<span class="kw">,</span>p)<span class="kw">;</span></span>
<span id="cb424-11"><a href="#cb424-11" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb424-12"><a href="#cb424-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-13"><a href="#cb424-13" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;RangeR</span><span class="er">&gt;</span></span>
<span id="cb424-14"><a href="#cb424-14" aria-hidden="true" tabindex="-1"></a>void sort(<span class="dt">R</span>&amp; r)</span>
<span id="cb424-15"><a href="#cb424-15" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb424-16"><a href="#cb424-16" aria-hidden="true" tabindex="-1"></a>     sort(r<span class="al">.</span>begin()<span class="kw">,</span>r<span class="al">.</span>end())<span class="kw">;</span>      <span class="fu">//</span> use the appropriate sort</span>
<span id="cb424-17"><a href="#cb424-17" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Progress happens.</p>
<h4 class="h3" id="part0018.html#ch13lev2sec13">13.9.2 Type
Predicates</h4>
<p>In <code class="calibre8">&lt;type_traits&gt;</code>, the standard
library offers simple type functions, called <em>type predicates</em>
that answers a fundamental question about types. For example:</p>
<p><a href="#part0037_split_063.html#p0183_04a"
id="part0018.html#p0183_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb425"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb425-1"><a href="#cb425-1" aria-hidden="true" tabindex="-1"></a>bool b1 <span class="kw">=</span> <span class="dt">Is_arithmetic&lt;</span>int<span class="er">&gt;</span>()<span class="kw">;</span>     <span class="fu">//</span> yes<span class="kw">,</span> int <span class="dt">is</span> an arithmetic type</span>
<span id="cb425-2"><a href="#cb425-2" aria-hidden="true" tabindex="-1"></a>bool b2 <span class="kw">=</span> <span class="dt">Is_arithmetic&lt;</span>string<span class="er">&gt;</span>()<span class="kw">;</span>  <span class="fu">//</span> no<span class="kw">,</span> std::string <span class="dt">is</span> not an arithmetic type</span></code></pre></div>
<p>Other examples are <code class="calibre8">is_class</code>, <code
class="calibre8">is_pod</code>, <code
class="calibre8">is_literal_type</code>, <code
class="calibre8">has_virtual_destructor</code>, and <code
class="calibre8">is_base_of</code>. They are most useful when we write
templates. For example:</p>
<p><a href="#part0037_split_064.html#p0184_01a"
id="part0018.html#p0184_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb426"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb426-1"><a href="#cb426-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Scalar</span><span class="er">&gt;</span></span>
<span id="cb426-2"><a href="#cb426-2" aria-hidden="true" tabindex="-1"></a>class complex <span class="kw">{</span></span>
<span id="cb426-3"><a href="#cb426-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Scalar</span> re<span class="kw">,</span> im<span class="kw">;</span></span>
<span id="cb426-4"><a href="#cb426-4" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb426-5"><a href="#cb426-5" aria-hidden="true" tabindex="-1"></a>     static_assert(<span class="dt">Is_arithmetic&lt;Scalar</span><span class="er">&gt;</span>()<span class="kw">,</span> <span class="ot">&quot;</span><span class="er">Sorry</span><span class="ot">,</span><span class="er"> I only support complex of arithmetic types</span><span class="ot">&quot;</span>)<span class="kw">;</span></span>
<span id="cb426-6"><a href="#cb426-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb426-7"><a href="#cb426-7" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>To improve readability compared to using the standard library
directly, I defined a type function:</p>
<p><a href="#part0037_split_065.html#p0184_02a"
id="part0018.html#p0184_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb427"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb427-1"><a href="#cb427-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb427-2"><a href="#cb427-2" aria-hidden="true" tabindex="-1"></a>constexpr bool <span class="dt">Is_arithmetic</span>()</span>
<span id="cb427-3"><a href="#cb427-3" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb427-4"><a href="#cb427-4" aria-hidden="true" tabindex="-1"></a>    return std::is_arithmetic<span class="dt">&lt;T</span>&gt;::value <span class="kw">;</span></span>
<span id="cb427-5"><a href="#cb427-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Older programs use <code class="calibre8">::value</code> directly
instead of <code class="calibre8">()</code>, but I consider that quite
ugly and it exposes implementation details.</p>
<h4 class="h3" id="part0018.html#ch13lev2sec14">13.9.3 <code
class="calibre16">enable_if</code></h4>
<p>Obvious ways of using type predicates includes conditions for <code
class="calibre8">static_assert</code>s, compile-time <code
class="calibre8">if</code>s, and <code
class="calibre8">enable_if</code>s. The standard-library <code
class="calibre8">enable_if</code> is a widely used mechanism for
conditonally introducing definitions. Consider defining a “smart
pointer”:</p>
<p><a href="#part0037_split_066.html#p0184_03a"
id="part0018.html#p0184_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb428"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb428-1"><a href="#cb428-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb428-2"><a href="#cb428-2" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Smart_pointer</span> <span class="kw">{</span></span>
<span id="cb428-3"><a href="#cb428-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">T</span>&amp; operator<span class="fu">*</span>()<span class="kw">;</span></span>
<span id="cb428-4"><a href="#cb428-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">T</span>&amp; operator<span class="er">−</span><span class="dt">&gt;</span>()<span class="kw">;</span>   <span class="fu">//</span> should work if and only if <span class="dt">T</span> <span class="dt">is</span> a class</span>
<span id="cb428-5"><a href="#cb428-5" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>The <code class="calibre8">−&gt;</code> should be defined if and only
if <code class="calibre8">T</code> is a class type. For example, <code
class="calibre8">Smart_pointer&lt;vector&lt;T&gt;&gt;</code> should have
<code class="calibre8">−&gt;</code>, but <code
class="calibre8">Smart_pointer&lt;int&gt;</code> should not. We cannot
use a compile-time <code class="calibre8">if</code> because we are not
inside a function. Instead, we write</p>
<p><a href="#part0037_split_067.html#p0184_04a"
id="part0018.html#p0184_04" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb429"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb429-1"><a href="#cb429-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb429-2"><a href="#cb429-2" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Smart_pointer</span> <span class="kw">{</span></span>
<span id="cb429-3"><a href="#cb429-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">T</span>&amp; operator<span class="fu">*</span>()<span class="kw">;</span></span>
<span id="cb429-4"><a href="#cb429-4" aria-hidden="true" tabindex="-1"></a>     std::enable_if<span class="dt">&lt;Is_class</span><span class="er">&lt;</span><span class="dt">T&gt;</span>()<span class="kw">,</span><span class="dt">T</span>&amp;&gt; operator<span class="er">−</span><span class="dt">&gt;</span>()<span class="kw">;</span>    <span class="fu">//</span> <span class="dt">is</span> defined if and only if <span class="dt">T</span> <span class="dt">is</span> a class</span>
<span id="cb429-5"><a href="#cb429-5" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>My type function <code class="calibre8">Is_class()</code> is defined
using the type trait <code class="calibre8">is_class</code> in just the
way I defined <code class="calibre8">is_aritmetic()</code> in §<a
href="#part0018.html#ch13lev2sec13" class="calibre6">13.9.2</a>.</p>
<p>If <code class="calibre8">Is_class&lt;T&gt;()</code> is <code
class="calibre8">true</code>, the type of <code
class="calibre8">operator−&gt;()</code> is <code
class="calibre8">T&amp;</code>; otherwise, the definition of <code
class="calibre8">operator−&gt;()</code> is ignored.</p>
<p>The syntax of <code class="calibre8">enable_if</code> is odd, awkward
to use, and will in many cases be rendered redundant by concepts (§<a
href="#part0012.html#ch07lev1sec2" class="calibre6">7.2</a>). However,
<code class="calibre8">enable_if</code> is the basis for much current
template metaprogramming and for many standard-library components. It
relies on a subtle language feature called SFINAE (“Substitution Failure
Is Not An Error”).</p>
<h3 class="h2" id="part0018.html#ch13lev1sec10"><span
id="part0018.html#page_185" class="calibre2 pagebreak"></span>13.10
Advice</h3>
<p>[1] A library doesn’t have to be large or complicated to be useful;
§<a href="#part0018.html#ch13lev1sec1" class="calibre6">13.1</a>.</p>
<p>[2] A resource is anything that has to be acquired and (explicitly or
implicitly) released; §<a href="#part0018.html#ch13lev1sec2"
class="calibre6">13.2</a>.</p>
<p>[3] Use resource handles to manage resources (RAII); §<a
href="#part0018.html#ch13lev1sec2" class="calibre6">13.2</a>; [CG:
R.1].</p>
<p>[4] Use <code class="calibre8">unique_ptr</code> to refer to objects
of polymorphic type; §<a href="#part0018.html#ch13lev2sec1"
class="calibre6">13.2.1</a>; [CG: R.20].</p>
<p>[5] Use <code class="calibre8">shared_ptr</code> to refer to shared
objects (only); §<a href="#part0018.html#ch13lev2sec1"
class="calibre6">13.2.1</a>; [CG: R.20].</p>
<p>[6] Prefer resource handles with specific semantics to smart
pointers; §<a href="#part0018.html#ch13lev2sec1"
class="calibre6">13.2.1</a>.</p>
<p>[7] Prefer <code class="calibre8">unique_ptr</code> to <code
class="calibre8">shared_ptr</code>; §<a
href="#part0010.html#ch05lev1sec3" class="calibre6">5.3</a>, §<a
href="#part0018.html#ch13lev2sec1" class="calibre6">13.2.1</a>.</p>
<p>[8] Use <code class="calibre8">make_unique()</code> to construct
<code class="calibre8">unique_ptr</code>s; §<a
href="#part0018.html#ch13lev2sec1" class="calibre6">13.2.1</a>; [CG:
R.22].</p>
<p>[9] Use <code class="calibre8">make_shared()</code> to construct
<code class="calibre8">shared_ptr</code>s; §<a
href="#part0018.html#ch13lev2sec1" class="calibre6">13.2.1</a>; [CG:
R.23].</p>
<p>[10] Prefer smart pointers to garbage collection; §<a
href="#part0010.html#ch05lev1sec3" class="calibre6">5.3</a>, §<a
href="#part0018.html#ch13lev2sec1" class="calibre6">13.2.1</a>.</p>
<p>[11] Don’t use <code class="calibre8">std::move();</code> §<a
href="#part0018.html#ch13lev2sec2" class="calibre6">13.2.2</a>; [CG:
ES.56].</p>
<p>[12] Use <code class="calibre8">std::forward()</code> exclusively for
forwarding; §<a href="#part0018.html#ch13lev2sec2"
class="calibre6">13.2.2</a>.</p>
<p>[13] Never read from an object after <code
class="calibre8">std::move()</code>ing or <code
class="calibre8">std::forward()</code>ing it; §<a
href="#part0018.html#ch13lev2sec2" class="calibre6">13.2.2</a>.</p>
<p>[14] Prefer <code class="calibre8">span</code>s to pointer-plus-count
interfaces; §<a href="#part0018.html#ch13lev1sec3"
class="calibre6">13.3</a>; [CG: F.24].</p>
<p>[15] Use <code class="calibre8">array</code> where you need a
sequence with a <code class="calibre8">constexpr</code> size; §<a
href="#part0018.html#ch13lev2sec3" class="calibre6">13.4.1</a>.</p>
<p>[16] Prefer <code class="calibre8">array</code> over built-in arrays;
§<a href="#part0018.html#ch13lev2sec3" class="calibre6">13.4.1</a>; [CG:
SL.con.2].</p>
<p>[17] Use <code class="calibre8">bitset</code> if you need <code
class="calibre8">N</code> bits and <code class="calibre8">N</code> is
not necessarily the number of bits in a built-in integer type; §<a
href="#part0018.html#ch13lev2sec4" class="calibre6">13.4.2</a>.</p>
<p>[18] Don’t overuse <code class="calibre8">pair</code> and <code
class="calibre8">tuple</code>; named <code
class="calibre8">struct</code>s often lead to more readable code; §<a
href="#part0018.html#ch13lev2sec5" class="calibre6">13.4.3</a>.</p>
<p>[19] When using <code class="calibre8">pair</code>, use template
argument deduction or <code class="calibre8">make_pair()</code> to avoid
redundant type specification; §<a href="#part0018.html#ch13lev2sec5"
class="calibre6">13.4.3</a>.</p>
<p>[20] When using <code class="calibre8">tuple</code>, use template
argument deduction and <code class="calibre8">make_tuple()</code> to
avoid redundant type specification; §<a
href="#part0018.html#ch13lev2sec5" class="calibre6">13.4.3</a>; [CG:
T.44].</p>
<p>[21] Prefer <code class="calibre8">variant</code> to explicit use of
<code class="calibre8">union</code>s; §<a
href="#part0018.html#ch13lev2sec6" class="calibre6">13.5.1</a>; [CG:
C.181].</p>
<p>[22] Use allocators to prevent memory fragmentation; §<a
href="#part0018.html#ch13lev1sec6" class="calibre6">13.6</a>.</p>
<p>[23] Time your programs before making claims about efficiency; §<a
href="#part0018.html#ch13lev1sec7" class="calibre6">13.7</a>.</p>
<p>[24] Use <code class="calibre8">duration_cast</code> to report time
measurements with proper units; §<a href="#part0018.html#ch13lev1sec7"
class="calibre6">13.7</a>.</p>
<p>[25] When specifying a <code class="calibre8">duration</code>, use
proper units; §<a href="#part0018.html#ch13lev1sec7"
class="calibre6">13.7</a>.</p>
<p>[26] Use <code class="calibre8">mem_fn()</code> or a lambda to create
function objects that can invoke a member function when called using the
traditional function call notation; §<a
href="#part0018.html#ch13lev2sec10" class="calibre6">13.8.2</a>.</p>
<p>[27] Use <code class="calibre8">function</code> when you need to
store something that can be called; §<a
href="#part0018.html#ch13lev2sec11" class="calibre6">13.8.3</a>.</p>
<p>[28] You can write code to explicitly depend on properties of types;
§<a href="#part0018.html#ch13lev1sec9" class="calibre6">13.9</a>.</p>
<p>[29] Prefer concepts over traits and <code
class="calibre8">enable_if</code> whenever you can; §<a
href="#part0018.html#ch13lev1sec9" class="calibre6">13.9</a>.</p>
<p>[30] Use aliases and type predicates to simplify notation; §<a
href="#part0018.html#ch13lev2sec12" class="calibre6">13.9.1</a>, §<a
href="#part0018.html#ch13lev2sec13" class="calibre6">13.9.2</a>.</p>
</section>
<p><span id="part0019.html"></span></p>
<section id="part0019.html#ch14" class="h1 bodymatter">
<h2 class="h1"><span id="part0019.html#page_187"
class="calibre2 pagebreak"></span><span class="big">14</span></h2>
<p>Numerics</p>
<p><em>The purpose of computing is insight, not numbers.</em></p>
<p><em>– R. W. Hamming</em></p>
<p><em>... but for the student, numbers are often the best road to
insight.</em></p>
<p><em>– A. Ralston</em></p>
<ul>
<li><p><a href="#part0019.html#ch14lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0019.html#ch14lev1sec2"
class="calibre6">Mathematical Functions</a></p></li>
<li><p><a href="#part0019.html#ch14lev1sec3" class="calibre6">Numerical
Algorithms</a></p>
<p><a href="#part0019.html#ch14lev2sec1" class="calibre6">Parallel
Numerical Algorithms</a></p></li>
<li><p><a href="#part0019.html#ch14lev1sec4" class="calibre6">Complex
Numbers</a></p></li>
<li><p><a href="#part0019.html#ch14lev1sec5" class="calibre6">Random
Numbers</a></p></li>
<li><p><a href="#part0019.html#ch14lev1sec6" class="calibre6">Vector
Arithmetic</a></p></li>
<li><p><a href="#part0019.html#ch14lev1sec7" class="calibre6">Numeric
Limits</a></p></li>
<li><p><a href="#part0019.html#ch14lev1sec8"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0019.html#ch14lev1sec1">14.1 Introduction</h3>
<p>C++ was not designed primarily with numeric computation in mind.
However, numeric computation typically occurs in the context of other
work – such as database access, networking, instrument control,
graphics, simulation, and financial analysis – so C++ becomes an
attractive vehicle for computations that are part of a larger system.
Furthermore, numeric methods have come a long way from being simple
loops over vectors of floating-point numbers. Where more complex data
structures are needed as part of a computation, C++’s strengths become
relevant. The net effect is that C++ is widely used for scientific,
engineering, financial, and other computation involving sophisticated
numerics. Consequently, facilities and techniques supporting such
computation have emerged. This chapter describes the parts of the
standard library that support numerics.</p>
<h3 class="h2" id="part0019.html#ch14lev1sec2"><span
id="part0019.html#page_188" class="calibre2 pagebreak"></span>14.2
Mathematical Functions</h3>
<p>In <code class="calibre8">&lt;cmath&gt;</code>, we find the
<em>standard mathematical functions</em>, such as <code
class="calibre8">sqrt()</code>, <code class="calibre8">log()</code>, and
<code class="calibre8">sin()</code> for arguments of type <code
class="calibre8">float</code>, <code class="calibre8">double</code>, and
<code class="calibre8">long double</code>:</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>Standard Mathematical
Functions</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">abs(x)</code></p></td>
<td class="calibre14"><p>Absolute value</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">ceil(x)</code></p></td>
<td class="calibre14"><p>Smallest integer &gt;= <code
class="calibre8">x</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">floor(x)</code></p></td>
<td class="calibre14"><p>Largest integer &lt;= <code
class="calibre8">x</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">sqrt(x)</code></p></td>
<td class="calibre14"><p>Square root; <code class="calibre8">x</code>
must be non-negative</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">cos(x)</code></p></td>
<td class="calibre14"><p>Cosine</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">sin(x)</code></p></td>
<td class="calibre14"><p>Sine</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">tan(x)</code></p></td>
<td class="calibre14"><p>Tangent</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">acos(x)</code></p></td>
<td class="calibre14"><p>Arccosine; the result is non-negative</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">asin(x)</code></p></td>
<td class="calibre14"><p>Arcsine; the result nearest to 0 is
returned</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">atan(x)</code></p></td>
<td class="calibre14"><p>Arctangent</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">sinh(x)</code></p></td>
<td class="calibre14"><p>Hyperbolic sine</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">cosh(x)</code></p></td>
<td class="calibre14"><p>Hyperbolic cosine</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">tanh(x)</code></p></td>
<td class="calibre14"><p>Hyperbolic tangent</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">exp(x)</code></p></td>
<td class="calibre14"><p>Base e exponential</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code class="calibre8">log(x)</code></p></td>
<td class="calibre14"><p>Natural logarithm, base e; <code
class="calibre8">x</code> must be positive</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code class="calibre8">log10(x)</code></p></td>
<td class="calibre14"><p>Base 10 logarithm</p></td>
</tr>
</tbody>
</table>
<p>The versions for <code class="calibre8">complex</code> (§<a
href="#part0019.html#ch14lev1sec4" class="calibre6">14.4</a>) are found
in <code class="calibre8">&lt;complex&gt;</code>. For each function, the
return type is the same as the argument type.</p>
<p>Errors are reported by setting <code class="calibre8">errno</code>
from <code class="calibre8">&lt;cerrno&gt;</code> to <code
class="calibre8">EDOM</code> for a domain error and to <code
class="calibre8">ERANGE</code> for a range error. For example:</p>
<p><a href="#part0038_split_000.html#p0188_01a"
id="part0019.html#p0188_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb430"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb430-1"><a href="#cb430-1" aria-hidden="true" tabindex="-1"></a>void f()</span>
<span id="cb430-2"><a href="#cb430-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb430-3"><a href="#cb430-3" aria-hidden="true" tabindex="-1"></a>     errno <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span> <span class="fu">//</span> clear old error state</span>
<span id="cb430-4"><a href="#cb430-4" aria-hidden="true" tabindex="-1"></a>     sqrt(<span class="er">−</span><span class="dv">1</span>)<span class="kw">;</span></span>
<span id="cb430-5"><a href="#cb430-5" aria-hidden="true" tabindex="-1"></a>     if (errno<span class="fu">==</span><span class="dt">EDOM</span>)</span>
<span id="cb430-6"><a href="#cb430-6" aria-hidden="true" tabindex="-1"></a>           cerr <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">sqrt</span><span class="ot">()</span><span class="er"> not defined for negative argument</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb430-7"><a href="#cb430-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-8"><a href="#cb430-8" aria-hidden="true" tabindex="-1"></a>     errno <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span> <span class="fu">//</span> clear old error state</span>
<span id="cb430-9"><a href="#cb430-9" aria-hidden="true" tabindex="-1"></a>     pow(numeric_limits<span class="dt">&lt;</span>double&gt;::<span class="dt">max</span>()<span class="kw">,</span><span class="dv">2</span>)<span class="kw">;</span></span>
<span id="cb430-10"><a href="#cb430-10" aria-hidden="true" tabindex="-1"></a>     if (errno <span class="fu">==</span> <span class="dt">ERANGE</span>)</span>
<span id="cb430-11"><a href="#cb430-11" aria-hidden="true" tabindex="-1"></a>           cerr <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">result of pow</span><span class="ot">()</span><span class="er"> too large to represent as a double</span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb430-12"><a href="#cb430-12" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>A few more mathematical functions are found in <code
class="calibre8">&lt;cstdlib&gt;</code> and the so-called <em>special
mathematical functions</em>, such as <code
class="calibre8">beta()</code>, <code
class="calibre8">rieman_zeta()</code>, and <code
class="calibre8">sph_bessel()</code>, are also in <code
class="calibre8">&lt;cmath&gt;</code>.</p>
<h3 class="h2" id="part0019.html#ch14lev1sec3"><span
id="part0019.html#page_189" class="calibre2 pagebreak"></span>14.3
Numerical Algorithms</h3>
<p>In <code class="calibre8">&lt;numeric&gt;</code>, we find a small set
of generalized numerical algorithms, such as <code
class="calibre8">accumulate()</code>.</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>Numerical
Algorithms</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">x=accumulate(b,e,i)</code></p></td>
<td class="calibre14"><p><code class="calibre8">x</code> is the sum of
<code class="calibre8">i</code> and the elements of [<code
class="calibre8">b</code>:<code class="calibre8">e</code>)</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">x=accumulate(b,e,i,f)</code></p></td>
<td class="calibre14"><p><code class="calibre8">accumulate</code> using
<code class="calibre8">f</code> instead of <code
class="calibre8">+</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">x=inner_product(b,e,b2,i)</code></p></td>
<td class="calibre14"><p><code class="calibre8">x</code> is the inner
product of [<code class="calibre8">b</code>:<code
class="calibre8">e</code>) and [<code class="calibre8">b2</code>:<code
class="calibre8">b2+(e−b)</code>), that is, the sum of <code
class="calibre8">i</code> and <code class="calibre8">(*p1)*(*p2)</code>
for each <code class="calibre8">p1</code> in [<code
class="calibre8">b</code>:<code class="calibre8">e</code>) and the
corresponding <code class="calibre8">p2</code> in [<code
class="calibre8">b2</code>:<code
class="calibre8">b2+(e−b)</code>)</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">x=inner_product(b,e,b2,i,f,f2)</code></p></td>
<td class="calibre14"><p><code class="calibre8">inner_product</code>
using <code class="calibre8">f</code> and <code
class="calibre8">f2</code> instead of <code class="calibre8">+</code>
and <code class="calibre8">*</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p=partial_sum(b,e,out)</code></p></td>
<td class="calibre14"><p>Element <code class="calibre8">i</code> of
[<code class="calibre8">out</code>:<code class="calibre8">p</code>) is
the sum of elements [<code class="calibre8">b</code>:<code
class="calibre8">b+i</code>]</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">p=partial_sum(b,e,out,f)</code></p></td>
<td class="calibre14"><p><code class="calibre8">partial_sum</code> using
<code class="calibre8">f</code> instead of <code
class="calibre8">+</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p=adjacent_difference(b,e,out)</code></p></td>
<td class="calibre14"><p>Element <code class="calibre8">i</code> of
[<code class="calibre8">out</code>:<code class="calibre8">p</code>)is
<code class="calibre8">*(b+i)−*(b+i−1)</code> for <code
class="calibre8">i&gt;0</code>; if <code
class="calibre8">e−b&gt;0</code>, then <code
class="calibre8">*out</code> is <code
class="calibre8">*b</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">p=adjacent_difference(b,e,out,f)</code></p></td>
<td class="calibre14"><p><code
class="calibre8">adjacent_difference</code> using <code
class="calibre8">f</code> instead of <code
class="calibre8">−</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">iota(b,e,v)</code></p></td>
<td class="calibre14"><p>For each element in [<code
class="calibre8">b</code>:<code class="calibre8">e</code>) assign <code
class="calibre8">++v</code>; thus the sequence becomes <code
class="calibre8">v+1</code>, <code class="calibre8">v+2</code>,
...</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">x=gcd(n,m)</code></p></td>
<td class="calibre14"><p><code class="calibre8">x</code> is the greatest
common denominator of integers <code class="calibre8">n</code> and <code
class="calibre8">m</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">x=lcm(n,m)</code></p></td>
<td class="calibre14"><p><code class="calibre8">x</code> is the least
common multiple of integers <code class="calibre8">n</code> and <code
class="calibre8">m</code></p></td>
</tr>
</tbody>
</table>
<p>These algorithms generalize common operations such as computing a sum
by letting them apply to all kinds of sequences. They also make the
operation applied to elements of those sequences a parameter. For each
algorithm, the general version is supplemented by a version applying the
most common operator for that algorithm. For example:</p>
<p><a href="#part0038_split_001.html#p0189_01a"
id="part0019.html#p0189_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb431"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb431-1"><a href="#cb431-1" aria-hidden="true" tabindex="-1"></a>list<span class="dt">&lt;</span>double<span class="er">&gt;</span> lst <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span> <span class="dv">2</span><span class="kw">,</span> <span class="dv">3</span><span class="kw">,</span> <span class="dv">4</span><span class="kw">,</span> <span class="dv">5</span><span class="kw">,</span> <span class="fl">9999.99999</span><span class="kw">};</span></span>
<span id="cb431-2"><a href="#cb431-2" aria-hidden="true" tabindex="-1"></a>auto s <span class="kw">=</span> accumulate(lst<span class="al">.</span>begin()<span class="kw">,</span>lst<span class="al">.</span>end()<span class="kw">,</span><span class="fl">0.0</span>)<span class="kw">;</span>     <span class="fu">//</span> calculate the sum<span class="fu">:</span> <span class="fl">10014.9999</span></span></code></pre></div>
<p>These algorithms work for every standard-library sequence and can
have operations supplied as arguments (§<a
href="#part0019.html#ch14lev1sec3" class="calibre6">14.3</a>).</p>
<h4 class="h3" id="part0019.html#ch14lev2sec1">14.3.1 Parallel
Algorithms</h4>
<p>In <code class="calibre8">&lt;numeric&gt;</code>, the numerical
algorithms have parallel versions (§<a
href="#part0017.html#ch12lev1sec9" class="calibre6">12.9</a>) that are
slightly different:</p>
<table class="all">
<thead class="calibre12">
<tr class="header calibre13">
<th colspan="2" class="calibre14"><p><strong>Parallel Numerical
Algorithms</strong></p></th>
</tr>
</thead>
<tbody class="calibre15">
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">x=reduce(b,e,v)</code></p></td>
<td class="calibre14"><p><code
class="calibre8">x=accumulate(b,e,v)</code>, except out of
order</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">x=reduce(b,e)</code></p></td>
<td class="calibre14"><p><code
class="calibre8">x=reduce(b,e,V{})</code>, where <code
class="calibre8">V</code> is <code class="calibre8">b</code>’s value
type</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">x=reduce(pol,b,e,v)</code></p></td>
<td class="calibre14"><p><code class="calibre8">x=reduce(b,e,v)</code>
with execution policy <code class="calibre8">pol</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">x=reduce(pol,b,e)</code></p></td>
<td class="calibre14"><p><code
class="calibre8">x=reduce(pol,b,e,V{})</code>, where <code
class="calibre8">V</code> is <code class="calibre8">b</code>’s value
type</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p=exclusive_scan(pol,b,e,out)</code></p></td>
<td class="calibre14"><p><code
class="calibre8">p=partial_sum(b,e,out)</code> according to <code
class="calibre8">pol</code>, excludes the ith input element from the ith
sum</p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">p=inclusive_scan(pol,b,e,out)</code></p></td>
<td class="calibre14"><p><code
class="calibre8">p=partial_sum(b,e,out)</code> according to <code
class="calibre8">pol</code> includes the ith input element in the ith
sum</p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p=transform_reduce(pol,b,e,f,v)</code></p></td>
<td class="calibre14"><p><code class="calibre8">f(x)</code> for each
<code class="calibre8">x</code> in [<code
class="calibre8">b</code>:<code class="calibre8">e</code>), then <code
class="calibre8">reduce</code></p></td>
</tr>
<tr class="even calibre13">
<td class="calibre14"><p><code
class="calibre8">p=transform_exclusive_scan(pol,b,e,out,f,v)</code></p></td>
<td class="calibre14"><p><code class="calibre8">f(x)</code> for each
<code class="calibre8">x</code> in [<code
class="calibre8">b</code>:<code class="calibre8">e</code>), then <code
class="calibre8">exclusive_scan</code></p></td>
</tr>
<tr class="odd calibre13">
<td class="calibre14"><p><code
class="calibre8">p=transform_inclusive_scan(pol,b,e,out,f,v)</code></p></td>
<td class="calibre14"><p><code class="calibre8">f(x)</code> for each
<code class="calibre8">x</code> in [<code
class="calibre8">b</code>:<code class="calibre8">e</code>), then <code
class="calibre8">inclusive_scan</code></p></td>
</tr>
</tbody>
</table>
<p><span id="part0019.html#page_190" class="pagebreak"></span>For
simplicity, I left out the versions of these algorithms that take
functor arguments, rather than just using <code
class="calibre8">+</code> and <code class="calibre8">=</code>. Except
for <code class="calibre8">reduce()</code>, I also left out the versions
with default policy (sequential) and default value.</p>
<p>Just as for the parallel algorithms in <code
class="calibre8">&lt;algorithm&gt;</code> (§<a
href="#part0017.html#ch12lev1sec9" class="calibre6">12.9</a>), we can
specify an execution policy:</p>
<p><a href="#part0038_split_002.html#p0190_01a"
id="part0019.html#p0190_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb432"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb432-1"><a href="#cb432-1" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>double<span class="er">&gt;</span> v <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span> <span class="dv">2</span><span class="kw">,</span> <span class="dv">3</span><span class="kw">,</span> <span class="dv">4</span><span class="kw">,</span> <span class="dv">5</span><span class="kw">,</span> <span class="fl">9999.99999</span><span class="kw">};</span></span>
<span id="cb432-2"><a href="#cb432-2" aria-hidden="true" tabindex="-1"></a>auto s <span class="kw">=</span> reduce(v<span class="al">.</span>begin()<span class="kw">,</span>v<span class="al">.</span>end())<span class="kw">;</span>      <span class="fu">//</span> calculate the sum using a double as the accumulator</span>
<span id="cb432-3"><a href="#cb432-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-4"><a href="#cb432-4" aria-hidden="true" tabindex="-1"></a>vector<span class="dt">&lt;</span>double<span class="er">&gt;</span> large<span class="kw">;</span></span>
<span id="cb432-5"><a href="#cb432-5" aria-hidden="true" tabindex="-1"></a><span class="fu">//</span> ... fill large with lots of values ...</span>
<span id="cb432-6"><a href="#cb432-6" aria-hidden="true" tabindex="-1"></a>auto s2 <span class="kw">=</span> reduce(par_unseq<span class="kw">,</span>large<span class="al">.</span>begin()<span class="kw">,</span>large<span class="al">.</span>end())<span class="kw">;</span> <span class="fu">//</span> calculate the sum using available parallelism</span></code></pre></div>
<p>The parallel algorithms (e.g., <code
class="calibre8">reduce()</code>) differ from the sequentional ones
(e.g., <code class="calibre8">accumulate()</code>) by allowing
operations on elements in unspecified order.</p>
<h3 class="h2" id="part0019.html#ch14lev1sec4">14.4 Complex Numbers</h3>
<p>The standard library supports a family of complex number types along
the lines of the <code class="calibre8">complex</code> class described
in §<a href="#part0009.html#ch04lev2sec1" class="calibre6">4.2.1</a>. To
support complex numbers where the scalars are single-precision
floating-point numbers (<code class="calibre8">float</code>s),
double-precision floating-point numbers (<code
class="calibre8">double</code>s), etc., the standard library <code
class="calibre8">complex</code> is a template:</p>
<p><a href="#part0038_split_003.html#p0190_02a"
id="part0019.html#p0190_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb433"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb433-1"><a href="#cb433-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">Scalar</span><span class="er">&gt;</span></span>
<span id="cb433-2"><a href="#cb433-2" aria-hidden="true" tabindex="-1"></a>class complex <span class="kw">{</span></span>
<span id="cb433-3"><a href="#cb433-3" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb433-4"><a href="#cb433-4" aria-hidden="true" tabindex="-1"></a>     complex(const <span class="dt">Scalar</span>&amp; re <span class="kw">={},</span> const <span class="dt">Scalar</span>&amp; im <span class="kw">={}</span>)<span class="kw">;</span>   <span class="fu">//</span> default function arguments<span class="kw">;</span> see <span class="er">§</span><span class="fl">3.6</span>.<span class="dv">1</span></span>
<span id="cb433-5"><a href="#cb433-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb433-6"><a href="#cb433-6" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>The usual arithmetic operations and the most common mathematical
functions are supported for complex numbers. For example:</p>
<p><a href="#part0038_split_004.html#p0190_03a"
id="part0019.html#p0190_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb434"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb434-1"><a href="#cb434-1" aria-hidden="true" tabindex="-1"></a>void f(complex<span class="dt">&lt;</span><span class="fl">float</span><span class="er">&gt;</span> fl<span class="kw">,</span> complex<span class="dt">&lt;</span>double<span class="er">&gt;</span> db)</span>
<span id="cb434-2"><a href="#cb434-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb434-3"><a href="#cb434-3" aria-hidden="true" tabindex="-1"></a>     complex<span class="dt">&lt;</span>long double<span class="er">&gt;</span> ld <span class="kw">{</span>fl<span class="fu">+</span>sqrt(db)<span class="kw">};</span></span>
<span id="cb434-4"><a href="#cb434-4" aria-hidden="true" tabindex="-1"></a>     db += fl<span class="fu">*</span><span class="dv">3</span><span class="kw">;</span></span>
<span id="cb434-5"><a href="#cb434-5" aria-hidden="true" tabindex="-1"></a>     fl <span class="kw">=</span> pow(<span class="dv">1</span><span class="fu">/</span>fl<span class="kw">,</span><span class="dv">2</span>)<span class="kw">;</span></span>
<span id="cb434-6"><a href="#cb434-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb434-7"><a href="#cb434-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The <code class="calibre8">sqrt()</code> and <code
class="calibre8">pow()</code> (exponentiation) functions are among the
usual mathematical functions defined in <code
class="calibre8">&lt;complex&gt;</code> (§<a
href="#part0019.html#ch14lev1sec2" class="calibre6">14.2</a>).</p>
<h3 class="h2" id="part0019.html#ch14lev1sec5"><span
id="part0019.html#page_191" class="calibre2 pagebreak"></span>14.5
Random Numbers</h3>
<p>Random numbers are useful in many contexts, such as testing, games,
simulation, and security. The diversity of application areas is
reflected in the wide selection of random number generators provided by
the standard library in <code class="calibre8">&lt;random&gt;</code>. A
random number generator consists of two parts:</p>
<p>[1] An <em>engine</em> that produces a sequence of random or
pseudo-random values</p>
<p>[2] A <em>distribution</em> that maps those values into a
mathematical distribution in a range</p>
<p>Examples of distributions are <code
class="calibre8">uniform_int_distribution</code> (where all integers
produced are equally likely), <code
class="calibre8">normal_distribution</code> (“the bell curve”), and
<code class="calibre8">exponential_distribution</code> (exponential
growth); each for some specified range. For example:</p>
<p><a href="#part0038_split_005.html#p0191_01a"
id="part0019.html#p0191_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb435"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb435-1"><a href="#cb435-1" aria-hidden="true" tabindex="-1"></a>using my_engine <span class="kw">=</span> default_random_engine<span class="kw">;</span>              <span class="fu">//</span> type of engine</span>
<span id="cb435-2"><a href="#cb435-2" aria-hidden="true" tabindex="-1"></a>using my_distribution <span class="kw">=</span> uniform_int_distribution&lt;&gt;<span class="kw">;</span>   <span class="fu">//</span> type of distribution</span>
<span id="cb435-3"><a href="#cb435-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-4"><a href="#cb435-4" aria-hidden="true" tabindex="-1"></a>my_engine re <span class="kw">{};</span>                                      <span class="fu">//</span> the default engine</span>
<span id="cb435-5"><a href="#cb435-5" aria-hidden="true" tabindex="-1"></a>my_distribution one_to_six <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">6</span><span class="kw">};</span>                     <span class="fu">//</span> distribution that maps to the ints <span class="dv">1</span>..<span class="dv">6</span></span>
<span id="cb435-6"><a href="#cb435-6" aria-hidden="true" tabindex="-1"></a>auto die <span class="kw">=</span> []()<span class="kw">{</span> return one_to_six(re)<span class="kw">;</span> <span class="kw">}</span>             <span class="fu">//</span> make a generator</span>
<span id="cb435-7"><a href="#cb435-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-8"><a href="#cb435-8" aria-hidden="true" tabindex="-1"></a>int x <span class="kw">=</span> die()<span class="kw">;</span>                                        <span class="fu">//</span> roll the die<span class="fu">:</span> x becomes a value in [<span class="dv">1</span><span class="fu">:</span><span class="dv">6</span>]</span></code></pre></div>
<p>Thanks to its uncompromising attention to generality and performance,
one expert has deemed the standard-library random number component “what
every random number library wants to be when it grows up.” However, it
can hardly be deemed “novice friendly.” The <code
class="calibre8">using</code> statements and the lambda make what is
being done a bit more obvious.</p>
<p>For novices (of any background) the fully general interface to the
random number library can be a serious obstacle. A simple uniform random
number generator is often sufficient to get started. For example:</p>
<p><a href="#part0038_split_006.html#p0191_02a"
id="part0019.html#p0191_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb436"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb436-1"><a href="#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="dt">Rand_int</span> rnd <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">10</span><span class="kw">};</span>    <span class="fu">//</span> make a random <span class="dt">number</span> generator for [<span class="dv">1</span><span class="fu">:</span><span class="dv">10</span>]</span>
<span id="cb436-2"><a href="#cb436-2" aria-hidden="true" tabindex="-1"></a>int x <span class="kw">=</span> rnd()<span class="kw">;</span>          <span class="fu">//</span> x <span class="dt">is</span> a number in <span class="er">[</span><span class="dv">1</span><span class="fu">:</span><span class="dv">10</span><span class="er">]</span></span></code></pre></div>
<p>So, how could we get that? We have to get something that, like <code
class="calibre8">die()</code>, combines an engine with a distribution
inside a class <code class="calibre8">Rand_int</code>:</p>
<p><a href="#part0038_split_007.html#p0191_03a"
id="part0019.html#p0191_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb437"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb437-1"><a href="#cb437-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Rand_int</span> <span class="kw">{</span></span>
<span id="cb437-2"><a href="#cb437-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb437-3"><a href="#cb437-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Rand_int</span>(int low<span class="kw">,</span> int high) <span class="fu">:</span>dist<span class="kw">{</span>low<span class="kw">,</span>high<span class="kw">}</span> <span class="kw">{</span> <span class="kw">}</span></span>
<span id="cb437-4"><a href="#cb437-4" aria-hidden="true" tabindex="-1"></a>     int operator()() <span class="kw">{</span> return dist(re)<span class="kw">;</span> <span class="kw">}</span>     <span class="fu">//</span> draw an int</span>
<span id="cb437-5"><a href="#cb437-5" aria-hidden="true" tabindex="-1"></a>     void seed(int s) <span class="kw">{</span> re.seed(s)<span class="kw">;</span> <span class="kw">}</span>          <span class="fu">//</span> choose new random engine seed</span>
<span id="cb437-6"><a href="#cb437-6" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb437-7"><a href="#cb437-7" aria-hidden="true" tabindex="-1"></a>     default_random_engine re<span class="kw">;</span></span>
<span id="cb437-8"><a href="#cb437-8" aria-hidden="true" tabindex="-1"></a>     uniform_int_distribution&lt;&gt; dist<span class="kw">;</span></span>
<span id="cb437-9"><a href="#cb437-9" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>That definition is still “expert level,” but the <em>use</em> of
<code class="calibre8">Rand_int()</code> is manageable in the first week
of a C++ course for novices. For example:</p>
<p><a href="#part0038_split_008.html#p0192_01a"
id="part0019.html#p0192_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb438"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb438-1"><a href="#cb438-1" aria-hidden="true" tabindex="-1"></a>int main()</span>
<span id="cb438-2"><a href="#cb438-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb438-3"><a href="#cb438-3" aria-hidden="true" tabindex="-1"></a>     constexprint max <span class="kw">=</span> <span class="dv">9</span><span class="kw">;</span></span>
<span id="cb438-4"><a href="#cb438-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">Rand_int</span> rnd <span class="kw">{</span><span class="dv">0</span><span class="kw">,</span>max<span class="kw">};</span>                         <span class="fu">//</span> make a uniform random <span class="dt">number</span> generator</span>
<span id="cb438-5"><a href="#cb438-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-6"><a href="#cb438-6" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>int<span class="er">&gt;</span> histogram(max<span class="fu">+</span><span class="dv">1</span>)<span class="kw">;</span>                 <span class="fu">//</span> make a vector of appropriate size</span>
<span id="cb438-7"><a href="#cb438-7" aria-hidden="true" tabindex="-1"></a>     for (int i<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span><span class="dv">200</span><span class="kw">;</span> ++i)</span>
<span id="cb438-8"><a href="#cb438-8" aria-hidden="true" tabindex="-1"></a>           ++histogram[rnd()]<span class="kw">;</span>                     <span class="fu">//</span> fill histogram with the frequencies of numbers [<span class="dv">0</span><span class="fu">:</span>max]</span>
<span id="cb438-9"><a href="#cb438-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-10"><a href="#cb438-10" aria-hidden="true" tabindex="-1"></a>     for (int i <span class="kw">=</span> <span class="dv">0</span><span class="kw">;</span> i<span class="kw">!=</span>histogram<span class="al">.</span>size()<span class="kw">;</span> ++i) <span class="kw">{</span>   <span class="fu">//</span> <span class="fu">write</span> out a bar graph</span>
<span id="cb438-11"><a href="#cb438-11" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> i <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb438-12"><a href="#cb438-12" aria-hidden="true" tabindex="-1"></a>           for (int j<span class="kw">=</span><span class="dv">0</span><span class="kw">;</span> j<span class="kw">!=</span>histogram[i]<span class="kw">;</span> ++j) cout <span class="al">&lt;&lt;</span> <span class="st">&#39;*&#39;</span><span class="kw">;</span></span>
<span id="cb438-13"><a href="#cb438-13" aria-hidden="true" tabindex="-1"></a>           cout <span class="al">&lt;&lt;</span> endl<span class="kw">;</span></span>
<span id="cb438-14"><a href="#cb438-14" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb438-15"><a href="#cb438-15" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The output is a (reassuringly boring) uniform distribution (with
reasonable statistical variation):</p>
<p><a href="#part0038_split_009.html#p0192_02a"
id="part0019.html#p0192_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb439"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb439-1"><a href="#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   *********************</span>
<span id="cb439-2"><a href="#cb439-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   ****************</span>
<span id="cb439-3"><a href="#cb439-3" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   *******************</span>
<span id="cb439-4"><a href="#cb439-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   ********************</span>
<span id="cb439-5"><a href="#cb439-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   ****************</span>
<span id="cb439-6"><a href="#cb439-6" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   ***********************</span>
<span id="cb439-7"><a href="#cb439-7" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>   **************************</span>
<span id="cb439-8"><a href="#cb439-8" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>   ***********</span>
<span id="cb439-9"><a href="#cb439-9" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>   **********************</span>
<span id="cb439-10"><a href="#cb439-10" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>   *************************</span></code></pre></div>
<p>There is no standard graphics library for C++, so I use “ASCII
graphics.” Obviously, there are lots of open source and commercial
graphics and GUI libraries for C++, but in this book I restrict myself
to ISO standard facilities.</p>
<h3 class="h2" id="part0019.html#ch14lev1sec6">14.6 Vector
Arithmetic</h3>
<p>The <code class="calibre8">vector</code> described in §<a
href="#part0016.html#ch11lev1sec2" class="calibre6">11.2</a> was
designed to be a general mechanism for holding values, to be flexible,
and to fit into the architecture of containers, iterators, and
algorithms. However, it does not support mathematical vector operations.
Adding such operations to <code class="calibre8">vector</code> would be
easy, but its generality and flexibility preclude optimizations that are
often considered essential for serious numerical work. Consequently, the
standard library provides (in <code
class="calibre8">&lt;valarray&gt;</code>) a <code
class="calibre8">vector</code>-like template, called <code
class="calibre8">valarray</code>, that is less general and more amenable
to optimization for numerical computation:</p>
<p><a href="#part0038_split_010.html#p0192_03a"
id="part0019.html#p0192_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb440"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb440-1"><a href="#cb440-1" aria-hidden="true" tabindex="-1"></a>template<span class="dt">&lt;</span>typename <span class="dt">T</span><span class="er">&gt;</span></span>
<span id="cb440-2"><a href="#cb440-2" aria-hidden="true" tabindex="-1"></a>class valarray <span class="kw">{</span></span>
<span id="cb440-3"><a href="#cb440-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb440-4"><a href="#cb440-4" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>The usual arithmetic operations and the most common mathematical
functions are supported for <code class="calibre8">valarray</code>s. For
example:</p>
<p><a href="#part0038_split_011.html#p0193_01a"
id="part0019.html#p0193_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb441"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb441-1"><a href="#cb441-1" aria-hidden="true" tabindex="-1"></a>void f(valarray<span class="dt">&lt;</span>double&gt;&amp; a1<span class="kw">,</span> valarray<span class="dt">&lt;</span>double&gt;&amp; a2)</span>
<span id="cb441-2"><a href="#cb441-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb441-3"><a href="#cb441-3" aria-hidden="true" tabindex="-1"></a>     valarray<span class="dt">&lt;</span>double<span class="er">&gt;</span> a <span class="kw">=</span> a1<span class="fu">*</span><span class="fl">3.14</span><span class="fu">+</span>a2<span class="fu">/</span>a1<span class="kw">;</span>       <span class="fu">//</span> numeric array operators <span class="fu">*</span><span class="kw">,</span> <span class="fu">+</span><span class="kw">,</span> <span class="fu">/</span><span class="kw">,</span> and <span class="kw">=</span></span>
<span id="cb441-4"><a href="#cb441-4" aria-hidden="true" tabindex="-1"></a>     a2 += a1<span class="fu">*</span><span class="fl">3.14</span><span class="kw">;</span></span>
<span id="cb441-5"><a href="#cb441-5" aria-hidden="true" tabindex="-1"></a>     a <span class="kw">=</span> abs(a)<span class="kw">;</span></span>
<span id="cb441-6"><a href="#cb441-6" aria-hidden="true" tabindex="-1"></a>     double d <span class="kw">=</span> a2[<span class="dv">7</span>]<span class="kw">;</span></span>
<span id="cb441-7"><a href="#cb441-7" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb441-8"><a href="#cb441-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>In additions to arithmetic operations, <code
class="calibre8">valarray</code> offers stride access to help implement
multidimensional computations.</p>
<h3 class="h2" id="part0019.html#ch14lev1sec7">14.7 Numeric Limits</h3>
<p>In <code class="calibre8">&lt;limits&gt;</code>, the standard library
provides classes that describe the properties of built-in types – such
as the maximum exponent of a <code class="calibre8">float</code> or the
number of bytes in an <code class="calibre8">int</code>; see §<a
href="#part0019.html#ch14lev1sec7" class="calibre6">14.7</a>. For
example, we can assert that a <code class="calibre8">char</code> is
signed:</p>
<p><a href="#part0038_split_012.html#p0193_02a"
id="part0019.html#p0193_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb442"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb442-1"><a href="#cb442-1" aria-hidden="true" tabindex="-1"></a>static_assert(numeric_limits<span class="dt">&lt;</span>char&gt;::is_signed<span class="kw">,</span><span class="ot">&quot;</span><span class="er">unsigned characters</span><span class="ot">!&quot;</span>)<span class="kw">;</span></span>
<span id="cb442-2"><a href="#cb442-2" aria-hidden="true" tabindex="-1"></a>static_assert(<span class="dv">100000</span><span class="dt">&lt;</span>numeric_limits<span class="er">&lt;</span>int&gt;::max()<span class="kw">,</span><span class="ot">&quot;</span><span class="er">small ints</span><span class="ot">!&quot;</span>)<span class="kw">;</span></span></code></pre></div>
<p>Note that the second assert (only) works because <code
class="calibre8">numeric_limits&lt;int&gt;::max()</code> is a <code
class="calibre8">constexpr</code> function (§<a
href="#part0006.html#ch01lev1sec6" class="calibre6">1.6</a>).</p>
<h3 class="h2" id="part0019.html#ch14lev1sec8">14.8 Advice</h3>
<p>[1] Numerical problems are often subtle. If you are not 100% certain
about the mathematical aspects of a numerical problem, either take
expert advice, experiment, or do both; §<a
href="#part0019.html#ch14lev1sec1" class="calibre6">14.1</a>.</p>
<p>[2] Don’t try to do serious numeric computation using only the bare
language; use libraries; §<a href="#part0019.html#ch14lev1sec1"
class="calibre6">14.1</a>.</p>
<p>[3] Consider <code class="calibre8">accumulate()</code>, <code
class="calibre8">inner_product()</code>, <code
class="calibre8">partial_sum()</code>, and <code
class="calibre8">adjacent_difference()</code> before you write a loop to
compute a value from a sequence; §<a href="#part0019.html#ch14lev1sec3"
class="calibre6">14.3</a>.</p>
<p>[4] Use <code class="calibre8">std::complex</code> for complex
arithmetic; §<a href="#part0019.html#ch14lev1sec4"
class="calibre6">14.4</a>.</p>
<p>[5] Bind an engine to a distribution to get a random number
generator; §<a href="#part0019.html#ch14lev1sec5"
class="calibre6">14.5</a>.</p>
<p>[6] Be careful that your random numbers are sufficiently random; §<a
href="#part0019.html#ch14lev1sec5" class="calibre6">14.5</a>.</p>
<p>[7] Don’t use the C standard-library <code
class="calibre8">rand()</code>; it isn’t insufficiently random for real
uses; §<a href="#part0019.html#ch14lev1sec5"
class="calibre6">14.5</a>.</p>
<p>[8] Use <code class="calibre8">valarray</code> for numeric
computation when run-time efficiency is more important than flexibility
with respect to operations and element types; §<a
href="#part0019.html#ch14lev1sec6" class="calibre6">14.6</a>.</p>
<p>[9] Properties of numeric types are accessible through <code
class="calibre8">numeric_limits</code>; §<a
href="#part0019.html#ch14lev1sec7" class="calibre6">14.7</a>.</p>
<p>[10] Use <code class="calibre8">numeric_limits</code> to check that
the numeric types are adequate for their use; §<a
href="#part0019.html#ch14lev1sec7" class="calibre6">14.7</a>.</p>
</section>
<p><span id="part0020.html"></span></p>
<section id="part0020.html#ch15" class="h1 bodymatter">
<h2 class="h1"><span id="part0020.html#page_195"
class="calibre2 pagebreak"></span><span class="big">15</span></h2>
<p>Concurrency</p>
<p><em>Keep it simple: as simple as possible, but no simpler.</em></p>
<p><em>– A. Einstein</em></p>
<ul>
<li><p><a href="#part0020.html#ch15lev1sec1"
class="calibre6">Introduction</a></p></li>
<li><p><a href="#part0020.html#ch15lev1sec2" class="calibre6">Tasks and
<code class="calibre8">thread</code>s</a></p></li>
<li><p><a href="#part0020.html#ch15lev1sec3" class="calibre6">Passing
Arguments</a></p></li>
<li><p><a href="#part0020.html#ch15lev1sec4" class="calibre6">Returning
Results</a></p></li>
<li><p><a href="#part0020.html#ch15lev1sec5" class="calibre6">Sharing
Data</a></p></li>
<li><p><a href="#part0020.html#ch15lev1sec6" class="calibre6">Waiting
for Events</a></p></li>
<li><p><a href="#part0020.html#ch15lev1sec7"
class="calibre6">Communicating Tasks</a></p>
<p><a href="#part0020.html#ch15lev2sec1" class="calibre6"><code
class="calibre8">future</code> and <code
class="calibre8">promise</code></a>; <a
href="#part0020.html#ch15lev2sec2" class="calibre6"><code
class="calibre8">packaged_task</code></a>; <a
href="#part0020.html#ch15lev2sec3" class="calibre6"><code
class="calibre8">async()</code></a></p></li>
<li><p><a href="#part0020.html#ch15lev1sec8"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0020.html#ch15lev1sec1">15.1 Introduction</h3>
<p>Concurrency – the execution of several tasks simultaneously – is
widely used to improve throughput (by using several processors for a
single computation) or to improve responsiveness (by allowing one part
of a program to progress while another is waiting for a response). All
modern programming languages provide support for this. The support
provided by the C++ standard library is a portable and type-safe variant
of what has been used in C++ for more than 20 years and is almost
universally supported by modern hardware. The standard-library support
is primarily aimed at supporting systems-level concurrency rather than
directly providing sophisticated higher-level concurrency models; those
can be supplied as libraries built using the standard-library
facilities.</p>
<p>The standard library directly supports concurrent execution of
multiple threads in a single address space. To allow that, C++ provides
a suitable memory model and a set of atomic operations. The atomic
operations allow lock-free programming [<a href="#part0021.html#ref16"
class="calibre6">Dechev,2010</a>]. The memory model <span
id="part0020.html#page_196" class="pagebreak"></span>ensures that as
long as a programmer avoids data races (uncontrolled concurrent access
to mutable data), everything works as one would naively expect. However,
most users will see concurrency only in terms of the standard library
and libraries built on top of that. This section briefly gives examples
of the main standard-library concurrency support facilities: <code
class="calibre8">thread</code>s, <code class="calibre8">mutex</code>es,
<code class="calibre8">lock()</code> operations, <code
class="calibre8">packaged_task</code>s, and <code
class="calibre8">future</code>s. These features are built directly upon
what operating systems offer and do not incur performance penalties
compared with those. Neither do they guarantee significant performance
improvements compared to what the operating system offers.</p>
<p>Do not consider concurrency a panacea. If a task can be done
sequentially, it is often simpler and faster to do so.</p>
<p>As an alternative to using explicit concurrency features, we can
often use a parallel algorithm to exploit multiple execution engines for
better performance (§<a href="#part0017.html#ch12lev1sec9"
class="calibre6">12.9</a>, §<a href="#part0019.html#ch14lev2sec1"
class="calibre6">14.3.1</a>).</p>
<h3 class="h2" id="part0020.html#ch15lev1sec2">15.2 Tasks and <code
class="calibre17">thread</code>s</h3>
<p>We call a computation that can potentially be executed concurrently
with other computations a <em>task</em>. A <em>thread</em> is the
system-level representation of a task in a program. A task to be
executed concurrently with other tasks is launched by constructing a
<code class="calibre8">std::thread</code> (found in <code
class="calibre8">&lt;thread&gt;</code>) with the task as its argument. A
task is a function or a function object:</p>
<p><a href="#part0039_split_000.html#p0196_01a"
id="part0020.html#p0196_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb443"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb443-1"><a href="#cb443-1" aria-hidden="true" tabindex="-1"></a>void f()<span class="kw">;</span>                 <span class="fu">//</span> function</span>
<span id="cb443-2"><a href="#cb443-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-3"><a href="#cb443-3" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">F</span> <span class="kw">{</span>                <span class="fu">//</span> function object</span>
<span id="cb443-4"><a href="#cb443-4" aria-hidden="true" tabindex="-1"></a>     void operator()()<span class="kw">;</span>   <span class="fu">//</span> <span class="dt">F</span><span class="st">&#39;</span><span class="er">s call operator (§6.3.2)</span></span>
<span id="cb443-5"><a href="#cb443-5" aria-hidden="true" tabindex="-1"></a><span class="er">};</span></span>
<span id="cb443-6"><a href="#cb443-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-7"><a href="#cb443-7" aria-hidden="true" tabindex="-1"></a><span class="er">void user()</span></span>
<span id="cb443-8"><a href="#cb443-8" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb443-9"><a href="#cb443-9" aria-hidden="true" tabindex="-1"></a><span class="ch">     </span><span class="er">thread t1 {f};       // f() executes in separate thread</span></span>
<span id="cb443-10"><a href="#cb443-10" aria-hidden="true" tabindex="-1"></a><span class="er">     thread t2 {F()};     // F()() executes in separate thread</span></span>
<span id="cb443-11"><a href="#cb443-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb443-12"><a href="#cb443-12" aria-hidden="true" tabindex="-1"></a><span class="er">     t1.join();           // wait for t1</span></span>
<span id="cb443-13"><a href="#cb443-13" aria-hidden="true" tabindex="-1"></a><span class="er">     t2.join();           // wait for t2</span></span>
<span id="cb443-14"><a href="#cb443-14" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>The <code class="calibre8">join()</code>s ensure that we don’t exit
<code class="calibre8">user()</code> until the threads have completed.
To “join” a <code class="calibre8">thread</code> means to “wait for the
thread to terminate.”</p>
<p>Threads of a program share a single address space. In this, threads
differ from processes, which generally do not directly share data. Since
threads share an address space, they can communicate through shared
objects (§<a href="#part0020.html#ch15lev1sec5"
class="calibre6">15.5</a>). Such communication is typically controlled
by locks or other mechanisms to prevent data races (uncontrolled
concurrent access to a variable).</p>
<p>Programming concurrent tasks can be <em>very</em> tricky. Consider
possible implementations of the tasks <code class="calibre8">f</code> (a
function) and <code class="calibre8">F</code> (a function object):</p>
<p><a href="#part0039_split_001.html#p0196_02a"
id="part0020.html#p0196_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb444"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb444-1"><a href="#cb444-1" aria-hidden="true" tabindex="-1"></a>void f()</span>
<span id="cb444-2"><a href="#cb444-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb444-3"><a href="#cb444-3" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">Hello </span><span class="ot">&quot;</span><span class="kw">;</span></span>
<span id="cb444-4"><a href="#cb444-4" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb444-5"><a href="#cb444-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb444-6"><a href="#cb444-6" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">F</span> <span class="kw">{</span></span>
<span id="cb444-7"><a href="#cb444-7" aria-hidden="true" tabindex="-1"></a>     void operator()() <span class="kw">{</span> cout <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er">Parallel World</span><span class="ot">!</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span> <span class="kw">}</span></span>
<span id="cb444-8"><a href="#cb444-8" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p><span id="part0020.html#page_197" class="pagebreak"></span>This is an
example of a bad error: here, <code class="calibre8">f</code> and <code
class="calibre8">F()</code> each use the object <code
class="calibre8">cout</code> without any form of synchronization. The
resulting output would be unpredictable and could vary between different
executions of the program because the order of execution of the
individual operations in the two tasks is not defined. The program may
produce “odd” output, such as</p>
<div class="sourceCode" id="cb445"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb445-1"><a href="#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="dt">PaHerallllel</span> o <span class="dt">World</span><span class="kw">!</span></span></code></pre></div>
<p>Only a specific guarantee in the standard saves us from a data race
within the definition of <code class="calibre8">ostream</code> that
could lead to a crash.</p>
<p>When defining tasks of a concurrent program, our aim is to keep tasks
completely separate except where they communicate in simple and obvious
ways. The simplest way of thinking of a concurrent task is as a function
that happens to run concurrently with its caller. For that to work, we
just have to pass arguments, get a result back, and make sure that there
is no use of shared data in between (no data races).</p>
<h3 class="h2" id="part0020.html#ch15lev1sec3">15.3 Passing
Arguments</h3>
<p>Typically, a task needs data to work upon. We can easily pass data
(or pointers or references to the data) as arguments. Consider:</p>
<p><a href="#part0039_split_002.html#p0197_01a"
id="part0020.html#p0197_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb446"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb446-1"><a href="#cb446-1" aria-hidden="true" tabindex="-1"></a>void f(vector<span class="dt">&lt;</span>double&gt;&amp; v)<span class="kw">;</span>    <span class="fu">//</span> function do something with v</span>
<span id="cb446-2"><a href="#cb446-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-3"><a href="#cb446-3" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">F</span> <span class="kw">{</span>                    <span class="fu">//</span> function object<span class="fu">:</span> do something with v</span>
<span id="cb446-4"><a href="#cb446-4" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>double&gt;&amp; v<span class="kw">;</span></span>
<span id="cb446-5"><a href="#cb446-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">F</span>(vector<span class="dt">&lt;</span>double&gt;&amp; vv) <span class="fu">:</span>v<span class="kw">{</span>vv<span class="kw">}</span> <span class="kw">{</span> <span class="kw">}</span></span>
<span id="cb446-6"><a href="#cb446-6" aria-hidden="true" tabindex="-1"></a>     void operator()()<span class="kw">;</span>       <span class="fu">//</span> application operator<span class="kw">;</span> <span class="er">§</span><span class="fl">6.3</span>.<span class="dv">2</span></span>
<span id="cb446-7"><a href="#cb446-7" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb446-8"><a href="#cb446-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-9"><a href="#cb446-9" aria-hidden="true" tabindex="-1"></a>int main()</span>
<span id="cb446-10"><a href="#cb446-10" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb446-11"><a href="#cb446-11" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>double<span class="er">&gt;</span> some_vec <span class="kw">{</span><span class="dv">1</span><span class="kw">,</span><span class="dv">2</span><span class="kw">,</span><span class="dv">3</span><span class="kw">,</span><span class="dv">4</span><span class="kw">,</span><span class="dv">5</span><span class="kw">,</span><span class="dv">6</span><span class="kw">,</span><span class="dv">7</span><span class="kw">,</span><span class="dv">8</span><span class="kw">,</span><span class="dv">9</span><span class="kw">};</span></span>
<span id="cb446-12"><a href="#cb446-12" aria-hidden="true" tabindex="-1"></a>     vector<span class="dt">&lt;</span>double<span class="er">&gt;</span> vec2 <span class="kw">{</span><span class="dv">10</span><span class="kw">,</span><span class="dv">11</span><span class="kw">,</span><span class="dv">12</span><span class="kw">,</span><span class="dv">13</span><span class="kw">,</span><span class="dv">14</span><span class="kw">};</span></span>
<span id="cb446-13"><a href="#cb446-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-14"><a href="#cb446-14" aria-hidden="true" tabindex="-1"></a>     thread t1 <span class="kw">{</span>f<span class="kw">,</span>ref(some_vec)<span class="kw">};</span>   <span class="fu">//</span> f(some_vec) executes in a separate thread</span>
<span id="cb446-15"><a href="#cb446-15" aria-hidden="true" tabindex="-1"></a>     thread t2 <span class="kw">{</span><span class="dt">F</span><span class="kw">{</span>vec2<span class="kw">}};</span>           <span class="fu">//</span> <span class="dt">F</span>(vec2)() executes in a separate thread</span>
<span id="cb446-16"><a href="#cb446-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-17"><a href="#cb446-17" aria-hidden="true" tabindex="-1"></a>     t1.join()<span class="kw">;</span></span>
<span id="cb446-18"><a href="#cb446-18" aria-hidden="true" tabindex="-1"></a>     t2.join()<span class="kw">;</span></span>
<span id="cb446-19"><a href="#cb446-19" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Obviously, <code class="calibre8">F{vec2}</code> saves a reference to
the argument vector in <code class="calibre8">F</code>. <code
class="calibre8">F</code> can now use that vector and hopefully no other
task accesses <code class="calibre8">vec2</code> while <code
class="calibre8">F</code> is executing. Passing <code
class="calibre8">vec2</code> by value would eliminate that risk.</p>
<p>The initialization with <code
class="calibre8">{f,ref(some_vec)}</code> uses a <code
class="calibre8">thread</code> variadic template constructor that can
accept an arbitrary sequence of arguments (§<a
href="#part0012.html#ch07lev1sec4" class="calibre6">7.4</a>). The <code
class="calibre8">ref()</code> is a type function from <code
class="calibre8">&lt;functional&gt;</code> that <span
id="part0020.html#page_198" class="pagebreak"></span>unfortunately is
needed to tell the variadic template to treat <code
class="calibre8">some_vec</code> as a reference, rather than as an
object. Without that <code class="calibre8">ref()</code>, <code
class="calibre8">some_vec</code> would be passed by value. The compiler
checks that the first argument can be invoked given the following
arguments and builds the necessary function object to pass to the
thread. Thus, if <code class="calibre8">F::operator()()</code> and <code
class="calibre8">f()</code> perform the same algorithm, the handling of
the two tasks are roughly equivalent: in both cases, a function object
is constructed for the <code class="calibre8">thread</code> to
execute.</p>
<h3 class="h2" id="part0020.html#ch15lev1sec4">15.4 Returning
Results</h3>
<p>In the example in §<a href="#part0020.html#ch15lev1sec3"
class="calibre6">15.3</a>, I pass the arguments by non-<code
class="calibre8">const</code> reference. I only do that if I expect the
task to modify the value of the data referred to (§<a
href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>). That’s a
somewhat sneaky, but not uncommon, way of returning a result. A less
obscure technique is to pass the input data by <code
class="calibre8">const</code> reference and to pass the location of a
place to deposit the result as a separate argument:</p>
<p><a href="#part0039_split_003.html#p0198_01a"
id="part0020.html#p0198_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb447"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb447-1"><a href="#cb447-1" aria-hidden="true" tabindex="-1"></a>void f(const vector<span class="dt">&lt;</span>double&gt;&amp; v<span class="kw">,</span> double<span class="fu">*</span> res)<span class="kw">;</span>    <span class="fu">//</span> take input from v<span class="kw">;</span> place result in <span class="fu">*</span>res</span>
<span id="cb447-2"><a href="#cb447-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-3"><a href="#cb447-3" aria-hidden="true" tabindex="-1"></a>class <span class="dt">F</span> <span class="kw">{</span></span>
<span id="cb447-4"><a href="#cb447-4" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb447-5"><a href="#cb447-5" aria-hidden="true" tabindex="-1"></a>     <span class="dt">F</span>(const vector<span class="dt">&lt;</span>double&gt;&amp; vv<span class="kw">,</span> double<span class="fu">*</span> p) <span class="fu">:</span>v<span class="kw">{</span>vv<span class="kw">},</span> res<span class="kw">{</span>p<span class="kw">}</span> <span class="kw">{</span> <span class="kw">}</span></span>
<span id="cb447-6"><a href="#cb447-6" aria-hidden="true" tabindex="-1"></a>     void operator()()<span class="kw">;</span>          <span class="fu">//</span> place result in <span class="fu">*</span>res</span>
<span id="cb447-7"><a href="#cb447-7" aria-hidden="true" tabindex="-1"></a>private<span class="fu">:</span></span>
<span id="cb447-8"><a href="#cb447-8" aria-hidden="true" tabindex="-1"></a>     const vector<span class="dt">&lt;</span>double&gt;&amp; v<span class="kw">;</span>    <span class="fu">//</span> source of input</span>
<span id="cb447-9"><a href="#cb447-9" aria-hidden="true" tabindex="-1"></a>     double<span class="fu">*</span> res<span class="kw">;</span>                <span class="fu">//</span> target for output</span>
<span id="cb447-10"><a href="#cb447-10" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb447-11"><a href="#cb447-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-12"><a href="#cb447-12" aria-hidden="true" tabindex="-1"></a>double g(const vector<span class="dt">&lt;</span>double&gt;&amp;)<span class="kw">;</span> <span class="fu">//</span> use return value</span>
<span id="cb447-13"><a href="#cb447-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-14"><a href="#cb447-14" aria-hidden="true" tabindex="-1"></a>void user(vector<span class="dt">&lt;</span>double&gt;&amp; vec1<span class="kw">,</span> vector<span class="dt">&lt;</span>double<span class="er">&gt;</span> vec2<span class="kw">,</span> vector<span class="dt">&lt;</span>double<span class="er">&gt;</span> vec3)</span>
<span id="cb447-15"><a href="#cb447-15" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb447-16"><a href="#cb447-16" aria-hidden="true" tabindex="-1"></a>     double res1<span class="kw">;</span></span>
<span id="cb447-17"><a href="#cb447-17" aria-hidden="true" tabindex="-1"></a>     double res2<span class="kw">;</span></span>
<span id="cb447-18"><a href="#cb447-18" aria-hidden="true" tabindex="-1"></a>     double res3<span class="kw">;</span></span>
<span id="cb447-19"><a href="#cb447-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-20"><a href="#cb447-20" aria-hidden="true" tabindex="-1"></a>     thread t1 <span class="kw">{</span>f<span class="kw">,</span>cref(vec1)<span class="kw">,</span>&amp;res1<span class="kw">};</span>        <span class="fu">//</span> f(vec1<span class="kw">,</span>&amp;res1) executes in a separate thread</span>
<span id="cb447-21"><a href="#cb447-21" aria-hidden="true" tabindex="-1"></a>     thread t2 <span class="kw">{</span><span class="dt">F</span><span class="kw">{</span>vec2<span class="kw">,</span>&amp;res2<span class="kw">}};</span>             <span class="fu">//</span> <span class="dt">F</span><span class="kw">{</span>vec2<span class="kw">,</span>&amp;res2<span class="kw">}</span>() executes in a separate thread</span>
<span id="cb447-22"><a href="#cb447-22" aria-hidden="true" tabindex="-1"></a>     thread t3 <span class="kw">{</span>[&amp;]()<span class="kw">{</span>res3 <span class="kw">=</span> g(vec3)<span class="kw">;}};</span>    <span class="fu">//</span> capture local variables by reference</span>
<span id="cb447-23"><a href="#cb447-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-24"><a href="#cb447-24" aria-hidden="true" tabindex="-1"></a>     t1.join()<span class="kw">;</span></span>
<span id="cb447-25"><a href="#cb447-25" aria-hidden="true" tabindex="-1"></a>     t2.join()<span class="kw">;</span></span>
<span id="cb447-26"><a href="#cb447-26" aria-hidden="true" tabindex="-1"></a>     t3.join()<span class="kw">;</span></span>
<span id="cb447-27"><a href="#cb447-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb447-28"><a href="#cb447-28" aria-hidden="true" tabindex="-1"></a>     cout <span class="al">&lt;&lt;</span> res1 <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="er"> </span><span class="st">&#39;</span> <span class="al">&lt;&lt;</span> res2 <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="er"> </span><span class="st">&#39;</span> <span class="al">&lt;&lt;</span> res3 <span class="al">&lt;&lt;</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span><span class="kw">;</span></span>
<span id="cb447-29"><a href="#cb447-29" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This works and the technique is very common, but I don’t consider
returning results through references particularly elegant, so I return
to this topic in §<a href="#part0020.html#ch15lev2sec1"
class="calibre6">15.7.1</a>.</p>
<h3 class="h2" id="part0020.html#ch15lev1sec5"><span
id="part0020.html#page_199" class="calibre2 pagebreak"></span>15.5
Sharing Data</h3>
<p>Sometimes tasks need to share data. In that case, the access has to
be synchronized so that at most one task at a time has access.
Experienced programmers will recognize this as a simplification (e.g.,
there is no problem with many tasks simultaneously reading immutable
data), but consider how to ensure that at most one task at a time has
access to a given set of objects.</p>
<p>The fundamental element of the solution is a <code
class="calibre8">mutex</code>, a “mutual exclusion object.” A <code
class="calibre8">thread</code> acquires a <code
class="calibre8">mutex</code> using a <code
class="calibre8">lock()</code> operation:</p>
<p><a href="#part0039_split_004.html#p0199_01a"
id="part0020.html#p0199_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb448"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb448-1"><a href="#cb448-1" aria-hidden="true" tabindex="-1"></a>mutex m<span class="kw">;</span> <span class="fu">//</span> controlling mutex</span>
<span id="cb448-2"><a href="#cb448-2" aria-hidden="true" tabindex="-1"></a>int sh<span class="kw">;</span>  <span class="fu">//</span> shared data</span>
<span id="cb448-3"><a href="#cb448-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-4"><a href="#cb448-4" aria-hidden="true" tabindex="-1"></a>void f()</span>
<span id="cb448-5"><a href="#cb448-5" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb448-6"><a href="#cb448-6" aria-hidden="true" tabindex="-1"></a>     scoped_lock lck <span class="kw">{</span>m<span class="kw">};</span>        <span class="fu">//</span> acquire mutex</span>
<span id="cb448-7"><a href="#cb448-7" aria-hidden="true" tabindex="-1"></a>     sh += <span class="dv">7</span><span class="kw">;</span>                    <span class="fu">//</span> manipulate shared data</span>
<span id="cb448-8"><a href="#cb448-8" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span>    <span class="fu">//</span> release mutex implicitly</span></code></pre></div>
<p>The type of <code class="calibre8">lck</code> is deduced to be <code
class="calibre8">scoped_lock&lt;mutex&gt;</code> (§<a
href="#part0011.html#ch06lev2sec3" class="calibre6">6.2.3</a>). The
<code class="calibre8">scoped_lock</code>’s constructor acquires the
mutex (through a call <code class="calibre8">m.lock()</code>). If
another thread has already acquired the mutex, the thread waits
(“blocks”) until the other thread completes its access. Once a thread
has completed its access to the shared data, the <code
class="calibre8">scoped_lock</code> releases the <code
class="calibre8">mutex</code> (with a call <code
class="calibre8">m.unlock()</code>). When a <code
class="calibre8">mutex</code> is released, <code
class="calibre8">thread</code>s waiting for it resume executing (“are
woken up”). The mutual exclusion and locking facilities are found in
<code class="calibre8">&lt;mutex&gt;</code>.</p>
<p>Note the use of RAII (§<a href="#part0010.html#ch05lev1sec3"
class="calibre6">5.3</a>). Use of resource handles, such as <code
class="calibre8">scoped_lock</code> and <code
class="calibre8">unique_lock</code> (§<a
href="#part0020.html#ch15lev1sec6" class="calibre6">15.6</a>), is
simpler and far safer than explicitly locking and unlocking <code
class="calibre8">mutex</code>es.</p>
<p>The correspondence between the shared data and a <code
class="calibre8">mutex</code> is conventional: the programmer simply has
to know which <code class="calibre8">mutex</code> is supposed to
correspond to which data. Obviously, this is error-prone, and equally
obviously we try to make the correspondence clear through various
language means. For example:</p>
<p><a href="#part0039_split_005.html#p0199_02a"
id="part0020.html#p0199_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb449"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb449-1"><a href="#cb449-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Record</span> <span class="kw">{</span></span>
<span id="cb449-2"><a href="#cb449-2" aria-hidden="true" tabindex="-1"></a>public<span class="fu">:</span></span>
<span id="cb449-3"><a href="#cb449-3" aria-hidden="true" tabindex="-1"></a>     mutex rm<span class="kw">;</span></span>
<span id="cb449-4"><a href="#cb449-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb449-5"><a href="#cb449-5" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span></code></pre></div>
<p>It doesn’t take a genius to guess that for a <code
class="calibre8">Record</code> called <code class="calibre8">rec</code>,
you are supposed to acquire <code class="calibre8">rec.rm</code> before
accessing the rest of <code class="calibre8">rec</code>, though a
comment or a better name might have helped the reader.</p>
<p>It is not uncommon to need to simultaneously access several resources
to perform some action. This can lead to deadlock. For example, if <code
class="calibre8">thread1</code> acquires <code
class="calibre8">mutex1</code> and then tries to acquire <code
class="calibre8">mutex2</code> while <code
class="calibre8">thread2</code> acquires <code
class="calibre8">mutex2</code> and then tries to acquire <code
class="calibre8">mutex1</code>, then neither task will ever proceed
further. The <code class="calibre8">scoped_lock</code> helps by enabling
us to acquire several locks simultaneously:</p>
<p><a href="#part0039_split_006.html#p0199_03a"
id="part0020.html#p0199_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb450"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb450-1"><a href="#cb450-1" aria-hidden="true" tabindex="-1"></a>void f()</span>
<span id="cb450-2"><a href="#cb450-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb450-3"><a href="#cb450-3" aria-hidden="true" tabindex="-1"></a>     scoped_lock lck <span class="kw">{</span>mutex1<span class="kw">,</span>mutex2<span class="kw">,</span>mutex3<span class="kw">};</span>   <span class="fu">//</span> acquire all three locks</span>
<span id="cb450-4"><a href="#cb450-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... manipulate shared data ...</span>
<span id="cb450-5"><a href="#cb450-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span><span class="fu">//</span> implicitly release all mutexes</span></code></pre></div>
<p><span id="part0020.html#page_200" class="pagebreak"></span>This <code
class="calibre8">scoped_lock</code> will proceed only after acquiring
all its <code class="calibre8">mutex</code>es arguments and will never
block (“go to sleep”) while holding a <code
class="calibre8">mutex</code>. The destructor for <code
class="calibre8">scoped_lock</code> ensures that the <code
class="calibre8">mutex</code>es are released when a <code
class="calibre8">thread</code> leaves the scope.</p>
<p>Communicating through shared data is pretty low level. In particular,
the programmer has to devise ways of knowing what work has and has not
been done by various tasks. In that regard, use of shared data is
inferior to the notion of call and return. On the other hand, some
people are convinced that sharing must be more efficient than copying
arguments and returns. That can indeed be so when large amounts of data
are involved, but locking and unlocking are relatively expensive
operations. On the other hand, modern machines are very good at copying
data, especially compact data, such as <code
class="calibre8">vector</code> elements. So don’t choose shared data for
communication because of “efficiency” without thought and preferably not
without measurement.</p>
<p>The basic <code class="calibre8">mutex</code> allows one thread at a
time to access data. One of the most common ways of sharing data is
among many readers and a single writer. This “reader-writer lock” idiom
is supported be <code class="calibre8">share_mutex</code>. A reader will
acquire the mutex “shared” so that other readers can still gain access,
whereas a writer will demand exclusive access. For example:</p>
<p><a href="#part0039_split_007.html#p0200_01a"
id="part0020.html#p0200_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb451"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb451-1"><a href="#cb451-1" aria-hidden="true" tabindex="-1"></a>shared_mutex mx<span class="kw">;</span>          <span class="fu">//</span> a mutex that can be shared</span>
<span id="cb451-2"><a href="#cb451-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-3"><a href="#cb451-3" aria-hidden="true" tabindex="-1"></a>void reader()</span>
<span id="cb451-4"><a href="#cb451-4" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb451-5"><a href="#cb451-5" aria-hidden="true" tabindex="-1"></a>     shared_lock lck <span class="kw">{</span>mx<span class="kw">};</span>       <span class="fu">//</span> willing to share access with other readers</span>
<span id="cb451-6"><a href="#cb451-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... <span class="fu">read</span> ...</span>
<span id="cb451-7"><a href="#cb451-7" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb451-8"><a href="#cb451-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-9"><a href="#cb451-9" aria-hidden="true" tabindex="-1"></a>void writer()</span>
<span id="cb451-10"><a href="#cb451-10" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb451-11"><a href="#cb451-11" aria-hidden="true" tabindex="-1"></a>     unique_lock lck <span class="kw">{</span>mx<span class="kw">};</span>       <span class="fu">//</span> needs exclusive (unique) access</span>
<span id="cb451-12"><a href="#cb451-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... <span class="fu">write</span> ...</span>
<span id="cb451-13"><a href="#cb451-13" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h3 class="h2" id="part0020.html#ch15lev1sec6">15.6 Waiting for
Events</h3>
<p>Sometimes, a <code class="calibre8">thread</code> needs to wait for
some kind of external event, such as another <code
class="calibre8">thread</code> completing a task or a certain amount of
time having passed. The simplest “event” is simply time passing. Using
the time facilities found in <code
class="calibre8">&lt;chrono&gt;</code> I can write:</p>
<p><a href="#part0039_split_008.html#p0200_02a"
id="part0020.html#p0200_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb452"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb452-1"><a href="#cb452-1" aria-hidden="true" tabindex="-1"></a>using namespace std::chrono<span class="kw">;</span>    <span class="fu">//</span> see <span class="er">§</span><span class="fl">13.7</span></span>
<span id="cb452-2"><a href="#cb452-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-3"><a href="#cb452-3" aria-hidden="true" tabindex="-1"></a>auto t0 <span class="kw">=</span> high_resolution_clock::now()<span class="kw">;</span></span>
<span id="cb452-4"><a href="#cb452-4" aria-hidden="true" tabindex="-1"></a>this_thread::sleep_for(milliseconds<span class="kw">{</span><span class="dv">20</span><span class="kw">}</span>)<span class="kw">;</span></span>
<span id="cb452-5"><a href="#cb452-5" aria-hidden="true" tabindex="-1"></a>auto t1 <span class="kw">=</span> high_resolution_clock::now()<span class="kw">;</span></span>
<span id="cb452-6"><a href="#cb452-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-7"><a href="#cb452-7" aria-hidden="true" tabindex="-1"></a>cout <span class="al">&lt;&lt;</span> duration_cast<span class="dt">&lt;</span>nanoseconds<span class="er">&gt;</span>(t1<span class="er">−</span>t0)<span class="kw">.</span>count() <span class="al">&lt;&lt;</span> <span class="ot">&quot;</span><span class="er"> nanoseconds passed</span><span class="ch">\n</span><span class="ot">&quot;</span><span class="kw">;</span></span></code></pre></div>
<p>Note that I didn’t even have to launch a <code
class="calibre8">thread</code>; by default, <code
class="calibre8">this_thread</code> refers to the one and only
thread.</p>
<p><span id="part0020.html#page_201" class="pagebreak"></span>I used
<code class="calibre8">duration_cast</code> to adjust the clock’s units
to the nanoseconds I wanted.</p>
<p>The basic support for communicating using external events is provided
by <code class="calibre8">condition_variable</code>s found in <code
class="calibre8">&lt;condition_variable&gt;</code>. A <code
class="calibre8">condition_variable</code> is a mechanism allowing one
<code class="calibre8">thread</code> to wait for another. In particular,
it allows a <code class="calibre8">thread</code> to wait for some
<em>condition</em> (often called an <em>event</em>) to occur as the
result of work done by other <code class="calibre8">thread</code>s.</p>
<p>Using <code class="calibre8">condition_variable</code>s supports many
forms of elegant and efficient sharing but can be rather tricky.
Consider the classical example of two <code
class="calibre8">thread</code>s communicating by passing messages
through a <code class="calibre8">queue</code>. For simplicity, I declare
the <code class="calibre8">queue</code> and the mechanism for avoiding
race conditions on that <code class="calibre8">queue</code> global to
the producer and consumer:</p>
<p><a href="#part0039_split_009.html#p0201_01a"
id="part0020.html#p0201_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb453"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb453-1"><a href="#cb453-1" aria-hidden="true" tabindex="-1"></a>class <span class="dt">Message</span> <span class="kw">{</span>    <span class="fu">//</span> object to be communicated</span>
<span id="cb453-2"><a href="#cb453-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb453-3"><a href="#cb453-3" aria-hidden="true" tabindex="-1"></a><span class="kw">};</span></span>
<span id="cb453-4"><a href="#cb453-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-5"><a href="#cb453-5" aria-hidden="true" tabindex="-1"></a>queue<span class="dt">&lt;Message</span><span class="er">&gt;</span> mqueue<span class="kw">;</span>         <span class="fu">//</span> the queue of messages</span>
<span id="cb453-6"><a href="#cb453-6" aria-hidden="true" tabindex="-1"></a>condition_variable mcond<span class="kw">;</span>      <span class="fu">//</span> the variable communicating events</span>
<span id="cb453-7"><a href="#cb453-7" aria-hidden="true" tabindex="-1"></a>mutex mmutex<span class="kw">;</span>                  <span class="fu">//</span> for synchronizing access to mcond</span></code></pre></div>
<p>The types <code class="calibre8">queue</code>, <code
class="calibre8">condition_variable</code>, and <code
class="calibre8">mutex</code> are provided by the standard library.</p>
<p>The <code class="calibre8">consumer()</code> reads and processes
<code class="calibre8">Message</code>s:</p>
<p><a href="#part0039_split_010.html#p0201_02a"
id="part0020.html#p0201_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb454"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb454-1"><a href="#cb454-1" aria-hidden="true" tabindex="-1"></a>void consumer()</span>
<span id="cb454-2"><a href="#cb454-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb454-3"><a href="#cb454-3" aria-hidden="true" tabindex="-1"></a>     while(<span class="kw">true</span>) <span class="kw">{</span></span>
<span id="cb454-4"><a href="#cb454-4" aria-hidden="true" tabindex="-1"></a>          unique_lock lck <span class="kw">{</span>mmutex<span class="kw">};</span>          <span class="fu">//</span> acquire mmutex</span>
<span id="cb454-5"><a href="#cb454-5" aria-hidden="true" tabindex="-1"></a>          mcond.wait(lck<span class="kw">,</span>[] <span class="kw">{</span> return <span class="kw">!</span>mqueue.empty()<span class="kw">;</span> <span class="kw">}</span>)<span class="kw">;</span>    <span class="fu">//</span> release lck and wait<span class="kw">;</span></span>
<span id="cb454-6"><a href="#cb454-6" aria-hidden="true" tabindex="-1"></a>                                                             <span class="fu">//</span> re<span class="fu">-</span>acquire lck upon wakeup</span>
<span id="cb454-7"><a href="#cb454-7" aria-hidden="true" tabindex="-1"></a>                                                             <span class="fu">//</span> don<span class="st">&#39;</span><span class="er">t wake up unless mqueue is non-empty</span></span>
<span id="cb454-8"><a href="#cb454-8" aria-hidden="true" tabindex="-1"></a><span class="er">          auto m = mqueue.front();           // get the message</span></span>
<span id="cb454-9"><a href="#cb454-9" aria-hidden="true" tabindex="-1"></a><span class="er">          mqueue.pop();</span></span>
<span id="cb454-10"><a href="#cb454-10" aria-hidden="true" tabindex="-1"></a><span class="er">          lck.unlock();                      // release lck</span></span>
<span id="cb454-11"><a href="#cb454-11" aria-hidden="true" tabindex="-1"></a><span class="er">          // ... process m ...</span></span>
<span id="cb454-12"><a href="#cb454-12" aria-hidden="true" tabindex="-1"></a><span class="er">     }</span></span>
<span id="cb454-13"><a href="#cb454-13" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>Here, I explicitly protect the operations on the <code
class="calibre8">queue</code> and on the <code
class="calibre8">condition_variable</code> with a <code
class="calibre8">unique_lock</code> on the <code
class="calibre8">mutex</code>. Waiting on <code
class="calibre8">condition_variable</code> releases its lock argument
until the wait is over (so that the queue is non-empty) and then
reacquires it. The explicit check of the condition, here <code
class="calibre8">!mqueue.empty()</code>, protects against waking up just
to find that some other task has “gotten there first” so that the
condition no longer holds.</p>
<p>I used a <code class="calibre8">unique_lock</code> rather than a
<code class="calibre8">scoped_lock</code> for two reasons:</p>
<ul>
<li><p>We need to pass the lock to the <code
class="calibre8">condition_variable</code>’s <code
class="calibre8">wait()</code>. A <code
class="calibre8">scoped_lock</code> cannot be copied, but a <code
class="calibre8">unique_lock</code> can be.</p></li>
<li><p>We want to unlock the <code class="calibre8">mutex</code>
protecting the condition variable before processing the message. A <code
class="calibre8">unique_lock</code> offers operations, such as <code
class="calibre8">lock()</code> and <code
class="calibre8">unlock()</code>, for low-level control of
synchronization.</p></li>
</ul>
<p>On the other hand, <code class="calibre8">unique_lock</code> can only
handle a single <code class="calibre8">mutex</code>.</p>
<p><span id="part0020.html#page_202" class="pagebreak"></span>The
corresponding <code class="calibre8">producer</code> looks like
this:</p>
<p><a href="#part0039_split_011.html#p0202_01a"
id="part0020.html#p0202_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb455"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb455-1"><a href="#cb455-1" aria-hidden="true" tabindex="-1"></a>void producer()</span>
<span id="cb455-2"><a href="#cb455-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb455-3"><a href="#cb455-3" aria-hidden="true" tabindex="-1"></a>     while(<span class="kw">true</span>) <span class="kw">{</span></span>
<span id="cb455-4"><a href="#cb455-4" aria-hidden="true" tabindex="-1"></a>          <span class="dt">Message</span> m<span class="kw">;</span></span>
<span id="cb455-5"><a href="#cb455-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> ... fill the message ...</span>
<span id="cb455-6"><a href="#cb455-6" aria-hidden="true" tabindex="-1"></a>          scoped_lock lck <span class="kw">{</span>mmutex<span class="kw">};</span>      <span class="fu">//</span> protect operations</span>
<span id="cb455-7"><a href="#cb455-7" aria-hidden="true" tabindex="-1"></a>          mqueue.push(m)<span class="kw">;</span></span>
<span id="cb455-8"><a href="#cb455-8" aria-hidden="true" tabindex="-1"></a>          mcond.notify_one()<span class="kw">;</span>            <span class="fu">//</span> notify</span>
<span id="cb455-9"><a href="#cb455-9" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span>                                   <span class="fu">//</span> release lock (at end of scope)</span>
<span id="cb455-10"><a href="#cb455-10" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h3 class="h2" id="part0020.html#ch15lev1sec7">15.7 Communicating
Tasks</h3>
<p>The standard library provides a few facilities to allow programmers
to operate at the conceptual level of tasks (work to potentially be done
concurrently) rather than directly at the lower level of threads and
locks:</p>
<ul>
<li><p><code class="calibre8">future</code> and <code
class="calibre8">promise</code> for returning a value from a task
spawned on a separate thread</p></li>
<li><p><code class="calibre8">packaged_task</code> to help launch tasks
and connect up the mechanisms for returning a result</p></li>
<li><p><code class="calibre8">async()</code> for launching of a task in
a manner very similar to calling a function</p></li>
</ul>
<p>These facilities are found in <code
class="calibre8">&lt;future&gt;</code>.</p>
<h4 class="h3" id="part0020.html#ch15lev2sec1">15.7.1 <code
class="calibre16">future</code> and <code
class="calibre16">promise</code></h4>
<p>The important point about <code class="calibre8">future</code> and
<code class="calibre8">promise</code> is that they enable a transfer of
a value between two tasks without explicit use of a lock; “the system”
implements the transfer efficiently. The basic idea is simple: when a
task wants to pass a value to another, it puts the value into a <code
class="calibre8">promise</code>. Somehow, the implementation makes that
value appear in the corresponding <code class="calibre8">future</code>,
from which it can be read (typically by the launcher of the task). We
can represent this graphically:</p>
<figure>
<img src="images/00033.jpeg" class="calibre1" />
</figure>
<p>If we have a <code class="calibre8">future&lt;X&gt;</code> called
<code class="calibre8">fx</code>, we can <code
class="calibre8">get()</code> a value of type <code
class="calibre8">X</code> from it:</p>
<p><a href="#part0039_split_012.html#p0202_02a"
id="part0020.html#p0202_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb456"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb456-1"><a href="#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="dt">X</span> v <span class="kw">=</span> fx<span class="kw">.</span>get()<span class="kw">;</span>  <span class="fu">//</span> if necessary<span class="kw">,</span> wait for the value to get computed</span></code></pre></div>
<p>If the value isn’t there yet, our thread is blocked until it arrives.
If the value couldn’t be computed, <code class="calibre8">get()</code>
might throw an exception (from the system or transmitted from the task
from which we were trying to <code class="calibre8">get()</code> the
value).</p>
<p><span id="part0020.html#page_203" class="pagebreak"></span>The main
purpose of a <code class="calibre8">promise</code> is to provide simple
“put” operations (called <code class="calibre8">set_value()</code> and
<code class="calibre8">set_exception()</code>) to match <code
class="calibre8">future</code>’s <code class="calibre8">get()</code>.
The names “future” and “promise” are historical; please don’t blame or
credit me. They are yet another fertile source of puns.</p>
<p>If you have a <code class="calibre8">promise</code> and need to send
a result of type <code class="calibre8">X</code> to a <code
class="calibre8">future</code>, you can do one of two things: pass a
value or pass an exception. For example:</p>
<p><a href="#part0039_split_013.html#p0203_01a"
id="part0020.html#p0203_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb457"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb457-1"><a href="#cb457-1" aria-hidden="true" tabindex="-1"></a>void f(promise<span class="dt">&lt;X</span>&gt;&amp; px) <span class="fu">//</span> a task<span class="fu">:</span> place the result in px</span>
<span id="cb457-2"><a href="#cb457-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb457-3"><a href="#cb457-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb457-4"><a href="#cb457-4" aria-hidden="true" tabindex="-1"></a>     try<span class="kw">{</span></span>
<span id="cb457-5"><a href="#cb457-5" aria-hidden="true" tabindex="-1"></a>          <span class="dt">X</span> res<span class="kw">;</span></span>
<span id="cb457-6"><a href="#cb457-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> ... compute a value for res ...</span>
<span id="cb457-7"><a href="#cb457-7" aria-hidden="true" tabindex="-1"></a>          px.set_value(res)<span class="kw">;</span></span>
<span id="cb457-8"><a href="#cb457-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb457-9"><a href="#cb457-9" aria-hidden="true" tabindex="-1"></a>     <span class="kw">catch</span> (...) <span class="kw">{</span>      <span class="fu">//</span> oops<span class="fu">:</span> couldn<span class="st">&#39;</span><span class="er">t compute res</span></span>
<span id="cb457-10"><a href="#cb457-10" aria-hidden="true" tabindex="-1"></a><span class="er">          px</span><span class="st">.</span><span class="er">set_exception</span><span class="st">(</span><span class="er">current_exception</span><span class="st">());</span><span class="er">     </span><span class="st">//</span><span class="er"> pass the exception to the future</span><span class="st">&#39;</span>s thread</span>
<span id="cb457-11"><a href="#cb457-11" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb457-12"><a href="#cb457-12" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The <code class="calibre8">current_exception()</code> refers to the
caught exception.</p>
<p>To deal with an exception transmitted through a <code
class="calibre8">future</code>, the caller of <code
class="calibre8">get()</code> must be prepared to catch it somewhere.
For example:</p>
<p><a href="#part0039_split_014.html#p0203_02a"
id="part0020.html#p0203_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb458"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb458-1"><a href="#cb458-1" aria-hidden="true" tabindex="-1"></a>void g(future<span class="dt">&lt;X</span>&gt;&amp; fx)       <span class="fu">//</span> a task<span class="fu">:</span> get the result from fx</span>
<span id="cb458-2"><a href="#cb458-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb458-3"><a href="#cb458-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb458-4"><a href="#cb458-4" aria-hidden="true" tabindex="-1"></a>     try<span class="kw">{</span></span>
<span id="cb458-5"><a href="#cb458-5" aria-hidden="true" tabindex="-1"></a>          <span class="dt">X</span> v <span class="kw">=</span> fx.get()<span class="kw">;</span>  <span class="fu">//</span> if necessary<span class="kw">,</span> wait for the value to get computed</span>
<span id="cb458-6"><a href="#cb458-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">//</span> ... use v ...</span>
<span id="cb458-7"><a href="#cb458-7" aria-hidden="true" tabindex="-1"></a>     <span class="kw">}</span></span>
<span id="cb458-8"><a href="#cb458-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">catch</span> (...) <span class="kw">{</span>         <span class="fu">//</span> oops<span class="fu">:</span> someone couldn<span class="st">&#39;</span><span class="er">t compute v</span></span>
<span id="cb458-9"><a href="#cb458-9" aria-hidden="true" tabindex="-1"></a><span class="er">          // ... handle error ...</span></span>
<span id="cb458-10"><a href="#cb458-10" aria-hidden="true" tabindex="-1"></a><span class="er">     }</span></span>
<span id="cb458-11"><a href="#cb458-11" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>If the error doesn’t need to be handled by <code
class="calibre8">g()</code> itself, the code reduces to the minimal:</p>
<p><a href="#part0039_split_015.html#p0203_03a"
id="part0020.html#p0203_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb459"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb459-1"><a href="#cb459-1" aria-hidden="true" tabindex="-1"></a>void g(future<span class="dt">&lt;X</span>&gt;&amp; fx)        <span class="fu">//</span> a task<span class="fu">:</span> get the result from fx</span>
<span id="cb459-2"><a href="#cb459-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb459-3"><a href="#cb459-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb459-4"><a href="#cb459-4" aria-hidden="true" tabindex="-1"></a>     <span class="dt">X</span> v <span class="kw">=</span> fx.get()<span class="kw">;</span>  <span class="fu">//</span> if necessary<span class="kw">,</span> wait for the value to get computed</span>
<span id="cb459-5"><a href="#cb459-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ... use v ...</span>
<span id="cb459-6"><a href="#cb459-6" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<h4 class="h3" id="part0020.html#ch15lev2sec2">15.7.2 <code
class="calibre16">packaged_task</code></h4>
<p>How do we get a <code class="calibre8">future</code> into the task
that needs a result and the corresponding <code
class="calibre8">promise</code> into the thread that should produce that
result? The <code class="calibre8">packaged_task</code> type is provided
to simplify setting up tasks connected with <code
class="calibre8">future</code>s and <code
class="calibre8">promise</code>s to be run on <code
class="calibre8">thread</code>s. A <code
class="calibre8">packaged_task</code> provides wrapper code to put the
return value or exception from the task into a <code
class="calibre8">promise</code> (like the code shown in §<a
href="#part0020.html#ch15lev2sec1" class="calibre6">15.7.1</a>). <span
id="part0020.html#page_204" class="pagebreak"></span>If you ask it by
calling <code class="calibre8">get_future</code>, a <code
class="calibre8">packaged_task</code> will give you the <code
class="calibre8">future</code> corresponding to its <code
class="calibre8">promise</code>. For example, we can set up two tasks to
each add half of the elements of a <code
class="calibre8">vector&lt;double&gt;</code> using the standard-library
<code class="calibre8">accumulate()</code> (§<a
href="#part0019.html#ch14lev1sec3" class="calibre6">14.3</a>):</p>
<p><a href="#part0039_split_016.html#p0204_01a"
id="part0020.html#p0204_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb460"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb460-1"><a href="#cb460-1" aria-hidden="true" tabindex="-1"></a>double accum(double<span class="fu">*</span> beg<span class="kw">,</span> double<span class="fu">*</span> end<span class="kw">,</span> double init)</span>
<span id="cb460-2"><a href="#cb460-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> compute the sum of [beg<span class="fu">:</span>end<span class="er">)</span> starting with the initial value init</span>
<span id="cb460-3"><a href="#cb460-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb460-4"><a href="#cb460-4" aria-hidden="true" tabindex="-1"></a>     return accumulate(beg<span class="kw">,</span>end<span class="kw">,</span>init)<span class="kw">;</span></span>
<span id="cb460-5"><a href="#cb460-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span>
<span id="cb460-6"><a href="#cb460-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-7"><a href="#cb460-7" aria-hidden="true" tabindex="-1"></a>double comp2(vector<span class="dt">&lt;</span>double&gt;&amp; v)</span>
<span id="cb460-8"><a href="#cb460-8" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb460-9"><a href="#cb460-9" aria-hidden="true" tabindex="-1"></a>     using <span class="dt">Task_type</span> <span class="kw">=</span> double(double<span class="fu">*</span><span class="kw">,</span>double<span class="fu">*</span><span class="kw">,</span>double)<span class="kw">;</span>            <span class="fu">//</span> type of task</span>
<span id="cb460-10"><a href="#cb460-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-11"><a href="#cb460-11" aria-hidden="true" tabindex="-1"></a>     packaged_task<span class="dt">&lt;Task_type</span><span class="er">&gt;</span> pt0 <span class="kw">{</span>accum<span class="kw">};</span>                        <span class="fu">//</span> package the task (i<span class="al">.</span>e<span class="al">.</span><span class="kw">,</span> accum)</span>
<span id="cb460-12"><a href="#cb460-12" aria-hidden="true" tabindex="-1"></a>     packaged_task<span class="dt">&lt;Task_type</span><span class="er">&gt;</span> pt1 <span class="kw">{</span>accum<span class="kw">};</span></span>
<span id="cb460-13"><a href="#cb460-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-14"><a href="#cb460-14" aria-hidden="true" tabindex="-1"></a>     future<span class="dt">&lt;</span>double<span class="er">&gt;</span> f0 <span class="kw">{</span>pt0.get_future()<span class="kw">};</span>                        <span class="fu">//</span> get hold of pt0<span class="st">&#39;</span><span class="er">s future</span></span>
<span id="cb460-15"><a href="#cb460-15" aria-hidden="true" tabindex="-1"></a><span class="er">     future</span><span class="st">&lt;</span><span class="er">double</span><span class="st">&gt;</span><span class="er"> f1 </span><span class="st">{</span><span class="er">pt1</span><span class="st">.</span><span class="er">get_future</span><span class="st">()};</span><span class="er">                        </span><span class="st">//</span><span class="er"> get hold of pt1</span><span class="st">&#39;</span>s future</span>
<span id="cb460-16"><a href="#cb460-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-17"><a href="#cb460-17" aria-hidden="true" tabindex="-1"></a>     double<span class="fu">*</span> first <span class="kw">=</span> &amp;v[<span class="dv">0</span>]<span class="kw">;</span></span>
<span id="cb460-18"><a href="#cb460-18" aria-hidden="true" tabindex="-1"></a>     thread t1 <span class="kw">{</span>move(pt0)<span class="kw">,</span>first<span class="kw">,</span>first<span class="fu">+</span>v.size()<span class="fu">/</span><span class="dv">2</span><span class="kw">,</span><span class="dv">0</span><span class="kw">};</span>              <span class="fu">//</span> start a thread for pt0</span>
<span id="cb460-19"><a href="#cb460-19" aria-hidden="true" tabindex="-1"></a>     thread t2 <span class="kw">{</span>move(pt1)<span class="kw">,</span>first<span class="fu">+</span>v.size()<span class="fu">/</span><span class="dv">2</span><span class="kw">,</span>first<span class="fu">+</span>v.size()<span class="kw">,</span><span class="dv">0</span><span class="kw">};</span>     <span class="fu">//</span> start a thread for pt1</span>
<span id="cb460-20"><a href="#cb460-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-21"><a href="#cb460-21" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb460-22"><a href="#cb460-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-23"><a href="#cb460-23" aria-hidden="true" tabindex="-1"></a>     return f0.get()<span class="fu">+</span>f1.get()<span class="kw">;</span>                                    <span class="fu">//</span> get the results</span>
<span id="cb460-24"><a href="#cb460-24" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>The <code class="calibre8">packaged_task</code> template takes the
type of the task as its template argument (here <code
class="calibre8">Task_type</code>, an alias for <code
class="calibre8">double(double*,double*,double)</code>) and the task as
its constructor argument (here, <code class="calibre8">accum</code>).
The <code class="calibre8">move()</code> operations are needed because a
<code class="calibre8">packaged_task</code> cannot be copied. The reason
that a <code class="calibre8">packaged_task</code> cannot be copied is
that it is a resource handle: it owns its <code
class="calibre8">promise</code> and is (indirectly) responsible for
whatever resources its task may own.</p>
<p>Please note the absence of explicit mention of locks in this code: we
are able to concentrate on tasks to be done, rather than on the
mechanisms used to manage their communication. The two tasks will be run
on separate threads and thus potentially in parallel.</p>
<h4 class="h3" id="part0020.html#ch15lev2sec3">15.7.3 <code
class="calibre16">async()</code></h4>
<p>The line of thinking I have pursued in this chapter is the one I
believe to be the simplest yet still among the most powerful: treat a
task as a function that may happen to run concurrently with other tasks.
It is far from the only model supported by the C++ standard library, but
it serves well for a wide range of needs. More subtle and tricky models
(e.g., styles of programming relying on shared memory), can be used as
needed.</p>
<p>To launch tasks to potentially run asynchronously, we can use <code
class="calibre8">async()</code>:</p>
<p><a href="#part0039_split_017.html#p0205_01a"
id="part0020.html#p0205_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb461"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb461-1"><a href="#cb461-1" aria-hidden="true" tabindex="-1"></a>double comp4(vector<span class="dt">&lt;</span>double&gt;&amp; v)</span>
<span id="cb461-2"><a href="#cb461-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> spawn many tasks if v <span class="dt">is</span> large enough</span>
<span id="cb461-3"><a href="#cb461-3" aria-hidden="true" tabindex="-1"></a><span class="er">{</span></span>
<span id="cb461-4"><a href="#cb461-4" aria-hidden="true" tabindex="-1"></a>     if (v.size()<span class="er">&lt;</span><span class="dv">10000</span><span class="er">)</span>      <span class="fu">//</span> <span class="dt">is</span> it worth using concurrency?</span>
<span id="cb461-5"><a href="#cb461-5" aria-hidden="true" tabindex="-1"></a>           return accum(v.begin()<span class="er">,</span>v.end()<span class="er">,</span><span class="fl">0.0</span>)<span class="kw">;</span></span>
<span id="cb461-6"><a href="#cb461-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-7"><a href="#cb461-7" aria-hidden="true" tabindex="-1"></a>     auto v0 <span class="kw">=</span> &amp;v[<span class="dv">0</span>]<span class="kw">;</span></span>
<span id="cb461-8"><a href="#cb461-8" aria-hidden="true" tabindex="-1"></a>     auto sz <span class="kw">=</span> v<span class="kw">.</span>size()<span class="kw">;</span></span>
<span id="cb461-9"><a href="#cb461-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-10"><a href="#cb461-10" aria-hidden="true" tabindex="-1"></a>     auto f0 <span class="kw">=</span> async(accum<span class="kw">,</span>v0<span class="kw">,</span>v0<span class="fu">+</span>sz<span class="fu">/</span><span class="dv">4</span><span class="kw">,</span><span class="fl">0.0</span>)<span class="kw">;</span>          <span class="fu">//</span> first quarter</span>
<span id="cb461-11"><a href="#cb461-11" aria-hidden="true" tabindex="-1"></a>     auto f1 <span class="kw">=</span> async(accum<span class="kw">,</span>v0<span class="fu">+</span>sz<span class="fu">/</span><span class="dv">4</span><span class="kw">,</span>v0<span class="fu">+</span>sz<span class="fu">/</span><span class="dv">2</span><span class="kw">,</span><span class="fl">0.0</span>)<span class="kw">;</span>     <span class="fu">//</span> second quarter</span>
<span id="cb461-12"><a href="#cb461-12" aria-hidden="true" tabindex="-1"></a>     auto f2 <span class="kw">=</span> async(accum<span class="kw">,</span>v0<span class="fu">+</span>sz<span class="fu">/</span><span class="dv">2</span><span class="kw">,</span>v0<span class="fu">+</span>sz<span class="fu">*</span><span class="dv">3</span><span class="fu">/</span><span class="dv">4</span><span class="kw">,</span><span class="fl">0.0</span>)<span class="kw">;</span>   <span class="fu">//</span> third quarter</span>
<span id="cb461-13"><a href="#cb461-13" aria-hidden="true" tabindex="-1"></a>     auto f3 <span class="kw">=</span> async(accum<span class="kw">,</span>v0<span class="fu">+</span>sz<span class="fu">*</span><span class="dv">3</span><span class="fu">/</span><span class="dv">4</span><span class="kw">,</span>v0<span class="fu">+</span>sz<span class="kw">,</span><span class="fl">0.0</span>)<span class="kw">;</span>     <span class="fu">//</span> fourth quarter</span>
<span id="cb461-14"><a href="#cb461-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-15"><a href="#cb461-15" aria-hidden="true" tabindex="-1"></a>     return f0<span class="kw">.</span>get()<span class="fu">+</span>f1<span class="kw">.</span>get()<span class="fu">+</span>f2<span class="kw">.</span>get()<span class="fu">+</span>f3<span class="kw">.</span>get()<span class="kw">;</span> <span class="fu">//</span> collect and combine the results</span>
<span id="cb461-16"><a href="#cb461-16" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p>Basically, <code class="calibre8">async()</code> separates the “call
part” of a function call from the “get the result part” and separates
both from the actual execution of the task. Using <code
class="calibre8">async()</code>, you don’t have to think about threads
and locks. Instead, you think just in terms of tasks that potentially
compute their results asynchronously. There is an obvious limitation:
don’t even think of using <code class="calibre8">async()</code> for
tasks that share resources needing locking. With <code
class="calibre8">async()</code> you don’t even know how many <code
class="calibre8">thread</code>s will be used because that’s up to <code
class="calibre8">async()</code> to decide based on what it knows about
the system resources available at the time of a call. For example, <code
class="calibre8">async()</code> may check whether any idle cores
(processors) are available before deciding how many <code
class="calibre8">thread</code>s to use.</p>
<p>Using a guess about the cost of computation relative to the cost of
launching a <code class="calibre8">thread</code>, such as <code
class="calibre8">v.size()&lt;10000</code>, is very primitive and prone
to gross mistakes about performance. However, this is not the place for
a proper discussion about how to manage <code
class="calibre8">thread</code>s. Don’t take this estimate as more than a
simple and probably poor guess.</p>
<p>It is rarely necessary to manually parallelize a standard-library
algorithm, such as <code class="calibre8">accumulate()</code>, because
the parallel algorithms, such as <code
class="calibre8">reduce(par_unseq,/*...*/)</code>, usually do a better
job at that (§<a href="#part0019.html#ch14lev2sec1"
class="calibre6">14.3.1</a>). However, the technique is general.</p>
<p>Please note that <code class="calibre8">async()</code> is not just a
mechanism specialized for parallel computation for increased
performance. For example, it can also be used to spawn a task for
getting information from a user, leaving the “main program” active with
something else (§<a href="#part0020.html#ch15lev2sec3"
class="calibre6">15.7.3</a>).</p>
<h3 class="h2" id="part0020.html#ch15lev1sec8">15.8 Advice</h3>
<p>[1] Use concurrency to improve responsiveness or to improve
throughput; §<a href="#part0020.html#ch15lev1sec1"
class="calibre6">15.1</a>.</p>
<p>[2] Work at the highest level of abstraction that you can afford; §<a
href="#part0020.html#ch15lev1sec1" class="calibre6">15.1</a>.</p>
<p>[3] Consider processes as an alternative to threads; §<a
href="#part0020.html#ch15lev1sec1" class="calibre6">15.1</a>.</p>
<p>[4] The standard-library concurrency facilities are type safe; §<a
href="#part0020.html#ch15lev1sec1" class="calibre6">15.1</a>.</p>
<p>[5] The memory model exists to save most programmers from having to
think about the machine architecture level of computers; §<a
href="#part0020.html#ch15lev1sec1" class="calibre6">15.1</a>.</p>
<p><span id="part0020.html#page_206" class="pagebreak"></span>[6] The
memory model makes memory appear roughly as naively expected; §<a
href="#part0020.html#ch15lev1sec1" class="calibre6">15.1</a>.</p>
<p>[7] Atomics allow for lock-free programming; §<a
href="#part0020.html#ch15lev1sec1" class="calibre6">15.1</a>.</p>
<p>[8] Leave lock-free programming to experts; §<a
href="#part0020.html#ch15lev1sec1" class="calibre6">15.1</a>.</p>
<p>[9] Sometimes, a sequential solution is simpler and faster than a
concurrent solution; §<a href="#part0020.html#ch15lev1sec1"
class="calibre6">15.1</a>.</p>
<p>[10] Avoid data races; §<a href="#part0020.html#ch15lev1sec1"
class="calibre6">15.1</a>, §<a href="#part0020.html#ch15lev1sec2"
class="calibre6">15.2</a>.</p>
<p>[11] Prefer parallel algorithms to direct use of concurrency; §<a
href="#part0020.html#ch15lev1sec1" class="calibre6">15.1</a>, §<a
href="#part0020.html#ch15lev2sec3" class="calibre6">15.7.3</a>.</p>
<p>[12] A <code class="calibre8">thread</code> is a type-safe interface
to a system thread; §<a href="#part0020.html#ch15lev1sec2"
class="calibre6">15.2</a>.</p>
<p>[13] Use <code class="calibre8">join()</code> to wait for a <code
class="calibre8">thread</code> to complete; §<a
href="#part0020.html#ch15lev1sec2" class="calibre6">15.2</a>.</p>
<p>[14] Avoid explicitly shared data whenever you can; §<a
href="#part0020.html#ch15lev1sec2" class="calibre6">15.2</a>.</p>
<p>[15] Prefer RAII to explicit lock/unlock; §<a
href="#part0020.html#ch15lev1sec5" class="calibre6">15.5</a>; [CG:
CP.20].</p>
<p>[16] Use <code class="calibre8">scoped_lock</code> to manage <code
class="calibre8">mutex</code>es; §<a href="#part0020.html#ch15lev1sec5"
class="calibre6">15.5</a>.</p>
<p>[17] Use <code class="calibre8">scoped_lock</code> to acquire
multiple locks; §<a href="#part0020.html#ch15lev1sec5"
class="calibre6">15.5</a>; [CG: CP.21].</p>
<p>[18] Use <code class="calibre8">shared_lock</code> to implement
reader-write locks; §<a href="#part0020.html#ch15lev1sec5"
class="calibre6">15.5</a>;</p>
<p>[19] Define a <code class="calibre8">mutex</code> together with the
data it protects; §<a href="#part0020.html#ch15lev1sec5"
class="calibre6">15.5</a>; [CG: CP.50].</p>
<p>[20] Use <code class="calibre8">condition_variable</code>s to manage
communication among <code class="calibre8">thread</code>s; §<a
href="#part0020.html#ch15lev1sec6" class="calibre6">15.6</a>.</p>
<p>[21] Use <code class="calibre8">unique_lock</code> (rather than <code
class="calibre8">scoped_lock</code>) when you need to copy a lock or
need lower-level manipulation of synchronization; §<a
href="#part0020.html#ch15lev1sec6" class="calibre6">15.6</a>.</p>
<p>[22] Use <code class="calibre8">unique_lock</code> (rather than <code
class="calibre8">scoped_lock</code>) with <code
class="calibre8">condition_variable</code>s; §<a
href="#part0020.html#ch15lev1sec6" class="calibre6">15.6</a>.</p>
<p>[23] Don’t wait without a condition; §<a
href="#part0020.html#ch15lev1sec6" class="calibre6">15.6</a>; [CG:
CP.42].</p>
<p>[24] Minimize time spent in a critical section; §<a
href="#part0020.html#ch15lev1sec6" class="calibre6">15.6</a> [CG:
CP.43].</p>
<p>[25] Think in terms of tasks that can be executed concurrently,
rather than directly in terms of <code class="calibre8">thread</code>s;
§<a href="#part0020.html#ch15lev1sec7" class="calibre6">15.7</a>.</p>
<p>[26] Value simplicity; §<a href="#part0020.html#ch15lev1sec7"
class="calibre6">15.7</a>.</p>
<p>[27] Prefer <code class="calibre8">packaged_task</code> and <code
class="calibre8">future</code>s over direct use of <code
class="calibre8">thread</code>s and <code
class="calibre8">mutex</code>es; §<a href="#part0020.html#ch15lev1sec7"
class="calibre6">15.7</a>.</p>
<p>[28] Return a result using a <code class="calibre8">promise</code>
and get a result from a <code class="calibre8">future</code>; §<a
href="#part0020.html#ch15lev2sec1" class="calibre6">15.7.1</a>; [CG:
CP.60].</p>
<p>[29] Use <code class="calibre8">packaged_task</code>s to handle
exceptions thrown by tasks and to arrange for value return; §<a
href="#part0020.html#ch15lev2sec2" class="calibre6">15.7.2</a>.</p>
<p>[30] Use a <code class="calibre8">packaged_task</code> and a <code
class="calibre8">future</code> to express a request to an external
service and wait for its response; §<a
href="#part0020.html#ch15lev2sec2" class="calibre6">15.7.2</a>.</p>
<p>[31] Use <code class="calibre8">async()</code> to launch simple
tasks; §<a href="#part0020.html#ch15lev2sec3"
class="calibre6">15.7.3</a>; [CG: CP.61].</p>
</section>
<p><span id="part0021.html"></span></p>
<section id="part0021.html#ch16" class="h1 bodymatter">
<h2 class="h1"><span id="part0021.html#page_207"
class="calibre2 pagebreak"></span><span class="big">16</span></h2>
<p>History and Compatibility</p>
<p><em>Hurry Slowly (festina lente).</em></p>
<p><em>– Octavius, Caesar Augustus</em></p>
<ul>
<li><p><a href="#part0021.html#ch16lev1sec1"
class="calibre6">History</a></p>
<p><a href="#part0021.html#ch16lev2sec1" class="calibre6">Timeline</a>;
<a href="#part0021.html#ch16lev2sec2" class="calibre6">The Early
Years</a>; <a href="#part0021.html#ch16lev2sec3" class="calibre6">The
ISO C++ Standards</a>; <a href="#part0021.html#ch16lev2sec4"
class="calibre6">Standards and Programming Style C++ Use</a></p></li>
<li><p><a href="#part0021.html#ch16lev1sec2" class="calibre6">C++
Feature Evolution</a></p>
<p><a href="#part0021.html#ch16lev2sec6" class="calibre6">C++11 Language
Features</a>; <a href="#part0021.html#ch16lev2sec7"
class="calibre6">C++14 Language Features</a>; <a
href="#part0021.html#ch16lev2sec8" class="calibre6">C++17 Language
Features</a>; <a href="#part0021.html#ch16lev2sec9"
class="calibre6">C++11 Standard-Library Components</a>; <a
href="#part0021.html#ch16lev2sec10" class="calibre6">C++14
Standard-Library Components</a>; <a href="#part0021.html#ch16lev2sec11"
class="calibre6">C++17 Standard-Library Components</a>; <a
href="#part0021.html#ch16lev2sec12" class="calibre6">Removed and
Deprecated Features</a></p></li>
<li><p><a href="#part0021.html#ch16lev1sec3" class="calibre6">C/C++
Compatibility</a></p>
<p><a href="#part0021.html#ch16lev2sec13" class="calibre6">C and C++ Are
Siblings</a>; <a href="#part0021.html#ch16lev2sec14"
class="calibre6">Compatibility Problems</a></p></li>
<li><p><a href="#part0021.html#ch16lev1sec4"
class="calibre6">Bibliography</a></p></li>
<li><p><a href="#part0021.html#ch16lev1sec5"
class="calibre6">Advice</a></p></li>
</ul>
<h3 class="h2" id="part0021.html#ch16lev1sec1">16.1 History</h3>
<p>I invented C++, wrote its early definitions, and produced its first
implementation. I chose and formulated the design criteria for C++,
designed its major language features, developed or helped to develop
many of the early libraries, and for 25 years was responsible for the
processing of extension proposals in the C++ standards committee.</p>
<p>C++ was designed to provide Simula’s facilities for program
organization [<a href="#part0021.html#ref15"
class="calibre6">Dahl,1970</a>] together with C’s efficiency and
flexibility for systems programming [<a href="#part0021.html#ref29"
class="calibre6">Kernighan,1978</a>]. Simula was the initial source of
C++’s abstraction mechanisms. The class concept (with derived classes
and virtual functions) was borrowed from it. However, templates and
exceptions came to C++ later with different sources of inspiration.</p>
<p><span id="part0021.html#page_208" class="pagebreak"></span>The
evolution of C++ was always in the context of its use. I spent a lot of
time listening to users and seeking out the opinions of experienced
programmers. In particular, my colleagues at AT&amp;T Bell Laboratories
were essential for the growth of C++ during its first decade.</p>
<p>This section is a brief overview; it does not try to mention every
language feature and library component. Furthermore, it does not go into
details. For more information, and in particular for more names of
people who contributed, see and my two papers from the ACM History of
Programming Languages conferences [<a href="#part0021.html#ref49"
class="calibre6">Stroustrup,1993</a>] [<a href="#part0021.html#ref53"
class="calibre6">Stroustrup,2007</a>] and my <em>Design and Evolution of
C++</em> book (known as “D&amp;E”) [<a href="#part0021.html#ref50"
class="calibre6">Stroustrup,1994</a>]. They describe the design and
evolution of C++ in detail and document influences from other
programming languages.</p>
<p>Most of the documents produced as part of the ISO C++ standards
effort are available online [<a href="#part0021.html#ref63"
class="calibre6">WG21</a>]. In my FAQ, I try to maintain a connection
between the standard facilities and the people who proposed and refined
those facilities [<a href="#part0021.html#ref55"
class="calibre6">Stroustrup,2010</a>]. C++ is not the work of a
faceless, anonymous committee or of a supposedly omnipotent “dictator
for life”; it is the work of many dedicated, experienced, hard-working
individuals.</p>
<h4 class="h3" id="part0021.html#ch16lev2sec1">16.1.1 Timeline</h4>
<p>The work that led to C++ started in the fall of 1979 under the name
“C with Classes.” Here is a simplified timeline:</p>
<p><em>1979</em> Work on “C with Classes” started. The initial feature
set included classes and derived classes, public/private access control,
constructors and destructors, and function declarations with argument
checking. The first library supported non-preemptive concurrent tasks
and random number generators.</p>
<p><em>1984</em> “C with Classes” was renamed to C++. By then, C++ had
acquired virtual functions, function and operator overloading,
references, and the I/O stream and complex number libraries.</p>
<p><em>1985</em> First commercial release of C++ (October 14). The
library included I/O streams, complex numbers, and tasks (non-preemptive
scheduling).</p>
<p><em>1985 The C++ Programming Language</em> (“TC++PL,” October 14) [<a
href="#part0021.html#ref44" class="calibre6">Stroustrup,1986</a>].</p>
<p><em>1989 The Annotated C++ Reference Manual</em> (“the ARM”) [<a
href="#part0021.html#ref18" class="calibre6">Ellis,1989</a>].</p>
<p><em>1991 The C++ Programming Language, Second Edition</em> [<a
href="#part0021.html#ref48" class="calibre6">Stroustrup,1991</a>],
presenting generic programming using templates and error handling based
on exceptions, including the “Resource Acquisition Is Initialization”
(RAII) general resource-management idiom.</p>
<p><em>1997 The C++ Programming Language, Third Edition</em> [<a
href="#part0021.html#ref51" class="calibre6">Stroustrup,1997</a>]
introduced ISO C++, including namespaces, <code
class="calibre8">dynamic_cast</code>, and many refinements of templates.
The standard library added the STL framework of generic containers and
algorithms.</p>
<p><em>1998</em> ISO C++ standard [<a href="#part0021.html#ref5"
class="calibre6">C++,1998</a>].</p>
<p><em>2002</em> Work on a revised standard, colloquially named C++0x,
started.</p>
<p><em>2003</em> A “bug fix” revision of the ISO C++ standard was
issued. A C++ Technical Report introduced new standard-library
components, such as regular expressions, unordered containers (hash
tables), and resource management pointers, which later became part of
C++11.</p>
<p><em>2006</em> An ISO C++ Technical Report on Performance addressed
questions of cost, predictability, and techniques, mostly related to
embedded systems programming [<a href="#part0021.html#ref6"
class="calibre6">C++,2004</a>].</p>
<p><span id="part0021.html#page_209"
class="pagebreak"></span><em>2011</em> ISO C++11 standard [<a
href="#part0021.html#ref8" class="calibre6">C++,2011</a>]. It provided
uniform initialization, move semantics, types deduced from initializers
(<code class="calibre8">auto</code>), range-<code
class="calibre8">for</code>, variadic template arguments, lambda
expressions, type aliases, a memory model suitable for concurrency, and
much more. The standard library added several components, including
threads, locks, and most of the components from the 2003 Technical
Report.</p>
<p><em>2013</em> The first complete C++11 implementations emerged.</p>
<p><em>2013 The C++ Programming Language, Fourth Edition</em> introduced
C++11.</p>
<p><em>2014</em> ISO C++14 standard [<a href="#part0021.html#ref9"
class="calibre6">C++,2014</a>] completing C++11 with variable templates,
digit separators, generic lambdas, and a few standard-library
improvements. The first C++14 implementations were completed.</p>
<p><em>2015</em> The C++ Core Guidelines projects started [<a
href="#part0021.html#ref60" class="calibre6">Stroustrup,2015</a>].</p>
<p><em>2015</em> The concepts TS was approved.</p>
<p><em>2017</em> ISO C++17 standard [<a href="#part0021.html#ref10"
class="calibre6">C++,2017</a>] offering a diverse set of new features,
including order of evaluation guarantees, structured bindings, fold
expressions, a file system library, parallel algorithms, and <code
class="calibre8">variant</code> and <code
class="calibre8">optional</code> types. The first C++17 implementations
were completed.</p>
<p><em>2017</em> The modules TS and the Ranges TS were approved.</p>
<p><em>2020</em> ISO C++20 standard (scheduled).</p>
<p>During development, C++11 was known as C++0x. As is not uncommon in
large projects, we were overly optimistic about the completion date.
Towards the end, we joked that the ’x’ in C++0x was hexadecimal so that
C++0x became C++0B. On the other hand, the committee shipped C++14 and
C++17 on time, as did the major compiler providers.</p>
<h4 class="h3" id="part0021.html#ch16lev2sec2">16.1.2 The Early
Years</h4>
<p>I originally designed and implemented the language because I wanted
to distribute the services of a UNIX kernel across multiprocessors and
local-area networks (what are now known as multicores and clusters). For
that, I needed to precisely specify parts of a system and how they
communicated. Simula [<a href="#part0021.html#ref15"
class="calibre6">Dahl,1970</a>] would have been ideal for that, except
for performance considerations. I also needed to deal directly with
hardware and provide high-performance concurrent programming mechanisms
for which C would have been ideal, except for its weak support for
modularity and type checking. The result of adding Simula-style classes
to C (Classic C; §<a href="#part0021.html#ch16lev2sec13"
class="calibre6">16.3.1</a>), “C with Classes,” was used for major
projects in which its facilities for writing programs that use minimal
time and space were severely tested. It lacked operator overloading,
references, virtual functions, templates, exceptions, and many, many
details [<a href="#part0021.html#ref42"
class="calibre6">Stroustrup,1982</a>]. The first use of C++ outside a
research organization started in July 1983.</p>
<p>The name C++ (pronounced “see plus plus”) was coined by Rick Mascitti
in the summer of 1983 and chosen as the replacement for “C with Classes”
by me. The name signifies the evolutionary nature of the changes from C;
“++” is the C increment operator. The slightly shorter name “C+” is a
syntax error; it had also been used as the name of an unrelated
language. Connoisseurs of C semantics find C++ inferior to ++C. The
language was not called D, because it was an extension of C, because it
did not attempt to remedy problems by removing features, and because
there already existed several would-be C successors named D. For yet
another interpretation of the name C++, see the appendix of [<a
href="#part0021.html#ref35" class="calibre6">Orwell,1949</a>].</p>
<p><span id="part0021.html#page_210" class="pagebreak"></span>C++ was
designed primarily so that my friends and I would not have to program in
assembler, C, or various then-fashionable high-level languages. Its main
purpose was to make writing good programs easier and more pleasant for
the individual programmer. In the early years, there was no C++ paper
design; design, documentation, and implementation went on
simultaneously. There was no “C++ project” either, or a “C++ design
committee.” Throughout, C++ evolved to cope with problems encountered by
users and as a result of discussions among my friends, my colleagues,
and me.</p>
<p>The very first design of C++ (then called “C with Classes”) included
function declarations with argument type checking and implicit
conversions, classes with the <code class="calibre8">public</code>/<code
class="calibre8">private</code> distinction between the interface and
the implementation, derived classes, and constructors and destructors. I
used macros to provide primitive parameterization [<a
href="#part0021.html#ref42" class="calibre6">Stroustrup,1982</a>]. This
was in non-experimental use by mid-1980. Late that year, I was able to
present a set of language facilities supporting a coherent set of
programming styles. In retrospect, I consider the introduction of
constructors and destructors most significant. In the terminology of the
time [<a href="#part0021.html#ref41"
class="calibre6">Stroustrup,1979</a>]:</p>
<p><em>A “new function” creates the execution environment for the member
functions and the “delete function” reverses that.</em></p>
<p>Soon after, “new function’ and “delete function’ were renamed
“constructor” and “destructor.” Here is the root of C++’s strategies for
resource management (causing a demand for exceptions) and the key to
many techniques for making user code short and clear. If there were
other languages at the time that supported multiple constructors capable
of executing general code, I didn’t (and don’t) know of them.
Destructors were new in C++.</p>
<p>C++ was released commercially in October 1985. By then, I had added
inlining (§<a href="#part0006.html#ch01lev1sec3"
class="calibre6">1.3</a>, §<a href="#part0009.html#ch04lev2sec1"
class="calibre6">4.2.1</a>), <code class="calibre8">const</code>s (§<a
href="#part0006.html#ch01lev1sec6" class="calibre6">1.6</a>), function
overloading (§<a href="#part0006.html#ch01lev1sec3"
class="calibre6">1.3</a>), references (§<a
href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>), operator
overloading (§<a href="#part0009.html#ch04lev2sec1"
class="calibre6">4.2.1</a>), and virtual functions (§<a
href="#part0009.html#ch04lev1sec4" class="calibre6">4.4</a>). Of these
features, support for run-time polymorphism in the form of virtual
functions was by far the most controversial. I knew its worth from
Simula but found it impossible to convince most people in the systems
programming world of its value. Systems programmers tended to view
indirect function calls with suspicion, and people acquainted with other
languages supporting object-oriented programming had a hard time
believing that <code class="calibre8">virtual</code> functions could be
fast enough to be useful in systems code. Conversely, many programmers
with an object-oriented background had (and many still have) a hard time
getting used to the idea that you use virtual function calls only to
express a choice that must be made at run time. The resistance to
virtual functions may be related to a resistance to the idea that you
can get better systems through more regular structure of code supported
by a programming language. Many C programmers seem convinced that what
really matters is complete flexibility and careful individual crafting
of every detail of a program. My view was (and is) that we need every
bit of help we can get from languages and tools: the inherent complexity
of the systems we are trying to build is always at the edge of what we
can express.</p>
<p>Early documents (e.g., [<a href="#part0021.html#ref43"
class="calibre6">Stroustrup,1985</a>] and [<a
href="#part0021.html#ref50" class="calibre6">Stroustrup,1994</a>])
described C++ like this:</p>
<p><em>C++ is a general-purpose programming language that</em></p>
<ul>
<li><p><em>is a better C</em></p></li>
<li><p><em>supports data abstraction</em></p></li>
<li><p><em>supports object-oriented programming</em></p></li>
</ul>
<p>Note <em>not</em> “C++ is an object-oriented programming language.”
Here, “supports data abstraction” refers to information hiding, classes
that are not part of class hierarchies, and generic programming. <span
id="part0021.html#page_211" class="pagebreak"></span>Initially, generic
programming was poorly supported through the use of macros
[Stroustrup,1981]. Templates and concepts came much later.</p>
<p>Much of the design of C++ was done on the blackboards of my
colleagues. In the early years, the feedback from Stu Feldman, Alexander
Fraser, Steve Johnson, Brian Kernighan, Doug McIlroy, and Dennis Ritchie
was invaluable.</p>
<p>In the second half of the 1980s, I continued to add language features
in response to user comments. The most important of those were templates
[<a href="#part0021.html#ref47" class="calibre6">Stroustrup,1988</a>]
and exception handling [<a href="#part0021.html#ref32"
class="calibre6">Koenig,1990</a>], which were considered experimental at
the time the standards effort started. In the design of templates, I was
forced to decide among flexibility, efficiency, and early type checking.
At the time, nobody knew how to simultaneously get all three. To compete
with C-style code for demanding systems applications, I felt that I had
to choose the first two properties. In retrospect, I think the choice
was the correct one, and the search for better type checking of
templates continues [<a href="#part0021.html#ref17"
class="calibre6">DosReis,2006</a>] [<a href="#part0021.html#ref24"
class="calibre6">Gregor,2006</a>] [<a href="#part0021.html#ref62"
class="calibre6">Sutton,2011</a>] [<a href="#part0021.html#ref56"
class="calibre6">Stroustrup,2012a</a>]. The design of exceptions focused
on multilevel propagation of exceptions, the passing of arbitrary
information to an error handler, and the integration between exceptions
and resource management by using local objects with destructors to
represent and release resources. I clumsily named that critical
technique <em>Resource Acquisition Is Initialization</em> and others
soon reduced that to the acronym <em>RAII</em> (§<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>).</p>
<p>I generalized C++’s inheritance mechanisms to support multiple base
classes [<a href="#part0021.html#ref45"
class="calibre6">Stroustrup,1987a</a>]. This was called <em>multiple
inheritance</em> and was considered difficult and controversial. I
considered it far less important than templates or exceptions. Multiple
inheritance of abstract classes (often called <em>interfaces</em>) is
now universal in languages supporting static type checking and
object-oriented programming.</p>
<p>The C++ language evolved hand-in-hand with some of the key library
facilities. For example, I designed the complex [<a
href="#part0021.html#ref42a" class="calibre6">Stroustrup,1984</a>],
vector, stack, and (I/O) stream classes [<a href="#part0021.html#ref43"
class="calibre6">Stroustrup,1985</a>] together with the operator
overloading mechanisms. The first string and list classes were developed
by Jonathan Shopiro and me as part of the same effort. Jonathan’s string
and list classes were the first to see extensive use as part of a
library. The string class from the standard C++ library has its roots in
these early efforts. The task library described in [<a
href="#part0021.html#ref46" class="calibre6">Stroustrup,1987b</a>] was
part of the first “C with Classes” program ever written in 1980. It
provided coroutines and a scheduler. I wrote it and its associated
classes to support Simula-style simulations. Unfortunately, we had to
wait until 2011 (30 years!) to get concurrency support standardized and
universally available (<a href="#part0020.html#ch15"
class="calibre6">Chapter 15</a>). Coroutines are likely to be part of
C++20 [<a href="#part0021.html#ref12"
class="calibre6">CoroutinesTS</a>]. The development of the template
facility was influenced by a variety of <code
class="calibre8">vector</code>, <code class="calibre8">map</code>, <code
class="calibre8">list</code>, and <code class="calibre8">sort</code>
templates devised by Andrew Koenig, Alex Stepanov, me, and others.</p>
<p>The most important innovation in the 1998 standard library was the
STL, a framework of algorithms and containers (<a
href="#part0016.html#ch11" class="calibre6">Chapter 11</a>, <a
href="#part0017.html#ch12" class="calibre6">Chapter 12</a>). It was the
work of Alex Stepanov (with Dave Musser, Meng Lee, and others) based on
more than a decade’s work on generic programming. The STL has been
massively influential within the C++ community and beyond.</p>
<p>C++ grew up in an environment with a multitude of established and
experimental programming languages (e.g., Ada [<a
href="#part0021.html#ref27" class="calibre6">Ichbiah,1979</a>], Algol 68
[<a href="#part0021.html#ref65" class="calibre6">Woodward,1974</a>], and
ML [<a href="#part0021.html#ref36" class="calibre6">Paulson,1996</a>]).
At the time, I was comfortable in about 25 languages, and their
influences on C++ are documented in [<a href="#part0021.html#ref50"
class="calibre6">Stroustrup,1994</a>] and [<a
href="#part0021.html#ref53" class="calibre6">Stroustrup,2007</a>].
However, the determining influences always came from the applications I
encountered. It was a deliberate policy to have the development of C++
“problem driven” rather than imitative.</p>
<h4 class="h3" id="part0021.html#ch16lev2sec3"><span
id="part0021.html#page_212" class="calibre2 pagebreak"></span>16.1.3 The
ISO C++ Standards</h4>
<p>The explosive growth of C++ use caused some changes. Sometime during
1987, it became clear that formal standardization of C++ was inevitable
and that we needed to start preparing the ground for a standardization
effort [<a href="#part0021.html#ref50"
class="calibre6">Stroustrup,1994</a>]. The result was a conscious effort
to maintain contact between implementers of C++ compilers and their
major users. This was done through paper and electronic mail and through
face-to-face meetings at C++ conferences and elsewhere.</p>
<p>AT&amp;T Bell Labs made a major contribution to C++ and its wider
community by allowing me to share drafts of revised versions of the C++
reference manual with implementers and users. Because many of those
people worked for companies that could be seen as competing with
AT&amp;T, the significance of this contribution should not be
underestimated. A less enlightened company could have caused major
problems of language fragmentation simply by doing nothing. As it
happened, about a hundred individuals from dozens of organizations read
and commented on what became the generally accepted reference manual and
the base document for the ANSI C++ standardization effort. Their names
can be found in <em>The Annotated C++ Reference Manual</em> (“the ARM”)
[<a href="#part0021.html#ref18" class="calibre6">Ellis,1989</a>]. The
X3J16 committee of ANSI was convened in December 1989 at the initiative
of Hewlett-Packard. In June 1991, this ANSI (American national)
standardization of C++ became part of an ISO (international)
standardization effort for C++. The ISO C++ committee is called WG21.
From 1990, these joint C++ standards committees have been the main forum
for the evolution of C++ and the refinement of its definition. I served
on these committees throughout. In particular, as the chairman of the
working group for extensions (later called the evolution group) from
1990 to 2014, I was directly responsible for handling proposals for
major changes to C++ and the addition of new language features. An
initial draft standard for public review was produced in April 1995. The
first ISO C++ standard (ISO/IEC 14882-1998) [<a
href="#part0021.html#ref5" class="calibre6">C++,1998</a>] was ratified
by a 22-0 national vote in 1998. A “bug fix release” of this standard
was issued in 2003, so you sometimes hear people refer to C++03, but
that is essentially the same language as C++98.</p>
<p>C++11, known for years as C++0x, is the work of the members of WG21.
The committee worked under increasingly onerous self-imposed processes
and procedures. These processes probably led to a better (and more
rigorous) specification, but they also limited innovation [<a
href="#part0021.html#ref53" class="calibre6">Stroustrup,2007</a>]. An
initial draft standard for public review was produced in 2009. The
second ISO C++ standard (ISO/IEC 14882-2011) [<a
href="#part0021.html#ref8" class="calibre6">C++,2011</a>] was ratified
by a 21-0 national vote in August 2011.</p>
<p>One reason for the long gap between the two standards is that most
members of the committee (including me) were under the mistaken
impression that the ISO rules required a “waiting period” after a
standard was issued before starting work on new features. Consequently,
serious work on new language features did not start until 2002. Other
reasons included the increased size of modern languages and their
foundation libraries. In terms of pages of standards text, the language
grew by about 30% and the standard library by about 100%. Much of the
increase was due to more detailed specification, rather than new
functionality. Also, the work on a new C++ standard obviously had to
take great care not to compromise older code through incompatible
changes. There are billions of lines of C++ code in use that the
committee must not break. Stability over decades is an essential
“feature.”</p>
<p>C++11 added massively to the standard library and pushed to complete
the feature set needed for a programming style that is a synthesis of
the “paradigms” and idioms that had proven successful with C++98.</p>
<p><span id="part0021.html#page_213" class="pagebreak"></span>The
overall aims for the C++11 effort were:</p>
<ul>
<li><p>Make C++ a better language for systems programming and library
building.</p></li>
<li><p>Make C++ easier to teach and learn.</p></li>
</ul>
<p>The aims are documented and detailed in [<a
href="#part0021.html#ref53" class="calibre6">Stroustrup,2007</a>].</p>
<p>A major effort was made to make concurrent systems programming
type-safe and portable. This involved a memory model (§<a
href="#part0020.html#ch15lev1sec1" class="calibre6">15.1</a>) and
support for lock-free programming, This was the work of Hans Boehm,
Brian McKnight, and others in the concurrency working group. On top of
that, we added the <code class="calibre8">thread</code>s library.</p>
<p>After C++11, there was wide agreement that 13 years between standards
were far too many. Herb Sutter proposed that the committee adopt a
policy of shipping on time at fixed intervals, the “train model.” I
argued strongly for a short interval between standards to minimize the
chance of delays because someone insisted on extra time to allow
inclusion of “just one more essential feature.” We agreed on an
ambitious 3-year schedule with the idea that we should alternate between
minor and major releases.</p>
<p>C++14 was deliberately a minor release aiming at “completing C++11.”
This reflects the reality that with a fixed release date, there will be
features that we know we want, but can’t deliver on time. Also, once in
widespread use, gaps in the feature set will inevitably be
discovered.</p>
<p>To allow work to progress faster, to allow parallel development of
independent features, and to better utilize the enthusiasm and skills of
the many volunteers, the committee makes use of the ISO mechanisms of
developing and publishing “Technical Specifications” (TSs). That seems
to work well for standard-library components, though it can lead to more
stages in the development process, and thus delays. For language
features, TSs seems to work less well. Possibly the reason is that few
significant language features are truly independent, because the work of
crafting standards wording isn’t all that different between a standard
and a TS, and because fewer people can experiment with compilers
implementations.</p>
<p>C++17 was meant to be a major release. By “major,” I mean containing
features that will change the way we think about design and structure
our software. By this definition, C++17 was at best a medium release. It
included a lot of minor extensions, but the features that would have
made dramatic changes (e.g., concepts, modules, and coroutines) were
either not ready or became mired in controversy and lack of design
direction. As a result, C++17 includes a little bit for everyone, but
nothing that will significantly change the life of a C++ programmer who
has already absorbed the lessons of C++11 and C++14. I hope that C++20
will be the promised and much-needed major revision, and that the major
new features will become widely available well before 2020. The dangers
are “Design by committee,” feature bloat, lack of consistent style, and
short-sighted decisions. In a committee with well over 100 members
present at each meeting and more participating online, such undesirable
phenomena are almost unavoidable. Making progress toward a
simpler-to-use and more coherent language is very hard.</p>
<h4 class="h3" id="part0021.html#ch16lev2sec4">16.1.4 Standards and
Style</h4>
<p>A standard says what will work, and how. It does not say what
constitutes good and effective use. There are significant differences
between understanding the technical details of programming language
features and using them effectively in combination with other features,
libraries, and tools to produce better software. By “better” I mean
“more maintainable, less error-prone, and faster.” <span
id="part0021.html#page_214" class="pagebreak"></span>We need to develop,
popularize, and support coherent programming styles. Further, we must
support the evolution of older code to these more modern, effective, and
coherent styles.</p>
<p>With the growth of the language and its standard library, the problem
of popularizing effective programming styles became critical. It is
extremely difficult to make large groups of programmers depart from
something that works for something better. There are still people who
see C++ as a few minor additions to C and people who consider 1980s
Object-Oriented programming styles based on massive class hierarchies
the pinnacle of development. Many are struggling to use C++11 well in
environments with lots of old C++ code. On the other hand, there are
also many who enthusiastically overuse novel facilities. For example,
some programmers are convinced that only code using massive amounts of
template metaprogramming is true C++.</p>
<p>What is <em>Modern C++</em>? In 2015, I set out to answer this
question by developing a set of coding guidelines supported by
articulated rationales. I soon found that I was not alone in grappling
with that problem and together with people from many parts of the world,
notably from Microsoft, Red Hat, and Facebook, we started the “C++ Core
Guidelines” project [<a href="#part0021.html#ref60"
class="calibre6">Stroustrup,2015</a>]. This is an ambitious project
aiming at complete type-safety and complete resource-safety as a base
for simpler, faster, and more maintainable code [Stroustrup,2016]. In
addition to specific coding rules with rationales, we back up the
guidelines with static analysis tools and a tiny support library. I see
something like that as necessary for moving the C++ community at large
forward to benefit from the improvements in language features,
libraries, and supporting tools.</p>
<h4 class="h3" id="part0021.html#ch16lev2sec5">16.1.5 C++ Use</h4>
<p>C++ is now a very widely used programming language. Its user
populations grew quickly from one in 1979 to about 400,000 in 1991; that
is, the number of users doubled about every 7.5 months for more than a
decade. Naturally, the growth rate slowed since that initial growth
spurt, but my best estimate is that there are about 4.5 million C++
programmers in 2018 [<a href="#part0021.html#ref28"
class="calibre6">Kazakova,2015</a>]. Much of that growth happened after
2005 when the exponential explosion of processor speed stopped so that
language performance grew in importance. This growth was achieved
without formal marketing or an organized user community.</p>
<p>C++ is primarily an industrial language; that is, it is more
prominent in industry than in education or programming language
research. It grew up in Bell Labs inspired by the varied and stringent
needs of the telecommunications and of systems programming (including
device drivers, networking, and embedded systems). From there, C++ use
has spread into essential every industry: microelectronics, Web
applications and infrastructure, operating systems, financial, medical,
automobile, aerospace, high-energy physics, biology, energy production,
machine learning, video games, graphics, animation, virtual reality, and
much more. It is primarily used where problems require C++’s combination
of the ability to use hardware effectively and to manage complexity.
This seems to be a continuously expanding set of applications [<a
href="#part0021.html#ref49" class="calibre6">Stroustrup,1993</a>] [<a
href="#part0021.html#ref59" class="calibre6">Stroustrup,2014</a>].</p>
<h3 class="h2" id="part0021.html#ch16lev1sec2">16.2 C++ Feature
Evolution</h3>
<p>Here, I list the language features and standard-library components
that have been added to C++ for the C++11, C++14, and C++17
standards.</p>
<h4 class="h3" id="part0021.html#ch16lev2sec6"><span
id="part0021.html#page_215" class="calibre2 pagebreak"></span>16.2.1
C++11 Language Features</h4>
<p>Looking at a list of language features can be quite bewildering.
Remember that a language feature is not meant to be used in isolation.
In particular, most features that are new in C++11 make no sense in
isolation from the framework provided by older features.</p>
<p>[1] Uniform and general initialization using <code
class="calibre8">{}</code>-lists (§<a href="#part0006.html#ch01lev1sec4"
class="calibre6">1.4</a>, §<a href="#part0009.html#ch04lev2sec3"
class="calibre6">4.2.3</a>)</p>
<p>[2] Type deduction from initializer: <code
class="calibre8">auto</code> (§<a href="#part0006.html#ch01lev1sec4"
class="calibre6">1.4</a>)</p>
<p>[3] Prevention of narrowing (§<a href="#part0006.html#ch01lev1sec4"
class="calibre6">1.4</a>)</p>
<p>[4] Generalized and guaranteed constant expressions: <code
class="calibre8">constexpr</code> (§<a
href="#part0006.html#ch01lev1sec6" class="calibre6">1.6</a>)</p>
<p>[5] Range-<code class="calibre8">for</code>-statement (§<a
href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>)</p>
<p>[6] Null pointer keyword: <code class="calibre8">nullptr</code> (§<a
href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>)</p>
<p>[7] Scoped and strongly typed <code class="calibre8">enums</code>:
<code class="calibre8">enum class</code> (§<a
href="#part0007.html#ch02lev1sec5" class="calibre6">2.5</a>)</p>
<p>[8] Compile-time assertions: <code
class="calibre8">static_assert</code> (§<a
href="#part0008.html#ch03lev2sec5" class="calibre6">3.5.5</a>)</p>
<p>[9] Language mapping of <code class="calibre8">{}</code>-list to
<code class="calibre8">std::initializer_list</code> (§<a
href="#part0009.html#ch04lev2sec3" class="calibre6">4.2.3</a>)</p>
<p>[10] Rvalue references, enabling move semantics (§<a
href="#part0010.html#ch05lev2sec5" class="calibre6">5.2.2</a>)</p>
<p>[11] Nested template arguments ending with <code
class="calibre8">&gt;&gt;</code> (no space between the <code
class="calibre8">&gt;</code>s)</p>
<p>[12] Lambdas (§<a href="#part0011.html#ch06lev2sec5"
class="calibre6">6.3.2</a>)</p>
<p>[13] Variadic templates (§<a href="#part0012.html#ch07lev1sec4"
class="calibre6">7.4</a>)</p>
<p>[14] Type and template aliases (§<a
href="#part0011.html#ch06lev2sec8" class="calibre6">6.4.2</a>)</p>
<p>[15] Unicode characters</p>
<p>[16] <code class="calibre8">long long</code> integer type</p>
<p>[17] Alignment controls: <code class="calibre8">alignas</code> and
<code class="calibre8">alignof</code></p>
<p>[18] The ability to use the type of an expression as a type in a
declaration: <code class="calibre8">decltype</code></p>
<p>[19] Raw string literals (§<a href="#part0014.html#ch09lev1sec4"
class="calibre6">9.4</a>)</p>
<p>[20] Generalized POD (“Plain Old Data”)</p>
<p>[21] Generalized <code class="calibre8">union</code>s</p>
<p>[22] Local classes as template arguments</p>
<p>[23] Suffix return type syntax</p>
<p>[24] A syntax for attributes and two standard attributes: <code
class="calibre8">[[carries_dependency]]</code> and <code
class="calibre8">[[noreturn]]</code></p>
<p>[25] Preventing exception propagation: the <code
class="calibre8">noexcept</code> specifier (§<a
href="#part0008.html#ch03lev2sec1" class="calibre6">3.5.1</a>)</p>
<p>[26] Testing for the possibility of a <code
class="calibre8">throw</code> in an expression: the <code
class="calibre8">noexcept</code> operator.</p>
<p>[27] C99 features: extended integral types (i.e., rules for optional
longer integer types); concatenation of narrow/wide strings; <code
class="calibre8">__STDC_HOSTED__</code>; <code
class="calibre8">_Pragma(X)</code>; vararg macros and empty macro
arguments</p>
<p>[28] <code class="calibre8">__func__</code> as the name of a string
holding the name of the current function</p>
<p>[29] <code class="calibre8">inline</code> namespaces</p>
<p>[30] Delegating constructors</p>
<p>[31] In-class member initializers (§<a
href="#part0010.html#ch05lev2sec3" class="calibre6">5.1.3</a>)</p>
<p>[32] Control of defaults: <code class="calibre8">default</code> and
<code class="calibre8">delete</code> (§4.6.5)</p>
<p>[33] Explicit conversion operators</p>
<p>[34] User-defined literals (§<a href="#part0010.html#ch05lev2sec9"
class="calibre6">5.4.4</a>)</p>
<p>[35] More explicit control of <code class="calibre8">template</code>
instantiation: <code class="calibre8">extern template</code>s</p>
<p>[36] Default template arguments for function templates</p>
<p><span id="part0021.html#page_216" class="pagebreak"></span>[37]
Inheriting constructors</p>
<p>[38] Override controls: <code class="calibre8">override</code> and
<code class="calibre8">final</code> (§<a
href="#part0009.html#ch04lev2sec4" class="calibre6">4.5.1</a>)</p>
<p>[39] A simpler and more general SFINAE (Substitution Failure Is Not
An Error) rule</p>
<p>[40] Memory model (§<a href="#part0020.html#ch15lev1sec1"
class="calibre6">15.1</a>)</p>
<p>[41] Thread-local storage: <code
class="calibre8">thread_local</code></p>
<p>For a more complete description of the changes to C++98 in C++11, see
[<a href="#part0021.html#ref58"
class="calibre6">Stroustrup,2013</a>].</p>
<h4 class="h3" id="part0021.html#ch16lev2sec7">16.2.2 C++14 Language
Features</h4>
<p>[1] Function return-type deduction; §<a
href="#part0008.html#ch03lev2sec7" class="calibre6">3.6.2</a></p>
<p>[2] Improved <code class="calibre8">constexpr</code> functions, e.g.,
<code class="calibre8">for</code>-loops allowed (§<a
href="#part0006.html#ch01lev1sec6" class="calibre6">1.6</a>)</p>
<p>[3] Variable templates (§<a href="#part0011.html#ch06lev2sec7"
class="calibre6">6.4.1</a>)</p>
<p>[4] Binary literals (§<a href="#part0006.html#ch01lev1sec4"
class="calibre6">1.4</a>)</p>
<p>[5] Digit separators (§<a href="#part0006.html#ch01lev1sec4"
class="calibre6">1.4</a>)</p>
<p>[6] Generic lambdas (§<a href="#part0011.html#ch06lev2sec6"
class="calibre6">6.3.3</a>)</p>
<p>[7] More general lambda capture</p>
<p>[8] <code class="calibre8">[[deprecated]]</code> attribute</p>
<p>[9] A few more minor extensions</p>
<h4 class="h3" id="part0021.html#ch16lev2sec8">16.2.3 C++17 Language
Features</h4>
<p>[1] Guaranteed copy elision (§<a href="#part0010.html#ch05lev2sec5"
class="calibre6">5.2.2</a>)</p>
<p>[2] Dynamic allocation of over-aligned types</p>
<p>[3] Stricter order of evaluation (§<a
href="#part0006.html#ch01lev1sec4" class="calibre6">1.4</a>)</p>
<p>[4] UTF-8 literals (<code class="calibre8">u8</code>)</p>
<p>[5] Hexadecimal floating-point literals</p>
<p>[6] Fold expressions (§<a href="#part0012.html#ch07lev2sec7"
class="calibre6">7.4.1</a>)</p>
<p>[7] Generic value template arguments (<code
class="calibre8">auto</code> template parameters)</p>
<p>[8] Class template argument type deduction (§<a
href="#part0011.html#ch06lev2sec3" class="calibre6">6.2.3</a>)</p>
<p>[9] Compile-time <code class="calibre8">if</code> (§<a
href="#part0011.html#ch06lev2sec9" class="calibre6">6.4.3</a>)</p>
<p>[10] Selection statements with initializers (§<a
href="#part0006.html#ch01lev1sec8" class="calibre6">1.8</a>)</p>
<p>[11] <code class="calibre8">constexpr</code> lambdas</p>
<p>[12] <code class="calibre8">inline</code> variables</p>
<p>[13] Structured bindings (§<a href="#part0008.html#ch03lev2sec8"
class="calibre6">3.6.3</a>)</p>
<p>[14] New standard attributes: <code
class="calibre8">[[fallthrough]]</code>, <code
class="calibre8">[[nodiscard]]</code>, and <code
class="calibre8">[[maybe_unused]]</code></p>
<p>[15] <code class="calibre8">std::byte</code> type</p>
<p>[16] Initialization of an <code class="calibre8">enum</code> by a
value of its underlying type (§<a href="#part0007.html#ch02lev1sec5"
class="calibre6">2.5</a>)</p>
<p>[17] A few more minor extensions</p>
<h4 class="h3" id="part0021.html#ch16lev2sec9">16.2.4 C++11
Standard-Library Components</h4>
<p>The C++11 additions to the standard library come in two forms: new
components (such as the regular expression matching library) and
improvements to C++98 components (such as move constructors for
containers).</p>
<p><span id="part0021.html#page_217" class="pagebreak"></span>[1] <code
class="calibre8">initializer_list</code> constructors for containers
(§<a href="#part0009.html#ch04lev2sec3" class="calibre6">4.2.3</a>)</p>
<p>[2] Move semantics for containers (§<a
href="#part0010.html#ch05lev2sec5" class="calibre6">5.2.2</a>, §<a
href="#part0016.html#ch11lev1sec2" class="calibre6">11.2</a>)</p>
<p>[3] A singly-linked list: <code class="calibre8">forward_list</code>
(§<a href="#part0016.html#ch11lev1sec6" class="calibre6">11.6</a>)</p>
<p>[4] Hash containers: <code class="calibre8">unordered_map</code>,
<code class="calibre8">unordered_multimap</code>, <code
class="calibre8">unordered_set</code>, and <code
class="calibre8">unordered_multiset</code> (§<a
href="#part0016.html#ch11lev1sec6" class="calibre6">11.6</a>, §<a
href="#part0016.html#ch11lev1sec5" class="calibre6">11.5</a>)</p>
<p>[5] Resource management pointers: <code
class="calibre8">unique_ptr</code>, <code
class="calibre8">shared_ptr</code>, and <code
class="calibre8">weak_ptr</code> (§<a href="#part0018.html#ch13lev2sec1"
class="calibre6">13.2.1</a>)</p>
<p>[6] Concurrency support: <code class="calibre8">thread</code> (§<a
href="#part0020.html#ch15lev1sec2" class="calibre6">15.2</a>), mutexes
(§<a href="#part0020.html#ch15lev1sec5" class="calibre6">15.5</a>),
locks (§<a href="#part0020.html#ch15lev1sec5"
class="calibre6">15.5</a>), and condition variables (§<a
href="#part0020.html#ch15lev1sec6" class="calibre6">15.6</a>)</p>
<p>[7] Higher-level concurrency support: <code
class="calibre8">packaged_thread</code>, <code
class="calibre8">future</code>, <code class="calibre8">promise</code>,
and <code class="calibre8">async()</code> (§<a
href="#part0020.html#ch15lev1sec7" class="calibre6">15.7</a>)</p>
<p>[8] <code class="calibre8">tuple</code>s (§<a
href="#part0018.html#ch13lev2sec5" class="calibre6">13.4.3</a>)</p>
<p>[9] Regular expressions: <code class="calibre8">regex</code> (§<a
href="#part0014.html#ch09lev1sec4" class="calibre6">9.4</a>)</p>
<p>[10] Random numbers: distributions and engines (§<a
href="#part0019.html#ch14lev1sec5" class="calibre6">14.5</a>)</p>
<p>[11] Integer type names, such as <code
class="calibre8">int16_t</code>, <code class="calibre8">uint32_t</code>,
and <code class="calibre8">int_fast64_t</code></p>
<p>[12] A fixed-sized contiguous sequence container: <code
class="calibre8">array</code> (§<a href="#part0018.html#ch13lev2sec3"
class="calibre6">13.4.1</a>)</p>
<p>[13] Copying and rethrowing exceptions (§<a
href="#part0020.html#ch15lev2sec1" class="calibre6">15.7.1</a>)</p>
<p>[14] Error reporting using error codes: <code
class="calibre8">system_error</code></p>
<p>[15] <code class="calibre8">emplace()</code> operations for
containers (§<a href="#part0016.html#ch11lev1sec6"
class="calibre6">11.6</a>)</p>
<p>[16] Wide use of <code class="calibre8">constexpr</code>
functions</p>
<p>[17] Systematic use of <code class="calibre8">noexcept</code>
functions</p>
<p>[18] Improved function adaptors: <code
class="calibre8">function</code> and <code
class="calibre8">bind()</code> (§<a href="#part0018.html#ch13lev1sec8"
class="calibre6">13.8</a>)</p>
<p>[19] <code class="calibre8">string</code> to numeric value
conversions</p>
<p>[20] Scoped allocators</p>
<p>[21] Type traits, such as <code class="calibre8">is_integral</code>
and <code class="calibre8">is_base_of</code> (§<a
href="#part0018.html#ch13lev2sec13" class="calibre6">13.9.2</a>)</p>
<p>[22] Time utilities: <code class="calibre8">duration</code> and <code
class="calibre8">time_point</code> (§<a
href="#part0018.html#ch13lev1sec7" class="calibre6">13.7</a>)</p>
<p>[23] Compile-time rational arithmetic: <code
class="calibre8">ratio</code></p>
<p>[24] Abandoning a process: <code
class="calibre8">quick_exit</code></p>
<p>[25] More algorithms, such as <code class="calibre8">move()</code>,
<code class="calibre8">copy_if()</code>, and <code
class="calibre8">is_sorted()</code> (<a href="#part0017.html#ch12"
class="calibre6">Chapter 12</a>)</p>
<p>[26] Garbage collection ABI (§<a href="#part0010.html#ch05lev1sec3"
class="calibre6">5.3</a>)</p>
<p>[27] Low-level concurrency support: <code
class="calibre8">atomic</code>s</p>
<h4 class="h3" id="part0021.html#ch16lev2sec10">16.2.5 C++14
Standard-Library Components</h4>
<p>[1] <code class="calibre8">shared_mutex</code> (§<a
href="#part0020.html#ch15lev1sec5" class="calibre6">15.5</a>)</p>
<p>[2] User-defined literals (§<a href="#part0010.html#ch05lev2sec9"
class="calibre6">5.4.4</a>)</p>
<p>[3] Tuple addressing by type (§<a href="#part0018.html#ch13lev2sec5"
class="calibre6">13.4.3</a>)</p>
<p>[4] Associative container heterogenous lookup</p>
<p>[5] Plus a few more minor features</p>
<h4 class="h3" id="part0021.html#ch16lev2sec11">16.2.6 C++17
Standard-Library Components</h4>
<p>[1] File system (§<a href="#part0015.html#ch10lev1sec10"
class="calibre6">10.10</a>)</p>
<p>[2] Parallel algorithms (§<a href="#part0017.html#ch12lev1sec9"
class="calibre6">12.9</a>, §<a href="#part0019.html#ch14lev2sec1"
class="calibre6">14.3.1</a>)</p>
<p>[3] Mathematical special functions (§<a
href="#part0019.html#ch14lev1sec2" class="calibre6">14.2</a>)</p>
<p>[4] <code class="calibre8">string_view</code> (§<a
href="#part0014.html#ch09lev1sec3" class="calibre6">9.3</a>)</p>
<p><span id="part0021.html#page_218" class="pagebreak"></span>[5] <code
class="calibre8">any</code> (§<a href="#part0018.html#ch13lev2sec8"
class="calibre6">13.5.3</a>)</p>
<p>[6] <code class="calibre8">variant</code> (§<a
href="#part0018.html#ch13lev2sec6" class="calibre6">13.5.1</a>)</p>
<p>[7] <code class="calibre8">optional</code> (§<a
href="#part0018.html#ch13lev2sec7" class="calibre6">13.5.2</a>)</p>
<p>[8] <code class="calibre8">invoke()</code></p>
<p>[9] Elementary string conversions: <code
class="calibre8">to_chars</code> and <code
class="calibre8">from_chars</code></p>
<p>[10] Polymorphic allocator (§<a href="#part0018.html#ch13lev1sec6"
class="calibre6">13.6</a>)</p>
<p>[11] A few more minor extensions</p>
<h4 class="h3" id="part0021.html#ch16lev2sec12">16.2.7 Removed and
Deprecated Features</h4>
<p>There are billions of lines of C++ “out there” and nobody knows
exactly what features are in critical use. Consequently, the ISO
committee removes older features only reluctantly and after years of
warning. However, sometimes troublesome features are removed:</p>
<ul>
<li><p>C++17 finally removed exceptions specifications:</p>
<p><a href="#part0040_split_000.html#p0218_01a"
id="part0021.html#p0218_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb462"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb462-1"><a href="#cb462-1" aria-hidden="true" tabindex="-1"></a>void f() <span class="kw">throw</span>(<span class="dt">X</span><span class="kw">,</span><span class="dt">Y</span>)<span class="kw">;</span> <span class="fu">//</span> <span class="dt">C</span>++<span class="dv">98</span><span class="kw">;</span> now an error</span></code></pre></div>
<p>The support facilities for exception specifications, <code
class="calibre8">unexcepted_handler</code>, <code
class="calibre8">set_unexpected()</code>, <code
class="calibre8">get_unexpected()</code>, and <code
class="calibre8">unexpected()</code>, are similarly removed. Instead,
use <code class="calibre8">noexcept</code> (§<a
href="#part0008.html#ch03lev2sec1" class="calibre6">3.5.1</a>).</p></li>
<li><p>Trigraphs are no longer supported.</p></li>
<li><p>The <code class="calibre8">auto_ptr</code> is deprecated.
Instead, use <code class="calibre8">unique_ptr</code> (§<a
href="#part0018.html#ch13lev2sec1"
class="calibre6">13.2.1</a>).</p></li>
<li><p>The use of the storage specifier <code
class="calibre8">register</code> is removed.</p></li>
<li><p>The use of <code class="calibre8">++</code> on a <code
class="calibre8">bool</code> is removed.</p></li>
<li><p>The C++98 <code class="calibre8">export</code> feature was
removed because it was complex and not shipped by the major vendors.
Instead, <code class="calibre8">export</code> is used as a keyword for
modules (§<a href="#part0008.html#ch03lev1sec3"
class="calibre6">3.3</a>).</p></li>
<li><p>Generation of copy operations is deprecated for a class with a
destructor (§<a href="#part0010.html#ch05lev2sec1"
class="calibre6">5.1.1</a>).</p></li>
<li><p>Assignment of a string literal to a <code
class="calibre8">char*</code> is removed. Instead use <code
class="calibre8">const char*</code> or <code
class="calibre8">auto</code>.</p></li>
<li><p>Some C++ standard-library function objects and associated
functions are deprecated. Most relate to argument binding. Instead use
lambdas and <code class="calibre8">function</code> (§<a
href="#part0018.html#ch13lev1sec8" class="calibre6">13.8</a>).</p></li>
</ul>
<p>By deprecating a feature, the standards committee expresses the wish
that the feature will go away. However, the committee does not have a
mandate to immediately remove a heavily used feature – however redundant
or dangerous it may be. Thus, a deprecation is a strong hint to avoid
the feature. It may disappear in the future. Compilers are likely to
issue warnings for uses of deprecated features. However, deprecated
features are part of the standard and history shows that they tend to
remain supported “forever” for reasons of compatibility.</p>
<h3 class="h2" id="part0021.html#ch16lev1sec3">16.3 C/C++
Compatibility</h3>
<p>With minor exceptions, C++ is a superset of C (meaning C11; [C11]).
Most differences stem from C++’s greater emphasis on type checking.
Well-written C programs tend to be C++ programs as well. A compiler can
diagnose every difference between C++ and C. The C99/C++11
incompatibilities are listed in Appendix C of the standard.</p>
<h4 class="h3" id="part0021.html#ch16lev2sec13"><span
id="part0021.html#page_219" class="calibre2 pagebreak"></span>16.3.1 C
and C++ Are Siblings</h4>
<p>Classic C has two main descendants: ISO C and ISO C++. Over the
years, these languages have evolved at different paces and in different
directions. One result of this is that each language provides support
for traditional C-style programming in slightly different ways. The
resulting incompatibilities can make life miserable for people who use
both C and C++, for people who write in one language using libraries
implemented in the other, and for implementers of libraries and tools
for C and C++.</p>
<p>How can I call C and C++ siblings? Look at a simplified family
tree:</p>
<figure>
<img src="images/00034.jpeg" class="calibre1" />
</figure>
<p>A solid line means a massive inheritance of features, a dashed line a
borrowing of major features, and a dotted line a borrowing of minor
features. From this, ISO C and ISO C++ emerge as the two major
descendants of K&amp;R C [<a href="#part0021.html#ref29"
class="calibre6">Kernighan,1978</a>], and as siblings. Each carries with
it the key aspects of Classic C, and neither is 100% compatible with
Classic C. I picked the term “Classic C” from a sticker that used to be
affixed to Dennis Ritchie’s terminal. It is K&amp;R C plus enumerations
and <code class="calibre8">struct</code> assignment. BCPL is defined by
[<a href="#part0021.html#ref38" class="calibre6">Richards,1980</a>] and
C89 by [<a href="#part0021.html#ref2" class="calibre6">C1990</a>].</p>
<p><span id="part0021.html#page_220" class="pagebreak"></span>Note that
differences between C and C++ are not necessarily the result of changes
to C made in C++. In several cases, the incompatibilities arise from
features adopted incompatibly into C long after they were common in C++.
Examples are the ability to assign a <code class="calibre8">T*</code> to
a <code class="calibre8">void*</code> and the linkage of global <code
class="calibre8">const</code>s [<a href="#part0021.html#ref52"
class="calibre6">Stroustrup,2002</a>]. Sometimes, a feature was even
incompatibly adopted into C after it was part of the ISO C++ standard,
such as details of the meaning of <code
class="calibre8">inline</code>.</p>
<h4 class="h3" id="part0021.html#ch16lev2sec14">16.3.2 Compatibility
Problems</h4>
<p>There are many minor incompatibilities between C and C++. All can
cause problems for a programmer, but all can be coped with in the
context of C++. If nothing else, C code fragments can be compiled as C
and linked to using the <code class="calibre8">extern "C"</code>
mechanism.</p>
<p>The major problems for converting a C program to C++ are likely to
be:</p>
<ul>
<li><p>Suboptimal design and programming style.</p></li>
<li><p>A <code class="calibre8">void*</code> implicitly converted to a
<code class="calibre8">T*</code> (that is, converted without a
cast).</p></li>
<li><p>C++ keywords, such as <code class="calibre8">class</code> and
<code class="calibre8">private</code>, used as identifiers in C
code.</p></li>
<li><p>Incompatible linkage of code fragments compiled as C and
fragments compiled as C++.</p></li>
</ul>
<h5 class="h4" id="part0021.html#ch16lev3sec1">16.3.2.1 Style
Problems</h5>
<p>Naturally, a C program is written in a C style, such as the style
used in K&amp;R [<a href="#part0021.html#ref30"
class="calibre6">Kernighan,1988</a>]. This implies widespread use of
pointers and arrays, and probably many macros. These facilities are hard
to use reliably in a large program. Resource management and error
handling are often ad hoc, documented (rather than language and tool
supported), and often incompletely documented and adhered to. A simple
line-for-line conversion of a C program into a C++ program yields a
program that is often a bit better checked. In fact, I have never
converted a C program into C++ without finding some bug. However, the
fundamental structure is unchanged, and so are the fundamental sources
of errors. If you had incomplete error handling, resource leaks, or
buffer overflows in the original C program, they will still be there in
the C++ version. To obtain major benefits, you must make changes to the
fundamental structure of the code:</p>
<p>[1] Don’t think of C++ as C with a few features added. C++ can be
used that way, but only suboptimally. To get really major advantages
from C++ as compared to C, you need to apply different design and
implementation styles.</p>
<p>[2] Use the C++ standard library as a teacher of new techniques and
programming styles. Note the difference from the C standard library
(e.g., <code class="calibre8">=</code> rather than <code
class="calibre8">strcpy()</code> for copying and <code
class="calibre8">==</code> rather than <code
class="calibre8">strcmp()</code> for comparing).</p>
<p>[3] Macro substitution is almost never necessary in C++. Use <code
class="calibre8">const</code> (§<a href="#part0006.html#ch01lev1sec6"
class="calibre6">1.6</a>), <code class="calibre8">constexpr</code> (§<a
href="#part0006.html#ch01lev1sec6" class="calibre6">1.6</a>), <code
class="calibre8">enum</code> or <code class="calibre8">enum class</code>
(§<a href="#part0007.html#ch02lev1sec5" class="calibre6">2.5</a>) to
define manifest constants, <code class="calibre8">inline</code> (§<a
href="#part0009.html#ch04lev2sec1" class="calibre6">4.2.1</a>) to avoid
function-calling overhead, <code class="calibre8">template</code>s (<a
href="#part0011.html#ch06" class="calibre6">Chapter 6</a>) to specify
families of functions and types, and <code
class="calibre8">namespace</code>s (§<a
href="#part0008.html#ch03lev1sec4" class="calibre6">3.4</a>) to avoid
name clashes.</p>
<p>[4] Don’t declare a variable before you need it and initialize it
immediately. A declaration can occur anywhere a statement can (§<a
href="#part0006.html#ch01lev1sec8" class="calibre6">1.8</a>), in <code
class="calibre8">for</code>-statement initializers (§<a
href="#part0006.html#ch01lev1sec7" class="calibre6">1.7</a>), and in
conditions (§<a href="#part0009.html#ch04lev2sec5"
class="calibre6">4.5.2</a>).</p>
<p>[5] Don’t use <code class="calibre8">malloc()</code>. The <code
class="calibre8">new</code> operator (§<a
href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>) does the
same job better, and instead of <code class="calibre8">realloc()</code>,
try a <code class="calibre8">vector</code> (§<a
href="#part0009.html#ch04lev2sec3" class="calibre6">4.2.3</a>, §<a
href="#part0017.html#ch12lev1sec1" class="calibre6">12.1</a>). Don’t
just replace <code class="calibre8">malloc()</code> and <code
class="calibre8">free()</code> with “naked” <code
class="calibre8">new</code> and <code class="calibre8">delete</code>
(§<a href="#part0009.html#ch04lev2sec2" class="calibre6">4.2.2</a>).</p>
<p><span id="part0021.html#page_221" class="pagebreak"></span>[6] Avoid
<code class="calibre8">void*</code>, unions, and casts, except deep
within the implementation of some function or class. Their use limits
the support you can get from the type system and can harm performance.
In most cases, a cast is an indication of a design error.</p>
<p>[7] If you must use an explicit type conversion, use an appropriate
named cast (e.g., <code class="calibre8">static_cast</code>; §<a
href="#part0021.html#ch16lev2sec12" class="calibre6">16.2.7</a>) for a
more precise statement of what you are trying to do.</p>
<p>[8] Minimize the use of arrays and C-style strings. C++
standard-library <code class="calibre8">string</code>s (§<a
href="#part0014.html#ch09lev1sec2" class="calibre6">9.2</a>), <code
class="calibre8">array</code>s (§<a href="#part0018.html#ch13lev2sec3"
class="calibre6">13.4.1</a>), and <code class="calibre8">vector</code>s
(§<a href="#part0016.html#ch11lev1sec2" class="calibre6">11.2</a>) can
often be used to write simpler and more maintainable code compared to
the traditional C style. In general, try not to build yourself what has
already been provided by the standard library.</p>
<p>[9] Avoid pointer arithmetic except in very specialized code (such as
a memory manager) and for simple array traversal (e.g., <code
class="calibre8">++p</code>).</p>
<p>[10] Do not assume that something laboriously written in C style
(avoiding C++ features such as classes, templates, and exceptions) is
more efficient than a shorter alternative (e.g., using standard-library
facilities). Often (but of course not always), the opposite is true.</p>
<h5 class="h4" id="part0021.html#ch16lev3sec2">16.3.2.2 <code
class="calibre18">void*</code></h5>
<p>In C, a <code class="calibre8">void*</code> may be used as the
right-hand operand of an assignment to or initialization of a variable
of any pointer type; in C++ it may not. For example:</p>
<p><a href="#part0040_split_001.html#p0221_01a"
id="part0021.html#p0221_01" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb463"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb463-1"><a href="#cb463-1" aria-hidden="true" tabindex="-1"></a>void f(int n)</span>
<span id="cb463-2"><a href="#cb463-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb463-3"><a href="#cb463-3" aria-hidden="true" tabindex="-1"></a>     int<span class="fu">*</span> p <span class="kw">=</span> malloc(n<span class="fu">*</span>sizeof(int))<span class="kw">;</span> <span class="co">/* not C++; in C++, allocate using &quot;new&quot; */</span></span>
<span id="cb463-4"><a href="#cb463-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">//</span> ...</span>
<span id="cb463-5"><a href="#cb463-5" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>This is probably the single most difficult incompatibility to deal
with. Note that the implicit conversion of a <code
class="calibre8">void*</code> to a different pointer type is
<em>not</em> in general harmless:</p>
<p><a href="#part0040_split_002.html#p0221_02a"
id="part0021.html#p0221_02" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb464"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb464-1"><a href="#cb464-1" aria-hidden="true" tabindex="-1"></a>char ch<span class="kw">;</span></span>
<span id="cb464-2"><a href="#cb464-2" aria-hidden="true" tabindex="-1"></a>void<span class="fu">*</span> pv <span class="kw">=</span> &amp;ch<span class="kw">;</span></span>
<span id="cb464-3"><a href="#cb464-3" aria-hidden="true" tabindex="-1"></a>int<span class="fu">*</span> pi <span class="kw">=</span> pv<span class="kw">;</span>      <span class="fu">//</span> not <span class="dt">C</span>++</span>
<span id="cb464-4"><a href="#cb464-4" aria-hidden="true" tabindex="-1"></a><span class="fu">*</span>pi <span class="kw">=</span> <span class="dv">666</span><span class="kw">;</span>         <span class="fu">//</span> overwrite ch and other bytes near ch</span></code></pre></div>
<p>In both languages, cast the result of <code
class="calibre8">malloc()</code> to the right type. If you use only C++,
avoid <code class="calibre8">malloc()</code>.</p>
<h5 class="h4" id="part0021.html#ch16lev3sec3">16.3.2.3 Linkage</h5>
<p>C and C++ can (and often are) implemented to use different linkage
conventions. The most basic reason for that is C++’s greater emphasis on
type checking. A practical reason is that C++ supports overloading, so
there can be two global functions called <code
class="calibre8">open()</code>. This has to be reflected in the way the
linker works.</p>
<p>To give a C++ function C linkage (so that it can be called from a C
program fragment) or to allow a C function to be called from a C++
program fragment, declare it <code class="calibre8">extern "C"</code>.
For example:</p>
<p><a href="#part0040_split_003.html#p0221_03a"
id="part0021.html#p0221_03" class="calibre6">Click here to view code
image</a></p>
<div class="sourceCode" id="cb465"><pre
class="sourceCode pro"><code class="sourceCode prolog"><span id="cb465-1"><a href="#cb465-1" aria-hidden="true" tabindex="-1"></a>extern <span class="ot">&quot;</span><span class="er">C</span><span class="ot">&quot;</span> double sqrt(double)<span class="kw">;</span></span></code></pre></div>
<p>Now <code class="calibre8">sqrt(double)</code> can be called from a C
or a C++ code fragment. The definition of <code
class="calibre8">sqrt(double)</code> can also be compiled as a C
function or as a C++ function.</p>
<p><span id="part0021.html#page_222" class="pagebreak"></span>Only one
function of a given name in a scope can have C linkage (because C
doesn’t allow function overloading). A linkage specification does not
affect type checking, so the C++ rules for function calls and argument
checking still apply to a function declared <code
class="calibre8">extern "C"</code>.</p>
<h3 class="h2" id="part0021.html#ch16lev1sec4">16.4 Bibliography</h3>
<p><span id="part0021.html#ref1"
class="calibre6"></span><em>[Boost]     The Boost Libraries: free
peer-reviewed portable C++ source libraries</em>. <a
href="http://www.boost.org" class="calibre6">www.boost.org</a>.</p>
<p><span id="part0021.html#ref2"
class="calibre6"></span><em>[C,1990]</em>     X3 Secretariat:
<em>Standard – The C Language</em>. X3J11/90-013. ISO Standard ISO/IEC
9899-1990. Computer and Business Equipment Manufacturers Association.
Washington, DC.</p>
<p><span id="part0021.html#ref3"
class="calibre6"></span><em>[C,1999]</em>     ISO/IEC 9899. <em>Standard
– The C Language</em>. X3J11/90-013-1999.</p>
<p><span id="part0021.html#ref4"
class="calibre6"></span><em>[C,2011]</em>     ISO/IEC 9899. <em>Standard
– The C Language</em>. X3J11/90-013-2011.</p>
<p><span id="part0021.html#ref5"
class="calibre6"></span><em>[C++,1998]</em>     ISO/IEC JTC1/SC22/WG21
(editor: Andrew Koenig): <em>International Standard – The C++
Language</em>. ISO/IEC 14882:1998.</p>
<p><span id="part0021.html#ref6"
class="calibre6"></span><em>[C++,2004]</em>     ISO/IEC JTC1/SC22/WG21
(editor: Lois Goldtwaite): <em>Technical Report on C++ Performance</em>.
ISO/IEC TR 18015:2004(E)</p>
<p><span id="part0021.html#ref7"
class="calibre6"></span><em>[C++Math,2010]     International Standard –
Extensions to the C++ Library to Support Mathematical Special
Functions</em>. ISO/IEC 29124:2010.</p>
<p><span id="part0021.html#ref8"
class="calibre6"></span><em>[C++,2011]</em>     ISO/IEC JTC1/SC22/WG21
(editor: Pete Becker): <em>International Standard – The C++
Language</em>. ISO/IEC 14882:2011.</p>
<p><span id="part0021.html#ref9"
class="calibre6"></span><em>[C++,2014]</em>     ISO/IEC JTC1/SC22/WG21
(editor: Stefanus du Toit): <em>International Standard – The C++
Language</em>. ISO/IEC 14882:2014.</p>
<p><span id="part0021.html#ref10"
class="calibre6"></span><em>[C++,2017]</em>     ISO/IEC JTC1/SC22/WG21
(editor: Richard Smith): <em>International Standard – The C++
Language</em>. ISO/IEC 14882:2017.</p>
<p><span id="part0021.html#ref11"
class="calibre6"></span><em>[ConceptsTS]</em>     ISO/IEC JTC1/SC22/WG21
(editor: Gabriel Dos Reis): <em>Technical Specification: C++ Extensions
for Concepts</em>. ISO/IEC TS 19217:2015.</p>
<p><span id="part0021.html#ref12"
class="calibre6"></span><em>[CoroutinesTS]</em>     ISO/IEC
JTC1/SC22/WG21 (editor: Gor Nishanov): <em>Technical Specification: C++
Extensions for Coroutines</em>. ISO/IEC TS 22277:2017.</p>
<p><span id="part0021.html#ref13"
class="calibre6"></span><em>[Cppreference]     Online source for C++
language and standard library facilities</em>. <a
href="http://www.cppreference.com"
class="calibre6">www.cppreference.com</a>.</p>
<p><span id="part0021.html#ref14"
class="calibre6"></span><em>[Cox,2007]</em>     Russ Cox: <em>Regular
Expression Matching Can Be Simple And Fast</em>. January 2007. <a
href="http://swtch.com/~rsc/regexp/regexp1.html"
class="calibre6">swtch.com/~rsc/regexp/regexp1.html</a>.</p>
<p><span id="part0021.html#ref15"
class="calibre6"></span><em>[Dahl,1970]</em>     O-J. Dahl, B. Myrhaug,
and K. Nygaard: <em>SIMULA Common Base Language.</em> Norwegian
Computing Center S-22. Oslo, Norway. 1970.</p>
<p><span id="part0021.html#ref16"
class="calibre6"></span><em>[Dechev,2010]</em>     D. Dechev, P.
Pirkelbauer, and B. Stroustrup: <em>Understanding and Effectively
Preventing the ABA Problem in Descriptor-based Lock-free Designs</em>.
13th IEEE Computer Society ISORC 2010 Symposium. May 2010.</p>
<p><span id="part0021.html#ref17"
class="calibre6"></span><em>[DosReis,2006]</em>     Gabriel Dos Reis and
Bjarne Stroustrup: <em>Specifying C++ Concepts</em>. POPL06. January
2006.</p>
<p><span id="part0021.html#ref18"
class="calibre6"></span><em>[Ellis,1989]</em>     Margaret A. Ellis and
Bjarne Stroustrup: <em>The Annotated C++ Reference Manual</em>.
Addison-Wesley. Reading, Massachusetts. 1990. ISBN 0-201-51459-1.</p>
<p><span id="part0021.html#ref19" class="calibre6"></span><span
id="part0021.html#page_223"
class="pagebreak"></span><em>[Garcia,2015]</em>     J. Daniel Garcia and
B. Stroustrup: <em>Improving performance and maintainability through
refactoring in C++11</em>. Isocpp.org. August 2015. <a
href="http://www.stroustrup.com/improving_garcia_stroustrup_2015.pdf"
class="calibre6">http://www.stroustrup.com/improving_garcia_stroustrup_2015.pdf</a>.</p>
<p><span id="part0021.html#ref20"
class="calibre6"></span><em>[Garcia,2016]</em>     G. Dos Reis, J. D.
Garcia, J. Lakos, A. Meredith, N. Myers, B. Stroustrup: <em>A Contract
Design</em>. P0380R1. 2016-7-11.</p>
<p><span id="part0021.html#ref21"
class="calibre6"></span><em>[Garcia,2018]</em>     G. Dos Reis, J. D.
Garcia, J. Lakos, A. Meredith, N. Myers, B. Stroustrup: <em>Support for
contract based programming in C++</em>. P0542R4. 2018-4-2.</p>
<p><span id="part0021.html#ref22"
class="calibre6"></span><em>[Friedl,1997]:</em>     Jeffrey E. F.
Friedl: <em>Mastering Regular Expressions</em>. O’Reilly Media.
Sebastopol, California. 1997. ISBN 978-1565922570.</p>
<p><span id="part0021.html#ref23"
class="calibre6"></span><em>[GSL]</em>     N. MacIntosh (Editor):
<em>Guidelines Support Library</em>. <a
href="https://github.com/microsoft/gsl"
class="calibre6">https://github.com/microsoft/gsl</a>.</p>
<p><span id="part0021.html#ref24"
class="calibre6"></span><em>[Gregor,2006]</em>     Douglas Gregor et
al.: <em>Concepts: Linguistic Support for Generic Programming in
C++</em>. OOPSLA’06.</p>
<p><span id="part0021.html#ref25"
class="calibre6"></span><em>[Hinnant,2018]</em>     Howard Hinnant:
<em>Date</em>. <a href="https://howardhinnant.github.io/date/date.html"
class="calibre6">https://howardhinnant.github.io/date/date.html</a>.
Github. 2018.</p>
<p><span id="part0021.html#ref26"
class="calibre6"></span><em>[Hinnant,2018b]</em>     Howard Hinnant:
<em>Timezones</em>. <a
href="https://howardhinnant.github.io/date/tz.html"
class="calibre6">https://howardhinnant.github.io/date/tz.html</a>.
Github. 2018.</p>
<p><span id="part0021.html#ref27"
class="calibre6"></span><em>[Ichbiah,1979]</em>     Jean D. Ichbiah et
al.: <em>Rationale for the Design of the ADA Programming Language</em>.
SIGPLAN Notices. Vol. 14, No. 6. June 1979.</p>
<p><span id="part0021.html#ref28"
class="calibre6"></span><em>[Kazakova,2015]</em>     Anastasia Kazakova:
<em>Infographic: C/C++ facts</em>. <a
href="https://blog.jetbrains.com/clion/2015/07/infographics-cpp-facts-before-clion/"
class="calibre6">https://blog.jetbrains.com/clion/2015/07/infographics-cpp-facts-before-clion/</a>
July 2015.</p>
<p><span id="part0021.html#ref29"
class="calibre6"></span><em>[Kernighan,1978]</em>     Brian W. Kernighan
and Dennis M. Ritchie: <em>The C Programming Language.</em> Prentice
Hall. Englewood Cliffs, New Jersey. 1978.</p>
<p><span id="part0021.html#ref30"
class="calibre6"></span><em>[Kernighan,1988]</em>     Brian W. Kernighan
and Dennis M. Ritchie: <em>The C Programming Language, Second
Edition.</em> Prentice-Hall. Englewood Cliffs, New Jersey. 1988. ISBN
0-13-110362-8.</p>
<p><span id="part0021.html#ref31"
class="calibre6"></span><em>[Knuth,1968]</em>     Donald E. Knuth:
<em>The Art of Computer Programming</em>. Addison-Wesley. Reading,
Massachusetts. 1968.</p>
<p><span id="part0021.html#ref32"
class="calibre6"></span><em>[Koenig,1990]</em>     A. R. Koenig and B.
Stroustrup: <em>Exception Handling for C++ (revised)</em>. Proc USENIX
C++ Conference. April 1990.</p>
<p><span id="part0021.html#ref33"
class="calibre6"></span><em>[Maddock,2009]</em>     John Maddock:
<em>Boost.Regex</em>. <a href="http://www.boost.org"
class="calibre6">www.boost.org</a>. 2009. 2017.</p>
<p><span id="part0021.html#ref34"
class="calibre6"></span><em>[ModulesTS]</em>     ISO/IEC JTC1/SC22/WG21
(editor: Gabriel Dos Reis): <em>Technical Specification: C++ Extensions
for Modules</em>. ISO/IEC TS 21544:2018.</p>
<p><span id="part0021.html#ref35"
class="calibre6"></span><em>[Orwell,1949]</em>     George Orwell:
<em>1984.</em> Secker and Warburg. London. 1949.</p>
<p><span id="part0021.html#ref36"
class="calibre6"></span><em>[Paulson,1996]</em>     Larry C. Paulson:
<em>ML for the Working Programmer</em>. Cambridge University Press.
Cambridge. 1996.</p>
<p><span id="part0021.html#ref37"
class="calibre6"></span><em>[RangesTS]</em>     ISO/IEC JTC1/SC22/WG21
(editor: Eric Niebler): <em>Technical Specification: C++ Extensions for
Ranges</em>. ISO/IEC TS 21425:2017. ISBN 0-521-56543-X.</p>
<p><span id="part0021.html#ref38"
class="calibre6"></span><em>[Richards,1980]</em>     Martin Richards and
Colin Whitby-Strevens: <em>BCPL – The Language and Its Compiler.</em>
Cambridge University Press. Cambridge. 1980. ISBN 0-521-21965-5.</p>
<p><span id="part0021.html#ref39" class="calibre6"></span><span
id="part0021.html#page_224"
class="pagebreak"></span><em>[Stepanov,1994]</em>     Alexander Stepanov
and Meng Lee: <em>The Standard Template Library</em>. HP Labs Technical
Report HPL-94-34 (R. 1). 1994.</p>
<p><span id="part0021.html#ref40"
class="calibre6"></span><em>[Stepanov,2009]</em>     Alexander Stepanov
and Paul McJones: <em>Elements of Programming</em>. Addison-Wesley.
2009. ISBN 978-0-321-63537-2.</p>
<p><span id="part0021.html#ref41"
class="calibre6"></span><em>[Stroustrup,1979]</em>     Personal lab
notes.</p>
<p><span id="part0021.html#ref42"
class="calibre6"></span><em>[Stroustrup,1982]</em>     B. Stroustrup:
<em>Classes: An Abstract Data Type Facility for the C Language</em>.
Sigplan Notices. January 1982. The first public description of “C with
Classes.”</p>
<p><span id="part0021.html#ref42a"
class="calibre6"></span><em>[Stroustrup,1984]</em>     B. Stroustrup:
<em>Operator Overloading in C++</em>. Proc. IFIP WG2.4 Conference on
System Implementation Languages: Experience &amp; Assessment. September
1984.</p>
<p><span id="part0021.html#ref43"
class="calibre6"></span><em>[Stroustrup,1985]</em>     B. Stroustrup:
<em>An Extensible I/O Facility for C++</em>. Proc. Summer 1985 USENIX
Conference.</p>
<p><span id="part0021.html#ref44"
class="calibre6"></span><em>[Stroustrup,1986]</em>     B. Stroustrup:
<em>The C++ Programming Language</em>. Addison-Wesley. Reading,
Massachusetts. 1986. ISBN 0-201-12078-X.</p>
<p><span id="part0021.html#ref45"
class="calibre6"></span><em>[Stroustrup,1987]</em>     B. Stroustrup:
<em>Multiple Inheritance for C++</em>. Proc. EUUG Spring Conference. May
1987.</p>
<p><span id="part0021.html#ref46"
class="calibre6"></span><em>[Stroustrup,1987b]</em>     B. Stroustrup
and J. Shopiro: <em>A Set of C Classes for Co-Routine Style
Programming</em>. Proc. USENIX C++ Conference. Santa Fe, New Mexico.
November 1987.</p>
<p><span id="part0021.html#ref47"
class="calibre6"></span><em>[Stroustrup,1988]</em>     B. Stroustrup:
<em>Parameterized Types for C++</em>. Proc. USENIX C++ Conference,
Denver, Colorado. 1988.</p>
<p><span id="part0021.html#ref48"
class="calibre6"></span><em>[Stroustrup,1991]</em>     B. Stroustrup:
<em>The C++ Programming Language (Second Edition)</em>. Addison-Wesley.
Reading, Massachusetts. 1991. ISBN 0-201-53992-6.</p>
<p><span id="part0021.html#ref49"
class="calibre6"></span><em>[Stroustrup,1993]</em>     B. Stroustrup:
<em>A History of C++: 1979–1991</em>. Proc. ACM History of Programming
Languages Conference (HOPL-2). ACM Sigplan Notices. Vol 28, No 3.
1993.</p>
<p><span id="part0021.html#ref50"
class="calibre6"></span><em>[Stroustrup,1994]</em>     B. Stroustrup:
<em>The Design and Evolution of C++</em>. Addison-Wesley. Reading,
Massachusetts. 1994. ISBN 0-201-54330-3.</p>
<p><span id="part0021.html#ref51"
class="calibre6"></span><em>[Stroustrup,1997]</em>     B. Stroustrup:
<em>The C++ Programming Language, Third Edition</em>. Addison-Wesley.
Reading, Massachusetts. 1997. ISBN 0-201-88954-4. Hardcover (“Special”)
Edition. 2000. ISBN 0-201-70073-5.</p>
<p><span id="part0021.html#ref52"
class="calibre6"></span><em>[Stroustrup,2002]</em>     B. Stroustrup:
<em>C and C++: Siblings</em>, <em>C and C++: A Case for
Compatibility</em>, and <em>C and C++: Case Studies in
Compatibility</em>. The C/C++ Users Journal. July-September 2002. <a
href="http://www.stroustrup.com/papers.html"
class="calibre6">www.stroustrup.com/papers.html</a>.</p>
<p><span id="part0021.html#ref53"
class="calibre6"></span><em>[Stroustrup,2007]</em>     B. Stroustrup:
<em>Evolving a language in and for the real world: C++ 1991-2006</em>.
ACM HOPL-III. June 2007.</p>
<p><span id="part0021.html#ref54"
class="calibre6"></span><em>[Stroustrup,2009]</em>     B. Stroustrup:
<em>Programming – Principles and Practice Using C++</em>.
Addison-Wesley. 2009. ISBN 0-321-54372-6.</p>
<p><span id="part0021.html#ref55"
class="calibre6"></span><em>[Stroustrup,2010]</em>     B. Stroustrup:
<em>The C++11 FAQ</em>. <a
href="http://www.stroustrup.com/C++11FAQ.html"
class="calibre6">www.stroustrup.com/C++11FAQ.html</a>.</p>
<p><span id="part0021.html#ref56"
class="calibre6"></span><em>[Stroustrup,2012a]</em>     B. Stroustrup
and A. Sutton: <em>A Concept Design for the STL</em>. WG21 Technical
Report N3351==12-0041. January 2012.</p>
<p><span id="part0021.html#ref57"
class="calibre6"></span><em>[Stroustrup,2012b]</em>     B. Stroustrup:
<em>Software Development for Infrastructure</em>. Computer. January
2012. doi:10.1109/MC.2011.353.</p>
<p><span id="part0021.html#ref58" class="calibre6"></span><span
id="part0021.html#page_225"
class="pagebreak"></span><em>[Stroustrup,2013]</em>     B. Stroustrup:
<em>The C++ Programming Language (Fourth Edition)</em>. Addison-Wesley.
2013. ISBN 0-321-56384-0.</p>
<p><span id="part0021.html#ref59"
class="calibre6"></span><em>[Stroustrup,2014]</em>     B. Stroustrup:
C++ Applications. <a href="http://www.stroustrup.com/applications.html"
class="calibre6">http://www.stroustrup.com/applications.html</a>.</p>
<p><span id="part0021.html#ref60"
class="calibre6"></span><em>[Stroustrup,2015]</em>     B. Stroustrup and
H. Sutter: <em>C++ Core Guidelines</em>. <a
href="https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md"
class="calibre6">https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md</a>.</p>
<p><span id="part0021.html#ref61"
class="calibre6"></span><em>[Stroustrup,2015b]</em>     B. Stroustrup,
H. Sutter, and G. Dos Reis: <em>A brief introduction to C++’s model for
type- and resource-safety</em>. Isocpp.org. October 2015. Revised
December 2015. <a href="http://www.stroustrup.com/resource-model.pdf"
class="calibre6">http://www.stroustrup.com/resource-model.pdf</a>.</p>
<p><span id="part0021.html#ref62"
class="calibre6"></span><em>[Sutton,2011]</em>     A. Sutton and B.
Stroustrup: <em>Design of Concept Libraries for C++</em>. Proc. SLE 2011
(International Conference on Software Language Engineering). July
2011.</p>
<p><span id="part0021.html#ref63"
class="calibre6"></span><em>[WG21]</em>     ISO SC22/WG21 The C++
Programming Language Standards Committee: <em>Document Archive</em>. <a
href="http://www.open-std.org/jtc1/sc22/wg21"
class="calibre6">www.open-std.org/jtc1/sc22/wg21</a>.</p>
<p><span id="part0021.html#ref64"
class="calibre6"></span><em>[Williams,2012]</em>     Anthony Williams:
<em>C++ Concurrency in Action – Practical Multithreading</em>. Manning
Publications Co. ISBN 978-1933988771.</p>
<p><span id="part0021.html#ref65"
class="calibre6"></span><em>[Woodward,1974]</em>     P. M. Woodward and
S. G. Bond: <em>Algol 68-R Users Guide.</em> Her Majesty’s Stationery
Office. London. 1974.</p>
<h3 class="h2" id="part0021.html#ch16lev1sec5">16.5 Advice</h3>
<p>[1] The ISO C++ standard [C++,2017] defines C++.</p>
<p>[2] When chosing a style for a new project or when modernizing a code
base, rely on the C++ Core Guidelines; §<a
href="#part0021.html#ch16lev2sec4" class="calibre6">16.1.4</a>.</p>
<p>[3] When learning C++, don’t focus on language features in isolation;
§<a href="#part0021.html#ch16lev2sec6" class="calibre6">16.2.1</a>.</p>
<p>[4] Don’t get stuck with decades-old language-feature sets and design
techniques; §<a href="#part0021.html#ch16lev2sec4"
class="calibre6">16.1.4</a>.</p>
<p>[5] Before using a new feature in production code, try it out by
writing small programs to test the standards conformance and performance
of the implementations you plan to use.</p>
<p>[6] For learning C++, use the most up-to-date and complete
implementation of Standard C++ that you can get access to.</p>
<p>[7] The common subset of C and C++ is not the best initial subset of
C++ to learn; §<a href="#part0021.html#ch16lev3sec1"
class="calibre6">16.3.2.1</a>.</p>
<p>[8] Prefer named casts, such as <code
class="calibre8">static_cast</code> over C-style casts; §<a
href="#part0021.html#ch16lev2sec12" class="calibre6">16.2.7</a>.</p>
<p>[9] When converting a C program to C++, first make sure that function
declarations (prototypes) and standard headers are used consistently;
§<a href="#part0021.html#ch16lev2sec14" class="calibre6">16.3.2</a>.</p>
<p>[10] When converting a C program to C++, rename variables that are
C++ keywords; §<a href="#part0021.html#ch16lev2sec14"
class="calibre6">16.3.2</a>.</p>
<p>[11] For portability and type safety, if you must use C, write in the
common subset of C and C++; §<a href="#part0021.html#ch16lev3sec1"
class="calibre6">16.3.2.1</a>.</p>
<p>[12] When converting a C program to C++, cast the result of <code
class="calibre8">malloc()</code> to the proper type or change all uses
of <code class="calibre8">malloc()</code> to uses of <code
class="calibre8">new</code>; §<a href="#part0021.html#ch16lev3sec2"
class="calibre6">16.3.2.2</a>.</p>
<p>[13] When converting from <code class="calibre8">malloc()</code> and
<code class="calibre8">free()</code> to <code
class="calibre8">new</code> and <code class="calibre8">delete</code>,
consider using <code class="calibre8">vector</code>, <code
class="calibre8">push_back()</code>, and <code
class="calibre8">reserve()</code> instead of <code
class="calibre8">realloc()</code>; §<a
href="#part0021.html#ch16lev3sec1" class="calibre6">16.3.2.1</a>.</p>
<p><span id="part0021.html#page_226" class="pagebreak"></span>[14] In
C++, there are no implicit conversions from <code
class="calibre8">int</code>s to enumerations; use explicit type
conversion where necessary.</p>
<p>[15] For each standard C header <code
class="calibre8">&lt;X.h&gt;</code> that places names in the global
namespace, the header <code class="calibre8">&lt;cX&gt;</code> places
the names in namespace <code class="calibre8">std</code>.</p>
<p>[16] Use <code class="calibre8">extern "C"</code> when declaring C
functions; §<a href="#part0021.html#ch16lev3sec3"
class="calibre6">16.3.2.3</a>.</p>
<p>[17] Prefer <code class="calibre8">string</code> over C-style strings
(direct manipulation of zero-terminated arrays of <code
class="calibre8">char</code>).</p>
<p>[18] Prefer <code class="calibre8">iostream</code>s over <code
class="calibre8">stdio</code>.</p>
<p>[19] Prefer containers (e.g., <code class="calibre8">vector</code>)
over built-in arrays.</p>
</section>
<p><span id="part0022.html"></span></p>
<section id="part0022.html#index" class="h1 backmatter">
<h2 class="h1"><span id="part0022.html#page_227"
class="calibre2 pagebreak"></span><span class="big">I</span></h2>
<p>Index</p>
<p><em>Knowledge is of two kinds. We know a subject ourselves, or we
know where we can find information on it.</em></p>
<p><em>– Samuel Johnson</em></p>
<h3 class="h3i">Token</h3>
<p><code class="calibre8">!=</code></p>
<p>container <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p>not-equal operator <a href="#part0006.html#page_6"
class="calibre6">6</a></p>
<p><code class="calibre8">"</code>, string literal <a
href="#part0006.html#page_3" class="calibre6">3</a></p>
<p><code class="calibre8">$, regex</code> <a
href="#part0014.html#page_117" class="calibre6">117</a></p>
<p><code class="calibre8">%</code></p>
<p>modulus operator <a href="#part0006.html#page_6"
class="calibre6">6</a></p>
<p>remainder operator <a href="#part0006.html#page_6"
class="calibre6">6</a></p>
<p><code class="calibre8">%=</code>, operator <a
href="#part0006.html#page_7" class="calibre6">7</a></p>
<p><code class="calibre8">&amp;</code></p>
<p>address-of operator <a href="#part0006.html#page_11"
class="calibre6">11</a></p>
<p>reference to <a href="#part0006.html#page_12"
class="calibre6">12</a></p>
<p><code class="calibre8">&amp;&amp;</code>, rvalue reference <a
href="#part0010.html#page_71" class="calibre6">71</a></p>
<p><code class="calibre8">(</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_117" class="calibre6">117</a></p>
<p><code class="calibre8">()</code>, call operator <a
href="#part0011.html#page_85" class="calibre6">85</a></p>
<p><code class="calibre8">(?:</code> pattern <a
href="#part0014.html#page_120" class="calibre6">120</a></p>
<p><code class="calibre8">)</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_117" class="calibre6">117</a></p>
<p><code class="calibre8">*</code></p>
<p>contents-of operator <a href="#part0006.html#page_11"
class="calibre6">11</a></p>
<p>multiply operator <a href="#part0006.html#page_6"
class="calibre6">6</a></p>
<p>pointer to <a href="#part0006.html#page_11"
class="calibre6">11</a></p>
<p><code class="calibre8">regex</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">*=</code>, scaling operator <a
href="#part0006.html#page_7" class="calibre6">7</a></p>
<p><code class="calibre8">*?</code> lazy <a
href="#part0014.html#page_118" class="calibre6">118</a></p>
<p><code class="calibre8">+</code></p>
<p>plus operator <a href="#part0006.html#page_6"
class="calibre6">6</a></p>
<p><code class="calibre8">regex</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">string</code> concatenation <a
href="#part0014.html#page_111" class="calibre6">111</a></p>
<p><code class="calibre8">++</code>, increment operator <a
href="#part0006.html#page_7" class="calibre6">7</a></p>
<p><code class="calibre8">+=</code></p>
<p>operator <a href="#part0006.html#page_7" class="calibre6">7</a></p>
<p><code class="calibre8">string</code> append <a
href="#part0014.html#page_112" class="calibre6">112</a></p>
<p><code class="calibre8">+?</code> lazy <a
href="#part0014.html#page_118" class="calibre6">118</a></p>
<p><code class="calibre8">-</code>, minus operator <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">--</code>, decrement operator <a
href="#part0006.html#page_7" class="calibre6">7</a></p>
<p><code class="calibre8">.</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_117" class="calibre6">117</a></p>
<p><code class="calibre8">/</code>, divide operator <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">//</code> comment <a
href="#part0006.html#page_2" class="calibre6">2</a></p>
<p><code class="calibre8">/=</code>, scaling operator <a
href="#part0006.html#page_7" class="calibre6">7</a></p>
<p><code class="calibre8">: public</code> <a
href="#part0009.html#page_55" class="calibre6">55</a></p>
<p><code class="calibre8">&lt;&lt;</code> <a
href="#part0010.html#page_75" class="calibre6">75</a></p>
<p>output operator <a href="#part0006.html#page_3"
class="calibre6">3</a></p>
<p><code class="calibre8">&lt;=</code></p>
<p>container <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p>less-than-or-equal operator <a href="#part0006.html#page_6"
class="calibre6">6</a></p>
<p><code class="calibre8">&lt;</code></p>
<p>container <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p>less-than operator <a href="#part0006.html#page_6"
class="calibre6">6</a></p>
<p><code class="calibre8">=</code></p>
<p><code class="calibre8">0</code> <a href="#part0009.html#page_54"
class="calibre6">54</a></p>
<p>and <code class="calibre8">==</code> <a href="#part0006.html#page_7"
class="calibre6">7</a></p>
<p><span id="part0022.html#page_228" class="pagebreak"></span>assignment
<a href="#part0006.html#page_16" class="calibre6">16</a></p>
<p><code class="calibre8">auto</code> <a href="#part0006.html#page_8"
class="calibre6">8</a></p>
<p>container <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p>initializer <a href="#part0006.html#page_7"
class="calibre6">7</a></p>
<p><code class="calibre8">string</code> assignment <a
href="#part0014.html#page_112" class="calibre6">112</a></p>
<p><code class="calibre8">==</code></p>
<p><code class="calibre8">=</code> and <a href="#part0006.html#page_7"
class="calibre6">7</a></p>
<p>container <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p>equal operator <a href="#part0006.html#page_6"
class="calibre6">6</a></p>
<p><code class="calibre8">string</code> <a
href="#part0014.html#page_112" class="calibre6">112</a></p>
<p><code class="calibre8">&gt;</code></p>
<p>container <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p>greater-than operator <a href="#part0006.html#page_6"
class="calibre6">6</a></p>
<p><code class="calibre8">&gt;=</code></p>
<p>container <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p>greater-than-or-equal operator <a href="#part0006.html#page_6"
class="calibre6">6</a></p>
<p><code class="calibre8">&gt;&gt;</code> <a
href="#part0010.html#page_75" class="calibre6">75</a></p>
<p>template arguments <a href="#part0021.html#page_215"
class="calibre6">215</a></p>
<p><code class="calibre8">?</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_117" class="calibre6">117</a></p>
<p><code class="calibre8">??</code> lazy <a
href="#part0014.html#page_118" class="calibre6">118</a></p>
<p><code class="calibre8">[</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_117" class="calibre6">117</a></p>
<p><code class="calibre8">[]</code></p>
<p><code class="calibre8">array</code> <a href="#part0018.html#page_171"
class="calibre6">171</a></p>
<p>array of <a href="#part0006.html#page_11" class="calibre6">11</a></p>
<p><code class="calibre8">string</code> <a
href="#part0014.html#page_112" class="calibre6">112</a></p>
<p><code class="calibre8">\</code>, backslash <a
href="#part0006.html#page_3" class="calibre6">3</a></p>
<p><code class="calibre8">]</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_117" class="calibre6">117</a></p>
<p><code class="calibre8">^</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_117" class="calibre6">117</a></p>
<p><code class="calibre8">{</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_117" class="calibre6">117</a></p>
<p><code class="calibre8">{}</code></p>
<p>grouping <a href="#part0006.html#page_2" class="calibre6">2</a></p>
<p>initializer <a href="#part0006.html#page_8"
class="calibre6">8</a></p>
<p><code class="calibre8">{}?</code> lazy <a
href="#part0014.html#page_118" class="calibre6">118</a></p>
<p><code class="calibre8">|</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_117" class="calibre6">117</a></p>
<p><code class="calibre8">}</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_117" class="calibre6">117</a></p>
<p><code class="calibre8">~</code>, destructor <a
href="#part0009.html#page_51" class="calibre6">51</a></p>
<p><code class="calibre8">0</code></p>
<p><code class="calibre8">=</code> <a href="#part0009.html#page_54"
class="calibre6">54</a></p>
<p><code class="calibre8">nullptr NULL</code> <a
href="#part0006.html#page_13" class="calibre6">13</a></p>
<h3 class="h3i">A</h3>
<p><code class="calibre8">abs()</code> <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p>abstract</p>
<p><code class="calibre8">class</code> <a href="#part0009.html#page_54"
class="calibre6">54</a></p>
<p>type <a href="#part0009.html#page_54" class="calibre6">54</a></p>
<p><code class="calibre8">accumulate()</code> <a
href="#part0019.html#page_189" class="calibre6">189</a></p>
<p>acquisition RAII, resource <a href="#part0018.html#page_164"
class="calibre6">164</a></p>
<p>adaptor, lambda as <a href="#part0018.html#page_180"
class="calibre6">180</a></p>
<p>address, memory <a href="#part0006.html#page_16"
class="calibre6">16</a></p>
<p>address-of operator <code class="calibre8">&amp;</code> <a
href="#part0006.html#page_11" class="calibre6">11</a></p>
<p><code class="calibre8">adjacent_difference()</code> <a
href="#part0019.html#page_189" class="calibre6">189</a></p>
<p>aims, C++11 <a href="#part0021.html#page_213"
class="calibre6">213</a></p>
<p>algorithm <a href="#part0017.html#page_149"
class="calibre6">149</a></p>
<p>container <a href="#part0017.html#page_150" class="calibre6">150</a>,
<a href="#part0017.html#page_160" class="calibre6">160</a></p>
<p>lifting <a href="#part0012.html#page_100"
class="calibre6">100</a></p>
<p>numerical <a href="#part0019.html#page_189"
class="calibre6">189</a></p>
<p>parallel <a href="#part0017.html#page_161"
class="calibre6">161</a></p>
<p>standard library <a href="#part0017.html#page_156"
class="calibre6">156</a></p>
<p><code class="calibre8">&lt;algorithm&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a>, <a
href="#part0017.html#page_156" class="calibre6">156</a></p>
<p>alias, <code class="calibre8">using</code> <a
href="#part0011.html#page_90" class="calibre6">90</a></p>
<p><code class="calibre8">alignas</code> <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<p><code class="calibre8">alignof</code> <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<p>allocation <a href="#part0009.html#page_51"
class="calibre6">51</a></p>
<p>allocator <code class="calibre8">new</code>, container <a
href="#part0018.html#page_178" class="calibre6">178</a></p>
<p>almost container <a href="#part0018.html#page_170"
class="calibre6">170</a></p>
<p><code class="calibre8">alnum</code>, <code
class="calibre8">regex</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">alpha</code>, <code
class="calibre8">regex</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">[[:alpha:]]</code> letter <a
href="#part0014.html#page_119" class="calibre6">119</a></p>
<p>ANSI C++ <a href="#part0021.html#page_212"
class="calibre6">212</a></p>
<p><code class="calibre8">any</code> <a href="#part0018.html#page_177"
class="calibre6">177</a></p>
<p>append <code class="calibre8">+=</code>, <code
class="calibre8">string</code> <a href="#part0014.html#page_112"
class="calibre6">112</a></p>
<p>argument</p>
<p>constrained <a href="#part0011.html#page_81"
class="calibre6">81</a></p>
<p>constrained template <a href="#part0011.html#page_82"
class="calibre6">82</a></p>
<p>default function <a href="#part0008.html#page_42"
class="calibre6">42</a></p>
<p>default template <a href="#part0012.html#page_98"
class="calibre6">98</a></p>
<p>function <a href="#part0008.html#page_41" class="calibre6">41</a></p>
<p>passing, function <a href="#part0010.html#page_66"
class="calibre6">66</a></p>
<p>type <a href="#part0011.html#page_82" class="calibre6">82</a></p>
<p>value <a href="#part0011.html#page_82" class="calibre6">82</a></p>
<p>arithmetic</p>
<p>conversions, usual <a href="#part0006.html#page_7"
class="calibre6">7</a></p>
<p>operator <a href="#part0006.html#page_6" class="calibre6">6</a></p>
<p>vector <a href="#part0019.html#page_192" class="calibre6">192</a></p>
<p>ARM <a href="#part0021.html#page_212" class="calibre6">212</a></p>
<p>array</p>
<p><code class="calibre8">array</code> vs. <a
href="#part0018.html#page_172" class="calibre6">172</a></p>
<p>of <code class="calibre8">[]</code> <a href="#part0006.html#page_11"
class="calibre6">11</a></p>
<p><code class="calibre8">array</code> <a href="#part0018.html#page_171"
class="calibre6">171</a></p>
<p><code class="calibre8">[]</code> <a href="#part0018.html#page_171"
class="calibre6">171</a></p>
<p><code class="calibre8">data()</code> <a
href="#part0018.html#page_171" class="calibre6">171</a></p>
<p>initialize <a href="#part0018.html#page_171"
class="calibre6">171</a></p>
<p><code class="calibre8">size()</code> <a
href="#part0018.html#page_171" class="calibre6">171</a></p>
<p>vs. array <a href="#part0018.html#page_172"
class="calibre6">172</a></p>
<p>vs. <code class="calibre8">vector</code> <a
href="#part0018.html#page_171" class="calibre6">171</a></p>
<p><code class="calibre8">&lt;array&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a></p>
<p><code class="calibre8">asin()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>assembler <a href="#part0021.html#page_210"
class="calibre6">210</a></p>
<p><code class="calibre8">assert()</code> <a
href="#part0008.html#page_40" class="calibre6">40</a></p>
<p>assertion <code class="calibre8">static_assert</code> <a
href="#part0008.html#page_40" class="calibre6">40</a></p>
<p><code class="calibre8">Assignable</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p>assignment</p>
<p><code class="calibre8">=</code> <a href="#part0006.html#page_16"
class="calibre6">16</a></p>
<p><code class="calibre8">=</code>, <code class="calibre8">string</code>
<a href="#part0014.html#page_112" class="calibre6">112</a></p>
<p>copy <a href="#part0010.html#page_66" class="calibre6">66</a>, <a
href="#part0010.html#page_69" class="calibre6">69</a></p>
<p>initialization and <a href="#part0006.html#page_18"
class="calibre6">18</a></p>
<p>move <a href="#part0010.html#page_66" class="calibre6">66</a>, <a
href="#part0010.html#page_72" class="calibre6">72</a></p>
<p>associative array – see <a href="#part0022.html#idx1"
class="calibre6"><code class="calibre8">map</code></a></p>
<p><code class="calibre8">async()</code> launch <a
href="#part0020.html#page_204" class="calibre6">204</a></p>
<p><code class="calibre8">at()</code> <a href="#part0016.html#page_141"
class="calibre6">141</a></p>
<p><code class="calibre8">atan()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p><span id="part0022.html#page_229" class="pagebreak"></span><code
class="calibre8">atan2()</code> <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p>AT&amp;T Bell Laboratories <a href="#part0021.html#page_212"
class="calibre6">212</a></p>
<p><code class="calibre8">auto =</code> <a href="#part0006.html#page_8"
class="calibre6">8</a></p>
<p><code class="calibre8">auto_ptr</code>, deprecated <a
href="#part0021.html#page_218" class="calibre6">218</a></p>
<h3 class="h3i">B</h3>
<p><code class="calibre8">back_inserter()</code> <a
href="#part0017.html#page_150" class="calibre6">150</a></p>
<p>backslash <code class="calibre8">\</code> <a
href="#part0006.html#page_3" class="calibre6">3</a></p>
<p><code class="calibre8">bad_variant_access</code> <a
href="#part0018.html#page_176" class="calibre6">176</a></p>
<p>base and derived <code class="calibre8">class</code> <a
href="#part0009.html#page_55" class="calibre6">55</a></p>
<p><code class="calibre8">basic_string</code> <a
href="#part0014.html#page_114" class="calibre6">114</a></p>
<p>BCPL <a href="#part0021.html#page_219" class="calibre6">219</a></p>
<p><code class="calibre8">begin()</code> <a
href="#part0010.html#page_75" class="calibre6">75</a>, <a
href="#part0016.html#page_143" class="calibre6">143</a>, <a
href="#part0016.html#page_147" class="calibre6">147</a>, <a
href="#part0017.html#page_150" class="calibre6">150</a></p>
<p>beginner, book for <a href="#part0006.html#page_1"
class="calibre6">1</a></p>
<p>Bell Laboratories, AT&amp;T <a href="#part0021.html#page_212"
class="calibre6">212</a></p>
<p><code class="calibre8">beta()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>bibliography <a href="#part0021.html#page_222"
class="calibre6">222</a></p>
<p><code class="calibre8">Bidirectionallterator</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p><code class="calibre8">BidirectionalRange</code> <a
href="#part0017.html#page_160" class="calibre6">160</a></p>
<p>binary search <a href="#part0017.html#page_156"
class="calibre6">156</a></p>
<p>binding, structured <a href="#part0008.html#page_45"
class="calibre6">45</a></p>
<p>bit-field, <code class="calibre8">bitset</code> and <a
href="#part0018.html#page_172" class="calibre6">172</a></p>
<p><code class="calibre8">bitset</code> <a
href="#part0018.html#page_172" class="calibre6">172</a></p>
<p>and bit-field <a href="#part0018.html#page_172"
class="calibre6">172</a></p>
<p>and <code class="calibre8">enum</code> <a
href="#part0018.html#page_172" class="calibre6">172</a></p>
<p><code class="calibre8">blank</code>, <code
class="calibre8">regex</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p>block</p>
<p>as function body, <code class="calibre8">try</code> <a
href="#part0016.html#page_141" class="calibre6">141</a></p>
<p><code class="calibre8">try</code> <a href="#part0008.html#page_36"
class="calibre6">36</a></p>
<p>body, function <a href="#part0006.html#page_2"
class="calibre6">2</a></p>
<p>book for beginner <a href="#part0006.html#page_1"
class="calibre6">1</a></p>
<p><code class="calibre8">bool</code> <a href="#part0006.html#page_5"
class="calibre6">5</a></p>
<p><code class="calibre8">Boolean</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p><code class="calibre8">BoundedRange</code> <a
href="#part0017.html#page_160" class="calibre6">160</a></p>
<p><code class="calibre8">break</code> <a href="#part0006.html#page_15"
class="calibre6">15</a></p>
<h3 class="h3i">C</h3>
<p>C <a href="#part0021.html#page_209" class="calibre6">209</a></p>
<p>and C++ compatibility <a href="#part0021.html#page_218"
class="calibre6">218</a></p>
<p>Classic <a href="#part0021.html#page_219"
class="calibre6">219</a></p>
<p>difference from <a href="#part0021.html#page_218"
class="calibre6">218</a></p>
<p>K&amp;R <a href="#part0021.html#page_219"
class="calibre6">219</a></p>
<p><code class="calibre8">void *</code> assignment, difference from <a
href="#part0021.html#page_221" class="calibre6">221</a></p>
<p>with Classes <a href="#part0021.html#page_208"
class="calibre6">208</a></p>
<p>with Classes language features <a href="#part0021.html#page_210"
class="calibre6">210</a></p>
<p>with Classes standard library <a href="#part0021.html#page_211"
class="calibre6">211</a></p>
<p>C++</p>
<p>ANSI <a href="#part0021.html#page_212" class="calibre6">212</a></p>
<p>compatibility, C and <a href="#part0021.html#page_218"
class="calibre6">218</a></p>
<p>Core Guidelines <a href="#part0021.html#page_214"
class="calibre6">214</a></p>
<p>core language <a href="#part0006.html#page_2"
class="calibre6">2</a></p>
<p>history <a href="#part0021.html#page_207"
class="calibre6">207</a></p>
<p>ISO <a href="#part0021.html#page_212" class="calibre6">212</a></p>
<p>meaning <a href="#part0021.html#page_209"
class="calibre6">209</a></p>
<p>modern <a href="#part0021.html#page_214" class="calibre6">214</a></p>
<p>pronunciation <a href="#part0021.html#page_209"
class="calibre6">209</a></p>
<p>standard, ISO <a href="#part0006.html#page_2"
class="calibre6">2</a></p>
<p>standard library <a href="#part0006.html#page_2"
class="calibre6">2</a></p>
<p>standardization <a href="#part0021.html#page_212"
class="calibre6">212</a></p>
<p>timeline <a href="#part0021.html#page_208"
class="calibre6">208</a></p>
<p>C++03 <a href="#part0021.html#page_212" class="calibre6">212</a></p>
<p>C++0x, C++11 <a href="#part0021.html#page_209"
class="calibre6">209</a>, <a href="#part0021.html#page_212"
class="calibre6">212</a></p>
<p>C++11</p>
<p>aims <a href="#part0021.html#page_213" class="calibre6">213</a></p>
<p>C++0x <a href="#part0021.html#page_209" class="calibre6">209</a>, <a
href="#part0021.html#page_212" class="calibre6">212</a></p>
<p>language features <a href="#part0021.html#page_215"
class="calibre6">215</a></p>
<p>library components <a href="#part0021.html#page_216"
class="calibre6">216</a></p>
<p>C++14</p>
<p>language features <a href="#part0021.html#page_216"
class="calibre6">216</a></p>
<p>library components <a href="#part0021.html#page_217"
class="calibre6">217</a></p>
<p>C++17</p>
<p>language features <a href="#part0021.html#page_216"
class="calibre6">216</a></p>
<p>library components <a href="#part0021.html#page_217"
class="calibre6">217</a></p>
<p>C++98 <a href="#part0021.html#page_212" class="calibre6">212</a></p>
<p>standard library <a href="#part0021.html#page_211"
class="calibre6">211</a></p>
<p>C11 <a href="#part0021.html#page_218" class="calibre6">218</a></p>
<p>C89 and C99 <a href="#part0021.html#page_218"
class="calibre6">218</a></p>
<p>C99, C89 and <a href="#part0021.html#page_218"
class="calibre6">218</a></p>
<p>call operator <code class="calibre8">()</code> <a
href="#part0011.html#page_85" class="calibre6">85</a></p>
<p>callback <a href="#part0018.html#page_181"
class="calibre6">181</a></p>
<p><code class="calibre8">capacity()</code> <a
href="#part0016.html#page_139" class="calibre6">139</a>, <a
href="#part0016.html#page_147" class="calibre6">147</a></p>
<p>capture list <a href="#part0011.html#page_87"
class="calibre6">87</a></p>
<p><code class="calibre8">carries_dependency</code> <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<p>cast <a href="#part0009.html#page_53" class="calibre6">53</a></p>
<p><code class="calibre8">catch</code></p>
<p>clause <a href="#part0008.html#page_36" class="calibre6">36</a></p>
<p>every exception <a href="#part0016.html#page_141"
class="calibre6">141</a></p>
<p><code class="calibre8">catch(...)</code> <a
href="#part0016.html#page_141" class="calibre6">141</a></p>
<p><code class="calibre8">ceil()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p><code class="calibre8">char</code> <a href="#part0006.html#page_5"
class="calibre6">5</a></p>
<p>character sets, multiple <a href="#part0014.html#page_114"
class="calibre6">114</a></p>
<p>check</p>
<p>compile-time <a href="#part0008.html#page_40"
class="calibre6">40</a></p>
<p>run-time <a href="#part0008.html#page_40" class="calibre6">40</a></p>
<p>checking, cost of range <a href="#part0016.html#page_142"
class="calibre6">142</a></p>
<p><code class="calibre8">chrono</code>, <code
class="calibre8">namespace</code> <a href="#part0018.html#page_179"
class="calibre6">179</a></p>
<p><code class="calibre8">&lt;chrono&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a>, <a
href="#part0018.html#page_179" class="calibre6">179</a>, <a
href="#part0020.html#page_200" class="calibre6">200</a></p>
<p>class <a href="#part0009.html#page_48" class="calibre6">48</a></p>
<p>concrete <a href="#part0009.html#page_48" class="calibre6">48</a></p>
<p>scope <a href="#part0006.html#page_9" class="calibre6">9</a></p>
<p><code class="calibre8">template</code> <a
href="#part0011.html#page_79" class="calibre6">79</a></p>
<p><code class="calibre8">class</code></p>
<p>abstract <a href="#part0009.html#page_54" class="calibre6">54</a></p>
<p>base and derived <a href="#part0009.html#page_55"
class="calibre6">55</a></p>
<p>hierarchy <a href="#part0009.html#page_57"
class="calibre6">57</a></p>
<p>Classic C <a href="#part0021.html#page_219"
class="calibre6">219</a></p>
<p>C-library header <a href="#part0013.html#page_110"
class="calibre6">110</a></p>
<p><code class="calibre8">clock</code> timing <a
href="#part0020.html#page_200" class="calibre6">200</a></p>
<p><code class="calibre8">&lt;cmath&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a>, <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p><span id="part0022.html#page_230" class="pagebreak"></span><code
class="calibre8">cntrl</code>, <code class="calibre8">regex</code> <a
href="#part0014.html#page_119" class="calibre6">119</a></p>
<p>code complexity, function and <a href="#part0006.html#page_4"
class="calibre6">4</a></p>
<p>comment, <code class="calibre8">//</code> <a
href="#part0006.html#page_2" class="calibre6">2</a></p>
<p><code class="calibre8">Common</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p><code class="calibre8">CommonReference</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p><code class="calibre8">common_type_t</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p>communication, task <a href="#part0020.html#page_202"
class="calibre6">202</a></p>
<p>comparison <a href="#part0010.html#page_74"
class="calibre6">74</a></p>
<p>operator <a href="#part0006.html#page_6" class="calibre6">6</a>, <a
href="#part0010.html#page_74" class="calibre6">74</a></p>
<p>compatibility, C and C++ <a href="#part0021.html#page_218"
class="calibre6">218</a></p>
<p>compilation</p>
<p>model, template <a href="#part0012.html#page_104"
class="calibre6">104</a></p>
<p>separate <a href="#part0008.html#page_30" class="calibre6">30</a></p>
<p>compiler <a href="#part0006.html#page_2" class="calibre6">2</a></p>
<p>compile-time</p>
<p>check <a href="#part0008.html#page_40" class="calibre6">40</a></p>
<p>computation <a href="#part0018.html#page_181"
class="calibre6">181</a></p>
<p>evaluation <a href="#part0006.html#page_10"
class="calibre6">10</a></p>
<p>complete encapsulation <a href="#part0010.html#page_66"
class="calibre6">66</a></p>
<p><code class="calibre8">complex</code> <a
href="#part0009.html#page_49" class="calibre6">49</a>, <a
href="#part0019.html#page_190" class="calibre6">190</a></p>
<p><code class="calibre8">&lt;complex&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a>, <a
href="#part0019.html#page_188" class="calibre6">188</a>, <a
href="#part0019.html#page_190" class="calibre6">190</a></p>
<p>complexity, function and code <a href="#part0006.html#page_4"
class="calibre6">4</a></p>
<p>components</p>
<p>C++11 library <a href="#part0021.html#page_216"
class="calibre6">216</a></p>
<p>C++14 library <a href="#part0021.html#page_217"
class="calibre6">217</a></p>
<p>C++17 library <a href="#part0021.html#page_217"
class="calibre6">217</a></p>
<p>computation, compile-time <a href="#part0018.html#page_181"
class="calibre6">181</a></p>
<p>concatenation <code class="calibre8">+</code>, <code
class="calibre8">string</code> <a href="#part0014.html#page_111"
class="calibre6">111</a></p>
<p>concept <a href="#part0011.html#page_81" class="calibre6">81</a>, <a
href="#part0012.html#page_94" class="calibre6">94</a></p>
<p>range <a href="#part0017.html#page_157" class="calibre6">157</a></p>
<p><code class="calibre8">concept</code> support <a
href="#part0012.html#page_94" class="calibre6">94</a></p>
<p>concrete</p>
<p>class <a href="#part0009.html#page_48" class="calibre6">48</a></p>
<p>type <a href="#part0009.html#page_48" class="calibre6">48</a></p>
<p>concurrency <a href="#part0020.html#page_195"
class="calibre6">195</a></p>
<p>condition, declaration in <a href="#part0009.html#page_61"
class="calibre6">61</a></p>
<p><code class="calibre8">condition_variable</code> <a
href="#part0020.html#page_201" class="calibre6">201</a></p>
<p><code class="calibre8">notify_one()</code> <a
href="#part0020.html#page_202" class="calibre6">202</a></p>
<p><code class="calibre8">wait()</code> <a
href="#part0020.html#page_201" class="calibre6">201</a></p>
<p><code class="calibre8">&lt;condition_variable&gt;</code> <a
href="#part0020.html#page_201" class="calibre6">201</a></p>
<p><code class="calibre8">const</code></p>
<p>immutability <a href="#part0006.html#page_9"
class="calibre6">9</a></p>
<p>member function <a href="#part0009.html#page_50"
class="calibre6">50</a></p>
<p>constant expression <a href="#part0006.html#page_10"
class="calibre6">10</a></p>
<p><code class="calibre8">const_cast</code> <a
href="#part0009.html#page_53" class="calibre6">53</a></p>
<p><code class="calibre8">constexpr</code></p>
<p>function <a href="#part0006.html#page_10" class="calibre6">10</a></p>
<p>immutability <a href="#part0006.html#page_9"
class="calibre6">9</a></p>
<p><code class="calibre8">const_iterator</code> <a
href="#part0017.html#page_154" class="calibre6">154</a></p>
<p>constrained</p>
<p>argument <a href="#part0011.html#page_81" class="calibre6">81</a></p>
<p>template <a href="#part0011.html#page_82" class="calibre6">82</a></p>
<p>template argument <a href="#part0011.html#page_82"
class="calibre6">82</a></p>
<p><code class="calibre8">Constructible</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p>constructor</p>
<p>and destructor <a href="#part0021.html#page_210"
class="calibre6">210</a></p>
<p>copy <a href="#part0010.html#page_66" class="calibre6">66</a>, <a
href="#part0010.html#page_69" class="calibre6">69</a></p>
<p>default <a href="#part0009.html#page_50" class="calibre6">50</a></p>
<p>delegating <a href="#part0021.html#page_215"
class="calibre6">215</a></p>
<p><code class="calibre8">explicit</code> <a
href="#part0010.html#page_67" class="calibre6">67</a></p>
<p>inheriting <a href="#part0021.html#page_216"
class="calibre6">216</a></p>
<p>initializer-list <a href="#part0009.html#page_52"
class="calibre6">52</a></p>
<p>invariant and <a href="#part0008.html#page_37"
class="calibre6">37</a></p>
<p>move <a href="#part0010.html#page_66" class="calibre6">66</a>, <a
href="#part0010.html#page_71" class="calibre6">71</a></p>
<p>container <a href="#part0009.html#page_51" class="calibre6">51</a>,
<a href="#part0011.html#page_79" class="calibre6">79</a>, <a
href="#part0016.html#page_137" class="calibre6">137</a></p>
<p><code class="calibre8">&gt;</code> <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p><code class="calibre8">=</code> <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p><code class="calibre8">&gt;=</code> <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p><code class="calibre8">&lt;</code> <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p><code class="calibre8">==</code> <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p><code class="calibre8">!=</code> <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p><code class="calibre8">&lt;=</code> <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p>algorithm <a href="#part0017.html#page_150" class="calibre6">150</a>,
<a href="#part0017.html#page_160" class="calibre6">160</a></p>
<p>allocator <code class="calibre8">new</code> <a
href="#part0018.html#page_178" class="calibre6">178</a></p>
<p>almost <a href="#part0018.html#page_170" class="calibre6">170</a></p>
<p>object in <a href="#part0016.html#page_140"
class="calibre6">140</a></p>
<p>overview <a href="#part0016.html#page_146"
class="calibre6">146</a></p>
<p><code class="calibre8">return</code> <a
href="#part0017.html#page_151" class="calibre6">151</a></p>
<p><code class="calibre8">sort()</code> <a
href="#part0018.html#page_181" class="calibre6">181</a></p>
<p>specialized <a href="#part0018.html#page_170"
class="calibre6">170</a></p>
<p>standard library <a href="#part0016.html#page_146"
class="calibre6">146</a></p>
<p>contents-of operator <code class="calibre8">*</code> <a
href="#part0006.html#page_11" class="calibre6">11</a></p>
<p>contract <a href="#part0008.html#page_40" class="calibre6">40</a></p>
<p>conversion <a href="#part0010.html#page_67"
class="calibre6">67</a></p>
<p>explicit type <a href="#part0009.html#page_53"
class="calibre6">53</a></p>
<p>narrowing <a href="#part0006.html#page_8" class="calibre6">8</a></p>
<p>conversions, usual arithmetic <a href="#part0006.html#page_7"
class="calibre6">7</a></p>
<p><code class="calibre8">ConvertibleTo</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p>copy <a href="#part0010.html#page_68" class="calibre6">68</a></p>
<p>assignment <a href="#part0010.html#page_66" class="calibre6">66</a>,
<a href="#part0010.html#page_69" class="calibre6">69</a></p>
<p>constructor <a href="#part0010.html#page_66" class="calibre6">66</a>,
<a href="#part0010.html#page_69" class="calibre6">69</a></p>
<p>cost of <a href="#part0010.html#page_70" class="calibre6">70</a></p>
<p>elision <a href="#part0010.html#page_72" class="calibre6">72</a></p>
<p>elision <a href="#part0010.html#page_66" class="calibre6">66</a></p>
<p>memberwise <a href="#part0010.html#page_66"
class="calibre6">66</a></p>
<p><code class="calibre8">copy()</code> <a
href="#part0017.html#page_156" class="calibre6">156</a></p>
<p><code class="calibre8">Copyable</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p><code class="calibre8">CopyConstructible</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p><code class="calibre8">copy_if()</code> <a
href="#part0017.html#page_156" class="calibre6">156</a></p>
<p>Core Guidelines, C++ <a href="#part0021.html#page_214"
class="calibre6">214</a></p>
<p>core language, C++ <a href="#part0006.html#page_2"
class="calibre6">2</a></p>
<p>coroutine <a href="#part0021.html#page_211"
class="calibre6">211</a></p>
<p><code class="calibre8">cos()</code> <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p><code class="calibre8">cosh()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>cost</p>
<p>of copy <a href="#part0010.html#page_70" class="calibre6">70</a></p>
<p>of range checking <a href="#part0016.html#page_142"
class="calibre6">142</a></p>
<p><code class="calibre8">count()</code> <a
href="#part0017.html#page_156" class="calibre6">156</a></p>
<p><code class="calibre8">count_if()</code> <a
href="#part0017.html#page_155" class="calibre6">155</a>–<a
href="#part0017.html#page_156" class="calibre6">156</a></p>
<p><code class="calibre8">cout</code>, output <a
href="#part0006.html#page_3" class="calibre6">3</a></p>
<p><code class="calibre8">&lt;cstdlib&gt;</code> <a
href="#part0013.html#page_110" class="calibre6">110</a></p>
<p>C-style</p>
<p><span id="part0022.html#page_231" class="pagebreak"></span>error
handling <a href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>string <a href="#part0006.html#page_13" class="calibre6">13</a></p>
<h3 class="h3i">D</h3>
<p><code class="calibre8">\d</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_119" class="calibre6">119</a></p>
<p><code class="calibre8">d</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_119" class="calibre6">119</a></p>
<p><code class="calibre8">\D</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_119" class="calibre6">119</a></p>
<p>data race <a href="#part0020.html#page_196"
class="calibre6">196</a></p>
<p><code class="calibre8">data()</code>, <code
class="calibre8">array</code> <a href="#part0018.html#page_171"
class="calibre6">171</a></p>
<p>D&amp;E <a href="#part0021.html#page_208"
class="calibre6">208</a></p>
<p>deadlock <a href="#part0020.html#page_199"
class="calibre6">199</a></p>
<p>deallocation <a href="#part0009.html#page_51"
class="calibre6">51</a></p>
<p>debugging <code class="calibre8">template</code> <a
href="#part0012.html#page_100" class="calibre6">100</a></p>
<p>declaration <a href="#part0006.html#page_5"
class="calibre6">5</a></p>
<p>function <a href="#part0006.html#page_4" class="calibre6">4</a></p>
<p>in condition <a href="#part0009.html#page_61"
class="calibre6">61</a></p>
<p>interface <a href="#part0008.html#page_29"
class="calibre6">29</a></p>
<p>-declaration, <code class="calibre8">using</code> <a
href="#part0008.html#page_34" class="calibre6">34</a></p>
<p>declarator operator <a href="#part0006.html#page_12"
class="calibre6">12</a></p>
<p><code class="calibre8">decltype</code> <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<p>decrement operator <code class="calibre8">--</code> <a
href="#part0006.html#page_7" class="calibre6">7</a></p>
<p>deduction</p>
<p>guide <a href="#part0011.html#page_83" class="calibre6">83</a>, <a
href="#part0018.html#page_176" class="calibre6">176</a></p>
<p><code class="calibre8">return</code>-type <a
href="#part0008.html#page_44" class="calibre6">44</a></p>
<p>default</p>
<p>constructor <a href="#part0009.html#page_50"
class="calibre6">50</a></p>
<p>function argument <a href="#part0008.html#page_42"
class="calibre6">42</a></p>
<p>member initializer <a href="#part0010.html#page_68"
class="calibre6">68</a></p>
<p>operations <a href="#part0010.html#page_66"
class="calibre6">66</a></p>
<p>template argument <a href="#part0012.html#page_98"
class="calibre6">98</a></p>
<p><code class="calibre8">=default</code> <a
href="#part0010.html#page_66" class="calibre6">66</a></p>
<p><code class="calibre8">DefaultConstructible</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p>definition implementation <a href="#part0008.html#page_30"
class="calibre6">30</a></p>
<p>delegating constructor <a href="#part0021.html#page_215"
class="calibre6">215</a></p>
<p><code class="calibre8">=delete</code> <a
href="#part0010.html#page_67" class="calibre6">67</a></p>
<p><code class="calibre8">delete</code></p>
<p>naked <a href="#part0009.html#page_52" class="calibre6">52</a></p>
<p>operator <a href="#part0009.html#page_51" class="calibre6">51</a></p>
<p>deprecated</p>
<p><code class="calibre8">auto_ptr</code> <a
href="#part0021.html#page_218" class="calibre6">218</a></p>
<p>feature <a href="#part0021.html#page_218"
class="calibre6">218</a></p>
<p><code class="calibre8">deque</code> <a href="#part0016.html#page_146"
class="calibre6">146</a></p>
<p>derived <code class="calibre8">class</code>, base and <a
href="#part0009.html#page_55" class="calibre6">55</a></p>
<p><code class="calibre8">DerivedFrom</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p><code class="calibre8">Destructible</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p>destructor <a href="#part0009.html#page_51" class="calibre6">51</a>,
<a href="#part0010.html#page_66" class="calibre6">66</a></p>
<p><code class="calibre8">^</code> <a href="#part0009.html#page_51"
class="calibre6">51</a></p>
<p>constructor and <a href="#part0021.html#page_210"
class="calibre6">210</a></p>
<p><code class="calibre8">virtual</code> <a
href="#part0009.html#page_59" class="calibre6">59</a></p>
<p>dictionary – see <a href="#part0022.html#idx1" class="calibre6"><code
class="calibre8">map</code></a></p>
<p>difference</p>
<p>from C <a href="#part0021.html#page_218" class="calibre6">218</a></p>
<p>from C <code class="calibre8">void *</code> assignment <a
href="#part0021.html#page_221" class="calibre6">221</a></p>
<p>digit, <code class="calibre8">[[:digit:]]</code> <a
href="#part0014.html#page_119" class="calibre6">119</a></p>
<p><code class="calibre8">digit</code>, <code
class="calibre8">regex</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">[[:digit:]]</code> digit <a
href="#part0014.html#page_119" class="calibre6">119</a></p>
<p>-directive, <code class="calibre8">using</code> <a
href="#part0008.html#page_35" class="calibre6">35</a></p>
<p>dispatch, tag <a href="#part0018.html#page_181"
class="calibre6">181</a></p>
<p>distribution, <code class="calibre8">random</code> <a
href="#part0019.html#page_191" class="calibre6">191</a></p>
<p>divide operator <code class="calibre8">/</code> <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p>domain error <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p><code class="calibre8">double</code> <a href="#part0006.html#page_5"
class="calibre6">5</a></p>
<p>duck typing <a href="#part0012.html#page_104"
class="calibre6">104</a></p>
<p><code class="calibre8">duration</code> <a
href="#part0018.html#page_179" class="calibre6">179</a></p>
<p><code class="calibre8">duration_cast</code> <a
href="#part0018.html#page_179" class="calibre6">179</a></p>
<p>dynamic store <a href="#part0009.html#page_51"
class="calibre6">51</a></p>
<p><code class="calibre8">dynamic_cast</code> <a
href="#part0009.html#page_61" class="calibre6">61</a></p>
<p>is instance of <a href="#part0009.html#page_62"
class="calibre6">62</a></p>
<p>is kind of <a href="#part0009.html#page_62"
class="calibre6">62</a></p>
<h3 class="h3i">E</h3>
<p><code class="calibre8">EDOM</code> <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p>element requirements <a href="#part0016.html#page_140"
class="calibre6">140</a></p>
<p>elision, copy <a href="#part0010.html#page_66"
class="calibre6">66</a></p>
<p><code class="calibre8">emplace_back()</code> <a
href="#part0016.html#page_147" class="calibre6">147</a></p>
<p><code class="calibre8">empty()</code> <a
href="#part0016.html#page_147" class="calibre6">147</a></p>
<p><code class="calibre8">enable_if</code> <a
href="#part0018.html#page_184" class="calibre6">184</a></p>
<p>encapsulation, complete <a href="#part0010.html#page_66"
class="calibre6">66</a></p>
<p><code class="calibre8">end()</code> <a href="#part0010.html#page_75"
class="calibre6">75</a>, <a href="#part0016.html#page_143"
class="calibre6">143</a>, <a href="#part0016.html#page_147"
class="calibre6">147</a>, <a href="#part0017.html#page_150"
class="calibre6">150</a></p>
<p>engine, <code class="calibre8">random</code> <a
href="#part0019.html#page_191" class="calibre6">191</a></p>
<p><code class="calibre8">enum</code>, <code
class="calibre8">bitset</code> and <a href="#part0018.html#page_172"
class="calibre6">172</a></p>
<p>equal operator <code class="calibre8">==</code> <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p>equality preserving <a href="#part0017.html#page_159"
class="calibre6">159</a></p>
<p><code class="calibre8">EqualityComparable</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p><code class="calibre8">equal_range()</code> <a
href="#part0017.html#page_156" class="calibre6">156</a>, <a
href="#part0018.html#page_173" class="calibre6">173</a></p>
<p><code class="calibre8">ERANGE</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p><code class="calibre8">erase()</code> <a
href="#part0016.html#page_143" class="calibre6">143</a>, <a
href="#part0016.html#page_147" class="calibre6">147</a></p>
<p><code class="calibre8">errno</code> <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p>error</p>
<p>domain <a href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>handling <a href="#part0008.html#page_35" class="calibre6">35</a></p>
<p>handling, C-style <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p>range <a href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>recovery <a href="#part0008.html#page_38" class="calibre6">38</a></p>
<p>run-time <a href="#part0008.html#page_35" class="calibre6">35</a></p>
<p>error-code, exception vs <a href="#part0008.html#page_38"
class="calibre6">38</a></p>
<p>essential operations <a href="#part0010.html#page_66"
class="calibre6">66</a></p>
<p>evaluation</p>
<p>compile-time <a href="#part0006.html#page_10"
class="calibre6">10</a></p>
<p>order of <a href="#part0006.html#page_7" class="calibre6">7</a></p>
<p>example</p>
<p><code class="calibre8">find_all()</code> <a
href="#part0017.html#page_151" class="calibre6">151</a></p>
<p><code class="calibre8">Hello</code>, <code
class="calibre8">World!</code> <a href="#part0006.html#page_2"
class="calibre6">2</a></p>
<p><code class="calibre8">Rand_int</code> <a
href="#part0019.html#page_191" class="calibre6">191</a></p>
<p><code class="calibre8">Vec</code> <a href="#part0016.html#page_141"
class="calibre6">141</a></p>
<p>exception <a href="#part0008.html#page_35"
class="calibre6">35</a></p>
<p>and <code class="calibre8">main()</code> <a
href="#part0016.html#page_141" class="calibre6">141</a></p>
<p><code class="calibre8">catch</code> every <a
href="#part0016.html#page_141" class="calibre6">141</a></p>
<p>specification, removed <a href="#part0021.html#page_218"
class="calibre6">218</a></p>
<p>vs error-code <a href="#part0008.html#page_38"
class="calibre6">38</a></p>
<p><span id="part0022.html#page_232" class="pagebreak"></span><code
class="calibre8">exclusive_scan()</code> <a
href="#part0019.html#page_189" class="calibre6">189</a></p>
<p>execution policy <a href="#part0017.html#page_161"
class="calibre6">161</a></p>
<p>explicit type conversion <a href="#part0009.html#page_53"
class="calibre6">53</a></p>
<p><code class="calibre8">explicit</code> constructor <a
href="#part0010.html#page_67" class="calibre6">67</a></p>
<p><code class="calibre8">exponential_distribution</code> <a
href="#part0019.html#page_191" class="calibre6">191</a></p>
<p><code class="calibre8">export</code> removed <a
href="#part0021.html#page_218" class="calibre6">218</a></p>
<p><code class="calibre8">expr()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>expression</p>
<p>constant <a href="#part0006.html#page_10" class="calibre6">10</a></p>
<p>lambda <a href="#part0011.html#page_87" class="calibre6">87</a></p>
<p><code class="calibre8">extern template</code> <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<h3 class="h3i">F</h3>
<p><code class="calibre8">fabs()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>facilities, standard library <a href="#part0013.html#page_108"
class="calibre6">108</a></p>
<p><code class="calibre8">fail_fast</code> <a
href="#part0018.html#page_170" class="calibre6">170</a></p>
<p>feature, deprecated <a href="#part0021.html#page_218"
class="calibre6">218</a></p>
<p>features</p>
<p>C with Classes language <a href="#part0021.html#page_210"
class="calibre6">210</a></p>
<p>C++11 language <a href="#part0021.html#page_215"
class="calibre6">215</a></p>
<p>C++14 language <a href="#part0021.html#page_216"
class="calibre6">216</a></p>
<p>C++17 language <a href="#part0021.html#page_216"
class="calibre6">216</a></p>
<p>file, header <a href="#part0008.html#page_31"
class="calibre6">31</a></p>
<p><code class="calibre8">final</code> <a href="#part0021.html#page_216"
class="calibre6">216</a></p>
<p><code class="calibre8">find()</code> <a
href="#part0017.html#page_150" class="calibre6">150</a>, <a
href="#part0017.html#page_156" class="calibre6">156</a></p>
<p><code class="calibre8">find_all()</code> example <a
href="#part0017.html#page_151" class="calibre6">151</a></p>
<p><code class="calibre8">find_if()</code> <a
href="#part0017.html#page_155" class="calibre6">155</a>–<a
href="#part0017.html#page_156" class="calibre6">156</a></p>
<p><code class="calibre8">first</code>, <code
class="calibre8">pair</code> member <a href="#part0018.html#page_173"
class="calibre6">173</a></p>
<p><code class="calibre8">floor()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p><code class="calibre8">fmod()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p><code class="calibre8">for</code></p>
<p>statement <a href="#part0006.html#page_11"
class="calibre6">11</a></p>
<p>statement, range <a href="#part0006.html#page_11"
class="calibre6">11</a></p>
<p><code class="calibre8">forward()</code> <a
href="#part0018.html#page_167" class="calibre6">167</a></p>
<p>forwarding, perfect <a href="#part0018.html#page_168"
class="calibre6">168</a></p>
<p><code class="calibre8">Forwardlterator</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p><code class="calibre8">forward_list</code> <a
href="#part0016.html#page_146" class="calibre6">146</a></p>
<p>singly-linked list <a href="#part0016.html#page_143"
class="calibre6">143</a></p>
<p><code class="calibre8">&lt;forward_list&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a></p>
<p><code class="calibre8">ForwardRange</code> <a
href="#part0017.html#page_160" class="calibre6">160</a></p>
<p>free store <a href="#part0009.html#page_51"
class="calibre6">51</a></p>
<p><code class="calibre8">frexp()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p><code class="calibre8">&lt;fstream&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a></p>
<p><code class="calibre8">__func__</code> <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<p>function <a href="#part0006.html#page_2" class="calibre6">2</a></p>
<p>and code complexity <a href="#part0006.html#page_4"
class="calibre6">4</a></p>
<p>argument <a href="#part0008.html#page_41" class="calibre6">41</a></p>
<p>argument, default <a href="#part0008.html#page_42"
class="calibre6">42</a></p>
<p>argument passing <a href="#part0010.html#page_66"
class="calibre6">66</a></p>
<p>body <a href="#part0006.html#page_2" class="calibre6">2</a></p>
<p>body, <code class="calibre8">try</code> block as <a
href="#part0016.html#page_141" class="calibre6">141</a></p>
<p><code class="calibre8">const</code> member <a
href="#part0009.html#page_50" class="calibre6">50</a></p>
<p><code class="calibre8">constexpr</code> <a
href="#part0006.html#page_10" class="calibre6">10</a></p>
<p>declaration <a href="#part0006.html#page_4"
class="calibre6">4</a></p>
<p>implementation of <code class="calibre8">virtual</code> <a
href="#part0009.html#page_56" class="calibre6">56</a></p>
<p>mathematical <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p>object <a href="#part0011.html#page_85" class="calibre6">85</a></p>
<p>overloading <a href="#part0006.html#page_4"
class="calibre6">4</a></p>
<p>return value <a href="#part0008.html#page_41"
class="calibre6">41</a></p>
<p><code class="calibre8">template</code> <a
href="#part0011.html#page_84" class="calibre6">84</a></p>
<p>type <a href="#part0018.html#page_181" class="calibre6">181</a></p>
<p>value return <a href="#part0010.html#page_66"
class="calibre6">66</a></p>
<p><code class="calibre8">function</code> <a
href="#part0018.html#page_180" class="calibre6">180</a></p>
<p>and <code class="calibre8">nullptr</code> <a
href="#part0018.html#page_180" class="calibre6">180</a></p>
<p>fundamental type <a href="#part0006.html#page_5"
class="calibre6">5</a></p>
<p><code class="calibre8">future</code></p>
<p>and <code class="calibre8">promise</code> <a
href="#part0020.html#page_202" class="calibre6">202</a></p>
<p>member <code class="calibre8">get()</code> <a
href="#part0020.html#page_202" class="calibre6">202</a></p>
<p><code class="calibre8">&lt;future&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a>, <a
href="#part0020.html#page_202" class="calibre6">202</a></p>
<h3 class="h3i">G</h3>
<p>garbage collection <a href="#part0010.html#page_73"
class="calibre6">73</a></p>
<p>generic programming <a href="#part0012.html#page_93"
class="calibre6">93</a>, <a href="#part0021.html#page_210"
class="calibre6">210</a></p>
<p><code class="calibre8">get&lt;&gt;()</code></p>
<p>by index <a href="#part0018.html#page_174"
class="calibre6">174</a></p>
<p>by type <a href="#part0018.html#page_174"
class="calibre6">174</a></p>
<p><code class="calibre8">get()</code>, <code
class="calibre8">future</code> member <a href="#part0020.html#page_202"
class="calibre6">202</a></p>
<p><code class="calibre8">graph</code>, <code
class="calibre8">regex</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p>greater-than operator <code class="calibre8">&gt;</code> <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p>greater-than-or-equal operator <code class="calibre8">&gt;=</code> <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p>greedy match <a href="#part0014.html#page_118"
class="calibre6">118</a>, <a href="#part0014.html#page_121"
class="calibre6">121</a></p>
<p>grouping, <code class="calibre8">{}</code> <a
href="#part0006.html#page_2" class="calibre6">2</a></p>
<p><code class="calibre8">gsl</code></p>
<p><code class="calibre8">namespace</code> <a
href="#part0018.html#page_168" class="calibre6">168</a></p>
<p><code class="calibre8">span</code> <a href="#part0018.html#page_168"
class="calibre6">168</a></p>
<p>Guidelines, C++ Core <a href="#part0021.html#page_214"
class="calibre6">214</a></p>
<h3 class="h3i">H</h3>
<p>half-open sequence <a href="#part0017.html#page_156"
class="calibre6">156</a></p>
<p>handle <a href="#part0009.html#page_52" class="calibre6">52</a></p>
<p>resource <a href="#part0010.html#page_69" class="calibre6">69</a>, <a
href="#part0018.html#page_165" class="calibre6">165</a></p>
<p>hardware, mapping to <a href="#part0006.html#page_16"
class="calibre6">16</a></p>
<p>hash table <a href="#part0016.html#page_144"
class="calibre6">144</a></p>
<p><code class="calibre8">hash&lt;&gt;</code>, <code
class="calibre8">unordered_map</code> <a href="#part0010.html#page_76"
class="calibre6">76</a></p>
<p>header</p>
<p>C-library <a href="#part0013.html#page_110"
class="calibre6">110</a></p>
<p>file <a href="#part0008.html#page_31" class="calibre6">31</a></p>
<p>standard library <a href="#part0013.html#page_109"
class="calibre6">109</a></p>
<p>heap <a href="#part0009.html#page_51" class="calibre6">51</a></p>
<p><code class="calibre8">Hello</code>, <code
class="calibre8">World!</code> example <a href="#part0006.html#page_2"
class="calibre6">2</a></p>
<p>hierarchy</p>
<p><code class="calibre8">class</code> <a href="#part0009.html#page_57"
class="calibre6">57</a></p>
<p>navigation <a href="#part0009.html#page_61"
class="calibre6">61</a></p>
<p>history, C++ <a href="#part0021.html#page_207"
class="calibre6">207</a></p>
<p>HOPL <a href="#part0021.html#page_208" class="calibre6">208</a></p>
<h3 class="h3i"><span id="part0022.html#page_233"
class="calibre2 pagebreak"></span>I</h3>
<p><code class="calibre8">if</code> statement <a
href="#part0006.html#page_14" class="calibre6">14</a></p>
<p>immutability</p>
<p><code class="calibre8">const</code> <a href="#part0006.html#page_9"
class="calibre6">9</a></p>
<p><code class="calibre8">constexpr</code> <a
href="#part0006.html#page_9" class="calibre6">9</a></p>
<p>implementation</p>
<p>definition <a href="#part0008.html#page_30"
class="calibre6">30</a></p>
<p>inheritance <a href="#part0009.html#page_60"
class="calibre6">60</a></p>
<p>iterator <a href="#part0017.html#page_153"
class="calibre6">153</a></p>
<p>of <code class="calibre8">virtual</code> function <a
href="#part0009.html#page_56" class="calibre6">56</a></p>
<p><code class="calibre8">string</code> <a
href="#part0014.html#page_113" class="calibre6">113</a></p>
<p>in-class member initialization <a href="#part0021.html#page_215"
class="calibre6">215</a></p>
<p><code class="calibre8">#include</code> <a
href="#part0008.html#page_31" class="calibre6">31</a></p>
<p><code class="calibre8">inclusive_scan()</code> <a
href="#part0019.html#page_189" class="calibre6">189</a></p>
<p>increment operator <code class="calibre8">++</code> <a
href="#part0006.html#page_7" class="calibre6">7</a></p>
<p>index, <code class="calibre8">get&lt;&gt;()</code> by <a
href="#part0018.html#page_174" class="calibre6">174</a></p>
<p>inheritance <a href="#part0009.html#page_55"
class="calibre6">55</a></p>
<p>implementation <a href="#part0009.html#page_60"
class="calibre6">60</a></p>
<p>interface <a href="#part0009.html#page_60"
class="calibre6">60</a></p>
<p>multiple <a href="#part0021.html#page_211"
class="calibre6">211</a></p>
<p>inheriting constructor <a href="#part0021.html#page_216"
class="calibre6">216</a></p>
<p>initialization</p>
<p>and assignment <a href="#part0006.html#page_18"
class="calibre6">18</a></p>
<p>in-class member <a href="#part0021.html#page_215"
class="calibre6">215</a></p>
<p>initialize <a href="#part0009.html#page_52"
class="calibre6">52</a></p>
<p><code class="calibre8">array</code> <a href="#part0018.html#page_171"
class="calibre6">171</a></p>
<p>initializer</p>
<p><code class="calibre8">=</code> <a href="#part0006.html#page_7"
class="calibre6">7</a></p>
<p><code class="calibre8">{}</code> <a href="#part0006.html#page_8"
class="calibre6">8</a></p>
<p>default member <a href="#part0010.html#page_68"
class="calibre6">68</a></p>
<p>initializer-list constructor <a href="#part0009.html#page_52"
class="calibre6">52</a></p>
<p><code class="calibre8">initializer_list</code> <a
href="#part0009.html#page_52" class="calibre6">52</a></p>
<p><code class="calibre8">inline</code> <a href="#part0009.html#page_49"
class="calibre6">49</a></p>
<p><code class="calibre8">namespace</code> <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<p>inlining <a href="#part0009.html#page_49" class="calibre6">49</a></p>
<p><code class="calibre8">inner_product()</code> <a
href="#part0019.html#page_189" class="calibre6">189</a></p>
<p><code class="calibre8">lnputlterator</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p><code class="calibre8">lnputRange</code> <a
href="#part0017.html#page_160" class="calibre6">160</a></p>
<p><code class="calibre8">insert()</code> <a
href="#part0016.html#page_143" class="calibre6">143</a>, <a
href="#part0016.html#page_147" class="calibre6">147</a></p>
<p>instantiation <a href="#part0011.html#page_81"
class="calibre6">81</a></p>
<p>instruction, machine <a href="#part0006.html#page_16"
class="calibre6">16</a></p>
<p><code class="calibre8">int</code> <a href="#part0006.html#page_5"
class="calibre6">5</a></p>
<p>output bits of <a href="#part0018.html#page_172"
class="calibre6">172</a></p>
<p><code class="calibre8">lntegral</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p>interface</p>
<p>declaration <a href="#part0008.html#page_29"
class="calibre6">29</a></p>
<p>inheritance <a href="#part0009.html#page_60"
class="calibre6">60</a></p>
<p>invariant <a href="#part0008.html#page_37"
class="calibre6">37</a></p>
<p>and constructor <a href="#part0008.html#page_37"
class="calibre6">37</a></p>
<p><code class="calibre8">lnvocable</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p><code class="calibre8">lnvocableRegular</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p>I/O, iterator and <a href="#part0017.html#page_154"
class="calibre6">154</a></p>
<p><code class="calibre8">&lt;ios&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a></p>
<p><code class="calibre8">&lt;iostream&gt;</code> <a
href="#part0006.html#page_3" class="calibre6">3</a>, <a
href="#part0013.html#page_109" class="calibre6">109</a></p>
<p><code class="calibre8">iota()</code> <a
href="#part0019.html#page_189" class="calibre6">189</a></p>
<p>is</p>
<p>instance of, <code class="calibre8">dynamic_cast</code> <a
href="#part0009.html#page_62" class="calibre6">62</a></p>
<p>kind of, <code class="calibre8">dynamic_cast</code> <a
href="#part0009.html#page_62" class="calibre6">62</a></p>
<p>ISO</p>
<p>C++ <a href="#part0021.html#page_212" class="calibre6">212</a></p>
<p>C++ standard <a href="#part0006.html#page_2"
class="calibre6">2</a></p>
<p>ISO-14882 <a href="#part0021.html#page_212"
class="calibre6">212</a></p>
<p><code class="calibre8">istream_iterator</code> <a
href="#part0017.html#page_154" class="calibre6">154</a></p>
<p>iterator <a href="#part0010.html#page_75" class="calibre6">75</a>, <a
href="#part0017.html#page_150" class="calibre6">150</a></p>
<p>and I/O <a href="#part0017.html#page_154"
class="calibre6">154</a></p>
<p>implementation <a href="#part0017.html#page_153"
class="calibre6">153</a></p>
<p><code class="calibre8">lterator</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p><code class="calibre8">iterator</code> <a
href="#part0016.html#page_143" class="calibre6">143</a>, <a
href="#part0017.html#page_154" class="calibre6">154</a></p>
<p><code class="calibre8">&lt;iterator&gt;</code> <a
href="#part0018.html#page_182" class="calibre6">182</a></p>
<p><code class="calibre8">iterator_category</code> <a
href="#part0018.html#page_182" class="calibre6">182</a></p>
<p><code class="calibre8">iterator_traits</code> <a
href="#part0018.html#page_181" class="calibre6">181</a>–<a
href="#part0018.html#page_182" class="calibre6">182</a></p>
<p><code class="calibre8">iterator_type</code> <a
href="#part0018.html#page_182" class="calibre6">182</a></p>
<h3 class="h3i">J</h3>
<p><code class="calibre8">join()</code>, <code
class="calibre8">thread</code> <a href="#part0020.html#page_196"
class="calibre6">196</a></p>
<h3 class="h3i">K</h3>
<p>key and value <a href="#part0016.html#page_144"
class="calibre6">144</a></p>
<p>K&amp;R C <a href="#part0021.html#page_219"
class="calibre6">219</a></p>
<h3 class="h3i">L</h3>
<p><code class="calibre8">\l</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_119" class="calibre6">119</a></p>
<p><code class="calibre8">\L</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_119" class="calibre6">119</a></p>
<p>lambda</p>
<p>as adaptor <a href="#part0018.html#page_180"
class="calibre6">180</a></p>
<p>expression <a href="#part0011.html#page_87"
class="calibre6">87</a></p>
<p>language</p>
<p>and library <a href="#part0013.html#page_107"
class="calibre6">107</a></p>
<p>features, C with Classes <a href="#part0021.html#page_210"
class="calibre6">210</a></p>
<p>features, C++11 <a href="#part0021.html#page_215"
class="calibre6">215</a></p>
<p>features, C++14 <a href="#part0021.html#page_216"
class="calibre6">216</a></p>
<p>features, C++17 <a href="#part0021.html#page_216"
class="calibre6">216</a></p>
<p>launch, <code class="calibre8">async()</code> <a
href="#part0020.html#page_204" class="calibre6">204</a></p>
<p>lazy</p>
<p><code class="calibre8">*?</code> <a href="#part0014.html#page_118"
class="calibre6">118</a></p>
<p><code class="calibre8">+?</code> <a href="#part0014.html#page_118"
class="calibre6">118</a></p>
<p><code class="calibre8">??</code> <a href="#part0014.html#page_118"
class="calibre6">118</a></p>
<p><code class="calibre8">{}?</code> <a href="#part0014.html#page_118"
class="calibre6">118</a></p>
<p>match <a href="#part0014.html#page_118" class="calibre6">118</a>, <a
href="#part0014.html#page_121" class="calibre6">121</a></p>
<p><code class="calibre8">ldexp()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>leak, resource <a href="#part0009.html#page_62"
class="calibre6">62</a>, <a href="#part0010.html#page_72"
class="calibre6">72</a>, <a href="#part0018.html#page_164"
class="calibre6">164</a></p>
<p>less-than operator <code class="calibre8">&lt;</code> <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p>less-than-or-equal operator <code class="calibre8">&lt;=</code> <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p>letter, <code class="calibre8">[[:alpha:]]</code> <a
href="#part0014.html#page_119" class="calibre6">119</a></p>
<p>library</p>
<p>algorithm, standard <a href="#part0017.html#page_156"
class="calibre6">156</a></p>
<p>C with Classes standard <a href="#part0021.html#page_211"
class="calibre6">211</a></p>
<p>C++98 standard <a href="#part0021.html#page_211"
class="calibre6">211</a></p>
<p><span id="part0022.html#page_234"
class="pagebreak"></span>components, C++11 <a
href="#part0021.html#page_216" class="calibre6">216</a></p>
<p>components, C++14 <a href="#part0021.html#page_217"
class="calibre6">217</a></p>
<p>components, C++17 <a href="#part0021.html#page_217"
class="calibre6">217</a></p>
<p>container, standard <a href="#part0016.html#page_146"
class="calibre6">146</a></p>
<p>facilities, standard <a href="#part0013.html#page_108"
class="calibre6">108</a></p>
<p>language and <a href="#part0013.html#page_107"
class="calibre6">107</a></p>
<p>non-standard <a href="#part0013.html#page_107"
class="calibre6">107</a></p>
<p>standard <a href="#part0013.html#page_107"
class="calibre6">107</a></p>
<p>lifetime, scope and <a href="#part0006.html#page_9"
class="calibre6">9</a></p>
<p>lifting algorithm <a href="#part0012.html#page_100"
class="calibre6">100</a></p>
<p><code class="calibre8">&lt;limits&gt;</code> <a
href="#part0018.html#page_181" class="calibre6">181</a>, <a
href="#part0019.html#page_193" class="calibre6">193</a></p>
<p>linker <a href="#part0006.html#page_2" class="calibre6">2</a></p>
<p>list</p>
<p>capture <a href="#part0011.html#page_87" class="calibre6">87</a></p>
<p><code class="calibre8">forward_list</code> singly-linked <a
href="#part0016.html#page_143" class="calibre6">143</a></p>
<p><code class="calibre8">list</code> <a href="#part0016.html#page_142"
class="calibre6">142</a>, <a href="#part0016.html#page_146"
class="calibre6">146</a></p>
<p>literal</p>
<p><code class="calibre8">"</code>, string <a
href="#part0006.html#page_3" class="calibre6">3</a></p>
<p>raw string <a href="#part0014.html#page_116"
class="calibre6">116</a></p>
<p>suffix, <code class="calibre8">s</code> <a
href="#part0014.html#page_113" class="calibre6">113</a></p>
<p>suffix, <code class="calibre8">sv</code> <a
href="#part0014.html#page_115" class="calibre6">115</a></p>
<p>type of string <a href="#part0014.html#page_113"
class="calibre6">113</a></p>
<p>user-defined <a href="#part0010.html#page_75"
class="calibre6">75</a>, <a href="#part0021.html#page_215"
class="calibre6">215</a></p>
<p><code class="calibre8">literals</code></p>
<p><code class="calibre8">string_literals</code> <a
href="#part0014.html#page_113" class="calibre6">113</a></p>
<p><code class="calibre8">string_view_literals</code> <a
href="#part0014.html#page_115" class="calibre6">115</a></p>
<p>local scope <a href="#part0006.html#page_9"
class="calibre6">9</a></p>
<p>lock, reader-writer <a href="#part0020.html#page_200"
class="calibre6">200</a></p>
<p><code class="calibre8">log()</code> <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p><code class="calibre8">log10()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p><code class="calibre8">long long</code> <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<p><code class="calibre8">lower</code>, <code
class="calibre8">regex</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<h3 class="h3i">M</h3>
<p>machine instruction <a href="#part0006.html#page_16"
class="calibre6">16</a></p>
<p><code class="calibre8">main()</code> <a href="#part0006.html#page_2"
class="calibre6">2</a></p>
<p>exception and <a href="#part0016.html#page_141"
class="calibre6">141</a></p>
<p><code class="calibre8">make_pair()</code> <a
href="#part0018.html#page_173" class="calibre6">173</a></p>
<p><code class="calibre8">make_shared()</code> <a
href="#part0018.html#page_166" class="calibre6">166</a></p>
<p><code class="calibre8">make_tuple()</code> <a
href="#part0018.html#page_174" class="calibre6">174</a></p>
<p><code class="calibre8">make_unique()</code> <a
href="#part0018.html#page_166" class="calibre6">166</a></p>
<p>management, resource <a href="#part0010.html#page_72"
class="calibre6">72</a>, <a href="#part0018.html#page_164"
class="calibre6">164</a></p>
<p><span id="part0022.html#idx1" class="calibre6"></span><code
class="calibre8">map</code> <a href="#part0016.html#page_144"
class="calibre6">144</a>, <a href="#part0016.html#page_146"
class="calibre6">146</a></p>
<p>and <code class="calibre8">unordered_map</code> <a
href="#part0016.html#page_146" class="calibre6">146</a></p>
<p><code class="calibre8">&lt;map&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a></p>
<p>mapped type, value <a href="#part0016.html#page_144"
class="calibre6">144</a></p>
<p>mapping to hardware <a href="#part0006.html#page_16"
class="calibre6">16</a></p>
<p>match</p>
<p>greedy <a href="#part0014.html#page_118" class="calibre6">118</a>, <a
href="#part0014.html#page_121" class="calibre6">121</a></p>
<p>lazy <a href="#part0014.html#page_118" class="calibre6">118</a>, <a
href="#part0014.html#page_121" class="calibre6">121</a></p>
<p>mathematical</p>
<p>function <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p>functions, special <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p>functions, standard <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p><code class="calibre8">&lt;math.h&gt;</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>Max Munch rule <a href="#part0014.html#page_118"
class="calibre6">118</a></p>
<p>meaning, C++ <a href="#part0021.html#page_209"
class="calibre6">209</a></p>
<p>member</p>
<p>function, <code class="calibre8">const</code> <a
href="#part0009.html#page_50" class="calibre6">50</a></p>
<p>initialization, in-class <a href="#part0021.html#page_215"
class="calibre6">215</a></p>
<p>initializer, default <a href="#part0010.html#page_68"
class="calibre6">68</a></p>
<p>memberwise copy <a href="#part0010.html#page_66"
class="calibre6">66</a></p>
<p><code class="calibre8">mem_fn()</code> <a
href="#part0018.html#page_180" class="calibre6">180</a></p>
<p>memory <a href="#part0010.html#page_73" class="calibre6">73</a></p>
<p>address <a href="#part0006.html#page_16" class="calibre6">16</a></p>
<p><code class="calibre8">&lt;memory&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a>, <a
href="#part0018.html#page_164" class="calibre6">164</a>, <a
href="#part0018.html#page_166" class="calibre6">166</a></p>
<p><code class="calibre8">merge()</code> <a
href="#part0017.html#page_156" class="calibre6">156</a></p>
<p><code class="calibre8">Mergeable</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p>minus operator <code class="calibre8">-</code> <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p>model, template compilation <a href="#part0012.html#page_104"
class="calibre6">104</a></p>
<p>modern C++ <a href="#part0021.html#page_214"
class="calibre6">214</a></p>
<p><code class="calibre8">modf()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>modularity <a href="#part0008.html#page_29"
class="calibre6">29</a></p>
<p><code class="calibre8">module</code> <a href="#part0008.html#page_32"
class="calibre6">32</a></p>
<p>suport <a href="#part0008.html#page_32" class="calibre6">32</a></p>
<p>modulus operator <code class="calibre8">%</code> <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">Movable</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p>move <a href="#part0010.html#page_71" class="calibre6">71</a></p>
<p>assignment <a href="#part0010.html#page_66" class="calibre6">66</a>,
<a href="#part0010.html#page_72" class="calibre6">72</a></p>
<p>constructor <a href="#part0010.html#page_66" class="calibre6">66</a>,
<a href="#part0010.html#page_71" class="calibre6">71</a></p>
<p><code class="calibre8">move()</code> <a href="#part0010.html#page_72"
class="calibre6">72</a>, <a href="#part0017.html#page_156"
class="calibre6">156</a>, <a href="#part0018.html#page_167"
class="calibre6">167</a></p>
<p><code class="calibre8">MoveConstructible</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p>moved-from</p>
<p>object <a href="#part0010.html#page_72" class="calibre6">72</a></p>
<p>state <a href="#part0018.html#page_168" class="calibre6">168</a></p>
<p>move-only type <a href="#part0018.html#page_167"
class="calibre6">167</a></p>
<p>multi-line pattern <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">multimap</code> <a
href="#part0016.html#page_146" class="calibre6">146</a></p>
<p>multiple</p>
<p>character sets <a href="#part0014.html#page_114"
class="calibre6">114</a></p>
<p>inheritance <a href="#part0021.html#page_211"
class="calibre6">211</a></p>
<p>return-values <a href="#part0008.html#page_44"
class="calibre6">44</a></p>
<p>multiply operator <code class="calibre8">*</code> <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">multiset</code> <a
href="#part0016.html#page_146" class="calibre6">146</a></p>
<p><code class="calibre8">mutex</code> <a href="#part0020.html#page_199"
class="calibre6">199</a></p>
<p><code class="calibre8">&lt;mutex&gt;</code> <a
href="#part0020.html#page_199" class="calibre6">199</a></p>
<h3 class="h3i">N</h3>
<p><code class="calibre8">\n</code>, newline <a
href="#part0006.html#page_3" class="calibre6">3</a></p>
<p>naked</p>
<p><code class="calibre8">delete</code> <a href="#part0009.html#page_52"
class="calibre6">52</a></p>
<p><code class="calibre8">new</code> <a href="#part0009.html#page_52"
class="calibre6">52</a></p>
<p>namespace scope <a href="#part0006.html#page_9"
class="calibre6">9</a></p>
<p><code class="calibre8">namespace</code> <a
href="#part0008.html#page_34" class="calibre6">34</a></p>
<p><code class="calibre8">chrono</code> <a
href="#part0018.html#page_179" class="calibre6">179</a></p>
<p><code class="calibre8">gsl</code> <a href="#part0018.html#page_168"
class="calibre6">168</a></p>
<p><code class="calibre8">inline</code> <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<p><code class="calibre8">pmr</code> <a href="#part0018.html#page_178"
class="calibre6">178</a></p>
<p><code class="calibre8">std</code> <a href="#part0006.html#page_3"
class="calibre6">3</a>, <a href="#part0008.html#page_35"
class="calibre6">35</a>, <a href="#part0013.html#page_109"
class="calibre6">109</a></p>
<p>narrowing conversion <a href="#part0006.html#page_8"
class="calibre6">8</a></p>
<p><span id="part0022.html#page_235"
class="pagebreak"></span>navigation, hierarchy <a
href="#part0009.html#page_61" class="calibre6">61</a></p>
<p><code class="calibre8">new</code></p>
<p>container allocator <a href="#part0018.html#page_178"
class="calibre6">178</a></p>
<p>naked <a href="#part0009.html#page_52" class="calibre6">52</a></p>
<p>operator <a href="#part0009.html#page_51" class="calibre6">51</a></p>
<p>newline <code class="calibre8">\n</code> <a
href="#part0006.html#page_3" class="calibre6">3</a></p>
<p><code class="calibre8">noexcept</code> <a
href="#part0008.html#page_37" class="calibre6">37</a></p>
<p><code class="calibre8">noexcept()</code> <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<p>non-memory resource <a href="#part0010.html#page_73"
class="calibre6">73</a></p>
<p>non-standard library <a href="#part0013.html#page_107"
class="calibre6">107</a></p>
<p><code class="calibre8">noreturn</code> <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<p><code class="calibre8">normal_distribution</code> <a
href="#part0019.html#page_191" class="calibre6">191</a></p>
<p>notation, regular expression <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p>not-equal operator <code class="calibre8">!=</code> <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">notify_one()</code>, <code
class="calibre8">condition_variable</code> <a
href="#part0020.html#page_202" class="calibre6">202</a></p>
<p><code class="calibre8">NULL 0</code>, <code
class="calibre8">nullptr</code> <a href="#part0006.html#page_13"
class="calibre6">13</a></p>
<p><code class="calibre8">nullptr</code> <a
href="#part0006.html#page_13" class="calibre6">13</a></p>
<p><code class="calibre8">function</code> and <a
href="#part0018.html#page_180" class="calibre6">180</a></p>
<p><code class="calibre8">NULL 0</code> <a href="#part0006.html#page_13"
class="calibre6">13</a></p>
<p>number, random <a href="#part0019.html#page_191"
class="calibre6">191</a></p>
<p><code class="calibre8">&lt;numeric&gt;</code> <a
href="#part0019.html#page_189" class="calibre6">189</a></p>
<p>numerical algorithm <a href="#part0019.html#page_189"
class="calibre6">189</a></p>
<p><code class="calibre8">numeric_limits</code> <a
href="#part0019.html#page_193" class="calibre6">193</a></p>
<h3 class="h3i">O</h3>
<p>object <a href="#part0006.html#page_5" class="calibre6">5</a></p>
<p>function <a href="#part0011.html#page_85" class="calibre6">85</a></p>
<p>in container <a href="#part0016.html#page_140"
class="calibre6">140</a></p>
<p>moved-from <a href="#part0010.html#page_72"
class="calibre6">72</a></p>
<p>object-oriented programming <a href="#part0009.html#page_57"
class="calibre6">57</a>, <a href="#part0021.html#page_210"
class="calibre6">210</a></p>
<p>operations</p>
<p>default <a href="#part0010.html#page_66" class="calibre6">66</a></p>
<p>essential <a href="#part0010.html#page_66"
class="calibre6">66</a></p>
<p>operator</p>
<p><code class="calibre8">%=</code> <a href="#part0006.html#page_7"
class="calibre6">7</a></p>
<p><code class="calibre8">+=</code> <a href="#part0006.html#page_7"
class="calibre6">7</a></p>
<p><code class="calibre8">&amp;</code>, address-of <a
href="#part0006.html#page_11" class="calibre6">11</a></p>
<p><code class="calibre8">()</code>, call <a
href="#part0011.html#page_85" class="calibre6">85</a></p>
<p><code class="calibre8">*</code>, contents-of <a
href="#part0006.html#page_11" class="calibre6">11</a></p>
<p><code class="calibre8">--</code>, decrement <a
href="#part0006.html#page_7" class="calibre6">7</a></p>
<p><code class="calibre8">/</code>, divide <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">==</code>, equal <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">&gt;</code>, greater-than <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">&gt;=</code>, greater-than-or-equal <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">++</code>, increment <a
href="#part0006.html#page_7" class="calibre6">7</a></p>
<p><code class="calibre8">&lt;</code>, less-than <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">&lt;=</code>, less-than-or-equal <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">-</code>, minus <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">%</code>, modulus <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">*</code>, multiply <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">!=</code>, not-equal <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">&lt;&lt;</code>, output <a
href="#part0006.html#page_3" class="calibre6">3</a></p>
<p><code class="calibre8">+</code>, plus <a href="#part0006.html#page_6"
class="calibre6">6</a></p>
<p><code class="calibre8">%</code>, remainder <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">*=</code>, scaling <a
href="#part0006.html#page_7" class="calibre6">7</a></p>
<p><code class="calibre8">/=</code>, scaling <a
href="#part0006.html#page_7" class="calibre6">7</a></p>
<p>arithmetic <a href="#part0006.html#page_6" class="calibre6">6</a></p>
<p>comparison <a href="#part0006.html#page_6" class="calibre6">6</a>, <a
href="#part0010.html#page_74" class="calibre6">74</a></p>
<p>declarator <a href="#part0006.html#page_12"
class="calibre6">12</a></p>
<p><code class="calibre8">delete</code> <a href="#part0009.html#page_51"
class="calibre6">51</a></p>
<p><code class="calibre8">new</code> <a href="#part0009.html#page_51"
class="calibre6">51</a></p>
<p>overloaded <a href="#part0009.html#page_51"
class="calibre6">51</a></p>
<p>user-defined <a href="#part0009.html#page_51"
class="calibre6">51</a></p>
<p>optimization, short-string <a href="#part0014.html#page_113"
class="calibre6">113</a></p>
<p><code class="calibre8">optional</code> <a
href="#part0018.html#page_176" class="calibre6">176</a></p>
<p>order of evaluation <a href="#part0006.html#page_7"
class="calibre6">7</a></p>
<p><code class="calibre8">ostream_iterator</code> <a
href="#part0017.html#page_154" class="calibre6">154</a></p>
<p><code class="calibre8">out_of_range</code> <a
href="#part0016.html#page_141" class="calibre6">141</a></p>
<p>output</p>
<p>bits of <code class="calibre8">int</code> <a
href="#part0018.html#page_172" class="calibre6">172</a></p>
<p><code class="calibre8">cout</code> <a href="#part0006.html#page_3"
class="calibre6">3</a></p>
<p>operator <code class="calibre8">&lt;&lt;</code> <a
href="#part0006.html#page_3" class="calibre6">3</a></p>
<p><code class="calibre8">Outputlterator</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p><code class="calibre8">OutputRange</code> <a
href="#part0017.html#page_160" class="calibre6">160</a></p>
<p>overloaded operator <a href="#part0009.html#page_51"
class="calibre6">51</a></p>
<p>overloading, function <a href="#part0006.html#page_4"
class="calibre6">4</a></p>
<p><code class="calibre8">override</code> <a
href="#part0009.html#page_55" class="calibre6">55</a></p>
<p>overview, container <a href="#part0016.html#page_146"
class="calibre6">146</a></p>
<p>ownership <a href="#part0018.html#page_164"
class="calibre6">164</a></p>
<h3 class="h3i">P</h3>
<p><code class="calibre8">packaged_task thread</code> <a
href="#part0020.html#page_203" class="calibre6">203</a></p>
<p><code class="calibre8">pair</code> <a href="#part0018.html#page_173"
class="calibre6">173</a></p>
<p>and structured binding <a href="#part0018.html#page_174"
class="calibre6">174</a></p>
<p>member <code class="calibre8">first</code> <a
href="#part0018.html#page_173" class="calibre6">173</a></p>
<p>member <code class="calibre8">second</code> <a
href="#part0018.html#page_173" class="calibre6">173</a></p>
<p><code class="calibre8">par</code> <a href="#part0017.html#page_161"
class="calibre6">161</a></p>
<p>parallel algorithm <a href="#part0017.html#page_161"
class="calibre6">161</a></p>
<p>parameterized type <a href="#part0011.html#page_79"
class="calibre6">79</a></p>
<p><code class="calibre8">partial_sum()</code> <a
href="#part0019.html#page_189" class="calibre6">189</a></p>
<p><code class="calibre8">par_unseq</code> <a
href="#part0017.html#page_161" class="calibre6">161</a></p>
<p>passing data to task <a href="#part0020.html#page_197"
class="calibre6">197</a></p>
<p>pattern <a href="#part0014.html#page_116"
class="calibre6">116</a></p>
<p><code class="calibre8">(?:</code> <a href="#part0014.html#page_120"
class="calibre6">120</a></p>
<p>multi-line <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p>perfect forwarding <a href="#part0018.html#page_168"
class="calibre6">168</a></p>
<p><code class="calibre8">Permutable</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p><code class="calibre8">phone_book</code> example <a
href="#part0016.html#page_138" class="calibre6">138</a></p>
<p>plus operator <code class="calibre8">+</code> <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">pmr</code>, <code
class="calibre8">namespace</code> <a href="#part0018.html#page_178"
class="calibre6">178</a></p>
<p>pointer <a href="#part0006.html#page_17" class="calibre6">17</a></p>
<p>smart <a href="#part0018.html#page_164" class="calibre6">164</a></p>
<p>to <code class="calibre8">*</code> <a href="#part0006.html#page_11"
class="calibre6">11</a></p>
<p>policy, execution <a href="#part0017.html#page_161"
class="calibre6">161</a></p>
<p>polymorphic type <a href="#part0009.html#page_54"
class="calibre6">54</a></p>
<p><code class="calibre8">pow()</code> <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p>precondition <a href="#part0008.html#page_37"
class="calibre6">37</a></p>
<p>predicate <a href="#part0011.html#page_86" class="calibre6">86</a>,
<a href="#part0017.html#page_155" class="calibre6">155</a></p>
<p>type <a href="#part0018.html#page_183" class="calibre6">183</a></p>
<p><code class="calibre8">Predicate</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p><span id="part0022.html#page_236" class="pagebreak"></span><code
class="calibre8">print</code>, <code class="calibre8">regex</code> <a
href="#part0014.html#page_119" class="calibre6">119</a></p>
<p>procedural programming <a href="#part0006.html#page_2"
class="calibre6">2</a></p>
<p>program <a href="#part0006.html#page_2" class="calibre6">2</a></p>
<p>programming</p>
<p>generic <a href="#part0012.html#page_93" class="calibre6">93</a>, <a
href="#part0021.html#page_210" class="calibre6">210</a></p>
<p>object-oriented <a href="#part0009.html#page_57"
class="calibre6">57</a>, <a href="#part0021.html#page_210"
class="calibre6">210</a></p>
<p>procedural <a href="#part0006.html#page_2" class="calibre6">2</a></p>
<p><code class="calibre8">promise</code></p>
<p><code class="calibre8">future</code> and <a
href="#part0020.html#page_202" class="calibre6">202</a></p>
<p>member <code class="calibre8">set_exception()</code> <a
href="#part0020.html#page_202" class="calibre6">202</a></p>
<p>member <code class="calibre8">set_value()</code> <a
href="#part0020.html#page_202" class="calibre6">202</a></p>
<p>pronunciation, C++ <a href="#part0021.html#page_209"
class="calibre6">209</a></p>
<p><code class="calibre8">punct</code>, <code
class="calibre8">regex</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p>pure <code class="calibre8">virtual</code> <a
href="#part0009.html#page_54" class="calibre6">54</a></p>
<p>purpose, <code class="calibre8">template</code> <a
href="#part0012.html#page_93" class="calibre6">93</a></p>
<p><code class="calibre8">push_back()</code> <a
href="#part0009.html#page_52" class="calibre6">52</a>, <a
href="#part0016.html#page_139" class="calibre6">139</a>, <a
href="#part0016.html#page_143" class="calibre6">143</a>, <a
href="#part0016.html#page_147" class="calibre6">147</a></p>
<p><code class="calibre8">push_front()</code> <a
href="#part0016.html#page_143" class="calibre6">143</a></p>
<h3 class="h3i">R</h3>
<p><code class="calibre8">R"</code> <a href="#part0014.html#page_116"
class="calibre6">116</a></p>
<p>race, data <a href="#part0020.html#page_196"
class="calibre6">196</a></p>
<p>RAII</p>
<p>and resource management <a href="#part0008.html#page_36"
class="calibre6">36</a></p>
<p>and <code class="calibre8">try</code>-block <a
href="#part0008.html#page_40" class="calibre6">40</a></p>
<p>and <code class="calibre8">try</code>-statement <a
href="#part0008.html#page_36" class="calibre6">36</a></p>
<p>resource acquisition <a href="#part0018.html#page_164"
class="calibre6">164</a></p>
<p><code class="calibre8">scoped_lock</code> and <a
href="#part0020.html#page_199" class="calibre6">199</a>–<a
href="#part0020.html#page_200" class="calibre6">200</a></p>
<p><code class="calibre8">RAII</code> <a href="#part0009.html#page_52"
class="calibre6">52</a></p>
<p><code class="calibre8">Rand_int</code> example <a
href="#part0019.html#page_191" class="calibre6">191</a></p>
<p>random number <a href="#part0019.html#page_191"
class="calibre6">191</a></p>
<p><code class="calibre8">random</code></p>
<p>distribution <a href="#part0019.html#page_191"
class="calibre6">191</a></p>
<p>engine <a href="#part0019.html#page_191" class="calibre6">191</a></p>
<p><code class="calibre8">&lt;random&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a>, <a
href="#part0019.html#page_191" class="calibre6">191</a></p>
<p><code class="calibre8">RandomAccessIterator</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p><code class="calibre8">RandomAccessRange</code> <a
href="#part0017.html#page_160" class="calibre6">160</a></p>
<p>range</p>
<p>checking, cost of <a href="#part0016.html#page_142"
class="calibre6">142</a></p>
<p>checking <code class="calibre8">Vec</code> <a
href="#part0016.html#page_140" class="calibre6">140</a></p>
<p>concept <a href="#part0017.html#page_157"
class="calibre6">157</a></p>
<p>error <a href="#part0019.html#page_188" class="calibre6">188</a></p>
<p><code class="calibre8">for</code> statement <a
href="#part0006.html#page_11" class="calibre6">11</a></p>
<p><code class="calibre8">Range</code> <a href="#part0017.html#page_157"
class="calibre6">157</a>, <a href="#part0017.html#page_160"
class="calibre6">160</a></p>
<p>raw string literal <a href="#part0014.html#page_116"
class="calibre6">116</a></p>
<p>reader-writer lock <a href="#part0020.html#page_200"
class="calibre6">200</a></p>
<p>recovery, error <a href="#part0008.html#page_38"
class="calibre6">38</a></p>
<p><code class="calibre8">reduce()</code> <a
href="#part0019.html#page_189" class="calibre6">189</a></p>
<p>reference <a href="#part0006.html#page_17"
class="calibre6">17</a></p>
<p><code class="calibre8">&amp;&amp;</code>, rvalue <a
href="#part0010.html#page_71" class="calibre6">71</a></p>
<p>rvalue <a href="#part0010.html#page_72" class="calibre6">72</a></p>
<p>to <code class="calibre8">&amp;</code> <a
href="#part0006.html#page_12" class="calibre6">12</a></p>
<p><code class="calibre8">regex</code></p>
<p><code class="calibre8">]</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">[</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">^</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">?</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">.</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">+</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">*</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">)</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">(</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">$</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">{</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">}</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">|</code> <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p><code class="calibre8">alnum</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">alpha</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">blank</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">cntrl</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">\D</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">\d</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">d</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">digit</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">graph</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">\l</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">\L</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">lower</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">print</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">punct</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p>regular expression <a href="#part0014.html#page_116"
class="calibre6">116</a></p>
<p>repetition <a href="#part0014.html#page_118"
class="calibre6">118</a></p>
<p><code class="calibre8">\s</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">\S</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">s</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">space</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">\U</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">\u</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">upper</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">w</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">\w</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">\W</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">xdigit</code> <a
href="#part0014.html#page_119" class="calibre6">119</a></p>
<p><code class="calibre8">&lt;regex&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a>, <a
href="#part0014.html#page_116" class="calibre6">116</a></p>
<p>regular expression <a href="#part0014.html#page_116"
class="calibre6">116</a></p>
<p><code class="calibre8">regex_iterator</code> <a
href="#part0014.html#page_121" class="calibre6">121</a></p>
<p><code class="calibre8">regex_search</code> <a
href="#part0014.html#page_116" class="calibre6">116</a></p>
<p>regular</p>
<p>expression notation <a href="#part0014.html#page_117"
class="calibre6">117</a></p>
<p>expression <code class="calibre8">&lt;regex&gt;</code> <a
href="#part0014.html#page_116" class="calibre6">116</a></p>
<p>expression <code class="calibre8">regex</code> <a
href="#part0014.html#page_116" class="calibre6">116</a></p>
<p><code class="calibre8">Regular</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p><code class="calibre8">reinterpret_cast</code> <a
href="#part0009.html#page_53" class="calibre6">53</a></p>
<p><code class="calibre8">Relation</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p>remainder operator <code class="calibre8">%</code> <a
href="#part0006.html#page_6" class="calibre6">6</a></p>
<p>removed</p>
<p>exception specification <a href="#part0021.html#page_218"
class="calibre6">218</a></p>
<p><code class="calibre8">export</code> <a
href="#part0021.html#page_218" class="calibre6">218</a></p>
<p>repetition, <code class="calibre8">regex</code> <a
href="#part0014.html#page_118" class="calibre6">118</a></p>
<p><code class="calibre8">replace()</code> <a
href="#part0017.html#page_156" class="calibre6">156</a></p>
<p><code class="calibre8">string</code> <a
href="#part0014.html#page_112" class="calibre6">112</a></p>
<p><code class="calibre8">replace_if()</code> <a
href="#part0017.html#page_156" class="calibre6">156</a></p>
<p><span id="part0022.html#page_237"
class="pagebreak"></span>requirement, <code
class="calibre8">template</code> <a href="#part0012.html#page_94"
class="calibre6">94</a></p>
<p>requirements, element <a href="#part0016.html#page_140"
class="calibre6">140</a></p>
<p><code class="calibre8">reserve()</code> <a
href="#part0016.html#page_139" class="calibre6">139</a>, <a
href="#part0016.html#page_147" class="calibre6">147</a></p>
<p><code class="calibre8">resize()</code> <a
href="#part0016.html#page_147" class="calibre6">147</a></p>
<p>resource</p>
<p>acquisition RAII <a href="#part0018.html#page_164"
class="calibre6">164</a></p>
<p>handle <a href="#part0010.html#page_69" class="calibre6">69</a>, <a
href="#part0018.html#page_165" class="calibre6">165</a></p>
<p>leak <a href="#part0009.html#page_62" class="calibre6">62</a>, <a
href="#part0010.html#page_72" class="calibre6">72</a>, <a
href="#part0018.html#page_164" class="calibre6">164</a></p>
<p>management <a href="#part0010.html#page_72" class="calibre6">72</a>,
<a href="#part0018.html#page_164" class="calibre6">164</a></p>
<p>management, RAII and <a href="#part0008.html#page_36"
class="calibre6">36</a></p>
<p>non-memory <a href="#part0010.html#page_73"
class="calibre6">73</a></p>
<p>retention <a href="#part0010.html#page_73"
class="calibre6">73</a></p>
<p>safety <a href="#part0010.html#page_72" class="calibre6">72</a></p>
<p>rethrow <a href="#part0008.html#page_38" class="calibre6">38</a></p>
<p>return</p>
<p>function value <a href="#part0010.html#page_66"
class="calibre6">66</a></p>
<p>type, suffix <a href="#part0021.html#page_215"
class="calibre6">215</a></p>
<p>value, function <a href="#part0008.html#page_41"
class="calibre6">41</a></p>
<p><code class="calibre8">return</code></p>
<p>container <a href="#part0017.html#page_151"
class="calibre6">151</a></p>
<p>type, <code class="calibre8">void</code> <a
href="#part0006.html#page_3" class="calibre6">3</a></p>
<p>returning results from task <a href="#part0020.html#page_198"
class="calibre6">198</a></p>
<p><code class="calibre8">return</code>-type deduction <a
href="#part0008.html#page_44" class="calibre6">44</a></p>
<p>return-values, multiple <a href="#part0008.html#page_44"
class="calibre6">44</a></p>
<p><code class="calibre8">riemanzeta()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>rule</p>
<p>Max Munch <a href="#part0014.html#page_118"
class="calibre6">118</a></p>
<p>of zero <a href="#part0010.html#page_67" class="calibre6">67</a></p>
<p>run-time</p>
<p>check <a href="#part0008.html#page_40" class="calibre6">40</a></p>
<p>error <a href="#part0008.html#page_35" class="calibre6">35</a></p>
<p>rvalue</p>
<p>reference <a href="#part0010.html#page_72"
class="calibre6">72</a></p>
<p>reference <code class="calibre8">&amp;&amp;</code> <a
href="#part0010.html#page_71" class="calibre6">71</a></p>
<h3 class="h3i">S</h3>
<p><code class="calibre8">s</code> literal suffix <a
href="#part0014.html#page_113" class="calibre6">113</a></p>
<p><code class="calibre8">\s</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_119" class="calibre6">119</a></p>
<p><code class="calibre8">s</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_119" class="calibre6">119</a></p>
<p><code class="calibre8">\S</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_119" class="calibre6">119</a></p>
<p>safety, resource <a href="#part0010.html#page_72"
class="calibre6">72</a></p>
<p><code class="calibre8">Same</code> <a href="#part0017.html#page_158"
class="calibre6">158</a></p>
<p>scaling</p>
<p>operator <code class="calibre8">/=</code> <a
href="#part0006.html#page_7" class="calibre6">7</a></p>
<p>operator <code class="calibre8">*=</code> <a
href="#part0006.html#page_7" class="calibre6">7</a></p>
<p>scope</p>
<p>and lifetime <a href="#part0006.html#page_9"
class="calibre6">9</a></p>
<p>class <a href="#part0006.html#page_9" class="calibre6">9</a></p>
<p>local <a href="#part0006.html#page_9" class="calibre6">9</a></p>
<p>namespace <a href="#part0006.html#page_9" class="calibre6">9</a></p>
<p><code class="calibre8">scoped_lock</code> <a
href="#part0018.html#page_164" class="calibre6">164</a></p>
<p>and RAII <a href="#part0020.html#page_199"
class="calibre6">199</a>–<a href="#part0020.html#page_200"
class="calibre6">200</a></p>
<p><code class="calibre8">unique_lock</code> and <a
href="#part0020.html#page_201" class="calibre6">201</a></p>
<p><code class="calibre8">scoped_lock()</code> <a
href="#part0020.html#page_199" class="calibre6">199</a></p>
<p>search, binary <a href="#part0017.html#page_156"
class="calibre6">156</a></p>
<p><code class="calibre8">second</code>, <code
class="calibre8">pair</code> member <a href="#part0018.html#page_173"
class="calibre6">173</a></p>
<p><code class="calibre8">Semiregular</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p><code class="calibre8">Sentinel</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p>separate compilation <a href="#part0008.html#page_30"
class="calibre6">30</a></p>
<p>sequence <a href="#part0017.html#page_150"
class="calibre6">150</a></p>
<p>half-open <a href="#part0017.html#page_156"
class="calibre6">156</a></p>
<p><code class="calibre8">set</code> <a href="#part0016.html#page_146"
class="calibre6">146</a></p>
<p><code class="calibre8">&lt;set&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a></p>
<p><code class="calibre8">set_exception()</code>, <code
class="calibre8">promise</code> member <a href="#part0020.html#page_202"
class="calibre6">202</a></p>
<p><code class="calibre8">set_value()</code>, <code
class="calibre8">promise</code> member <a href="#part0020.html#page_202"
class="calibre6">202</a></p>
<p><code class="calibre8">shared_lock</code> <a
href="#part0020.html#page_200" class="calibre6">200</a></p>
<p><code class="calibre8">shared_mutex</code> <a
href="#part0020.html#page_200" class="calibre6">200</a></p>
<p><code class="calibre8">shared_ptr</code> <a
href="#part0018.html#page_164" class="calibre6">164</a></p>
<p>sharing data task <a href="#part0020.html#page_199"
class="calibre6">199</a></p>
<p>short-string optimization <a href="#part0014.html#page_113"
class="calibre6">113</a></p>
<p><code class="calibre8">SignedIntegral</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p>SIMD <a href="#part0017.html#page_161" class="calibre6">161</a></p>
<p>Simula <a href="#part0021.html#page_207" class="calibre6">207</a></p>
<p><code class="calibre8">sin()</code> <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p>singly-linked list, <code class="calibre8">forward_list</code> <a
href="#part0016.html#page_143" class="calibre6">143</a></p>
<p><code class="calibre8">sinh()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>size of type <a href="#part0006.html#page_6"
class="calibre6">6</a></p>
<p><code class="calibre8">size()</code> <a href="#part0010.html#page_75"
class="calibre6">75</a>, <a href="#part0016.html#page_147"
class="calibre6">147</a></p>
<p><code class="calibre8">array</code> <a href="#part0018.html#page_171"
class="calibre6">171</a></p>
<p><code class="calibre8">SizedRange</code> <a
href="#part0017.html#page_160" class="calibre6">160</a></p>
<p><code class="calibre8">SizedSentinel</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p><code class="calibre8">sizeof</code> <a href="#part0006.html#page_6"
class="calibre6">6</a></p>
<p><code class="calibre8">sizeof()</code> <a
href="#part0018.html#page_181" class="calibre6">181</a></p>
<p><code class="calibre8">size_t</code> <a href="#part0011.html#page_90"
class="calibre6">90</a></p>
<p>smart pointer <a href="#part0018.html#page_164"
class="calibre6">164</a></p>
<p><code class="calibre8">smatch</code> <a
href="#part0014.html#page_116" class="calibre6">116</a></p>
<p><code class="calibre8">sort()</code> <a
href="#part0017.html#page_149" class="calibre6">149</a>, <a
href="#part0017.html#page_156" class="calibre6">156</a></p>
<p>container <a href="#part0018.html#page_181"
class="calibre6">181</a></p>
<p><code class="calibre8">Sortable</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p><code class="calibre8">space</code>, <code
class="calibre8">regex</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p><code class="calibre8">span</code></p>
<p><code class="calibre8">gsl</code> <a href="#part0018.html#page_168"
class="calibre6">168</a></p>
<p><code class="calibre8">string_view</code> and <a
href="#part0018.html#page_168" class="calibre6">168</a></p>
<p>special mathematical functions <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p>specialized container <a href="#part0018.html#page_170"
class="calibre6">170</a></p>
<p><code class="calibre8">sphbessel()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p><code class="calibre8">sqrt()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p><code class="calibre8">&lt;sstream&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a></p>
<p>standard</p>
<p>ISO C++ <a href="#part0006.html#page_2" class="calibre6">2</a></p>
<p>library <a href="#part0013.html#page_107"
class="calibre6">107</a></p>
<p>library algorithm <a href="#part0017.html#page_156"
class="calibre6">156</a></p>
<p>library, C++ <a href="#part0006.html#page_2"
class="calibre6">2</a></p>
<p>library, C with Classes <a href="#part0021.html#page_211"
class="calibre6">211</a></p>
<p>library, C++98 <a href="#part0021.html#page_211"
class="calibre6">211</a></p>
<p>library container <a href="#part0016.html#page_146"
class="calibre6">146</a></p>
<p>library facilities <a href="#part0013.html#page_108"
class="calibre6">108</a></p>
<p>library header <a href="#part0013.html#page_109"
class="calibre6">109</a></p>
<p>library <code class="calibre8">std</code> <a
href="#part0013.html#page_109" class="calibre6">109</a></p>
<p>mathematical functions <a href="#part0019.html#page_188"
class="calibre6">188</a></p>
<p>standardization, C++ <a href="#part0021.html#page_212"
class="calibre6">212</a></p>
<p><span id="part0022.html#page_238" class="pagebreak"></span>state,
moved-from <a href="#part0018.html#page_168"
class="calibre6">168</a></p>
<p>statement</p>
<p><code class="calibre8">for</code> <a href="#part0006.html#page_11"
class="calibre6">11</a></p>
<p><code class="calibre8">if</code> <a href="#part0006.html#page_14"
class="calibre6">14</a></p>
<p>range <code class="calibre8">for</code> <a
href="#part0006.html#page_11" class="calibre6">11</a></p>
<p><code class="calibre8">switch</code> <a href="#part0006.html#page_14"
class="calibre6">14</a></p>
<p><code class="calibre8">while</code> <a href="#part0006.html#page_14"
class="calibre6">14</a></p>
<p><code class="calibre8">static_assert</code> <a
href="#part0019.html#page_193" class="calibre6">193</a></p>
<p>assertion <a href="#part0008.html#page_40"
class="calibre6">40</a></p>
<p><code class="calibre8">static_cast</code> <a
href="#part0009.html#page_53" class="calibre6">53</a></p>
<p><code class="calibre8">std</code></p>
<p><code class="calibre8">namespace</code> <a
href="#part0006.html#page_3" class="calibre6">3</a>, <a
href="#part0008.html#page_35" class="calibre6">35</a>, <a
href="#part0013.html#page_109" class="calibre6">109</a></p>
<p>standard library <a href="#part0013.html#page_109"
class="calibre6">109</a></p>
<p><code class="calibre8">&lt;stdexcept&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a></p>
<p>STL <a href="#part0021.html#page_211" class="calibre6">211</a></p>
<p>store</p>
<p>dynamic <a href="#part0009.html#page_51" class="calibre6">51</a></p>
<p>free <a href="#part0009.html#page_51" class="calibre6">51</a></p>
<p><code class="calibre8">StrictTotallyOrdered</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p><code class="calibre8">StrictWeakOrder</code> <a
href="#part0017.html#page_159" class="calibre6">159</a></p>
<p>string</p>
<p>C-style <a href="#part0006.html#page_13" class="calibre6">13</a></p>
<p>literal <code class="calibre8">"</code> <a
href="#part0006.html#page_3" class="calibre6">3</a></p>
<p>literal, raw <a href="#part0014.html#page_116"
class="calibre6">116</a></p>
<p>literal, type of <a href="#part0014.html#page_113"
class="calibre6">113</a></p>
<p>Unicode <a href="#part0014.html#page_114"
class="calibre6">114</a></p>
<p><code class="calibre8">string</code> <a
href="#part0014.html#page_111" class="calibre6">111</a></p>
<p><code class="calibre8">[]</code> <a href="#part0014.html#page_112"
class="calibre6">112</a></p>
<p><code class="calibre8">==</code> <a href="#part0014.html#page_112"
class="calibre6">112</a></p>
<p>append <code class="calibre8">+=</code> <a
href="#part0014.html#page_112" class="calibre6">112</a></p>
<p>assignment <code class="calibre8">=</code> <a
href="#part0014.html#page_112" class="calibre6">112</a></p>
<p>concatenation <code class="calibre8">+</code> <a
href="#part0014.html#page_111" class="calibre6">111</a></p>
<p>implementation <a href="#part0014.html#page_113"
class="calibre6">113</a></p>
<p><code class="calibre8">replace()</code> <a
href="#part0014.html#page_112" class="calibre6">112</a></p>
<p><code class="calibre8">substr()</code> <a
href="#part0014.html#page_112" class="calibre6">112</a></p>
<p><code class="calibre8">&lt;string&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a>, <a
href="#part0014.html#page_111" class="calibre6">111</a></p>
<p><code class="calibre8">string_literals</code>, <code
class="calibre8">literals</code> <a href="#part0014.html#page_113"
class="calibre6">113</a></p>
<p><code class="calibre8">string_span</code> <a
href="#part0018.html#page_170" class="calibre6">170</a></p>
<p><code class="calibre8">string_view</code> <a
href="#part0014.html#page_114" class="calibre6">114</a></p>
<p>and <code class="calibre8">span</code> <a
href="#part0018.html#page_168" class="calibre6">168</a></p>
<p><code class="calibre8">string_view_literals</code>, <code
class="calibre8">literals</code> <a href="#part0014.html#page_115"
class="calibre6">115</a></p>
<p>structured</p>
<p>binding <a href="#part0008.html#page_45" class="calibre6">45</a></p>
<p>binding, <code class="calibre8">pair</code> and <a
href="#part0018.html#page_174" class="calibre6">174</a></p>
<p>binding, <code class="calibre8">tuple</code> and <a
href="#part0018.html#page_174" class="calibre6">174</a></p>
<p>subclass, superclass and <a href="#part0009.html#page_55"
class="calibre6">55</a></p>
<p><code class="calibre8">[]</code>subscripting <a
href="#part0016.html#page_147" class="calibre6">147</a></p>
<p><code class="calibre8">substr()</code>, <code
class="calibre8">string</code> <a href="#part0014.html#page_112"
class="calibre6">112</a></p>
<p>suffix <a href="#part0010.html#page_75" class="calibre6">75</a></p>
<p>return type <a href="#part0021.html#page_215"
class="calibre6">215</a></p>
<p><code class="calibre8">s</code> literal <a
href="#part0014.html#page_113" class="calibre6">113</a></p>
<p><code class="calibre8">sv</code> literal <a
href="#part0014.html#page_115" class="calibre6">115</a></p>
<p>superclass and subclass <a href="#part0009.html#page_55"
class="calibre6">55</a></p>
<p>suport, <code class="calibre8">module</code> <a
href="#part0008.html#page_32" class="calibre6">32</a></p>
<p>support, <code class="calibre8">concept</code> <a
href="#part0012.html#page_94" class="calibre6">94</a></p>
<p><code class="calibre8">sv</code> literal suffix <a
href="#part0014.html#page_115" class="calibre6">115</a></p>
<p><code class="calibre8">swap()</code> <a href="#part0010.html#page_76"
class="calibre6">76</a></p>
<p><code class="calibre8">Swappable</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p><code class="calibre8">SwappableWith</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p><code class="calibre8">switch</code> statement <a
href="#part0006.html#page_14" class="calibre6">14</a></p>
<p><code class="calibre8">synchronized_pool_resource</code> <a
href="#part0018.html#page_178" class="calibre6">178</a></p>
<h3 class="h3i">T</h3>
<p>table, hash <a href="#part0016.html#page_144"
class="calibre6">144</a></p>
<p>tag dispatch <a href="#part0018.html#page_181"
class="calibre6">181</a></p>
<p><code class="calibre8">tanh()</code> <a
href="#part0019.html#page_188" class="calibre6">188</a></p>
<p>task</p>
<p>and <code class="calibre8">thread</code> <a
href="#part0020.html#page_196" class="calibre6">196</a></p>
<p>communication <a href="#part0020.html#page_202"
class="calibre6">202</a></p>
<p>passing data to <a href="#part0020.html#page_197"
class="calibre6">197</a></p>
<p>returning results from <a href="#part0020.html#page_198"
class="calibre6">198</a></p>
<p>sharing data <a href="#part0020.html#page_199"
class="calibre6">199</a></p>
<p>TC++PL <a href="#part0021.html#page_208" class="calibre6">208</a></p>
<p>template</p>
<p>argument, constrained <a href="#part0011.html#page_82"
class="calibre6">82</a></p>
<p>argument, default <a href="#part0012.html#page_98"
class="calibre6">98</a></p>
<p>arguments, <code class="calibre8">&gt;&gt;</code> <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<p>compilation model <a href="#part0012.html#page_104"
class="calibre6">104</a></p>
<p>constrained <a href="#part0011.html#page_82"
class="calibre6">82</a></p>
<p>variadic <a href="#part0012.html#page_100"
class="calibre6">100</a></p>
<p><code class="calibre8">template</code> <a
href="#part0011.html#page_79" class="calibre6">79</a></p>
<p>class <a href="#part0011.html#page_79" class="calibre6">79</a></p>
<p>debugging <a href="#part0012.html#page_100"
class="calibre6">100</a></p>
<p><code class="calibre8">extern</code> <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<p>function <a href="#part0011.html#page_84" class="calibre6">84</a></p>
<p>purpose <a href="#part0012.html#page_93" class="calibre6">93</a></p>
<p>requirement <a href="#part0012.html#page_94"
class="calibre6">94</a></p>
<p><code class="calibre8">this</code> <a href="#part0010.html#page_70"
class="calibre6">70</a></p>
<p><code class="calibre8">thread</code></p>
<p><code class="calibre8">join()</code> <a
href="#part0020.html#page_196" class="calibre6">196</a></p>
<p><code class="calibre8">packaged_task</code> <a
href="#part0020.html#page_203" class="calibre6">203</a></p>
<p>task and <a href="#part0020.html#page_196"
class="calibre6">196</a></p>
<p><code class="calibre8">&lt;thread&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a>, <a
href="#part0020.html#page_196" class="calibre6">196</a></p>
<p><code class="calibre8">thread_local</code> <a
href="#part0021.html#page_216" class="calibre6">216</a></p>
<p>time <a href="#part0018.html#page_179" class="calibre6">179</a></p>
<p>timeline, C++ <a href="#part0021.html#page_208"
class="calibre6">208</a></p>
<p><code class="calibre8">time_point</code> <a
href="#part0018.html#page_179" class="calibre6">179</a></p>
<p>timing, <code class="calibre8">clock</code> <a
href="#part0020.html#page_200" class="calibre6">200</a></p>
<p>to hardware, mapping <a href="#part0006.html#page_16"
class="calibre6">16</a></p>
<p><code class="calibre8">transform_reduce()</code> <a
href="#part0019.html#page_189" class="calibre6">189</a></p>
<p>translation unit <a href="#part0008.html#page_32"
class="calibre6">32</a></p>
<p><code class="calibre8">try</code></p>
<p>block <a href="#part0008.html#page_36" class="calibre6">36</a></p>
<p>block as function body <a href="#part0016.html#page_141"
class="calibre6">141</a></p>
<p><code class="calibre8">try</code>-block, RAII and <a
href="#part0008.html#page_40" class="calibre6">40</a></p>
<p><code class="calibre8">try</code>-statement, RAII and <a
href="#part0008.html#page_36" class="calibre6">36</a></p>
<p><code class="calibre8">tuple</code> <a href="#part0018.html#page_174"
class="calibre6">174</a></p>
<p>and structured binding <a href="#part0018.html#page_174"
class="calibre6">174</a></p>
<p>type <a href="#part0006.html#page_5" class="calibre6">5</a></p>
<p>abstract <a href="#part0009.html#page_54" class="calibre6">54</a></p>
<p>argument <a href="#part0011.html#page_82" class="calibre6">82</a></p>
<p><span id="part0022.html#page_239" class="pagebreak"></span>concrete
<a href="#part0009.html#page_48" class="calibre6">48</a></p>
<p>conversion, explicit <a href="#part0009.html#page_53"
class="calibre6">53</a></p>
<p>function <a href="#part0018.html#page_181"
class="calibre6">181</a></p>
<p>fundamental <a href="#part0006.html#page_5"
class="calibre6">5</a></p>
<p><code class="calibre8">get&lt;&gt;()</code> by <a
href="#part0018.html#page_174" class="calibre6">174</a></p>
<p>move-only <a href="#part0018.html#page_167"
class="calibre6">167</a></p>
<p>of string literal <a href="#part0014.html#page_113"
class="calibre6">113</a></p>
<p>parameterized <a href="#part0011.html#page_79"
class="calibre6">79</a></p>
<p>polymorphic <a href="#part0009.html#page_54"
class="calibre6">54</a></p>
<p>predicate <a href="#part0018.html#page_183"
class="calibre6">183</a></p>
<p>size of <a href="#part0006.html#page_6" class="calibre6">6</a></p>
<p><code class="calibre8">typename</code> <a
href="#part0011.html#page_79" class="calibre6">79</a>, <a
href="#part0017.html#page_152" class="calibre6">152</a></p>
<p><code class="calibre8">&lt;type_traits&gt;</code> <a
href="#part0018.html#page_183" class="calibre6">183</a></p>
<p>typing, duck <a href="#part0012.html#page_104"
class="calibre6">104</a></p>
<h3 class="h3i">U</h3>
<p><code class="calibre8">\U</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_119" class="calibre6">119</a></p>
<p><code class="calibre8">\u</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_119" class="calibre6">119</a></p>
<p>udl <a href="#part0010.html#page_75" class="calibre6">75</a></p>
<p>Unicode string <a href="#part0014.html#page_114"
class="calibre6">114</a></p>
<p><code class="calibre8">uniform_int_distribution</code> <a
href="#part0019.html#page_191" class="calibre6">191</a></p>
<p>uninitialized <a href="#part0006.html#page_8"
class="calibre6">8</a></p>
<p><code class="calibre8">unique_copy()</code> <a
href="#part0017.html#page_149" class="calibre6">149</a>, <a
href="#part0017.html#page_156" class="calibre6">156</a></p>
<p><code class="calibre8">unique_lock</code> <a
href="#part0020.html#page_200" class="calibre6">200</a>–<a
href="#part0020.html#page_201" class="calibre6">201</a></p>
<p>and <code class="calibre8">scoped_lock</code> <a
href="#part0020.html#page_201" class="calibre6">201</a></p>
<p><code class="calibre8">unique_ptr</code> <a
href="#part0009.html#page_62" class="calibre6">62</a>, <a
href="#part0018.html#page_164" class="calibre6">164</a></p>
<p><code class="calibre8">unordered_map</code> <a
href="#part0016.html#page_144" class="calibre6">144</a>, <a
href="#part0016.html#page_146" class="calibre6">146</a></p>
<p><code class="calibre8">hash&lt;&gt;</code> <a
href="#part0010.html#page_76" class="calibre6">76</a></p>
<p><code class="calibre8">map</code> and <a
href="#part0016.html#page_146" class="calibre6">146</a></p>
<p><code class="calibre8">&lt;unordered_map&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a></p>
<p><code class="calibre8">unordered_multimap</code> <a
href="#part0016.html#page_146" class="calibre6">146</a></p>
<p><code class="calibre8">unordered_multiset</code> <a
href="#part0016.html#page_146" class="calibre6">146</a></p>
<p><code class="calibre8">unordered_set</code> <a
href="#part0016.html#page_146" class="calibre6">146</a></p>
<p><code class="calibre8">unsigned</code> <a
href="#part0006.html#page_5" class="calibre6">5</a></p>
<p><code class="calibre8">UnsignedIntegral</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p><code class="calibre8">upper</code>, <code
class="calibre8">regex</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<p>user-defined</p>
<p>literal <a href="#part0010.html#page_75" class="calibre6">75</a>, <a
href="#part0021.html#page_215" class="calibre6">215</a></p>
<p>operator <a href="#part0009.html#page_51" class="calibre6">51</a></p>
<p><code class="calibre8">using</code></p>
<p>alias <a href="#part0011.html#page_90" class="calibre6">90</a></p>
<p>-declaration <a href="#part0008.html#page_34"
class="calibre6">34</a></p>
<p>-directive <a href="#part0008.html#page_35"
class="calibre6">35</a></p>
<p>usual arithmetic conversions <a href="#part0006.html#page_7"
class="calibre6">7</a></p>
<p><code class="calibre8">&lt;utility&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a>, <a
href="#part0018.html#page_173" class="calibre6">173</a>–<a
href="#part0018.html#page_174" class="calibre6">174</a></p>
<h3 class="h3i">V</h3>
<p><code class="calibre8">valarray</code> <a
href="#part0019.html#page_192" class="calibre6">192</a></p>
<p><code class="calibre8">&lt;valarray&gt;</code> <a
href="#part0019.html#page_192" class="calibre6">192</a></p>
<p>value <a href="#part0006.html#page_5" class="calibre6">5</a></p>
<p>argument <a href="#part0011.html#page_82" class="calibre6">82</a></p>
<p>key and <a href="#part0016.html#page_144"
class="calibre6">144</a></p>
<p>mapped type <a href="#part0016.html#page_144"
class="calibre6">144</a></p>
<p>return, function <a href="#part0010.html#page_66"
class="calibre6">66</a></p>
<p><code class="calibre8">value_type</code> <a
href="#part0011.html#page_90" class="calibre6">90</a></p>
<p><code class="calibre8">valuetype</code> <a
href="#part0016.html#page_147" class="calibre6">147</a></p>
<p>variable <a href="#part0006.html#page_5" class="calibre6">5</a></p>
<p>variadic template <a href="#part0012.html#page_100"
class="calibre6">100</a></p>
<p><code class="calibre8">variant</code> <a
href="#part0018.html#page_175" class="calibre6">175</a></p>
<p><code class="calibre8">Vec</code></p>
<p>example <a href="#part0016.html#page_141"
class="calibre6">141</a></p>
<p>range checking <a href="#part0016.html#page_140"
class="calibre6">140</a></p>
<p>vector arithmetic <a href="#part0019.html#page_192"
class="calibre6">192</a></p>
<p><code class="calibre8">vector</code> <a
href="#part0016.html#page_138" class="calibre6">138</a>, <a
href="#part0016.html#page_146" class="calibre6">146</a></p>
<p><code class="calibre8">array</code> vs. <a
href="#part0018.html#page_171" class="calibre6">171</a></p>
<p><code class="calibre8">&lt;vector&gt;</code> <a
href="#part0013.html#page_109" class="calibre6">109</a></p>
<p><code class="calibre8">vector&lt;bool&gt;</code> <a
href="#part0018.html#page_170" class="calibre6">170</a></p>
<p>vectorized <a href="#part0017.html#page_161"
class="calibre6">161</a></p>
<p><code class="calibre8">View</code> <a href="#part0017.html#page_160"
class="calibre6">160</a></p>
<p><code class="calibre8">virtual</code> <a
href="#part0009.html#page_54" class="calibre6">54</a></p>
<p>destructor <a href="#part0009.html#page_59"
class="calibre6">59</a></p>
<p>function, implementation of <a href="#part0009.html#page_56"
class="calibre6">56</a></p>
<p>function table <code class="calibre8">vtbl</code> <a
href="#part0009.html#page_56" class="calibre6">56</a></p>
<p>pure <a href="#part0009.html#page_54" class="calibre6">54</a></p>
<p><code class="calibre8">void</code></p>
<p><code class="calibre8">*</code> <a href="#part0021.html#page_221"
class="calibre6">221</a></p>
<p><code class="calibre8">*</code> assignment, difference from C <a
href="#part0021.html#page_221" class="calibre6">221</a></p>
<p><code class="calibre8">return</code> type <a
href="#part0006.html#page_3" class="calibre6">3</a></p>
<p><code class="calibre8">vtbl</code>, <code
class="calibre8">virtual</code> function table <a
href="#part0009.html#page_56" class="calibre6">56</a></p>
<h3 class="h3i">W</h3>
<p><code class="calibre8">w</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_119" class="calibre6">119</a></p>
<p><code class="calibre8">\w</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_119" class="calibre6">119</a></p>
<p><code class="calibre8">\W</code>, <code class="calibre8">regex</code>
<a href="#part0014.html#page_119" class="calibre6">119</a></p>
<p><code class="calibre8">wait()</code>, <code
class="calibre8">condition_variable</code> <a
href="#part0020.html#page_201" class="calibre6">201</a></p>
<p><code class="calibre8">WeaklyEqualityComparable</code> <a
href="#part0017.html#page_158" class="calibre6">158</a></p>
<p>WG21 <a href="#part0021.html#page_208" class="calibre6">208</a></p>
<p><code class="calibre8">while</code> statement <a
href="#part0006.html#page_14" class="calibre6">14</a></p>
<h3 class="h3i">X</h3>
<p>X3J16 <a href="#part0021.html#page_212" class="calibre6">212</a></p>
<p><code class="calibre8">xdigit</code>, <code
class="calibre8">regex</code> <a href="#part0014.html#page_119"
class="calibre6">119</a></p>
<h3 class="h3i">Z</h3>
<p>zero, rule of <a href="#part0010.html#page_67"
class="calibre6">67</a></p>
</section>
<p><span id="part0023.html"></span></p>
<h2 class="h2za" id="part0023.html#credit"><span
id="part0023.html#page_240"
class="calibre2 pagebreak"></span>Credits</h2>
<p>Page ii: “I have made this letter longer than usual, because I lack
the time to make it short.” Pascal, B. (1904). The provincial letters of
Blaise Pascal, J.M. Dent.</p>
<p>Page x: “When you wish to instruct, be brief, Marcus Tullius Cicero -
Horace for English Readers, Being a Translation of the Poems of Quintus
Horatius Flaccus into English Prose, trans. E.C. Wickham (Oxford:
Clarendon Press, 1903).</p>
<p>Page 1: “The first thing we do, let’s kill all the language lawyers”,
paraphrasing William Shakesphere - Henry The Sixth, Part 2 Act 4, scene
2, 71-78.</p>
<p>Page 21: “Don’t Panic!”, Neil Gaiman, Don’t Panic: The Official
Hitchhiker’s Guide to the Galaxy Companion Pocket Books, 1988.</p>
<p>Page 29: “Don’t interrupt me while I’m interrupting”, Winston
Churchill (1966). “The Irrepressible Churchill: Stories, Sayings and
Impressions of Sir Winston Churchill”, World Publishing Company.</p>
<p>Page 49: “Those types are not ‘abstract’; they are as real as int and
float”, Doug McIlroy.</p>
<p>Page 67: “When someone says I want a programming language in which I
need only say what I wish done, give him a lollipop”, Alan Perlis
ACM-SIGPLAN ‘82, Epigrams in Programming.</p>
<p>Page 95: “Programming: you have to start with interesting
algorithms”, Alex Stepanov.</p>
<p>Page 109: “Why waste time learning when ignorance is instantaneous?”,
Watterson, B. (1992). Attack of the deranged mutant killer monster snow
goons: A Calvin and Hobbes collection. Kansas City: Andrews and
McMeel.</p>
<p>Page 113: “Prefer the standard to the offbeat”, Strunk, W., &amp;
White, E. B. (1959). The elements of style. N.Y: Macmillan.</p>
<p>Page 125: “What you see is all you get”, Kernighan, B. W., &amp;
Ritchie, D. M. (1988). The C programming language. Upper Saddle River
NJ: Prentice Hall.</p>
<p>Page 141: “It was new. It was singular. It was simple. It must
succeed!”, Horatio Nelson.</p>
<p>Page 153: “Do not multiply entities beyond necessity.” William
Occam.</p>
<p>Page 160: “a finite set of rules .... Input ... Output ...
Effectiveness”, Donald E. Knuth: The Art of Computer Programming.
Addison-Wesley, Reading, Massachusetts. 1968.</p>
<p>Page 167: “The time you enjoy wasting is not wasted time.” Bertrand
Russell.</p>
<p>Page 193: “The purpose of computing is insight, not numbers”,
Hamming, R. W. (1962). Numerical methods for scientists and
engineers.</p>
<p>Page 193: “... but for the student, numbers are often the best road
to insight.” A first course in numerical analysis, Anthony Ralston,
McGraw-Hill, 1965.</p>
<p>Page 201: “Keep it simple: as simple as possible, but no simpler”,
Albert Einstein.</p>
<p>Page 215: “Hurry Slowly (festina lente)”, Octavius, Caesar Augustus
quoted in Alison Jones, Stephanie Pickering, Megan Thomson (1997).
Chambers dictionary of quotations, Chambers.</p>
<p><span id="part0024.html"></span></p>
<section class="backmatter">
<div class="image">
<span id="part0024.html#page_244" class="pagebreak"></span><img
src="images/00035.jpeg" class="calibre1" alt="Image" />
</div>
</section>
<p><span id="part0025_split_000.html"></span></p>
<h2 class="calibre19" id="part0025_split_000.html#ch01_images">Code
Snippets</h2>
<p>Many titles include programming code or configuration examples. To
optimize the presentation of these elements, view the eBook in
single-column, landscape mode and adjust the font size to the smallest
setting. In addition to presenting code and configurations in the
reflowable text format, we have included images of the code that mimic
the presentation found in the print book; therefore, where the
reflowable format may compromise the presentation of the code listing,
you will see a “Click here to view code image” link. Click the link to
view the print-fidelity code image. To return to the previous page
viewed, click the Back button on your device or app.</p>
<div id="part0025_split_000.html#calibre_pb_1" class="calibre20">

</div>
<p><span id="part0025_split_001.html"></span></p>
<div id="part0025_split_001.html#calibre_pb_2" class="image-p">
<a href="#part0006.html#p0002_01" id="part0025_split_001.html#p0002_01a"
class="calibre6"><img src="images/00036.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_001.html#calibre_pb_3" class="calibre20">

</div>
<p><span id="part0025_split_002.html"></span></p>
<div id="part0025_split_002.html#calibre_pb_4" class="image-p">
<a href="#part0006.html#p0003_01" id="part0025_split_002.html#p0003_01a"
class="calibre6"><img src="images/00037.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_002.html#calibre_pb_5" class="calibre20">

</div>
<p><span id="part0025_split_003.html"></span></p>
<div id="part0025_split_003.html#calibre_pb_6" class="image-p">
<a href="#part0006.html#p0003_02" id="part0025_split_003.html#p0003_02a"
class="calibre6"><img src="images/00038.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_003.html#calibre_pb_7" class="calibre20">

</div>
<p><span id="part0025_split_004.html"></span></p>
<div id="part0025_split_004.html#calibre_pb_8" class="image-p">
<a href="#part0006.html#p0004_01" id="part0025_split_004.html#p0004_01a"
class="calibre6"><img src="images/00039.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_004.html#calibre_pb_9" class="calibre20">

</div>
<p><span id="part0025_split_005.html"></span></p>
<div id="part0025_split_005.html#calibre_pb_10" class="image-p">
<a href="#part0006.html#p0004_02" id="part0025_split_005.html#p0004_02a"
class="calibre6"><img src="images/00040.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_005.html#calibre_pb_11" class="calibre20">

</div>
<p><span id="part0025_split_006.html"></span></p>
<div id="part0025_split_006.html#calibre_pb_12" class="image-p">
<a href="#part0006.html#p0004_03" id="part0025_split_006.html#p0004_03a"
class="calibre6"><img src="images/00041.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_006.html#calibre_pb_13" class="calibre20">

</div>
<p><span id="part0025_split_007.html"></span></p>
<div id="part0025_split_007.html#calibre_pb_14" class="image-p">
<a href="#part0006.html#p0004_04" id="part0025_split_007.html#p0004_04a"
class="calibre6"><img src="images/00042.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_007.html#calibre_pb_15" class="calibre20">

</div>
<p><span id="part0025_split_008.html"></span></p>
<div id="part0025_split_008.html#calibre_pb_16" class="image-p">
<a href="#part0006.html#p0004_05" id="part0025_split_008.html#p0004_05a"
class="calibre6"><img src="images/00043.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_008.html#calibre_pb_17" class="calibre20">

</div>
<p><span id="part0025_split_009.html"></span></p>
<div id="part0025_split_009.html#calibre_pb_18" class="image-p">
<a href="#part0006.html#p0005_01" id="part0025_split_009.html#p0005_01a"
class="calibre6"><img src="images/00044.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_009.html#calibre_pb_19" class="calibre20">

</div>
<p><span id="part0025_split_010.html"></span></p>
<div id="part0025_split_010.html#calibre_pb_20" class="image-p">
<a href="#part0006.html#p0005_02" id="part0025_split_010.html#p0005_02a"
class="calibre6"><img src="images/00045.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_010.html#calibre_pb_21" class="calibre20">

</div>
<p><span id="part0025_split_011.html"></span></p>
<div id="part0025_split_011.html#calibre_pb_22" class="image-p">
<a href="#part0006.html#p0006_01" id="part0025_split_011.html#p0006_01a"
class="calibre6"><img src="images/00046.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_011.html#calibre_pb_23" class="calibre20">

</div>
<p><span id="part0025_split_012.html"></span></p>
<div id="part0025_split_012.html#calibre_pb_24" class="image-p">
<a href="#part0006.html#p0006_02" id="part0025_split_012.html#p0006_02a"
class="calibre6"><img src="images/00047.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_012.html#calibre_pb_25" class="calibre20">

</div>
<p><span id="part0025_split_013.html"></span></p>
<div id="part0025_split_013.html#calibre_pb_26" class="image-p">
<a href="#part0006.html#p0007_01" id="part0025_split_013.html#p0007_01a"
class="calibre6"><img src="images/00048.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_013.html#calibre_pb_27" class="calibre20">

</div>
<p><span id="part0025_split_014.html"></span></p>
<div id="part0025_split_014.html#calibre_pb_28" class="image-p">
<a href="#part0006.html#p0007_02" id="part0025_split_014.html#p0007_02a"
class="calibre6"><img src="images/00049.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_014.html#calibre_pb_29" class="calibre20">

</div>
<p><span id="part0025_split_015.html"></span></p>
<div id="part0025_split_015.html#calibre_pb_30" class="image-p">
<a href="#part0006.html#p0007_03" id="part0025_split_015.html#p0007_03a"
class="calibre6"><img src="images/00050.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_015.html#calibre_pb_31" class="calibre20">

</div>
<p><span id="part0025_split_016.html"></span></p>
<div id="part0025_split_016.html#calibre_pb_32" class="image-p">
<a href="#part0006.html#p0007_04" id="part0025_split_016.html#p0007_04a"
class="calibre6"><img src="images/00051.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_016.html#calibre_pb_33" class="calibre20">

</div>
<p><span id="part0025_split_017.html"></span></p>
<div id="part0025_split_017.html#calibre_pb_34" class="image-p">
<a href="#part0006.html#p0008_01" id="part0025_split_017.html#p0008_01a"
class="calibre6"><img src="images/00052.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_017.html#calibre_pb_35" class="calibre20">

</div>
<p><span id="part0025_split_018.html"></span></p>
<div id="part0025_split_018.html#calibre_pb_36" class="image-p">
<a href="#part0006.html#p0008_02" id="part0025_split_018.html#p0008_02a"
class="calibre6"><img src="images/00053.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_018.html#calibre_pb_37" class="calibre20">

</div>
<p><span id="part0025_split_019.html"></span></p>
<div id="part0025_split_019.html#calibre_pb_38" class="image-p">
<a href="#part0006.html#p0008_03" id="part0025_split_019.html#p0008_03a"
class="calibre6"><img src="images/00054.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_019.html#calibre_pb_39" class="calibre20">

</div>
<p><span id="part0025_split_020.html"></span></p>
<div id="part0025_split_020.html#calibre_pb_40" class="image-p">
<a href="#part0006.html#p0009_01" id="part0025_split_020.html#p0009_01a"
class="calibre6"><img src="images/00055.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_020.html#calibre_pb_41" class="calibre20">

</div>
<p><span id="part0025_split_021.html"></span></p>
<div id="part0025_split_021.html#calibre_pb_42" class="image-p">
<a href="#part0006.html#p0010_01" id="part0025_split_021.html#p0010_01a"
class="calibre6"><img src="images/00056.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_021.html#calibre_pb_43" class="calibre20">

</div>
<p><span id="part0025_split_022.html"></span></p>
<div id="part0025_split_022.html#calibre_pb_44" class="image-p">
<a href="#part0006.html#p0010_02" id="part0025_split_022.html#p0010_02a"
class="calibre6"><img src="images/00057.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_022.html#calibre_pb_45" class="calibre20">

</div>
<p><span id="part0025_split_023.html"></span></p>
<div id="part0025_split_023.html#calibre_pb_46" class="image-p">
<a href="#part0006.html#p0010_03" id="part0025_split_023.html#p0010_03a"
class="calibre6"><img src="images/00058.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_023.html#calibre_pb_47" class="calibre20">

</div>
<p><span id="part0025_split_024.html"></span></p>
<div id="part0025_split_024.html#calibre_pb_48" class="image-p">
<a href="#part0006.html#p0011_01" id="part0025_split_024.html#p0011_01a"
class="calibre6"><img src="images/00059.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_024.html#calibre_pb_49" class="calibre20">

</div>
<p><span id="part0025_split_025.html"></span></p>
<div id="part0025_split_025.html#calibre_pb_50" class="image-p">
<a href="#part0006.html#p0011_02" id="part0025_split_025.html#p0011_02a"
class="calibre6"><img src="images/00060.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_025.html#calibre_pb_51" class="calibre20">

</div>
<p><span id="part0025_split_026.html"></span></p>
<div id="part0025_split_026.html#calibre_pb_52" class="image-p">
<a href="#part0006.html#p0011_03" id="part0025_split_026.html#p0011_03a"
class="calibre6"><img src="images/00061.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_026.html#calibre_pb_53" class="calibre20">

</div>
<p><span id="part0025_split_027.html"></span></p>
<div id="part0025_split_027.html#calibre_pb_54" class="image-p">
<a href="#part0006.html#p0011_04" id="part0025_split_027.html#p0011_04a"
class="calibre6"><img src="images/00062.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_027.html#calibre_pb_55" class="calibre20">

</div>
<p><span id="part0025_split_028.html"></span></p>
<div id="part0025_split_028.html#calibre_pb_56" class="image-p">
<a href="#part0006.html#p0012_01" id="part0025_split_028.html#p0012_01a"
class="calibre6"><img src="images/00063.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_028.html#calibre_pb_57" class="calibre20">

</div>
<p><span id="part0025_split_029.html"></span></p>
<div id="part0025_split_029.html#calibre_pb_58" class="image-p">
<a href="#part0006.html#p0012_02" id="part0025_split_029.html#p0012_02a"
class="calibre6"><img src="images/00064.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_029.html#calibre_pb_59" class="calibre20">

</div>
<p><span id="part0025_split_030.html"></span></p>
<div id="part0025_split_030.html#calibre_pb_60" class="image-p">
<a href="#part0006.html#p0012_03" id="part0025_split_030.html#p0012_03a"
class="calibre6"><img src="images/00065.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_030.html#calibre_pb_61" class="calibre20">

</div>
<p><span id="part0025_split_031.html"></span></p>
<div id="part0025_split_031.html#calibre_pb_62" class="image-p">
<a href="#part0006.html#p0012_04" id="part0025_split_031.html#p0012_04a"
class="calibre6"><img src="images/00066.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_031.html#calibre_pb_63" class="calibre20">

</div>
<p><span id="part0025_split_032.html"></span></p>
<div id="part0025_split_032.html#calibre_pb_64" class="image-p">
<a href="#part0006.html#p0012_05" id="part0025_split_032.html#p0012_05a"
class="calibre6"><img src="images/00067.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_032.html#calibre_pb_65" class="calibre20">

</div>
<p><span id="part0025_split_033.html"></span></p>
<div id="part0025_split_033.html#calibre_pb_66" class="image-p">
<a href="#part0006.html#p0013_01" id="part0025_split_033.html#p0013_01a"
class="calibre6"><img src="images/00068.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_033.html#calibre_pb_67" class="calibre20">

</div>
<p><span id="part0025_split_034.html"></span></p>
<div id="part0025_split_034.html#calibre_pb_68" class="image-p">
<a href="#part0006.html#p0013_02" id="part0025_split_034.html#p0013_02a"
class="calibre6"><img src="images/00069.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_034.html#calibre_pb_69" class="calibre20">

</div>
<p><span id="part0025_split_035.html"></span></p>
<div id="part0025_split_035.html#calibre_pb_70" class="image-p">
<a href="#part0006.html#p0013_03" id="part0025_split_035.html#p0013_03a"
class="calibre6"><img src="images/00070.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_035.html#calibre_pb_71" class="calibre20">

</div>
<p><span id="part0025_split_036.html"></span></p>
<div id="part0025_split_036.html#calibre_pb_72" class="image-p">
<a href="#part0006.html#p0014_01" id="part0025_split_036.html#p0014_01a"
class="calibre6"><img src="images/00071.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_036.html#calibre_pb_73" class="calibre20">

</div>
<p><span id="part0025_split_037.html"></span></p>
<div id="part0025_split_037.html#calibre_pb_74" class="image-p">
<a href="#part0006.html#p0014_02" id="part0025_split_037.html#p0014_02a"
class="calibre6"><img src="images/00072.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_037.html#calibre_pb_75" class="calibre20">

</div>
<p><span id="part0025_split_038.html"></span></p>
<div id="part0025_split_038.html#calibre_pb_76" class="image-p">
<a href="#part0006.html#p0015_01" id="part0025_split_038.html#p0015_01a"
class="calibre6"><img src="images/00073.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_038.html#calibre_pb_77" class="calibre20">

</div>
<p><span id="part0025_split_039.html"></span></p>
<div id="part0025_split_039.html#calibre_pb_78" class="image-p">
<a href="#part0006.html#p0015_02" id="part0025_split_039.html#p0015_02a"
class="calibre6"><img src="images/00074.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_039.html#calibre_pb_79" class="calibre20">

</div>
<p><span id="part0025_split_040.html"></span></p>
<div id="part0025_split_040.html#calibre_pb_80" class="image-p">
<a href="#part0006.html#p0016_01" id="part0025_split_040.html#p0016_01a"
class="calibre6"><img src="images/00075.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_040.html#calibre_pb_81" class="calibre20">

</div>
<p><span id="part0025_split_041.html"></span></p>
<div id="part0025_split_041.html#calibre_pb_82" class="image-p">
<a href="#part0006.html#p0016_02" id="part0025_split_041.html#p0016_02a"
class="calibre6"><img src="images/00076.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_041.html#calibre_pb_83" class="calibre20">

</div>
<p><span id="part0025_split_042.html"></span></p>
<div id="part0025_split_042.html#calibre_pb_84" class="image-p">
<a href="#part0006.html#p0017_01" id="part0025_split_042.html#p0017_01a"
class="calibre6"><img src="images/00077.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_042.html#calibre_pb_85" class="calibre20">

</div>
<p><span id="part0025_split_043.html"></span></p>
<div id="part0025_split_043.html#calibre_pb_86" class="image-p">
<a href="#part0006.html#p0017_02" id="part0025_split_043.html#p0017_02a"
class="calibre6"><img src="images/00078.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_043.html#calibre_pb_87" class="calibre20">

</div>
<p><span id="part0025_split_044.html"></span></p>
<div id="part0025_split_044.html#calibre_pb_88" class="image-p">
<a href="#part0006.html#p0018_01" id="part0025_split_044.html#p0018_01a"
class="calibre6"><img src="images/00079.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0025_split_044.html#calibre_pb_89" class="calibre20">

</div>
<p><span id="part0025_split_045.html"></span></p>
<div id="part0025_split_045.html#calibre_pb_90" class="image-p">
<a href="#part0006.html#p0018_02" id="part0025_split_045.html#p0018_02a"
class="calibre6"><img src="images/00080.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0026_split_000.html"></span></p>
<div id="part0026_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0007.html#p0022_01" id="part0026_split_000.html#p0022_01a"
class="calibre6"><img src="images/00081.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0026_split_001.html"></span></p>
<div id="part0026_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0007.html#p0022_02" id="part0026_split_001.html#p0022_02a"
class="calibre6"><img src="images/00082.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0026_split_002.html"></span></p>
<div id="part0026_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0007.html#p0022_03" id="part0026_split_002.html#p0022_03a"
class="calibre6"><img src="images/00083.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0026_split_003.html"></span></p>
<div id="part0026_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0007.html#p0023_01" id="part0026_split_003.html#p0023_01a"
class="calibre6"><img src="images/00084.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_003.html#calibre_pb_8" class="calibre20">

</div>
<p><span id="part0026_split_004.html"></span></p>
<div id="part0026_split_004.html#calibre_pb_9" class="image-p">
<a href="#part0007.html#p0023_02" id="part0026_split_004.html#p0023_02a"
class="calibre6"><img src="images/00085.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_004.html#calibre_pb_10" class="calibre20">

</div>
<p><span id="part0026_split_005.html"></span></p>
<div id="part0026_split_005.html#calibre_pb_11" class="image-p">
<a href="#part0007.html#p0024_01" id="part0026_split_005.html#p0024_01a"
class="calibre6"><img src="images/00086.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_005.html#calibre_pb_12" class="calibre20">

</div>
<p><span id="part0026_split_006.html"></span></p>
<div id="part0026_split_006.html#calibre_pb_13" class="image-p">
<a href="#part0007.html#p0024_02" id="part0026_split_006.html#p0024_02a"
class="calibre6"><img src="images/00087.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_006.html#calibre_pb_14" class="calibre20">

</div>
<p><span id="part0026_split_007.html"></span></p>
<div id="part0026_split_007.html#calibre_pb_15" class="image-p">
<a href="#part0007.html#p0025_01" id="part0026_split_007.html#p0025_01a"
class="calibre6"><img src="images/00088.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_007.html#calibre_pb_16" class="calibre20">

</div>
<p><span id="part0026_split_008.html"></span></p>
<div id="part0026_split_008.html#calibre_pb_17" class="image-p">
<a href="#part0007.html#p0025_02" id="part0026_split_008.html#p0025_02a"
class="calibre6"><img src="images/00089.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_008.html#calibre_pb_18" class="calibre20">

</div>
<p><span id="part0026_split_009.html"></span></p>
<div id="part0026_split_009.html#calibre_pb_19" class="image-p">
<a href="#part0007.html#p0025_03" id="part0026_split_009.html#p0025_03a"
class="calibre6"><img src="images/00090.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_009.html#calibre_pb_20" class="calibre20">

</div>
<p><span id="part0026_split_010.html"></span></p>
<div id="part0026_split_010.html#calibre_pb_21" class="image-p">
<a href="#part0007.html#p0026_01" id="part0026_split_010.html#p0026_01a"
class="calibre6"><img src="images/00091.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_010.html#calibre_pb_22" class="calibre20">

</div>
<p><span id="part0026_split_011.html"></span></p>
<div id="part0026_split_011.html#calibre_pb_23" class="image-p">
<a href="#part0007.html#p0026_02" id="part0026_split_011.html#p0026_02a"
class="calibre6"><img src="images/00092.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_011.html#calibre_pb_24" class="calibre20">

</div>
<p><span id="part0026_split_012.html"></span></p>
<div id="part0026_split_012.html#calibre_pb_25" class="image-p">
<a href="#part0007.html#p0027_01" id="part0026_split_012.html#p0027_01a"
class="calibre6"><img src="images/00093.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_012.html#calibre_pb_26" class="calibre20">

</div>
<p><span id="part0026_split_013.html"></span></p>
<div id="part0026_split_013.html#calibre_pb_27" class="image-p">
<a href="#part0007.html#p0027_02" id="part0026_split_013.html#p0027_02a"
class="calibre6"><img src="images/00094.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_013.html#calibre_pb_28" class="calibre20">

</div>
<p><span id="part0026_split_014.html"></span></p>
<div id="part0026_split_014.html#calibre_pb_29" class="image-p">
<a href="#part0007.html#p0027_03" id="part0026_split_014.html#p0027_03a"
class="calibre6"><img src="images/00095.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_014.html#calibre_pb_30" class="calibre20">

</div>
<p><span id="part0026_split_015.html"></span></p>
<div id="part0026_split_015.html#calibre_pb_31" class="image-p">
<a href="#part0007.html#p0027_04" id="part0026_split_015.html#p0027_04a"
class="calibre6"><img src="images/00096.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0026_split_015.html#calibre_pb_32" class="calibre20">

</div>
<p><span id="part0026_split_016.html"></span></p>
<div id="part0026_split_016.html#calibre_pb_33" class="image-p">
<a href="#part0007.html#p0027_05" id="part0026_split_016.html#p0027_05a"
class="calibre6"><img src="images/00097.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0027_split_000.html"></span></p>
<div id="part0027_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0008.html#p0029_01" id="part0027_split_000.html#p0029_01a"
class="calibre6"><img src="images/00098.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0027_split_001.html"></span></p>
<div id="part0027_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0008.html#p0030_01" id="part0027_split_001.html#p0030_01a"
class="calibre6"><img src="images/00099.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0027_split_002.html"></span></p>
<div id="part0027_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0008.html#p0030_02" id="part0027_split_002.html#p0030_02a"
class="calibre6"><img src="images/00100.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0027_split_003.html"></span></p>
<div id="part0027_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0008.html#p0031_01" id="part0027_split_003.html#p0031_01a"
class="calibre6"><img src="images/00101.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_003.html#calibre_pb_8" class="calibre20">

</div>
<p><span id="part0027_split_004.html"></span></p>
<div id="part0027_split_004.html#calibre_pb_9" class="image-p">
<a href="#part0008.html#p0031_02" id="part0027_split_004.html#p0031_02a"
class="calibre6"><img src="images/00102.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_004.html#calibre_pb_10" class="calibre20">

</div>
<p><span id="part0027_split_005.html"></span></p>
<div id="part0027_split_005.html#calibre_pb_11" class="image-p">
<a href="#part0008.html#p0031_03" id="part0027_split_005.html#p0031_03a"
class="calibre6"><img src="images/00103.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_005.html#calibre_pb_12" class="calibre20">

</div>
<p><span id="part0027_split_006.html"></span></p>
<div id="part0027_split_006.html#calibre_pb_13" class="image-p">
<a href="#part0008.html#p0032_01" id="part0027_split_006.html#p0032_01a"
class="calibre6"><img src="images/00104.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_006.html#calibre_pb_14" class="calibre20">

</div>
<p><span id="part0027_split_007.html"></span></p>
<div id="part0027_split_007.html#calibre_pb_15" class="image-p">
<a href="#part0008.html#p0033_01" id="part0027_split_007.html#p0033_01a"
class="calibre6"><img src="images/00105.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_007.html#calibre_pb_16" class="calibre20">

</div>
<p><span id="part0027_split_008.html"></span></p>
<div id="part0027_split_008.html#calibre_pb_17" class="image-p">
<a href="#part0008.html#p0034_01" id="part0027_split_008.html#p0034_01a"
class="calibre6"><img src="images/00106.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_008.html#calibre_pb_18" class="calibre20">

</div>
<p><span id="part0027_split_009.html"></span></p>
<div id="part0027_split_009.html#calibre_pb_19" class="image-p">
<a href="#part0008.html#p0035_01" id="part0027_split_009.html#p0035_01a"
class="calibre6"><img src="images/00107.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_009.html#calibre_pb_20" class="calibre20">

</div>
<p><span id="part0027_split_010.html"></span></p>
<div id="part0027_split_010.html#calibre_pb_21" class="image-p">
<a href="#part0008.html#p0036_01" id="part0027_split_010.html#p0036_01a"
class="calibre6"><img src="images/00108.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_010.html#calibre_pb_22" class="calibre20">

</div>
<p><span id="part0027_split_011.html"></span></p>
<div id="part0027_split_011.html#calibre_pb_23" class="image-p">
<a href="#part0008.html#p0036_02" id="part0027_split_011.html#p0036_02a"
class="calibre6"><img src="images/00109.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_011.html#calibre_pb_24" class="calibre20">

</div>
<p><span id="part0027_split_012.html"></span></p>
<div id="part0027_split_012.html#calibre_pb_25" class="image-p">
<a href="#part0008.html#p0037_01" id="part0027_split_012.html#p0037_01a"
class="calibre6"><img src="images/00110.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_012.html#calibre_pb_26" class="calibre20">

</div>
<p><span id="part0027_split_013.html"></span></p>
<div id="part0027_split_013.html#calibre_pb_27" class="image-p">
<a href="#part0008.html#p0037_02" id="part0027_split_013.html#p0037_02a"
class="calibre6"><img src="images/00111.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_013.html#calibre_pb_28" class="calibre20">

</div>
<p><span id="part0027_split_014.html"></span></p>
<div id="part0027_split_014.html#calibre_pb_29" class="image-p">
<a href="#part0008.html#p0038_01" id="part0027_split_014.html#p0038_01a"
class="calibre6"><img src="images/00112.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_014.html#calibre_pb_30" class="calibre20">

</div>
<p><span id="part0027_split_015.html"></span></p>
<div id="part0027_split_015.html#calibre_pb_31" class="image-p">
<a href="#part0008.html#p0038_02" id="part0027_split_015.html#p0038_02a"
class="calibre6"><img src="images/00113.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_015.html#calibre_pb_32" class="calibre20">

</div>
<p><span id="part0027_split_016.html"></span></p>
<div id="part0027_split_016.html#calibre_pb_33" class="image-p">
<a href="#part0008.html#p0040_01" id="part0027_split_016.html#p0040_01a"
class="calibre6"><img src="images/00114.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_016.html#calibre_pb_34" class="calibre20">

</div>
<p><span id="part0027_split_017.html"></span></p>
<div id="part0027_split_017.html#calibre_pb_35" class="image-p">
<a href="#part0008.html#p0040_02" id="part0027_split_017.html#p0040_02a"
class="calibre6"><img src="images/00115.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_017.html#calibre_pb_36" class="calibre20">

</div>
<p><span id="part0027_split_018.html"></span></p>
<div id="part0027_split_018.html#calibre_pb_37" class="image-p">
<a href="#part0008.html#p0041_01" id="part0027_split_018.html#p0041_01a"
class="calibre6"><img src="images/00116.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_018.html#calibre_pb_38" class="calibre20">

</div>
<p><span id="part0027_split_019.html"></span></p>
<div id="part0027_split_019.html#calibre_pb_39" class="image-p">
<a href="#part0008.html#p0041_02" id="part0027_split_019.html#p0041_02a"
class="calibre6"><img src="images/00117.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_019.html#calibre_pb_40" class="calibre20">

</div>
<p><span id="part0027_split_020.html"></span></p>
<div id="part0027_split_020.html#calibre_pb_41" class="image-p">
<a href="#part0008.html#p0041_03" id="part0027_split_020.html#p0041_03a"
class="calibre6"><img src="images/00118.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_020.html#calibre_pb_42" class="calibre20">

</div>
<p><span id="part0027_split_021.html"></span></p>
<div id="part0027_split_021.html#calibre_pb_43" class="image-p">
<a href="#part0008.html#p0041_04" id="part0027_split_021.html#p0041_04a"
class="calibre6"><img src="images/00119.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_021.html#calibre_pb_44" class="calibre20">

</div>
<p><span id="part0027_split_022.html"></span></p>
<div id="part0027_split_022.html#calibre_pb_45" class="image-p">
<a href="#part0008.html#p0042_01" id="part0027_split_022.html#p0042_01a"
class="calibre6"><img src="images/00120.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_022.html#calibre_pb_46" class="calibre20">

</div>
<p><span id="part0027_split_023.html"></span></p>
<div id="part0027_split_023.html#calibre_pb_47" class="image-p">
<a href="#part0008.html#p0043_01" id="part0027_split_023.html#p0043_01a"
class="calibre6"><img src="images/00121.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_023.html#calibre_pb_48" class="calibre20">

</div>
<p><span id="part0027_split_024.html"></span></p>
<div id="part0027_split_024.html#calibre_pb_49" class="image-p">
<a href="#part0008.html#p0043_02" id="part0027_split_024.html#p0043_02a"
class="calibre6"><img src="images/00122.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_024.html#calibre_pb_50" class="calibre20">

</div>
<p><span id="part0027_split_025.html"></span></p>
<div id="part0027_split_025.html#calibre_pb_51" class="image-p">
<a href="#part0008.html#p0043_03" id="part0027_split_025.html#p0043_03a"
class="calibre6"><img src="images/00123.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_025.html#calibre_pb_52" class="calibre20">

</div>
<p><span id="part0027_split_026.html"></span></p>
<div id="part0027_split_026.html#calibre_pb_53" class="image-p">
<a href="#part0008.html#p0043_04" id="part0027_split_026.html#p0043_04a"
class="calibre6"><img src="images/00124.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_026.html#calibre_pb_54" class="calibre20">

</div>
<p><span id="part0027_split_027.html"></span></p>
<div id="part0027_split_027.html#calibre_pb_55" class="image-p">
<a href="#part0008.html#p0044_01" id="part0027_split_027.html#p0044_01a"
class="calibre6"><img src="images/00125.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_027.html#calibre_pb_56" class="calibre20">

</div>
<p><span id="part0027_split_028.html"></span></p>
<div id="part0027_split_028.html#calibre_pb_57" class="image-p">
<a href="#part0008.html#p0044_02" id="part0027_split_028.html#p0044_02a"
class="calibre6"><img src="images/00126.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_028.html#calibre_pb_58" class="calibre20">

</div>
<p><span id="part0027_split_029.html"></span></p>
<div id="part0027_split_029.html#calibre_pb_59" class="image-p">
<a href="#part0008.html#p0044_03" id="part0027_split_029.html#p0044_03a"
class="calibre6"><img src="images/00127.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_029.html#calibre_pb_60" class="calibre20">

</div>
<p><span id="part0027_split_030.html"></span></p>
<div id="part0027_split_030.html#calibre_pb_61" class="image-p">
<a href="#part0008.html#p0044_04" id="part0027_split_030.html#p0044_04a"
class="calibre6"><img src="images/00128.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_030.html#calibre_pb_62" class="calibre20">

</div>
<p><span id="part0027_split_031.html"></span></p>
<div id="part0027_split_031.html#calibre_pb_63" class="image-p">
<a href="#part0008.html#p0045_01" id="part0027_split_031.html#p0045_01a"
class="calibre6"><img src="images/00129.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_031.html#calibre_pb_64" class="calibre20">

</div>
<p><span id="part0027_split_032.html"></span></p>
<div id="part0027_split_032.html#calibre_pb_65" class="image-p">
<a href="#part0008.html#p0045_02" id="part0027_split_032.html#p0045_02a"
class="calibre6"><img src="images/00130.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_032.html#calibre_pb_66" class="calibre20">

</div>
<p><span id="part0027_split_033.html"></span></p>
<div id="part0027_split_033.html#calibre_pb_67" class="image-p">
<a href="#part0008.html#p0045_03" id="part0027_split_033.html#p0045_03a"
class="calibre6"><img src="images/00131.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0027_split_033.html#calibre_pb_68" class="calibre20">

</div>
<p><span id="part0027_split_034.html"></span></p>
<div id="part0027_split_034.html#calibre_pb_69" class="image-p">
<a href="#part0008.html#p0045_04" id="part0027_split_034.html#p0045_04a"
class="calibre6"><img src="images/00132.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0028_split_000.html"></span></p>
<div id="part0028_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0009.html#p0049_01" id="part0028_split_000.html#p0049_01a"
class="calibre6"><img src="images/00133.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0028_split_001.html"></span></p>
<div id="part0028_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0009.html#p0050_01" id="part0028_split_001.html#p0050_01a"
class="calibre6"><img src="images/00134.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0028_split_002.html"></span></p>
<div id="part0028_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0009.html#p0050_02" id="part0028_split_002.html#p0050_02a"
class="calibre6"><img src="images/00135.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0028_split_003.html"></span></p>
<div id="part0028_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0009.html#p0050_03" id="part0028_split_003.html#p0050_03a"
class="calibre6"><img src="images/00136.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_003.html#calibre_pb_8" class="calibre20">

</div>
<p><span id="part0028_split_004.html"></span></p>
<div id="part0028_split_004.html#calibre_pb_9" class="image-p">
<a href="#part0009.html#p0050_04" id="part0028_split_004.html#p0050_04a"
class="calibre6"><img src="images/00137.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_004.html#calibre_pb_10" class="calibre20">

</div>
<p><span id="part0028_split_005.html"></span></p>
<div id="part0028_split_005.html#calibre_pb_11" class="image-p">
<a href="#part0009.html#p0051_01" id="part0028_split_005.html#p0051_01a"
class="calibre6"><img src="images/00138.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_005.html#calibre_pb_12" class="calibre20">

</div>
<p><span id="part0028_split_006.html"></span></p>
<div id="part0028_split_006.html#calibre_pb_13" class="image-p">
<a href="#part0009.html#p0052_01" id="part0028_split_006.html#p0052_01a"
class="calibre6"><img src="images/00139.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_006.html#calibre_pb_14" class="calibre20">

</div>
<p><span id="part0028_split_007.html"></span></p>
<div id="part0028_split_007.html#calibre_pb_15" class="image-p">
<a href="#part0009.html#p0052_02" id="part0028_split_007.html#p0052_02a"
class="calibre6"><img src="images/00140.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_007.html#calibre_pb_16" class="calibre20">

</div>
<p><span id="part0028_split_008.html"></span></p>
<div id="part0028_split_008.html#calibre_pb_17" class="image-p">
<a href="#part0009.html#p0053_01" id="part0028_split_008.html#p0053_01a"
class="calibre6"><img src="images/00141.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_008.html#calibre_pb_18" class="calibre20">

</div>
<p><span id="part0028_split_009.html"></span></p>
<div id="part0028_split_009.html#calibre_pb_19" class="image-p">
<a href="#part0009.html#p0053_02" id="part0028_split_009.html#p0053_02a"
class="calibre6"><img src="images/00142.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_009.html#calibre_pb_20" class="calibre20">

</div>
<p><span id="part0028_split_010.html"></span></p>
<div id="part0028_split_010.html#calibre_pb_21" class="image-p">
<a href="#part0009.html#p0053_03" id="part0028_split_010.html#p0053_03a"
class="calibre6"><img src="images/00143.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_010.html#calibre_pb_22" class="calibre20">

</div>
<p><span id="part0028_split_011.html"></span></p>
<div id="part0028_split_011.html#calibre_pb_23" class="image-p">
<a href="#part0009.html#p0053_04" id="part0028_split_011.html#p0053_04a"
class="calibre6"><img src="images/00144.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_011.html#calibre_pb_24" class="calibre20">

</div>
<p><span id="part0028_split_012.html"></span></p>
<div id="part0028_split_012.html#calibre_pb_25" class="image-p">
<a href="#part0009.html#p0054_01" id="part0028_split_012.html#p0054_01a"
class="calibre6"><img src="images/00145.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_012.html#calibre_pb_26" class="calibre20">

</div>
<p><span id="part0028_split_013.html"></span></p>
<div id="part0028_split_013.html#calibre_pb_27" class="image-p">
<a href="#part0009.html#p0054_02" id="part0028_split_013.html#p0054_02a"
class="calibre6"><img src="images/00146.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_013.html#calibre_pb_28" class="calibre20">

</div>
<p><span id="part0028_split_014.html"></span></p>
<div id="part0028_split_014.html#calibre_pb_29" class="image-p">
<a href="#part0009.html#p0054_03" id="part0028_split_014.html#p0054_03a"
class="calibre6"><img src="images/00147.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_014.html#calibre_pb_30" class="calibre20">

</div>
<p><span id="part0028_split_015.html"></span></p>
<div id="part0028_split_015.html#calibre_pb_31" class="image-p">
<a href="#part0009.html#p0055_01" id="part0028_split_015.html#p0055_01a"
class="calibre6"><img src="images/00148.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_015.html#calibre_pb_32" class="calibre20">

</div>
<p><span id="part0028_split_016.html"></span></p>
<div id="part0028_split_016.html#calibre_pb_33" class="image-p">
<a href="#part0009.html#p0055_02" id="part0028_split_016.html#p0055_02a"
class="calibre6"><img src="images/00149.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_016.html#calibre_pb_34" class="calibre20">

</div>
<p><span id="part0028_split_017.html"></span></p>
<div id="part0028_split_017.html#calibre_pb_35" class="image-p">
<a href="#part0009.html#p0055_03" id="part0028_split_017.html#p0055_03a"
class="calibre6"><img src="images/00150.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_017.html#calibre_pb_36" class="calibre20">

</div>
<p><span id="part0028_split_018.html"></span></p>
<div id="part0028_split_018.html#calibre_pb_37" class="image-p">
<a href="#part0009.html#p0056_01" id="part0028_split_018.html#p0056_01a"
class="calibre6"><img src="images/00151.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_018.html#calibre_pb_38" class="calibre20">

</div>
<p><span id="part0028_split_019.html"></span></p>
<div id="part0028_split_019.html#calibre_pb_39" class="image-p">
<a href="#part0009.html#p0056_02" id="part0028_split_019.html#p0056_02a"
class="calibre6"><img src="images/00152.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_019.html#calibre_pb_40" class="calibre20">

</div>
<p><span id="part0028_split_020.html"></span></p>
<div id="part0028_split_020.html#calibre_pb_41" class="image-p">
<a href="#part0009.html#p0058_01" id="part0028_split_020.html#p0058_01a"
class="calibre6"><img src="images/00153.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_020.html#calibre_pb_42" class="calibre20">

</div>
<p><span id="part0028_split_021.html"></span></p>
<div id="part0028_split_021.html#calibre_pb_43" class="image-p">
<a href="#part0009.html#p0058_02" id="part0028_split_021.html#p0058_02a"
class="calibre6"><img src="images/00154.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_021.html#calibre_pb_44" class="calibre20">

</div>
<p><span id="part0028_split_022.html"></span></p>
<div id="part0028_split_022.html#calibre_pb_45" class="image-p">
<a href="#part0009.html#p0058_03" id="part0028_split_022.html#p0058_03a"
class="calibre6"><img src="images/00155.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_022.html#calibre_pb_46" class="calibre20">

</div>
<p><span id="part0028_split_023.html"></span></p>
<div id="part0028_split_023.html#calibre_pb_47" class="image-p">
<a href="#part0009.html#p0059_01" id="part0028_split_023.html#p0059_01a"
class="calibre6"><img src="images/00156.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_023.html#calibre_pb_48" class="calibre20">

</div>
<p><span id="part0028_split_024.html"></span></p>
<div id="part0028_split_024.html#calibre_pb_49" class="image-p">
<a href="#part0009.html#p0059_02" id="part0028_split_024.html#p0059_02a"
class="calibre6"><img src="images/00157.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_024.html#calibre_pb_50" class="calibre20">

</div>
<p><span id="part0028_split_025.html"></span></p>
<div id="part0028_split_025.html#calibre_pb_51" class="image-p">
<a href="#part0009.html#p0060_01" id="part0028_split_025.html#p0060_01a"
class="calibre6"><img src="images/00158.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_025.html#calibre_pb_52" class="calibre20">

</div>
<p><span id="part0028_split_026.html"></span></p>
<div id="part0028_split_026.html#calibre_pb_53" class="image-p">
<a href="#part0009.html#p0061_01" id="part0028_split_026.html#p0061_01a"
class="calibre6"><img src="images/00159.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_026.html#calibre_pb_54" class="calibre20">

</div>
<p><span id="part0028_split_027.html"></span></p>
<div id="part0028_split_027.html#calibre_pb_55" class="image-p">
<a href="#part0009.html#p0061_02" id="part0028_split_027.html#p0061_02a"
class="calibre6"><img src="images/00160.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_027.html#calibre_pb_56" class="calibre20">

</div>
<p><span id="part0028_split_028.html"></span></p>
<div id="part0028_split_028.html#calibre_pb_57" class="image-p">
<a href="#part0009.html#p0061_03" id="part0028_split_028.html#p0061_03a"
class="calibre6"><img src="images/00161.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_028.html#calibre_pb_58" class="calibre20">

</div>
<p><span id="part0028_split_029.html"></span></p>
<div id="part0028_split_029.html#calibre_pb_59" class="image-p">
<a href="#part0009.html#p0062_01" id="part0028_split_029.html#p0062_01a"
class="calibre6"><img src="images/00162.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_029.html#calibre_pb_60" class="calibre20">

</div>
<p><span id="part0028_split_030.html"></span></p>
<div id="part0028_split_030.html#calibre_pb_61" class="image-p">
<a href="#part0009.html#p0062_02" id="part0028_split_030.html#p0062_02a"
class="calibre6"><img src="images/00163.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0028_split_030.html#calibre_pb_62" class="calibre20">

</div>
<p><span id="part0028_split_031.html"></span></p>
<div id="part0028_split_031.html#calibre_pb_63" class="image-p">
<a href="#part0009.html#p0062_03" id="part0028_split_031.html#p0062_03a"
class="calibre6"><img src="images/00164.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0029_split_000.html"></span></p>
<div id="part0029_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0010.html#p0066_01" id="part0029_split_000.html#p0066_01a"
class="calibre6"><img src="images/00165.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0029_split_001.html"></span></p>
<div id="part0029_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0010.html#p0066_02" id="part0029_split_001.html#p0066_02a"
class="calibre6"><img src="images/00166.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0029_split_002.html"></span></p>
<div id="part0029_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0010.html#p0067_01" id="part0029_split_002.html#p0067_01a"
class="calibre6"><img src="images/00167.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0029_split_003.html"></span></p>
<div id="part0029_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0010.html#p0067_02" id="part0029_split_003.html#p0067_02a"
class="calibre6"><img src="images/00168.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_003.html#calibre_pb_8" class="calibre20">

</div>
<p><span id="part0029_split_004.html"></span></p>
<div id="part0029_split_004.html#calibre_pb_9" class="image-p">
<a href="#part0010.html#p0067_03" id="part0029_split_004.html#p0067_03a"
class="calibre6"><img src="images/00169.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_004.html#calibre_pb_10" class="calibre20">

</div>
<p><span id="part0029_split_005.html"></span></p>
<div id="part0029_split_005.html#calibre_pb_11" class="image-p">
<a href="#part0010.html#p0067_04" id="part0029_split_005.html#p0067_04a"
class="calibre6"><img src="images/00170.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_005.html#calibre_pb_12" class="calibre20">

</div>
<p><span id="part0029_split_006.html"></span></p>
<div id="part0029_split_006.html#calibre_pb_13" class="image-p">
<a href="#part0010.html#p0068_01" id="part0029_split_006.html#p0068_01a"
class="calibre6"><img src="images/00171.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_006.html#calibre_pb_14" class="calibre20">

</div>
<p><span id="part0029_split_007.html"></span></p>
<div id="part0029_split_007.html#calibre_pb_15" class="image-p">
<a href="#part0010.html#p0068_02" id="part0029_split_007.html#p0068_02a"
class="calibre6"><img src="images/00172.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_007.html#calibre_pb_16" class="calibre20">

</div>
<p><span id="part0029_split_008.html"></span></p>
<div id="part0029_split_008.html#calibre_pb_17" class="image-p">
<a href="#part0010.html#p0068_03" id="part0029_split_008.html#p0068_03a"
class="calibre6"><img src="images/00173.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_008.html#calibre_pb_18" class="calibre20">

</div>
<p><span id="part0029_split_009.html"></span></p>
<div id="part0029_split_009.html#calibre_pb_19" class="image-p">
<a href="#part0010.html#p0068_04" id="part0029_split_009.html#p0068_04a"
class="calibre6"><img src="images/00174.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_009.html#calibre_pb_20" class="calibre20">

</div>
<p><span id="part0029_split_010.html"></span></p>
<div id="part0029_split_010.html#calibre_pb_21" class="image-p">
<a href="#part0010.html#p0069_01" id="part0029_split_010.html#p0069_01a"
class="calibre6"><img src="images/00175.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_010.html#calibre_pb_22" class="calibre20">

</div>
<p><span id="part0029_split_011.html"></span></p>
<div id="part0029_split_011.html#calibre_pb_23" class="image-p">
<a href="#part0010.html#p0069_02" id="part0029_split_011.html#p0069_02a"
class="calibre6"><img src="images/00176.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_011.html#calibre_pb_24" class="calibre20">

</div>
<p><span id="part0029_split_012.html"></span></p>
<div id="part0029_split_012.html#calibre_pb_25" class="image-p">
<a href="#part0010.html#p0070_01" id="part0029_split_012.html#p0070_01a"
class="calibre6"><img src="images/00177.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_012.html#calibre_pb_26" class="calibre20">

</div>
<p><span id="part0029_split_013.html"></span></p>
<div id="part0029_split_013.html#calibre_pb_27" class="image-p">
<a href="#part0010.html#p0070_02" id="part0029_split_013.html#p0070_02a"
class="calibre6"><img src="images/00178.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_013.html#calibre_pb_28" class="calibre20">

</div>
<p><span id="part0029_split_014.html"></span></p>
<div id="part0029_split_014.html#calibre_pb_29" class="image-p">
<a href="#part0010.html#p0070_03" id="part0029_split_014.html#p0070_03a"
class="calibre6"><img src="images/00179.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_014.html#calibre_pb_30" class="calibre20">

</div>
<p><span id="part0029_split_015.html"></span></p>
<div id="part0029_split_015.html#calibre_pb_31" class="image-p">
<a href="#part0010.html#p0071_01" id="part0029_split_015.html#p0071_01a"
class="calibre6"><img src="images/00180.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_015.html#calibre_pb_32" class="calibre20">

</div>
<p><span id="part0029_split_016.html"></span></p>
<div id="part0029_split_016.html#calibre_pb_33" class="image-p">
<a href="#part0010.html#p0071_02" id="part0029_split_016.html#p0071_02a"
class="calibre6"><img src="images/00181.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_016.html#calibre_pb_34" class="calibre20">

</div>
<p><span id="part0029_split_017.html"></span></p>
<div id="part0029_split_017.html#calibre_pb_35" class="image-p">
<a href="#part0010.html#p0071_03" id="part0029_split_017.html#p0071_03a"
class="calibre6"><img src="images/00182.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_017.html#calibre_pb_36" class="calibre20">

</div>
<p><span id="part0029_split_018.html"></span></p>
<div id="part0029_split_018.html#calibre_pb_37" class="image-p">
<a href="#part0010.html#p0072_01" id="part0029_split_018.html#p0072_01a"
class="calibre6"><img src="images/00183.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_018.html#calibre_pb_38" class="calibre20">

</div>
<p><span id="part0029_split_019.html"></span></p>
<div id="part0029_split_019.html#calibre_pb_39" class="image-p">
<a href="#part0010.html#p0073_01" id="part0029_split_019.html#p0073_01a"
class="calibre6"><img src="images/00184.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_019.html#calibre_pb_40" class="calibre20">

</div>
<p><span id="part0029_split_020.html"></span></p>
<div id="part0029_split_020.html#calibre_pb_41" class="image-p">
<a href="#part0010.html#p0074_01" id="part0029_split_020.html#p0074_01a"
class="calibre6"><img src="images/00185.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_020.html#calibre_pb_42" class="calibre20">

</div>
<p><span id="part0029_split_021.html"></span></p>
<div id="part0029_split_021.html#calibre_pb_43" class="image-p">
<a href="#part0010.html#p0074_02" id="part0029_split_021.html#p0074_02a"
class="calibre6"><img src="images/00186.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_021.html#calibre_pb_44" class="calibre20">

</div>
<p><span id="part0029_split_022.html"></span></p>
<div id="part0029_split_022.html#calibre_pb_45" class="image-p">
<a href="#part0010.html#p0075_01" id="part0029_split_022.html#p0075_01a"
class="calibre6"><img src="images/00187.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_022.html#calibre_pb_46" class="calibre20">

</div>
<p><span id="part0029_split_023.html"></span></p>
<div id="part0029_split_023.html#calibre_pb_47" class="image-p">
<a href="#part0010.html#p0075_02" id="part0029_split_023.html#p0075_02a"
class="calibre6"><img src="images/00188.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_023.html#calibre_pb_48" class="calibre20">

</div>
<p><span id="part0029_split_024.html"></span></p>
<div id="part0029_split_024.html#calibre_pb_49" class="image-p">
<a href="#part0010.html#p0076_01" id="part0029_split_024.html#p0076_01a"
class="calibre6"><img src="images/00189.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0029_split_024.html#calibre_pb_50" class="calibre20">

</div>
<p><span id="part0029_split_025.html"></span></p>
<div id="part0029_split_025.html#calibre_pb_51" class="image-p">
<a href="#part0010.html#p0076_02" id="part0029_split_025.html#p0076_02a"
class="calibre6"><img src="images/00190.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0030_split_000.html"></span></p>
<div id="part0030_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0011.html#p0080_01" id="part0030_split_000.html#p0080_01a"
class="calibre6"><img src="images/00191.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0030_split_001.html"></span></p>
<div id="part0030_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0011.html#p0080_02" id="part0030_split_001.html#p0080_02a"
class="calibre6"><img src="images/00192.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0030_split_002.html"></span></p>
<div id="part0030_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0011.html#p0080_03" id="part0030_split_002.html#p0080_03a"
class="calibre6"><img src="images/00193.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0030_split_003.html"></span></p>
<div id="part0030_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0011.html#p0081_01" id="part0030_split_003.html#p0081_01a"
class="calibre6"><img src="images/00194.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_003.html#calibre_pb_8" class="calibre20">

</div>
<p><span id="part0030_split_004.html"></span></p>
<div id="part0030_split_004.html#calibre_pb_9" class="image-p">
<a href="#part0011.html#p0081_02" id="part0030_split_004.html#p0081_02a"
class="calibre6"><img src="images/00195.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_004.html#calibre_pb_10" class="calibre20">

</div>
<p><span id="part0030_split_005.html"></span></p>
<div id="part0030_split_005.html#calibre_pb_11" class="image-p">
<a href="#part0011.html#p0081_03" id="part0030_split_005.html#p0081_03a"
class="calibre6"><img src="images/00196.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_005.html#calibre_pb_12" class="calibre20">

</div>
<p><span id="part0030_split_006.html"></span></p>
<div id="part0030_split_006.html#calibre_pb_13" class="image-p">
<a href="#part0011.html#p0082_01" id="part0030_split_006.html#p0082_01a"
class="calibre6"><img src="images/00197.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_006.html#calibre_pb_14" class="calibre20">

</div>
<p><span id="part0030_split_007.html"></span></p>
<div id="part0030_split_007.html#calibre_pb_15" class="image-p">
<a href="#part0011.html#p0082_02" id="part0030_split_007.html#p0082_02a"
class="calibre6"><img src="images/00198.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_007.html#calibre_pb_16" class="calibre20">

</div>
<p><span id="part0030_split_008.html"></span></p>
<div id="part0030_split_008.html#calibre_pb_17" class="image-p">
<a href="#part0011.html#p0082_03" id="part0030_split_008.html#p0082_03a"
class="calibre6"><img src="images/00199.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_008.html#calibre_pb_18" class="calibre20">

</div>
<p><span id="part0030_split_009.html"></span></p>
<div id="part0030_split_009.html#calibre_pb_19" class="image-p">
<a href="#part0011.html#p0082_04" id="part0030_split_009.html#p0082_04a"
class="calibre6"><img src="images/00200.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_009.html#calibre_pb_20" class="calibre20">

</div>
<p><span id="part0030_split_010.html"></span></p>
<div id="part0030_split_010.html#calibre_pb_21" class="image-p">
<a href="#part0011.html#p0083_01" id="part0030_split_010.html#p0083_01a"
class="calibre6"><img src="images/00201.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_010.html#calibre_pb_22" class="calibre20">

</div>
<p><span id="part0030_split_011.html"></span></p>
<div id="part0030_split_011.html#calibre_pb_23" class="image-p">
<a href="#part0011.html#p0083_02" id="part0030_split_011.html#p0083_02a"
class="calibre6"><img src="images/00202.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_011.html#calibre_pb_24" class="calibre20">

</div>
<p><span id="part0030_split_012.html"></span></p>
<div id="part0030_split_012.html#calibre_pb_25" class="image-p">
<a href="#part0011.html#p0083_03" id="part0030_split_012.html#p0083_03a"
class="calibre6"><img src="images/00203.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_012.html#calibre_pb_26" class="calibre20">

</div>
<p><span id="part0030_split_013.html"></span></p>
<div id="part0030_split_013.html#calibre_pb_27" class="image-p">
<a href="#part0011.html#p0083_04" id="part0030_split_013.html#p0083_04a"
class="calibre6"><img src="images/00204.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_013.html#calibre_pb_28" class="calibre20">

</div>
<p><span id="part0030_split_014.html"></span></p>
<div id="part0030_split_014.html#calibre_pb_29" class="image-p">
<a href="#part0011.html#p0084_01" id="part0030_split_014.html#p0084_01a"
class="calibre6"><img src="images/00205.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_014.html#calibre_pb_30" class="calibre20">

</div>
<p><span id="part0030_split_015.html"></span></p>
<div id="part0030_split_015.html#calibre_pb_31" class="image-p">
<a href="#part0011.html#p0084_02" id="part0030_split_015.html#p0084_02a"
class="calibre6"><img src="images/00206.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_015.html#calibre_pb_32" class="calibre20">

</div>
<p><span id="part0030_split_016.html"></span></p>
<div id="part0030_split_016.html#calibre_pb_33" class="image-p">
<a href="#part0011.html#p0085_01" id="part0030_split_016.html#p0085_01a"
class="calibre6"><img src="images/00207.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_016.html#calibre_pb_34" class="calibre20">

</div>
<p><span id="part0030_split_017.html"></span></p>
<div id="part0030_split_017.html#calibre_pb_35" class="image-p">
<a href="#part0011.html#p0085_02" id="part0030_split_017.html#p0085_02a"
class="calibre6"><img src="images/00208.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_017.html#calibre_pb_36" class="calibre20">

</div>
<p><span id="part0030_split_018.html"></span></p>
<div id="part0030_split_018.html#calibre_pb_37" class="image-p">
<a href="#part0011.html#p0085_03" id="part0030_split_018.html#p0085_03a"
class="calibre6"><img src="images/00209.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_018.html#calibre_pb_38" class="calibre20">

</div>
<p><span id="part0030_split_019.html"></span></p>
<div id="part0030_split_019.html#calibre_pb_39" class="image-p">
<a href="#part0011.html#p0085_04" id="part0030_split_019.html#p0085_04a"
class="calibre6"><img src="images/00210.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_019.html#calibre_pb_40" class="calibre20">

</div>
<p><span id="part0030_split_020.html"></span></p>
<div id="part0030_split_020.html#calibre_pb_41" class="image-p">
<a href="#part0011.html#p0086_01" id="part0030_split_020.html#p0086_01a"
class="calibre6"><img src="images/00211.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_020.html#calibre_pb_42" class="calibre20">

</div>
<p><span id="part0030_split_021.html"></span></p>
<div id="part0030_split_021.html#calibre_pb_43" class="image-p">
<a href="#part0011.html#p0086_02" id="part0030_split_021.html#p0086_02a"
class="calibre6"><img src="images/00212.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_021.html#calibre_pb_44" class="calibre20">

</div>
<p><span id="part0030_split_022.html"></span></p>
<div id="part0030_split_022.html#calibre_pb_45" class="image-p">
<a href="#part0011.html#p0086_03" id="part0030_split_022.html#p0086_03a"
class="calibre6"><img src="images/00213.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_022.html#calibre_pb_46" class="calibre20">

</div>
<p><span id="part0030_split_023.html"></span></p>
<div id="part0030_split_023.html#calibre_pb_47" class="image-p">
<a href="#part0011.html#p0086_04" id="part0030_split_023.html#p0086_04a"
class="calibre6"><img src="images/00214.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_023.html#calibre_pb_48" class="calibre20">

</div>
<p><span id="part0030_split_024.html"></span></p>
<div id="part0030_split_024.html#calibre_pb_49" class="image-p">
<a href="#part0011.html#p0087_01" id="part0030_split_024.html#p0087_01a"
class="calibre6"><img src="images/00215.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_024.html#calibre_pb_50" class="calibre20">

</div>
<p><span id="part0030_split_025.html"></span></p>
<div id="part0030_split_025.html#calibre_pb_51" class="image-p">
<a href="#part0011.html#p0087_02" id="part0030_split_025.html#p0087_02a"
class="calibre6"><img src="images/00216.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_025.html#calibre_pb_52" class="calibre20">

</div>
<p><span id="part0030_split_026.html"></span></p>
<div id="part0030_split_026.html#calibre_pb_53" class="image-p">
<a href="#part0011.html#p0087_03" id="part0030_split_026.html#p0087_03a"
class="calibre6"><img src="images/00217.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_026.html#calibre_pb_54" class="calibre20">

</div>
<p><span id="part0030_split_027.html"></span></p>
<div id="part0030_split_027.html#calibre_pb_55" class="image-p">
<a href="#part0011.html#p0088_01" id="part0030_split_027.html#p0088_01a"
class="calibre6"><img src="images/00218.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_027.html#calibre_pb_56" class="calibre20">

</div>
<p><span id="part0030_split_028.html"></span></p>
<div id="part0030_split_028.html#calibre_pb_57" class="image-p">
<a href="#part0011.html#p0088_02" id="part0030_split_028.html#p0088_02a"
class="calibre6"><img src="images/00219.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_028.html#calibre_pb_58" class="calibre20">

</div>
<p><span id="part0030_split_029.html"></span></p>
<div id="part0030_split_029.html#calibre_pb_59" class="image-p">
<a href="#part0011.html#p0089_01" id="part0030_split_029.html#p0089_01a"
class="calibre6"><img src="images/00220.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_029.html#calibre_pb_60" class="calibre20">

</div>
<p><span id="part0030_split_030.html"></span></p>
<div id="part0030_split_030.html#calibre_pb_61" class="image-p">
<a href="#part0011.html#p0089_02" id="part0030_split_030.html#p0089_02a"
class="calibre6"><img src="images/00221.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_030.html#calibre_pb_62" class="calibre20">

</div>
<p><span id="part0030_split_031.html"></span></p>
<div id="part0030_split_031.html#calibre_pb_63" class="image-p">
<a href="#part0011.html#p0090_01" id="part0030_split_031.html#p0090_01a"
class="calibre6"><img src="images/00222.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_031.html#calibre_pb_64" class="calibre20">

</div>
<p><span id="part0030_split_032.html"></span></p>
<div id="part0030_split_032.html#calibre_pb_65" class="image-p">
<a href="#part0011.html#p0090_02" id="part0030_split_032.html#p0090_02a"
class="calibre6"><img src="images/00223.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_032.html#calibre_pb_66" class="calibre20">

</div>
<p><span id="part0030_split_033.html"></span></p>
<div id="part0030_split_033.html#calibre_pb_67" class="image-p">
<a href="#part0011.html#p0090_03" id="part0030_split_033.html#p0090_03a"
class="calibre6"><img src="images/00224.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_033.html#calibre_pb_68" class="calibre20">

</div>
<p><span id="part0030_split_034.html"></span></p>
<div id="part0030_split_034.html#calibre_pb_69" class="image-p">
<a href="#part0011.html#p0091_01" id="part0030_split_034.html#p0091_01a"
class="calibre6"><img src="images/00225.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_034.html#calibre_pb_70" class="calibre20">

</div>
<p><span id="part0030_split_035.html"></span></p>
<div id="part0030_split_035.html#calibre_pb_71" class="image-p">
<a href="#part0011.html#p0091_02" id="part0030_split_035.html#p0091_02a"
class="calibre6"><img src="images/00226.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0030_split_035.html#calibre_pb_72" class="calibre20">

</div>
<p><span id="part0030_split_036.html"></span></p>
<div id="part0030_split_036.html#calibre_pb_73" class="image-p">
<a href="#part0011.html#p0091_03" id="part0030_split_036.html#p0091_03a"
class="calibre6"><img src="images/00227.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0031_split_000.html"></span></p>
<div id="part0031_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0012.html#p0094_01" id="part0031_split_000.html#p0094_01a"
class="calibre6"><img src="images/00228.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0031_split_001.html"></span></p>
<div id="part0031_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0012.html#p0094_02" id="part0031_split_001.html#p0094_02a"
class="calibre6"><img src="images/00229.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0031_split_002.html"></span></p>
<div id="part0031_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0012.html#p0095_01" id="part0031_split_002.html#p0095_01a"
class="calibre6"><img src="images/00230.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0031_split_003.html"></span></p>
<div id="part0031_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0012.html#p0095_02" id="part0031_split_003.html#p0095_02a"
class="calibre6"><img src="images/00231.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_003.html#calibre_pb_8" class="calibre20">

</div>
<p><span id="part0031_split_004.html"></span></p>
<div id="part0031_split_004.html#calibre_pb_9" class="image-p">
<a href="#part0012.html#p0095_03" id="part0031_split_004.html#p0095_03a"
class="calibre6"><img src="images/00232.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_004.html#calibre_pb_10" class="calibre20">

</div>
<p><span id="part0031_split_005.html"></span></p>
<div id="part0031_split_005.html#calibre_pb_11" class="image-p">
<a href="#part0012.html#p0095_04" id="part0031_split_005.html#p0095_04a"
class="calibre6"><img src="images/00233.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_005.html#calibre_pb_12" class="calibre20">

</div>
<p><span id="part0031_split_006.html"></span></p>
<div id="part0031_split_006.html#calibre_pb_13" class="image-p">
<a href="#part0012.html#p0096_01" id="part0031_split_006.html#p0096_01a"
class="calibre6"><img src="images/00234.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_006.html#calibre_pb_14" class="calibre20">

</div>
<p><span id="part0031_split_007.html"></span></p>
<div id="part0031_split_007.html#calibre_pb_15" class="image-p">
<a href="#part0012.html#p0096_02" id="part0031_split_007.html#p0096_02a"
class="calibre6"><img src="images/00235.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_007.html#calibre_pb_16" class="calibre20">

</div>
<p><span id="part0031_split_008.html"></span></p>
<div id="part0031_split_008.html#calibre_pb_17" class="image-p">
<a href="#part0012.html#p0096_03" id="part0031_split_008.html#p0096_03a"
class="calibre6"><img src="images/00236.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_008.html#calibre_pb_18" class="calibre20">

</div>
<p><span id="part0031_split_009.html"></span></p>
<div id="part0031_split_009.html#calibre_pb_19" class="image-p">
<a href="#part0012.html#p0097_01" id="part0031_split_009.html#p0097_01a"
class="calibre6"><img src="images/00237.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_009.html#calibre_pb_20" class="calibre20">

</div>
<p><span id="part0031_split_010.html"></span></p>
<div id="part0031_split_010.html#calibre_pb_21" class="image-p">
<a href="#part0012.html#p0097_02" id="part0031_split_010.html#p0097_02a"
class="calibre6"><img src="images/00238.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_010.html#calibre_pb_22" class="calibre20">

</div>
<p><span id="part0031_split_011.html"></span></p>
<div id="part0031_split_011.html#calibre_pb_23" class="image-p">
<a href="#part0012.html#p0098_01" id="part0031_split_011.html#p0098_01a"
class="calibre6"><img src="images/00239.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_011.html#calibre_pb_24" class="calibre20">

</div>
<p><span id="part0031_split_012.html"></span></p>
<div id="part0031_split_012.html#calibre_pb_25" class="image-p">
<a href="#part0012.html#p0098_02" id="part0031_split_012.html#p0098_02a"
class="calibre6"><img src="images/00240.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_012.html#calibre_pb_26" class="calibre20">

</div>
<p><span id="part0031_split_013.html"></span></p>
<div id="part0031_split_013.html#calibre_pb_27" class="image-p">
<a href="#part0012.html#p0098_03" id="part0031_split_013.html#p0098_03a"
class="calibre6"><img src="images/00241.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_013.html#calibre_pb_28" class="calibre20">

</div>
<p><span id="part0031_split_014.html"></span></p>
<div id="part0031_split_014.html#calibre_pb_29" class="image-p">
<a href="#part0012.html#p0099_01" id="part0031_split_014.html#p0099_01a"
class="calibre6"><img src="images/00242.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_014.html#calibre_pb_30" class="calibre20">

</div>
<p><span id="part0031_split_015.html"></span></p>
<div id="part0031_split_015.html#calibre_pb_31" class="image-p">
<a href="#part0012.html#p0100_01" id="part0031_split_015.html#p0100_01a"
class="calibre6"><img src="images/00243.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_015.html#calibre_pb_32" class="calibre20">

</div>
<p><span id="part0031_split_016.html"></span></p>
<div id="part0031_split_016.html#calibre_pb_33" class="image-p">
<a href="#part0012.html#p0100_02" id="part0031_split_016.html#p0100_02a"
class="calibre6"><img src="images/00244.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_016.html#calibre_pb_34" class="calibre20">

</div>
<p><span id="part0031_split_017.html"></span></p>
<div id="part0031_split_017.html#calibre_pb_35" class="image-p">
<a href="#part0012.html#p0100_03" id="part0031_split_017.html#p0100_03a"
class="calibre6"><img src="images/00245.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_017.html#calibre_pb_36" class="calibre20">

</div>
<p><span id="part0031_split_018.html"></span></p>
<div id="part0031_split_018.html#calibre_pb_37" class="image-p">
<a href="#part0012.html#p0101_01" id="part0031_split_018.html#p0101_01a"
class="calibre6"><img src="images/00246.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_018.html#calibre_pb_38" class="calibre20">

</div>
<p><span id="part0031_split_019.html"></span></p>
<div id="part0031_split_019.html#calibre_pb_39" class="image-p">
<a href="#part0012.html#p0101_02" id="part0031_split_019.html#p0101_02a"
class="calibre6"><img src="images/00247.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_019.html#calibre_pb_40" class="calibre20">

</div>
<p><span id="part0031_split_020.html"></span></p>
<div id="part0031_split_020.html#calibre_pb_41" class="image-p">
<a href="#part0012.html#p0101_03" id="part0031_split_020.html#p0101_03a"
class="calibre6"><img src="images/00248.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_020.html#calibre_pb_42" class="calibre20">

</div>
<p><span id="part0031_split_021.html"></span></p>
<div id="part0031_split_021.html#calibre_pb_43" class="image-p">
<a href="#part0012.html#p0102_01" id="part0031_split_021.html#p0102_01a"
class="calibre6"><img src="images/00249.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_021.html#calibre_pb_44" class="calibre20">

</div>
<p><span id="part0031_split_022.html"></span></p>
<div id="part0031_split_022.html#calibre_pb_45" class="image-p">
<a href="#part0012.html#p0102_02" id="part0031_split_022.html#p0102_02a"
class="calibre6"><img src="images/00250.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_022.html#calibre_pb_46" class="calibre20">

</div>
<p><span id="part0031_split_023.html"></span></p>
<div id="part0031_split_023.html#calibre_pb_47" class="image-p">
<a href="#part0012.html#p0102_03" id="part0031_split_023.html#p0102_03a"
class="calibre6"><img src="images/00251.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_023.html#calibre_pb_48" class="calibre20">

</div>
<p><span id="part0031_split_024.html"></span></p>
<div id="part0031_split_024.html#calibre_pb_49" class="image-p">
<a href="#part0012.html#p0102_04" id="part0031_split_024.html#p0102_04a"
class="calibre6"><img src="images/00252.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_024.html#calibre_pb_50" class="calibre20">

</div>
<p><span id="part0031_split_025.html"></span></p>
<div id="part0031_split_025.html#calibre_pb_51" class="image-p">
<a href="#part0012.html#p0102_05" id="part0031_split_025.html#p0102_05a"
class="calibre6"><img src="images/00253.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_025.html#calibre_pb_52" class="calibre20">

</div>
<p><span id="part0031_split_026.html"></span></p>
<div id="part0031_split_026.html#calibre_pb_53" class="image-p">
<a href="#part0012.html#p0103_01" id="part0031_split_026.html#p0103_01a"
class="calibre6"><img src="images/00254.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_026.html#calibre_pb_54" class="calibre20">

</div>
<p><span id="part0031_split_027.html"></span></p>
<div id="part0031_split_027.html#calibre_pb_55" class="image-p">
<a href="#part0012.html#p0103_02" id="part0031_split_027.html#p0103_02a"
class="calibre6"><img src="images/00255.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0031_split_027.html#calibre_pb_56" class="calibre20">

</div>
<p><span id="part0031_split_028.html"></span></p>
<div id="part0031_split_028.html#calibre_pb_57" class="image-p">
<a href="#part0012.html#p0103_03" id="part0031_split_028.html#p0103_03a"
class="calibre6"><img src="images/00256.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0032_split_000.html"></span></p>
<div id="part0032_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0013.html#p0109_01" id="part0032_split_000.html#p0109_01a"
class="calibre6"><img src="images/00257.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0032_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0032_split_001.html"></span></p>
<div id="part0032_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0013.html#p0109_02" id="part0032_split_001.html#p0109_02a"
class="calibre6"><img src="images/00258.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0033_split_000.html"></span></p>
<div id="part0033_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0014.html#p0112_01" id="part0033_split_000.html#p0112_01a"
class="calibre6"><img src="images/00259.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0033_split_001.html"></span></p>
<div id="part0033_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0014.html#p0112_02" id="part0033_split_001.html#p0112_02a"
class="calibre6"><img src="images/00260.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0033_split_002.html"></span></p>
<div id="part0033_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0014.html#p0112_03" id="part0033_split_002.html#p0112_03a"
class="calibre6"><img src="images/00261.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0033_split_003.html"></span></p>
<div id="part0033_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0014.html#p0113_01" id="part0033_split_003.html#p0113_01a"
class="calibre6"><img src="images/00262.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_003.html#calibre_pb_8" class="calibre20">

</div>
<p><span id="part0033_split_004.html"></span></p>
<div id="part0033_split_004.html#calibre_pb_9" class="image-p">
<a href="#part0014.html#p0113_02" id="part0033_split_004.html#p0113_02a"
class="calibre6"><img src="images/00263.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_004.html#calibre_pb_10" class="calibre20">

</div>
<p><span id="part0033_split_005.html"></span></p>
<div id="part0033_split_005.html#calibre_pb_11" class="image-p">
<a href="#part0014.html#p0113_03" id="part0033_split_005.html#p0113_03a"
class="calibre6"><img src="images/00264.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_005.html#calibre_pb_12" class="calibre20">

</div>
<p><span id="part0033_split_006.html"></span></p>
<div id="part0033_split_006.html#calibre_pb_13" class="image-p">
<a href="#part0014.html#p0113_04" id="part0033_split_006.html#p0113_04a"
class="calibre6"><img src="images/00265.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_006.html#calibre_pb_14" class="calibre20">

</div>
<p><span id="part0033_split_007.html"></span></p>
<div id="part0033_split_007.html#calibre_pb_15" class="image-p">
<a href="#part0014.html#p0114_01" id="part0033_split_007.html#p0114_01a"
class="calibre6"><img src="images/00266.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_007.html#calibre_pb_16" class="calibre20">

</div>
<p><span id="part0033_split_008.html"></span></p>
<div id="part0033_split_008.html#calibre_pb_17" class="image-p">
<a href="#part0014.html#p0114_02" id="part0033_split_008.html#p0114_02a"
class="calibre6"><img src="images/00267.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_008.html#calibre_pb_18" class="calibre20">

</div>
<p><span id="part0033_split_009.html"></span></p>
<div id="part0033_split_009.html#calibre_pb_19" class="image-p">
<a href="#part0014.html#p0115_01" id="part0033_split_009.html#p0115_01a"
class="calibre6"><img src="images/00268.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_009.html#calibre_pb_20" class="calibre20">

</div>
<p><span id="part0033_split_010.html"></span></p>
<div id="part0033_split_010.html#calibre_pb_21" class="image-p">
<a href="#part0014.html#p0115_02" id="part0033_split_010.html#p0115_02a"
class="calibre6"><img src="images/00269.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_010.html#calibre_pb_22" class="calibre20">

</div>
<p><span id="part0033_split_011.html"></span></p>
<div id="part0033_split_011.html#calibre_pb_23" class="image-p">
<a href="#part0014.html#p0115_03" id="part0033_split_011.html#p0115_03a"
class="calibre6"><img src="images/00270.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_011.html#calibre_pb_24" class="calibre20">

</div>
<p><span id="part0033_split_012.html"></span></p>
<div id="part0033_split_012.html#calibre_pb_25" class="image-p">
<a href="#part0014.html#p0115_04" id="part0033_split_012.html#p0115_04a"
class="calibre6"><img src="images/00271.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_012.html#calibre_pb_26" class="calibre20">

</div>
<p><span id="part0033_split_013.html"></span></p>
<div id="part0033_split_013.html#calibre_pb_27" class="image-p">
<a href="#part0014.html#p0116_01" id="part0033_split_013.html#p0116_01a"
class="calibre6"><img src="images/00272.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_013.html#calibre_pb_28" class="calibre20">

</div>
<p><span id="part0033_split_014.html"></span></p>
<div id="part0033_split_014.html#calibre_pb_29" class="image-p">
<a href="#part0014.html#p0116_02" id="part0033_split_014.html#p0116_02a"
class="calibre6"><img src="images/00273.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_014.html#calibre_pb_30" class="calibre20">

</div>
<p><span id="part0033_split_015.html"></span></p>
<div id="part0033_split_015.html#calibre_pb_31" class="image-p">
<a href="#part0014.html#p0116_03" id="part0033_split_015.html#p0116_03a"
class="calibre6"><img src="images/00274.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_015.html#calibre_pb_32" class="calibre20">

</div>
<p><span id="part0033_split_016.html"></span></p>
<div id="part0033_split_016.html#calibre_pb_33" class="image-p">
<a href="#part0014.html#p0117_01" id="part0033_split_016.html#p0117_01a"
class="calibre6"><img src="images/00275.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_016.html#calibre_pb_34" class="calibre20">

</div>
<p><span id="part0033_split_017.html"></span></p>
<div id="part0033_split_017.html#calibre_pb_35" class="image-p">
<a href="#part0014.html#p0118_01" id="part0033_split_017.html#p0118_01a"
class="calibre6"><img src="images/00276.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_017.html#calibre_pb_36" class="calibre20">

</div>
<p><span id="part0033_split_018.html"></span></p>
<div id="part0033_split_018.html#calibre_pb_37" class="image-p">
<a href="#part0014.html#p0118_02" id="part0033_split_018.html#p0118_02a"
class="calibre6"><img src="images/00277.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_018.html#calibre_pb_38" class="calibre20">

</div>
<p><span id="part0033_split_019.html"></span></p>
<div id="part0033_split_019.html#calibre_pb_39" class="image-p">
<a href="#part0014.html#p0118_03" id="part0033_split_019.html#p0118_03a"
class="calibre6"><img src="images/00278.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_019.html#calibre_pb_40" class="calibre20">

</div>
<p><span id="part0033_split_020.html"></span></p>
<div id="part0033_split_020.html#calibre_pb_41" class="image-p">
<a href="#part0014.html#p0118_04" id="part0033_split_020.html#p0118_04a"
class="calibre6"><img src="images/00279.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_020.html#calibre_pb_42" class="calibre20">

</div>
<p><span id="part0033_split_021.html"></span></p>
<div id="part0033_split_021.html#calibre_pb_43" class="image-p">
<a href="#part0014.html#p0120_01" id="part0033_split_021.html#p0120_01a"
class="calibre6"><img src="images/00280.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_021.html#calibre_pb_44" class="calibre20">

</div>
<p><span id="part0033_split_022.html"></span></p>
<div id="part0033_split_022.html#calibre_pb_45" class="image-p">
<a href="#part0014.html#p0120_02" id="part0033_split_022.html#p0120_02a"
class="calibre6"><img src="images/00281.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_022.html#calibre_pb_46" class="calibre20">

</div>
<p><span id="part0033_split_023.html"></span></p>
<div id="part0033_split_023.html#calibre_pb_47" class="image-p">
<a href="#part0014.html#p0120_03" id="part0033_split_023.html#p0120_03a"
class="calibre6"><img src="images/00282.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_023.html#calibre_pb_48" class="calibre20">

</div>
<p><span id="part0033_split_024.html"></span></p>
<div id="part0033_split_024.html#calibre_pb_49" class="image-p">
<a href="#part0014.html#p0120_04" id="part0033_split_024.html#p0120_04a"
class="calibre6"><img src="images/00283.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_024.html#calibre_pb_50" class="calibre20">

</div>
<p><span id="part0033_split_025.html"></span></p>
<div id="part0033_split_025.html#calibre_pb_51" class="image-p">
<a href="#part0014.html#p0120_05" id="part0033_split_025.html#p0120_05a"
class="calibre6"><img src="images/00284.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_025.html#calibre_pb_52" class="calibre20">

</div>
<p><span id="part0033_split_026.html"></span></p>
<div id="part0033_split_026.html#calibre_pb_53" class="image-p">
<a href="#part0014.html#p0120_06" id="part0033_split_026.html#p0120_06a"
class="calibre6"><img src="images/00285.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_026.html#calibre_pb_54" class="calibre20">

</div>
<p><span id="part0033_split_027.html"></span></p>
<div id="part0033_split_027.html#calibre_pb_55" class="image-p">
<a href="#part0014.html#p0121_01" id="part0033_split_027.html#p0121_01a"
class="calibre6"><img src="images/00286.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0033_split_027.html#calibre_pb_56" class="calibre20">

</div>
<p><span id="part0033_split_028.html"></span></p>
<div id="part0033_split_028.html#calibre_pb_57" class="image-p">
<a href="#part0014.html#p0121_02" id="part0033_split_028.html#p0121_02a"
class="calibre6"><img src="images/00287.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0034_split_000.html"></span></p>
<div id="part0034_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0015.html#p0125_01" id="part0034_split_000.html#p0125_01a"
class="calibre6"><img src="images/00288.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0034_split_001.html"></span></p>
<div id="part0034_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0015.html#p0125_02" id="part0034_split_001.html#p0125_02a"
class="calibre6"><img src="images/00289.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0034_split_002.html"></span></p>
<div id="part0034_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0015.html#p0125_03" id="part0034_split_002.html#p0125_03a"
class="calibre6"><img src="images/00290.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0034_split_003.html"></span></p>
<div id="part0034_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0015.html#p0125_04" id="part0034_split_003.html#p0125_04a"
class="calibre6"><img src="images/00291.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_003.html#calibre_pb_8" class="calibre20">

</div>
<p><span id="part0034_split_004.html"></span></p>
<div id="part0034_split_004.html#calibre_pb_9" class="image-p">
<a href="#part0015.html#p0126_01" id="part0034_split_004.html#p0126_01a"
class="calibre6"><img src="images/00292.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_004.html#calibre_pb_10" class="calibre20">

</div>
<p><span id="part0034_split_005.html"></span></p>
<div id="part0034_split_005.html#calibre_pb_11" class="image-p">
<a href="#part0015.html#p0126_02" id="part0034_split_005.html#p0126_02a"
class="calibre6"><img src="images/00293.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_005.html#calibre_pb_12" class="calibre20">

</div>
<p><span id="part0034_split_006.html"></span></p>
<div id="part0034_split_006.html#calibre_pb_13" class="image-p">
<a href="#part0015.html#p0126_03" id="part0034_split_006.html#p0126_03a"
class="calibre6"><img src="images/00294.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_006.html#calibre_pb_14" class="calibre20">

</div>
<p><span id="part0034_split_007.html"></span></p>
<div id="part0034_split_007.html#calibre_pb_15" class="image-p">
<a href="#part0015.html#p0127_01" id="part0034_split_007.html#p0127_01a"
class="calibre6"><img src="images/00295.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_007.html#calibre_pb_16" class="calibre20">

</div>
<p><span id="part0034_split_008.html"></span></p>
<div id="part0034_split_008.html#calibre_pb_17" class="image-p">
<a href="#part0015.html#p0127_02" id="part0034_split_008.html#p0127_02a"
class="calibre6"><img src="images/00296.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_008.html#calibre_pb_18" class="calibre20">

</div>
<p><span id="part0034_split_009.html"></span></p>
<div id="part0034_split_009.html#calibre_pb_19" class="image-p">
<a href="#part0015.html#p0128_01" id="part0034_split_009.html#p0128_01a"
class="calibre6"><img src="images/00297.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_009.html#calibre_pb_20" class="calibre20">

</div>
<p><span id="part0034_split_010.html"></span></p>
<div id="part0034_split_010.html#calibre_pb_21" class="image-p">
<a href="#part0015.html#p0128_02" id="part0034_split_010.html#p0128_02a"
class="calibre6"><img src="images/00298.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_010.html#calibre_pb_22" class="calibre20">

</div>
<p><span id="part0034_split_011.html"></span></p>
<div id="part0034_split_011.html#calibre_pb_23" class="image-p">
<a href="#part0015.html#p0128_03" id="part0034_split_011.html#p0128_03a"
class="calibre6"><img src="images/00299.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_011.html#calibre_pb_24" class="calibre20">

</div>
<p><span id="part0034_split_012.html"></span></p>
<div id="part0034_split_012.html#calibre_pb_25" class="image-p">
<a href="#part0015.html#p0129_01" id="part0034_split_012.html#p0129_01a"
class="calibre6"><img src="images/00300.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_012.html#calibre_pb_26" class="calibre20">

</div>
<p><span id="part0034_split_013.html"></span></p>
<div id="part0034_split_013.html#calibre_pb_27" class="image-p">
<a href="#part0015.html#p0129_02" id="part0034_split_013.html#p0129_02a"
class="calibre6"><img src="images/00301.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_013.html#calibre_pb_28" class="calibre20">

</div>
<p><span id="part0034_split_014.html"></span></p>
<div id="part0034_split_014.html#calibre_pb_29" class="image-p">
<a href="#part0015.html#p0129_03" id="part0034_split_014.html#p0129_03a"
class="calibre6"><img src="images/00302.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_014.html#calibre_pb_30" class="calibre20">

</div>
<p><span id="part0034_split_015.html"></span></p>
<div id="part0034_split_015.html#calibre_pb_31" class="image-p">
<a href="#part0015.html#p0129_04" id="part0034_split_015.html#p0129_04a"
class="calibre6"><img src="images/00303.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_015.html#calibre_pb_32" class="calibre20">

</div>
<p><span id="part0034_split_016.html"></span></p>
<div id="part0034_split_016.html#calibre_pb_33" class="image-p">
<a href="#part0015.html#p0129_05" id="part0034_split_016.html#p0129_05a"
class="calibre6"><img src="images/00304.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_016.html#calibre_pb_34" class="calibre20">

</div>
<p><span id="part0034_split_017.html"></span></p>
<div id="part0034_split_017.html#calibre_pb_35" class="image-p">
<a href="#part0015.html#p0129_06" id="part0034_split_017.html#p0129_06a"
class="calibre6"><img src="images/00305.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_017.html#calibre_pb_36" class="calibre20">

</div>
<p><span id="part0034_split_018.html"></span></p>
<div id="part0034_split_018.html#calibre_pb_37" class="image-p">
<a href="#part0015.html#p0130_01" id="part0034_split_018.html#p0130_01a"
class="calibre6"><img src="images/00306.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_018.html#calibre_pb_38" class="calibre20">

</div>
<p><span id="part0034_split_019.html"></span></p>
<div id="part0034_split_019.html#calibre_pb_39" class="image-p">
<a href="#part0015.html#p0130_02" id="part0034_split_019.html#p0130_02a"
class="calibre6"><img src="images/00307.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_019.html#calibre_pb_40" class="calibre20">

</div>
<p><span id="part0034_split_020.html"></span></p>
<div id="part0034_split_020.html#calibre_pb_41" class="image-p">
<a href="#part0015.html#p0130_03" id="part0034_split_020.html#p0130_03a"
class="calibre6"><img src="images/00308.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_020.html#calibre_pb_42" class="calibre20">

</div>
<p><span id="part0034_split_021.html"></span></p>
<div id="part0034_split_021.html#calibre_pb_43" class="image-p">
<a href="#part0015.html#p0130_04" id="part0034_split_021.html#p0130_04a"
class="calibre6"><img src="images/00309.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_021.html#calibre_pb_44" class="calibre20">

</div>
<p><span id="part0034_split_022.html"></span></p>
<div id="part0034_split_022.html#calibre_pb_45" class="image-p">
<a href="#part0015.html#p0131_01" id="part0034_split_022.html#p0131_01a"
class="calibre6"><img src="images/00310.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_022.html#calibre_pb_46" class="calibre20">

</div>
<p><span id="part0034_split_023.html"></span></p>
<div id="part0034_split_023.html#calibre_pb_47" class="image-p">
<a href="#part0015.html#p0131_02" id="part0034_split_023.html#p0131_02a"
class="calibre6"><img src="images/00311.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_023.html#calibre_pb_48" class="calibre20">

</div>
<p><span id="part0034_split_024.html"></span></p>
<div id="part0034_split_024.html#calibre_pb_49" class="image-p">
<a href="#part0015.html#p0131_03" id="part0034_split_024.html#p0131_03a"
class="calibre6"><img src="images/00312.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_024.html#calibre_pb_50" class="calibre20">

</div>
<p><span id="part0034_split_025.html"></span></p>
<div id="part0034_split_025.html#calibre_pb_51" class="image-p">
<a href="#part0015.html#p0132_01" id="part0034_split_025.html#p0132_01a"
class="calibre6"><img src="images/00313.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_025.html#calibre_pb_52" class="calibre20">

</div>
<p><span id="part0034_split_026.html"></span></p>
<div id="part0034_split_026.html#calibre_pb_53" class="image-p">
<a href="#part0015.html#p0132_02" id="part0034_split_026.html#p0132_02a"
class="calibre6"><img src="images/00314.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_026.html#calibre_pb_54" class="calibre20">

</div>
<p><span id="part0034_split_027.html"></span></p>
<div id="part0034_split_027.html#calibre_pb_55" class="image-p">
<a href="#part0015.html#p0132_03" id="part0034_split_027.html#p0132_03a"
class="calibre6"><img src="images/00315.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_027.html#calibre_pb_56" class="calibre20">

</div>
<p><span id="part0034_split_028.html"></span></p>
<div id="part0034_split_028.html#calibre_pb_57" class="image-p">
<a href="#part0015.html#p0133_01" id="part0034_split_028.html#p0133_01a"
class="calibre6"><img src="images/00316.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_028.html#calibre_pb_58" class="calibre20">

</div>
<p><span id="part0034_split_029.html"></span></p>
<div id="part0034_split_029.html#calibre_pb_59" class="image-p">
<a href="#part0015.html#p0133_02" id="part0034_split_029.html#p0133_02a"
class="calibre6"><img src="images/00317.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_029.html#calibre_pb_60" class="calibre20">

</div>
<p><span id="part0034_split_030.html"></span></p>
<div id="part0034_split_030.html#calibre_pb_61" class="image-p">
<a href="#part0015.html#p0133_03" id="part0034_split_030.html#p0133_03a"
class="calibre6"><img src="images/00318.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0034_split_030.html#calibre_pb_62" class="calibre20">

</div>
<p><span id="part0034_split_031.html"></span></p>
<div id="part0034_split_031.html#calibre_pb_63" class="image-p">
<a href="#part0015.html#p0134_01" id="part0034_split_031.html#p0134_01a"
class="calibre6"><img src="images/00319.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0035_split_000.html"></span></p>
<div id="part0035_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0016.html#p0138_01" id="part0035_split_000.html#p0138_01a"
class="calibre6"><img src="images/00320.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0035_split_001.html"></span></p>
<div id="part0035_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0016.html#p0138_02" id="part0035_split_001.html#p0138_02a"
class="calibre6"><img src="images/00321.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0035_split_002.html"></span></p>
<div id="part0035_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0016.html#p0138_03" id="part0035_split_002.html#p0138_03a"
class="calibre6"><img src="images/00322.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0035_split_003.html"></span></p>
<div id="part0035_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0016.html#p0138_04" id="part0035_split_003.html#p0138_04a"
class="calibre6"><img src="images/00323.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_003.html#calibre_pb_8" class="calibre20">

</div>
<p><span id="part0035_split_004.html"></span></p>
<div id="part0035_split_004.html#calibre_pb_9" class="image-p">
<a href="#part0016.html#p0139_01" id="part0035_split_004.html#p0139_01a"
class="calibre6"><img src="images/00324.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_004.html#calibre_pb_10" class="calibre20">

</div>
<p><span id="part0035_split_005.html"></span></p>
<div id="part0035_split_005.html#calibre_pb_11" class="image-p">
<a href="#part0016.html#p0139_02" id="part0035_split_005.html#p0139_02a"
class="calibre6"><img src="images/00325.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_005.html#calibre_pb_12" class="calibre20">

</div>
<p><span id="part0035_split_006.html"></span></p>
<div id="part0035_split_006.html#calibre_pb_13" class="image-p">
<a href="#part0016.html#p0139_03" id="part0035_split_006.html#p0139_03a"
class="calibre6"><img src="images/00326.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_006.html#calibre_pb_14" class="calibre20">

</div>
<p><span id="part0035_split_007.html"></span></p>
<div id="part0035_split_007.html#calibre_pb_15" class="image-p">
<a href="#part0016.html#p0140_01" id="part0035_split_007.html#p0140_01a"
class="calibre6"><img src="images/00327.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_007.html#calibre_pb_16" class="calibre20">

</div>
<p><span id="part0035_split_008.html"></span></p>
<div id="part0035_split_008.html#calibre_pb_17" class="image-p">
<a href="#part0016.html#p0140_02" id="part0035_split_008.html#p0140_02a"
class="calibre6"><img src="images/00328.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_008.html#calibre_pb_18" class="calibre20">

</div>
<p><span id="part0035_split_009.html"></span></p>
<div id="part0035_split_009.html#calibre_pb_19" class="image-p">
<a href="#part0016.html#p0140_03" id="part0035_split_009.html#p0140_03a"
class="calibre6"><img src="images/00329.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_009.html#calibre_pb_20" class="calibre20">

</div>
<p><span id="part0035_split_010.html"></span></p>
<div id="part0035_split_010.html#calibre_pb_21" class="image-p">
<a href="#part0016.html#p0141_01" id="part0035_split_010.html#p0141_01a"
class="calibre6"><img src="images/00330.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_010.html#calibre_pb_22" class="calibre20">

</div>
<p><span id="part0035_split_011.html"></span></p>
<div id="part0035_split_011.html#calibre_pb_23" class="image-p">
<a href="#part0016.html#p0141_02" id="part0035_split_011.html#p0141_02a"
class="calibre6"><img src="images/00331.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_011.html#calibre_pb_24" class="calibre20">

</div>
<p><span id="part0035_split_012.html"></span></p>
<div id="part0035_split_012.html#calibre_pb_25" class="image-p">
<a href="#part0016.html#p0141_03" id="part0035_split_012.html#p0141_03a"
class="calibre6"><img src="images/00332.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_012.html#calibre_pb_26" class="calibre20">

</div>
<p><span id="part0035_split_013.html"></span></p>
<div id="part0035_split_013.html#calibre_pb_27" class="image-p">
<a href="#part0016.html#p0142_01" id="part0035_split_013.html#p0142_01a"
class="calibre6"><img src="images/00333.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_013.html#calibre_pb_28" class="calibre20">

</div>
<p><span id="part0035_split_014.html"></span></p>
<div id="part0035_split_014.html#calibre_pb_29" class="image-p">
<a href="#part0016.html#p0142_02" id="part0035_split_014.html#p0142_02a"
class="calibre6"><img src="images/00334.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_014.html#calibre_pb_30" class="calibre20">

</div>
<p><span id="part0035_split_015.html"></span></p>
<div id="part0035_split_015.html#calibre_pb_31" class="image-p">
<a href="#part0016.html#p0143_01" id="part0035_split_015.html#p0143_01a"
class="calibre6"><img src="images/00335.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_015.html#calibre_pb_32" class="calibre20">

</div>
<p><span id="part0035_split_016.html"></span></p>
<div id="part0035_split_016.html#calibre_pb_33" class="image-p">
<a href="#part0016.html#p0143_02" id="part0035_split_016.html#p0143_02a"
class="calibre6"><img src="images/00336.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_016.html#calibre_pb_34" class="calibre20">

</div>
<p><span id="part0035_split_017.html"></span></p>
<div id="part0035_split_017.html#calibre_pb_35" class="image-p">
<a href="#part0016.html#p0144_01" id="part0035_split_017.html#p0144_01a"
class="calibre6"><img src="images/00337.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_017.html#calibre_pb_36" class="calibre20">

</div>
<p><span id="part0035_split_018.html"></span></p>
<div id="part0035_split_018.html#calibre_pb_37" class="image-p">
<a href="#part0016.html#p0144_02" id="part0035_split_018.html#p0144_02a"
class="calibre6"><img src="images/00338.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_018.html#calibre_pb_38" class="calibre20">

</div>
<p><span id="part0035_split_019.html"></span></p>
<div id="part0035_split_019.html#calibre_pb_39" class="image-p">
<a href="#part0016.html#p0145_01" id="part0035_split_019.html#p0145_01a"
class="calibre6"><img src="images/00339.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_019.html#calibre_pb_40" class="calibre20">

</div>
<p><span id="part0035_split_020.html"></span></p>
<div id="part0035_split_020.html#calibre_pb_41" class="image-p">
<a href="#part0016.html#p0145_02" id="part0035_split_020.html#p0145_02a"
class="calibre6"><img src="images/00340.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_020.html#calibre_pb_42" class="calibre20">

</div>
<p><span id="part0035_split_021.html"></span></p>
<div id="part0035_split_021.html#calibre_pb_43" class="image-p">
<a href="#part0016.html#p0145_03" id="part0035_split_021.html#p0145_03a"
class="calibre6"><img src="images/00341.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_021.html#calibre_pb_44" class="calibre20">

</div>
<p><span id="part0035_split_022.html"></span></p>
<div id="part0035_split_022.html#calibre_pb_45" class="image-p">
<a href="#part0016.html#p0146_01" id="part0035_split_022.html#p0146_01a"
class="calibre6"><img src="images/00342.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0035_split_022.html#calibre_pb_46" class="calibre20">

</div>
<p><span id="part0035_split_023.html"></span></p>
<div id="part0035_split_023.html#calibre_pb_47" class="image-p">
<a href="#part0016.html#p0147_01" id="part0035_split_023.html#p0147_01a"
class="calibre6"><img src="images/00343.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0036_split_000.html"></span></p>
<div id="part0036_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0017.html#p0149_01" id="part0036_split_000.html#p0149_01a"
class="calibre6"><img src="images/00344.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0036_split_001.html"></span></p>
<div id="part0036_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0017.html#p0150_01" id="part0036_split_001.html#p0150_01a"
class="calibre6"><img src="images/00345.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0036_split_002.html"></span></p>
<div id="part0036_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0017.html#p0150_02" id="part0036_split_002.html#p0150_02a"
class="calibre6"><img src="images/00346.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0036_split_003.html"></span></p>
<div id="part0036_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0017.html#p0151_01" id="part0036_split_003.html#p0151_01a"
class="calibre6"><img src="images/00347.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_003.html#calibre_pb_8" class="calibre20">

</div>
<p><span id="part0036_split_004.html"></span></p>
<div id="part0036_split_004.html#calibre_pb_9" class="image-p">
<a href="#part0017.html#p0151_02" id="part0036_split_004.html#p0151_02a"
class="calibre6"><img src="images/00348.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_004.html#calibre_pb_10" class="calibre20">

</div>
<p><span id="part0036_split_005.html"></span></p>
<div id="part0036_split_005.html#calibre_pb_11" class="image-p">
<a href="#part0017.html#p0151_03" id="part0036_split_005.html#p0151_03a"
class="calibre6"><img src="images/00349.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_005.html#calibre_pb_12" class="calibre20">

</div>
<p><span id="part0036_split_006.html"></span></p>
<div id="part0036_split_006.html#calibre_pb_13" class="image-p">
<a href="#part0017.html#p0151_04" id="part0036_split_006.html#p0151_04a"
class="calibre6"><img src="images/00350.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_006.html#calibre_pb_14" class="calibre20">

</div>
<p><span id="part0036_split_007.html"></span></p>
<div id="part0036_split_007.html#calibre_pb_15" class="image-p">
<a href="#part0017.html#p0152_01" id="part0036_split_007.html#p0152_01a"
class="calibre6"><img src="images/00351.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_007.html#calibre_pb_16" class="calibre20">

</div>
<p><span id="part0036_split_008.html"></span></p>
<div id="part0036_split_008.html#calibre_pb_17" class="image-p">
<a href="#part0017.html#p0152_02" id="part0036_split_008.html#p0152_02a"
class="calibre6"><img src="images/00352.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_008.html#calibre_pb_18" class="calibre20">

</div>
<p><span id="part0036_split_009.html"></span></p>
<div id="part0036_split_009.html#calibre_pb_19" class="image-p">
<a href="#part0017.html#p0152_03" id="part0036_split_009.html#p0152_03a"
class="calibre6"><img src="images/00353.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_009.html#calibre_pb_20" class="calibre20">

</div>
<p><span id="part0036_split_010.html"></span></p>
<div id="part0036_split_010.html#calibre_pb_21" class="image-p">
<a href="#part0017.html#p0154_01" id="part0036_split_010.html#p0154_01a"
class="calibre6"><img src="images/00354.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_010.html#calibre_pb_22" class="calibre20">

</div>
<p><span id="part0036_split_011.html"></span></p>
<div id="part0036_split_011.html#calibre_pb_23" class="image-p">
<a href="#part0017.html#p0154_02" id="part0036_split_011.html#p0154_02a"
class="calibre6"><img src="images/00355.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_011.html#calibre_pb_24" class="calibre20">

</div>
<p><span id="part0036_split_012.html"></span></p>
<div id="part0036_split_012.html#calibre_pb_25" class="image-p">
<a href="#part0017.html#p0154_03" id="part0036_split_012.html#p0154_03a"
class="calibre6"><img src="images/00356.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_012.html#calibre_pb_26" class="calibre20">

</div>
<p><span id="part0036_split_013.html"></span></p>
<div id="part0036_split_013.html#calibre_pb_27" class="image-p">
<a href="#part0017.html#p0155_01" id="part0036_split_013.html#p0155_01a"
class="calibre6"><img src="images/00357.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_013.html#calibre_pb_28" class="calibre20">

</div>
<p><span id="part0036_split_014.html"></span></p>
<div id="part0036_split_014.html#calibre_pb_29" class="image-p">
<a href="#part0017.html#p0155_02" id="part0036_split_014.html#p0155_02a"
class="calibre6"><img src="images/00358.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_014.html#calibre_pb_30" class="calibre20">

</div>
<p><span id="part0036_split_015.html"></span></p>
<div id="part0036_split_015.html#calibre_pb_31" class="image-p">
<a href="#part0017.html#p0156_01" id="part0036_split_015.html#p0156_01a"
class="calibre6"><img src="images/00359.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_015.html#calibre_pb_32" class="calibre20">

</div>
<p><span id="part0036_split_016.html"></span></p>
<div id="part0036_split_016.html#calibre_pb_33" class="image-p">
<a href="#part0017.html#p0156_02" id="part0036_split_016.html#p0156_02a"
class="calibre6"><img src="images/00360.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_016.html#calibre_pb_34" class="calibre20">

</div>
<p><span id="part0036_split_017.html"></span></p>
<div id="part0036_split_017.html#calibre_pb_35" class="image-p">
<a href="#part0017.html#p0156_03" id="part0036_split_017.html#p0156_03a"
class="calibre6"><img src="images/00361.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_017.html#calibre_pb_36" class="calibre20">

</div>
<p><span id="part0036_split_018.html"></span></p>
<div id="part0036_split_018.html#calibre_pb_37" class="image-p">
<a href="#part0017.html#p0157_01" id="part0036_split_018.html#p0157_01a"
class="calibre6"><img src="images/00362.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_018.html#calibre_pb_38" class="calibre20">

</div>
<p><span id="part0036_split_019.html"></span></p>
<div id="part0036_split_019.html#calibre_pb_39" class="image-p">
<a href="#part0017.html#p0157_02" id="part0036_split_019.html#p0157_02a"
class="calibre6"><img src="images/00363.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_019.html#calibre_pb_40" class="calibre20">

</div>
<p><span id="part0036_split_020.html"></span></p>
<div id="part0036_split_020.html#calibre_pb_41" class="image-p">
<a href="#part0017.html#p0158_01" id="part0036_split_020.html#p0158_01a"
class="calibre6"><img src="images/00364.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_020.html#calibre_pb_42" class="calibre20">

</div>
<p><span id="part0036_split_021.html"></span></p>
<div id="part0036_split_021.html#calibre_pb_43" class="image-p">
<a href="#part0017.html#p0160_01" id="part0036_split_021.html#p0160_01a"
class="calibre6"><img src="images/00365.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0036_split_021.html#calibre_pb_44" class="calibre20">

</div>
<p><span id="part0036_split_022.html"></span></p>
<div id="part0036_split_022.html#calibre_pb_45" class="image-p">
<a href="#part0017.html#p0161_01" id="part0036_split_022.html#p0161_01a"
class="calibre6"><img src="images/00366.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0037_split_000.html"></span></p>
<div id="part0037_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0018.html#p0164_01" id="part0037_split_000.html#p0164_01a"
class="calibre6"><img src="images/00367.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0037_split_001.html"></span></p>
<div id="part0037_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0018.html#p0164_02" id="part0037_split_001.html#p0164_02a"
class="calibre6"><img src="images/00368.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0037_split_002.html"></span></p>
<div id="part0037_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0018.html#p0165_01" id="part0037_split_002.html#p0165_01a"
class="calibre6"><img src="images/00369.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0037_split_003.html"></span></p>
<div id="part0037_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0018.html#p0165_02" id="part0037_split_003.html#p0165_02a"
class="calibre6"><img src="images/00370.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_003.html#calibre_pb_8" class="calibre20">

</div>
<p><span id="part0037_split_004.html"></span></p>
<div id="part0037_split_004.html#calibre_pb_9" class="image-p">
<a href="#part0018.html#p0165_03" id="part0037_split_004.html#p0165_03a"
class="calibre6"><img src="images/00371.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_004.html#calibre_pb_10" class="calibre20">

</div>
<p><span id="part0037_split_005.html"></span></p>
<div id="part0037_split_005.html#calibre_pb_11" class="image-p">
<a href="#part0018.html#p0166_01" id="part0037_split_005.html#p0166_01a"
class="calibre6"><img src="images/00372.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_005.html#calibre_pb_12" class="calibre20">

</div>
<p><span id="part0037_split_006.html"></span></p>
<div id="part0037_split_006.html#calibre_pb_13" class="image-p">
<a href="#part0018.html#p0167_01" id="part0037_split_006.html#p0167_01a"
class="calibre6"><img src="images/00373.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_006.html#calibre_pb_14" class="calibre20">

</div>
<p><span id="part0037_split_007.html"></span></p>
<div id="part0037_split_007.html#calibre_pb_15" class="image-p">
<a href="#part0018.html#p0167_02" id="part0037_split_007.html#p0167_02a"
class="calibre6"><img src="images/00374.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_007.html#calibre_pb_16" class="calibre20">

</div>
<p><span id="part0037_split_008.html"></span></p>
<div id="part0037_split_008.html#calibre_pb_17" class="image-p">
<a href="#part0018.html#p0167_03" id="part0037_split_008.html#p0167_03a"
class="calibre6"><img src="images/00375.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_008.html#calibre_pb_18" class="calibre20">

</div>
<p><span id="part0037_split_009.html"></span></p>
<div id="part0037_split_009.html#calibre_pb_19" class="image-p">
<a href="#part0018.html#p0167_04" id="part0037_split_009.html#p0167_04a"
class="calibre6"><img src="images/00376.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_009.html#calibre_pb_20" class="calibre20">

</div>
<p><span id="part0037_split_010.html"></span></p>
<div id="part0037_split_010.html#calibre_pb_21" class="image-p">
<a href="#part0018.html#p0167_05" id="part0037_split_010.html#p0167_05a"
class="calibre6"><img src="images/00377.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_010.html#calibre_pb_22" class="calibre20">

</div>
<p><span id="part0037_split_011.html"></span></p>
<div id="part0037_split_011.html#calibre_pb_23" class="image-p">
<a href="#part0018.html#p0168_01" id="part0037_split_011.html#p0168_01a"
class="calibre6"><img src="images/00378.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_011.html#calibre_pb_24" class="calibre20">

</div>
<p><span id="part0037_split_012.html"></span></p>
<div id="part0037_split_012.html#calibre_pb_25" class="image-p">
<a href="#part0018.html#p0169_01" id="part0037_split_012.html#p0169_01a"
class="calibre6"><img src="images/00379.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_012.html#calibre_pb_26" class="calibre20">

</div>
<p><span id="part0037_split_013.html"></span></p>
<div id="part0037_split_013.html#calibre_pb_27" class="image-p">
<a href="#part0018.html#p0169_02" id="part0037_split_013.html#p0169_02a"
class="calibre6"><img src="images/00380.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_013.html#calibre_pb_28" class="calibre20">

</div>
<p><span id="part0037_split_014.html"></span></p>
<div id="part0037_split_014.html#calibre_pb_29" class="image-p">
<a href="#part0018.html#p0169_03" id="part0037_split_014.html#p0169_03a"
class="calibre6"><img src="images/00381.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_014.html#calibre_pb_30" class="calibre20">

</div>
<p><span id="part0037_split_015.html"></span></p>
<div id="part0037_split_015.html#calibre_pb_31" class="image-p">
<a href="#part0018.html#p0169_04" id="part0037_split_015.html#p0169_04a"
class="calibre6"><img src="images/00382.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_015.html#calibre_pb_32" class="calibre20">

</div>
<p><span id="part0037_split_016.html"></span></p>
<div id="part0037_split_016.html#calibre_pb_33" class="image-p">
<a href="#part0018.html#p0169_05" id="part0037_split_016.html#p0169_05a"
class="calibre6"><img src="images/00383.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_016.html#calibre_pb_34" class="calibre20">

</div>
<p><span id="part0037_split_017.html"></span></p>
<div id="part0037_split_017.html#calibre_pb_35" class="image-p">
<a href="#part0018.html#p0171_01" id="part0037_split_017.html#p0171_01a"
class="calibre6"><img src="images/00384.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_017.html#calibre_pb_36" class="calibre20">

</div>
<p><span id="part0037_split_018.html"></span></p>
<div id="part0037_split_018.html#calibre_pb_37" class="image-p">
<a href="#part0018.html#p0171_02" id="part0037_split_018.html#p0171_02a"
class="calibre6"><img src="images/00385.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_018.html#calibre_pb_38" class="calibre20">

</div>
<p><span id="part0037_split_019.html"></span></p>
<div id="part0037_split_019.html#calibre_pb_39" class="image-p">
<a href="#part0018.html#p0171_03" id="part0037_split_019.html#p0171_03a"
class="calibre6"><img src="images/00386.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_019.html#calibre_pb_40" class="calibre20">

</div>
<p><span id="part0037_split_020.html"></span></p>
<div id="part0037_split_020.html#calibre_pb_41" class="image-p">
<a href="#part0018.html#p0171_04" id="part0037_split_020.html#p0171_04a"
class="calibre6"><img src="images/00387.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_020.html#calibre_pb_42" class="calibre20">

</div>
<p><span id="part0037_split_021.html"></span></p>
<div id="part0037_split_021.html#calibre_pb_43" class="image-p">
<a href="#part0018.html#p0172_01" id="part0037_split_021.html#p0172_01a"
class="calibre6"><img src="images/00388.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_021.html#calibre_pb_44" class="calibre20">

</div>
<p><span id="part0037_split_022.html"></span></p>
<div id="part0037_split_022.html#calibre_pb_45" class="image-p">
<a href="#part0018.html#p0172_02" id="part0037_split_022.html#p0172_02a"
class="calibre6"><img src="images/00389.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_022.html#calibre_pb_46" class="calibre20">

</div>
<p><span id="part0037_split_023.html"></span></p>
<div id="part0037_split_023.html#calibre_pb_47" class="image-p">
<a href="#part0018.html#p0172_03" id="part0037_split_023.html#p0172_03a"
class="calibre6"><img src="images/00390.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_023.html#calibre_pb_48" class="calibre20">

</div>
<p><span id="part0037_split_024.html"></span></p>
<div id="part0037_split_024.html#calibre_pb_49" class="image-p">
<a href="#part0018.html#p0172_04" id="part0037_split_024.html#p0172_04a"
class="calibre6"><img src="images/00391.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_024.html#calibre_pb_50" class="calibre20">

</div>
<p><span id="part0037_split_025.html"></span></p>
<div id="part0037_split_025.html#calibre_pb_51" class="image-p">
<a href="#part0018.html#p0173_01" id="part0037_split_025.html#p0173_01a"
class="calibre6"><img src="images/00392.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_025.html#calibre_pb_52" class="calibre20">

</div>
<p><span id="part0037_split_026.html"></span></p>
<div id="part0037_split_026.html#calibre_pb_53" class="image-p">
<a href="#part0018.html#p0173_02" id="part0037_split_026.html#p0173_02a"
class="calibre6"><img src="images/00393.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_026.html#calibre_pb_54" class="calibre20">

</div>
<p><span id="part0037_split_027.html"></span></p>
<div id="part0037_split_027.html#calibre_pb_55" class="image-p">
<a href="#part0018.html#p0173_03" id="part0037_split_027.html#p0173_03a"
class="calibre6"><img src="images/00394.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_027.html#calibre_pb_56" class="calibre20">

</div>
<p><span id="part0037_split_028.html"></span></p>
<div id="part0037_split_028.html#calibre_pb_57" class="image-p">
<a href="#part0018.html#p0173_04" id="part0037_split_028.html#p0173_04a"
class="calibre6"><img src="images/00395.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_028.html#calibre_pb_58" class="calibre20">

</div>
<p><span id="part0037_split_029.html"></span></p>
<div id="part0037_split_029.html#calibre_pb_59" class="image-p">
<a href="#part0018.html#p0174_01" id="part0037_split_029.html#p0174_01a"
class="calibre6"><img src="images/00396.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_029.html#calibre_pb_60" class="calibre20">

</div>
<p><span id="part0037_split_030.html"></span></p>
<div id="part0037_split_030.html#calibre_pb_61" class="image-p">
<a href="#part0018.html#p0174_02" id="part0037_split_030.html#p0174_02a"
class="calibre6"><img src="images/00397.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_030.html#calibre_pb_62" class="calibre20">

</div>
<p><span id="part0037_split_031.html"></span></p>
<div id="part0037_split_031.html#calibre_pb_63" class="image-p">
<a href="#part0018.html#p0174_03" id="part0037_split_031.html#p0174_03a"
class="calibre6"><img src="images/00398.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_031.html#calibre_pb_64" class="calibre20">

</div>
<p><span id="part0037_split_032.html"></span></p>
<div id="part0037_split_032.html#calibre_pb_65" class="image-p">
<a href="#part0018.html#p0174_04" id="part0037_split_032.html#p0174_04a"
class="calibre6"><img src="images/00399.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_032.html#calibre_pb_66" class="calibre20">

</div>
<p><span id="part0037_split_033.html"></span></p>
<div id="part0037_split_033.html#calibre_pb_67" class="image-p">
<a href="#part0018.html#p0174_05" id="part0037_split_033.html#p0174_05a"
class="calibre6"><img src="images/00400.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_033.html#calibre_pb_68" class="calibre20">

</div>
<p><span id="part0037_split_034.html"></span></p>
<div id="part0037_split_034.html#calibre_pb_69" class="image-p">
<a href="#part0018.html#p0175_01" id="part0037_split_034.html#p0175_01a"
class="calibre6"><img src="images/00401.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_034.html#calibre_pb_70" class="calibre20">

</div>
<p><span id="part0037_split_035.html"></span></p>
<div id="part0037_split_035.html#calibre_pb_71" class="image-p">
<a href="#part0018.html#p0175_02" id="part0037_split_035.html#p0175_02a"
class="calibre6"><img src="images/00402.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_035.html#calibre_pb_72" class="calibre20">

</div>
<p><span id="part0037_split_036.html"></span></p>
<div id="part0037_split_036.html#calibre_pb_73" class="image-p">
<a href="#part0018.html#p0175_03" id="part0037_split_036.html#p0175_03a"
class="calibre6"><img src="images/00403.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_036.html#calibre_pb_74" class="calibre20">

</div>
<p><span id="part0037_split_037.html"></span></p>
<div id="part0037_split_037.html#calibre_pb_75" class="image-p">
<a href="#part0018.html#p0176_01" id="part0037_split_037.html#p0176_01a"
class="calibre6"><img src="images/00404.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_037.html#calibre_pb_76" class="calibre20">

</div>
<p><span id="part0037_split_038.html"></span></p>
<div id="part0037_split_038.html#calibre_pb_77" class="image-p">
<a href="#part0018.html#p0176_02" id="part0037_split_038.html#p0176_02a"
class="calibre6"><img src="images/00405.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_038.html#calibre_pb_78" class="calibre20">

</div>
<p><span id="part0037_split_039.html"></span></p>
<div id="part0037_split_039.html#calibre_pb_79" class="image-p">
<a href="#part0018.html#p0176_03" id="part0037_split_039.html#p0176_03a"
class="calibre6"><img src="images/00406.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_039.html#calibre_pb_80" class="calibre20">

</div>
<p><span id="part0037_split_040.html"></span></p>
<div id="part0037_split_040.html#calibre_pb_81" class="image-p">
<a href="#part0018.html#p0177_01" id="part0037_split_040.html#p0177_01a"
class="calibre6"><img src="images/00407.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_040.html#calibre_pb_82" class="calibre20">

</div>
<p><span id="part0037_split_041.html"></span></p>
<div id="part0037_split_041.html#calibre_pb_83" class="image-p">
<a href="#part0018.html#p0177_02" id="part0037_split_041.html#p0177_02a"
class="calibre6"><img src="images/00408.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_041.html#calibre_pb_84" class="calibre20">

</div>
<p><span id="part0037_split_042.html"></span></p>
<div id="part0037_split_042.html#calibre_pb_85" class="image-p">
<a href="#part0018.html#p0177_03" id="part0037_split_042.html#p0177_03a"
class="calibre6"><img src="images/00409.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_042.html#calibre_pb_86" class="calibre20">

</div>
<p><span id="part0037_split_043.html"></span></p>
<div id="part0037_split_043.html#calibre_pb_87" class="image-p">
<a href="#part0018.html#p0177_04" id="part0037_split_043.html#p0177_04a"
class="calibre6"><img src="images/00410.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_043.html#calibre_pb_88" class="calibre20">

</div>
<p><span id="part0037_split_044.html"></span></p>
<div id="part0037_split_044.html#calibre_pb_89" class="image-p">
<a href="#part0018.html#p0178_01" id="part0037_split_044.html#p0178_01a"
class="calibre6"><img src="images/00411.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_044.html#calibre_pb_90" class="calibre20">

</div>
<p><span id="part0037_split_045.html"></span></p>
<div id="part0037_split_045.html#calibre_pb_91" class="image-p">
<a href="#part0018.html#p0178_02" id="part0037_split_045.html#p0178_02a"
class="calibre6"><img src="images/00412.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_045.html#calibre_pb_92" class="calibre20">

</div>
<p><span id="part0037_split_046.html"></span></p>
<div id="part0037_split_046.html#calibre_pb_93" class="image-p">
<a href="#part0018.html#p0179_01" id="part0037_split_046.html#p0179_01a"
class="calibre6"><img src="images/00413.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_046.html#calibre_pb_94" class="calibre20">

</div>
<p><span id="part0037_split_047.html"></span></p>
<div id="part0037_split_047.html#calibre_pb_95" class="image-p">
<a href="#part0018.html#p0179_02" id="part0037_split_047.html#p0179_02a"
class="calibre6"><img src="images/00414.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_047.html#calibre_pb_96" class="calibre20">

</div>
<p><span id="part0037_split_048.html"></span></p>
<div id="part0037_split_048.html#calibre_pb_97" class="image-p">
<a href="#part0018.html#p0179_03" id="part0037_split_048.html#p0179_03a"
class="calibre6"><img src="images/00415.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_048.html#calibre_pb_98" class="calibre20">

</div>
<p><span id="part0037_split_049.html"></span></p>
<div id="part0037_split_049.html#calibre_pb_99" class="image-p">
<a href="#part0018.html#p0180_01" id="part0037_split_049.html#p0180_01a"
class="calibre6"><img src="images/00416.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_049.html#calibre_pb_100" class="calibre20">

</div>
<p><span id="part0037_split_050.html"></span></p>
<div id="part0037_split_050.html#calibre_pb_101" class="image-p">
<a href="#part0018.html#p0180_02" id="part0037_split_050.html#p0180_02a"
class="calibre6"><img src="images/00417.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_050.html#calibre_pb_102" class="calibre20">

</div>
<p><span id="part0037_split_051.html"></span></p>
<div id="part0037_split_051.html#calibre_pb_103" class="image-p">
<a href="#part0018.html#p0180_03" id="part0037_split_051.html#p0180_03a"
class="calibre6"><img src="images/00418.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_051.html#calibre_pb_104" class="calibre20">

</div>
<p><span id="part0037_split_052.html"></span></p>
<div id="part0037_split_052.html#calibre_pb_105" class="image-p">
<a href="#part0018.html#p0181_01" id="part0037_split_052.html#p0181_01a"
class="calibre6"><img src="images/00419.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_052.html#calibre_pb_106" class="calibre20">

</div>
<p><span id="part0037_split_053.html"></span></p>
<div id="part0037_split_053.html#calibre_pb_107" class="image-p">
<a href="#part0018.html#p0181_02" id="part0037_split_053.html#p0181_02a"
class="calibre6"><img src="images/00420.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_053.html#calibre_pb_108" class="calibre20">

</div>
<p><span id="part0037_split_054.html"></span></p>
<div id="part0037_split_054.html#calibre_pb_109" class="image-p">
<a href="#part0018.html#p0181_03" id="part0037_split_054.html#p0181_03a"
class="calibre6"><img src="images/00421.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_054.html#calibre_pb_110" class="calibre20">

</div>
<p><span id="part0037_split_055.html"></span></p>
<div id="part0037_split_055.html#calibre_pb_111" class="image-p">
<a href="#part0018.html#p0182_01" id="part0037_split_055.html#p0182_01a"
class="calibre6"><img src="images/00422.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_055.html#calibre_pb_112" class="calibre20">

</div>
<p><span id="part0037_split_056.html"></span></p>
<div id="part0037_split_056.html#calibre_pb_113" class="image-p">
<a href="#part0018.html#p0182_02" id="part0037_split_056.html#p0182_02a"
class="calibre6"><img src="images/00423.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_056.html#calibre_pb_114" class="calibre20">

</div>
<p><span id="part0037_split_057.html"></span></p>
<div id="part0037_split_057.html#calibre_pb_115" class="image-p">
<a href="#part0018.html#p0182_03" id="part0037_split_057.html#p0182_03a"
class="calibre6"><img src="images/00424.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_057.html#calibre_pb_116" class="calibre20">

</div>
<p><span id="part0037_split_058.html"></span></p>
<div id="part0037_split_058.html#calibre_pb_117" class="image-p">
<a href="#part0018.html#p0182_04" id="part0037_split_058.html#p0182_04a"
class="calibre6"><img src="images/00425.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_058.html#calibre_pb_118" class="calibre20">

</div>
<p><span id="part0037_split_059.html"></span></p>
<div id="part0037_split_059.html#calibre_pb_119" class="image-p">
<a href="#part0018.html#p0182_05" id="part0037_split_059.html#p0182_05a"
class="calibre6"><img src="images/00426.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_059.html#calibre_pb_120" class="calibre20">

</div>
<p><span id="part0037_split_060.html"></span></p>
<div id="part0037_split_060.html#calibre_pb_121" class="image-p">
<a href="#part0018.html#p0183_01" id="part0037_split_060.html#p0183_01a"
class="calibre6"><img src="images/00427.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_060.html#calibre_pb_122" class="calibre20">

</div>
<p><span id="part0037_split_061.html"></span></p>
<div id="part0037_split_061.html#calibre_pb_123" class="image-p">
<a href="#part0018.html#p0183_02" id="part0037_split_061.html#p0183_02a"
class="calibre6"><img src="images/00428.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_061.html#calibre_pb_124" class="calibre20">

</div>
<p><span id="part0037_split_062.html"></span></p>
<div id="part0037_split_062.html#calibre_pb_125" class="image-p">
<a href="#part0018.html#p0183_03" id="part0037_split_062.html#p0183_03a"
class="calibre6"><img src="images/00429.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_062.html#calibre_pb_126" class="calibre20">

</div>
<p><span id="part0037_split_063.html"></span></p>
<div id="part0037_split_063.html#calibre_pb_127" class="image-p">
<a href="#part0018.html#p0183_04" id="part0037_split_063.html#p0183_04a"
class="calibre6"><img src="images/00430.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_063.html#calibre_pb_128" class="calibre20">

</div>
<p><span id="part0037_split_064.html"></span></p>
<div id="part0037_split_064.html#calibre_pb_129" class="image-p">
<a href="#part0018.html#p0184_01" id="part0037_split_064.html#p0184_01a"
class="calibre6"><img src="images/00431.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_064.html#calibre_pb_130" class="calibre20">

</div>
<p><span id="part0037_split_065.html"></span></p>
<div id="part0037_split_065.html#calibre_pb_131" class="image-p">
<a href="#part0018.html#p0184_02" id="part0037_split_065.html#p0184_02a"
class="calibre6"><img src="images/00432.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_065.html#calibre_pb_132" class="calibre20">

</div>
<p><span id="part0037_split_066.html"></span></p>
<div id="part0037_split_066.html#calibre_pb_133" class="image-p">
<a href="#part0018.html#p0184_03" id="part0037_split_066.html#p0184_03a"
class="calibre6"><img src="images/00433.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0037_split_066.html#calibre_pb_134" class="calibre20">

</div>
<p><span id="part0037_split_067.html"></span></p>
<div id="part0037_split_067.html#calibre_pb_135" class="image-p">
<a href="#part0018.html#p0184_04" id="part0037_split_067.html#p0184_04a"
class="calibre6"><img src="images/00434.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0038_split_000.html"></span></p>
<div id="part0038_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0019.html#p0188_01" id="part0038_split_000.html#p0188_01a"
class="calibre6"><img src="images/00435.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0038_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0038_split_001.html"></span></p>
<div id="part0038_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0019.html#p0189_01" id="part0038_split_001.html#p0189_01a"
class="calibre6"><img src="images/00436.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0038_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0038_split_002.html"></span></p>
<div id="part0038_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0019.html#p0190_01" id="part0038_split_002.html#p0190_01a"
class="calibre6"><img src="images/00437.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0038_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0038_split_003.html"></span></p>
<div id="part0038_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0019.html#p0190_02" id="part0038_split_003.html#p0190_02a"
class="calibre6"><img src="images/00438.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0038_split_003.html#calibre_pb_8" class="calibre20">

</div>
<p><span id="part0038_split_004.html"></span></p>
<div id="part0038_split_004.html#calibre_pb_9" class="image-p">
<a href="#part0019.html#p0190_03" id="part0038_split_004.html#p0190_03a"
class="calibre6"><img src="images/00439.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0038_split_004.html#calibre_pb_10" class="calibre20">

</div>
<p><span id="part0038_split_005.html"></span></p>
<div id="part0038_split_005.html#calibre_pb_11" class="image-p">
<a href="#part0019.html#p0191_01" id="part0038_split_005.html#p0191_01a"
class="calibre6"><img src="images/00440.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0038_split_005.html#calibre_pb_12" class="calibre20">

</div>
<p><span id="part0038_split_006.html"></span></p>
<div id="part0038_split_006.html#calibre_pb_13" class="image-p">
<a href="#part0019.html#p0191_02" id="part0038_split_006.html#p0191_02a"
class="calibre6"><img src="images/00441.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0038_split_006.html#calibre_pb_14" class="calibre20">

</div>
<p><span id="part0038_split_007.html"></span></p>
<div id="part0038_split_007.html#calibre_pb_15" class="image-p">
<a href="#part0019.html#p0191_03" id="part0038_split_007.html#p0191_03a"
class="calibre6"><img src="images/00442.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0038_split_007.html#calibre_pb_16" class="calibre20">

</div>
<p><span id="part0038_split_008.html"></span></p>
<div id="part0038_split_008.html#calibre_pb_17" class="image-p">
<a href="#part0019.html#p0192_01" id="part0038_split_008.html#p0192_01a"
class="calibre6"><img src="images/00443.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0038_split_008.html#calibre_pb_18" class="calibre20">

</div>
<p><span id="part0038_split_009.html"></span></p>
<div id="part0038_split_009.html#calibre_pb_19" class="image-p">
<a href="#part0019.html#p0192_02" id="part0038_split_009.html#p0192_02a"
class="calibre6"><img src="images/00444.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0038_split_009.html#calibre_pb_20" class="calibre20">

</div>
<p><span id="part0038_split_010.html"></span></p>
<div id="part0038_split_010.html#calibre_pb_21" class="image-p">
<a href="#part0019.html#p0192_03" id="part0038_split_010.html#p0192_03a"
class="calibre6"><img src="images/00445.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0038_split_010.html#calibre_pb_22" class="calibre20">

</div>
<p><span id="part0038_split_011.html"></span></p>
<div id="part0038_split_011.html#calibre_pb_23" class="image-p">
<a href="#part0019.html#p0193_01" id="part0038_split_011.html#p0193_01a"
class="calibre6"><img src="images/00446.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0038_split_011.html#calibre_pb_24" class="calibre20">

</div>
<p><span id="part0038_split_012.html"></span></p>
<div id="part0038_split_012.html#calibre_pb_25" class="image-p">
<a href="#part0019.html#p0193_02" id="part0038_split_012.html#p0193_02a"
class="calibre6"><img src="images/00447.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0039_split_000.html"></span></p>
<div id="part0039_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0020.html#p0196_01" id="part0039_split_000.html#p0196_01a"
class="calibre6"><img src="images/00448.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0039_split_001.html"></span></p>
<div id="part0039_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0020.html#p0196_02" id="part0039_split_001.html#p0196_02a"
class="calibre6"><img src="images/00449.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0039_split_002.html"></span></p>
<div id="part0039_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0020.html#p0197_01" id="part0039_split_002.html#p0197_01a"
class="calibre6"><img src="images/00450.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0039_split_003.html"></span></p>
<div id="part0039_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0020.html#p0198_01" id="part0039_split_003.html#p0198_01a"
class="calibre6"><img src="images/00451.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_003.html#calibre_pb_8" class="calibre20">

</div>
<p><span id="part0039_split_004.html"></span></p>
<div id="part0039_split_004.html#calibre_pb_9" class="image-p">
<a href="#part0020.html#p0199_01" id="part0039_split_004.html#p0199_01a"
class="calibre6"><img src="images/00452.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_004.html#calibre_pb_10" class="calibre20">

</div>
<p><span id="part0039_split_005.html"></span></p>
<div id="part0039_split_005.html#calibre_pb_11" class="image-p">
<a href="#part0020.html#p0199_02" id="part0039_split_005.html#p0199_02a"
class="calibre6"><img src="images/00453.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_005.html#calibre_pb_12" class="calibre20">

</div>
<p><span id="part0039_split_006.html"></span></p>
<div id="part0039_split_006.html#calibre_pb_13" class="image-p">
<a href="#part0020.html#p0199_03" id="part0039_split_006.html#p0199_03a"
class="calibre6"><img src="images/00454.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_006.html#calibre_pb_14" class="calibre20">

</div>
<p><span id="part0039_split_007.html"></span></p>
<div id="part0039_split_007.html#calibre_pb_15" class="image-p">
<a href="#part0020.html#p0200_01" id="part0039_split_007.html#p0200_01a"
class="calibre6"><img src="images/00455.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_007.html#calibre_pb_16" class="calibre20">

</div>
<p><span id="part0039_split_008.html"></span></p>
<div id="part0039_split_008.html#calibre_pb_17" class="image-p">
<a href="#part0020.html#p0200_02" id="part0039_split_008.html#p0200_02a"
class="calibre6"><img src="images/00456.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_008.html#calibre_pb_18" class="calibre20">

</div>
<p><span id="part0039_split_009.html"></span></p>
<div id="part0039_split_009.html#calibre_pb_19" class="image-p">
<a href="#part0020.html#p0201_01" id="part0039_split_009.html#p0201_01a"
class="calibre6"><img src="images/00457.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_009.html#calibre_pb_20" class="calibre20">

</div>
<p><span id="part0039_split_010.html"></span></p>
<div id="part0039_split_010.html#calibre_pb_21" class="image-p">
<a href="#part0020.html#p0201_02" id="part0039_split_010.html#p0201_02a"
class="calibre6"><img src="images/00458.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_010.html#calibre_pb_22" class="calibre20">

</div>
<p><span id="part0039_split_011.html"></span></p>
<div id="part0039_split_011.html#calibre_pb_23" class="image-p">
<a href="#part0020.html#p0202_01" id="part0039_split_011.html#p0202_01a"
class="calibre6"><img src="images/00459.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_011.html#calibre_pb_24" class="calibre20">

</div>
<p><span id="part0039_split_012.html"></span></p>
<div id="part0039_split_012.html#calibre_pb_25" class="image-p">
<a href="#part0020.html#p0202_02" id="part0039_split_012.html#p0202_02a"
class="calibre6"><img src="images/00460.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_012.html#calibre_pb_26" class="calibre20">

</div>
<p><span id="part0039_split_013.html"></span></p>
<div id="part0039_split_013.html#calibre_pb_27" class="image-p">
<a href="#part0020.html#p0203_01" id="part0039_split_013.html#p0203_01a"
class="calibre6"><img src="images/00461.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_013.html#calibre_pb_28" class="calibre20">

</div>
<p><span id="part0039_split_014.html"></span></p>
<div id="part0039_split_014.html#calibre_pb_29" class="image-p">
<a href="#part0020.html#p0203_02" id="part0039_split_014.html#p0203_02a"
class="calibre6"><img src="images/00462.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_014.html#calibre_pb_30" class="calibre20">

</div>
<p><span id="part0039_split_015.html"></span></p>
<div id="part0039_split_015.html#calibre_pb_31" class="image-p">
<a href="#part0020.html#p0203_03" id="part0039_split_015.html#p0203_03a"
class="calibre6"><img src="images/00463.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_015.html#calibre_pb_32" class="calibre20">

</div>
<p><span id="part0039_split_016.html"></span></p>
<div id="part0039_split_016.html#calibre_pb_33" class="image-p">
<a href="#part0020.html#p0204_01" id="part0039_split_016.html#p0204_01a"
class="calibre6"><img src="images/00464.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0039_split_016.html#calibre_pb_34" class="calibre20">

</div>
<p><span id="part0039_split_017.html"></span></p>
<div id="part0039_split_017.html#calibre_pb_35" class="image-p">
<a href="#part0020.html#p0205_01" id="part0039_split_017.html#p0205_01a"
class="calibre6"><img src="images/00465.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<p><span id="part0040_split_000.html"></span></p>
<div id="part0040_split_000.html#calibre_pb_1" class="image-p">
<a href="#part0021.html#p0218_01" id="part0040_split_000.html#p0218_01a"
class="calibre6"><img src="images/00466.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0040_split_000.html#calibre_pb_2" class="calibre20">

</div>
<p><span id="part0040_split_001.html"></span></p>
<div id="part0040_split_001.html#calibre_pb_3" class="image-p">
<a href="#part0021.html#p0221_01" id="part0040_split_001.html#p0221_01a"
class="calibre6"><img src="images/00467.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0040_split_001.html#calibre_pb_4" class="calibre20">

</div>
<p><span id="part0040_split_002.html"></span></p>
<div id="part0040_split_002.html#calibre_pb_5" class="image-p">
<a href="#part0021.html#p0221_02" id="part0040_split_002.html#p0221_02a"
class="calibre6"><img src="images/00468.jpeg" class="calibre21"
alt="Image" /></a>
</div>
<div id="part0040_split_002.html#calibre_pb_6" class="calibre20">

</div>
<p><span id="part0040_split_003.html"></span></p>
<div id="part0040_split_003.html#calibre_pb_7" class="image-p">
<a href="#part0021.html#p0221_03" id="part0040_split_003.html#p0221_03a"
class="calibre6"><img src="images/00469.jpeg" class="calibre21"
alt="Image" /></a>
</div>
</body>
</html>
